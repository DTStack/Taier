<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dtstack.batch.dao.BatchDataSourceCenterDao">

    <sql id="select_content_fragment">
        id, project_id, tenant_id, create_user_id, modify_user_id, gmt_create, gmt_modified, is_deleted, is_default, dt_center_source_id
    </sql>

    <select id="getSourceCenterByCenterId" resultType="com.dtstack.batch.domain.BatchDataSourceCenter">
        SELECT
        <include refid="select_content_fragment" />
        FROM rdos_batch_data_source_center
        WHERE id = #{id} AND is_deleted = 0
    </select>

    <update id="deleteByProjectId">
        UPDATE rdos_batch_data_source_center
        SET is_deleted = 1, gmt_modified = now(), modify_user_id = #{userId}
        WHERE project_id = #{projectId} AND is_deleted = 0;
    </update>

    <update id="deleteById">
        UPDATE rdos_batch_data_source_center
        SET is_deleted = 1, gmt_modified = now(), modify_user_id = #{userId}
        WHERE id = #{sourceId} AND is_deleted = 0
    </update>

    <insert id="insertDataSource" parameterType="com.dtstack.batch.domain.BatchDataSourceCenter" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO rdos_batch_data_source_center
        (project_id, tenant_id, create_user_id, modify_user_id, gmt_create, gmt_modified, is_deleted, is_default, dt_center_source_id)
        VALUES
        (#{projectId}, #{tenantId}, #{createUserId}, #{createUserId}, now(), now(), 0, #{isDefault}, #{dtCenterSourceId})
    </insert>

    <select id="getInfoIdByCenterId" resultType="java.lang.Long">
        select dt_center_source_id from rdos_batch_data_source_center
        where is_deleted = 0 and id = #{sourceId}
    </select>

    <select id="getInfoIdsByCenterIds" resultType="java.lang.Long">
        select dt_center_source_id from rdos_batch_data_source_center
        where is_deleted = 0
        and id in
        <foreach collection="sourceIds" item="id" open="(" separator="," close=")" >
            id = #{id}
        </foreach>
    </select>

    <select id="getInfoIdsByProject" resultType="com.dtstack.batch.domain.BatchDataSourceCenter">
        select
        <include refid="select_content_fragment" />
        from rdos_batch_data_source_center
        where is_deleted = 0 and project_id = #{projectId}
    </select>

    <select id="getDataSourceCenterByInfoId" resultType="com.dtstack.batch.domain.BatchDataSourceCenter">
        SELECT
        <include refid="select_content_fragment" />
        FROM rdos_batch_data_source_center
        WHERE dt_center_source_id = #{infoId} and project_id = #{projectId} AND is_deleted = 0
        limit 1
    </select>

    <select id="getAllDataSourceCenterList" resultType="com.dtstack.batch.domain.BatchDataSourceCenter">
        select <include refid="select_content_fragment" />
        from rdos_batch_data_source_center
        where is_deleted = 0
    </select>

    <select id="getListByTenantId" resultType="com.dtstack.batch.domain.BatchDataSourceCenter">
        select <include refid="select_content_fragment" />
        from rdos_batch_data_source_center
        where is_deleted = 0 and tenant_id = #{tenantId}
    </select>

    <select id="getDataSourceCenterByInfoIds" resultType="com.dtstack.batch.domain.BatchDataSourceCenter">
        select <include refid="select_content_fragment" />
        from rdos_batch_data_source_center
        where is_deleted = 0 and project_id = #{projectId}
        and dt_center_source_id in
        <foreach collection="infoIdList" item="infoId" open="(" separator="," close=")">
            #{infoId}
        </foreach>
    </select>

    <select id="getDefaultDataSourceCenterByProjectId" resultType="com.dtstack.batch.domain.BatchDataSourceCenter">
        select <include refid="select_content_fragment" />
        from rdos_batch_data_source_center
        where is_deleted = 0 and project_id = #{projectId} and is_default = 1
    </select>

    <select id="getDefaultDataSourceCenterByDataInfoId" resultType="com.dtstack.batch.domain.BatchDataSourceCenter">
        select <include refid="select_content_fragment" />
        from rdos_batch_data_source_center
        where is_deleted = 0 and dt_center_source_id = #{dataInfoId} and is_default = 1 limit 1
    </select>

    <select id="getDataSourceCenterById" resultType="com.dtstack.batch.domain.BatchDataSourceCenter">
        select <include refid="select_content_fragment" />
        from rdos_batch_data_source_center
        where is_deleted = 0 and id = #{sourceId}
    </select>

</mapper>