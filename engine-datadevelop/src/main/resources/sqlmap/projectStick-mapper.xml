<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dtstack.batch.dao.ProjectStickDao">

    <sql id="select_content_fragment">
        id,tenant_id,project_id,stick,create_user_id,modify_user_id,gmt_create,gmt_modified,is_deleted
    </sql>

   <update id="updateStick">
       UPDATE rdos_project_stick SET stick = #{stick}, modify_user_id=#{modifyUserId}, gmt_modified=now()
        WHERE create_user_id = #{createUserId} and tenant_id = #{tenantId} and project_id = #{projectId} and is_deleted = 0
   </update>

    <insert id="insert">
        INSERT INTO rdos_project_stick
        (tenant_id,project_id,create_user_id,modify_user_id,stick)
        VALUES
        (#{tenantId},#{projectId},#{createUserId},#{createUserId},#{stick})
    </insert>

    <select id="getByUserIdAndProjectId" resultType="com.dtstack.batch.domain.ProjectStick">
        SELECT
        <include refid="select_content_fragment"/>
        FROM rdos_project_stick
        WHERE create_user_id = #{createUserId} and tenant_id = #{tenantId} and project_id = #{projectId} and is_deleted = 0 limit 1
    </select>

    <select id="listByProjectIdsAndUserId" resultType="com.dtstack.batch.domain.ProjectStick">
        SELECT
        <include refid="select_content_fragment"/>
        FROM rdos_project_stick
        WHERE create_user_id = #{createUserId} and tenant_id = #{tenantId} and is_deleted = 0
        <if test="projectIds != null and projectIds.size() > 0">
            And project_id in
            <foreach collection="projectIds" index="index" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
    </select>

    <update id="deleteByProjectId" parameterType="java.lang.Long">
        UPDATE rdos_project_stick
        SET is_deleted = 1, gmt_modified = now(), modify_user_id=#{modifyUserId}
        WHERE project_id = #{projectId} AND is_deleted = 0;
    </update>
</mapper>