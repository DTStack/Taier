<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dtstack.engine.dao.TenantDao">

    <sql id="update_fragment">
        <set>
            <if test="dtUicTenantId != null">
                dt_uic_tenant_id = #{dtUicTenantId},
            </if>
            <if test="tenantName != null">
                tenant_name = #{tenantName},
            </if>
            <if test="tenantDesc != null">
                tenant_desc = #{tenantDesc},
            </if>
            gmt_modified = now()
        </set>
    </sql>

    <sql id="tenant_filed" >
        `id`,`dt_uic_tenant_id`,`tenant_name`,`tenant_desc`,`gmt_create`,`gmt_modified`,`is_deleted`
    </sql>

    <insert id="insert" parameterType="Tenant" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO console_dtuic_tenant(dt_uic_tenant_id,tenant_name,tenant_desc)
        VALUES (#{dtUicTenantId},#{tenantName},#{tenantDesc})
    </insert>

    <select id="listAllDtUicTenantIds" resultType="Tenant">
        SELECT
        <include refid="tenant_filed"/>
        FROM console_dtuic_tenant
        WHERE is_deleted = 0
    </select>

    <select id="getNameByDtUicTenantId" resultType="java.lang.String">
        SELECT tenant_name
        FROM console_dtuic_tenant
        WHERE is_deleted = 0 AND dt_uic_tenant_id = #{dtUicTenantId}
    </select>

    <select id="getIdByDtUicTenantId" resultType="java.lang.Long">
        SELECT id
        FROM console_dtuic_tenant
        WHERE is_deleted = 0 AND dt_uic_tenant_id = #{dtUicTenantId} LIMIT 1
    </select>

    <select id="getByDtUicTenantId"  resultType="Tenant">
        SELECT
        <include refid="tenant_filed"/>
        FROM console_dtuic_tenant
        WHERE is_deleted = 0 AND dt_uic_tenant_id = #{dtUicTenantId} LIMIT 1
    </select>

    <select id="listDtUicTenantIdByIds" resultType="java.lang.Long">
        SELECT dt_uic_tenant_id
        FROM console_dtuic_tenant
        WHERE is_deleted = 0
        <if test="ids !=null and ids.size() > 0">
            and id in
            <foreach collection="ids" item="id" open="(" separator="," close=")">
                #{id}
            </foreach>
        </if>
    </select>

    <select id="listAllTenantByDtUicTenantIds" resultType="Tenant">
        SELECT
        <include refid="tenant_filed"/>
        FROM console_dtuic_tenant
        WHERE is_deleted = 0
        <if test="ids.size() > 0">
            and dt_uic_tenant_id in
            <foreach collection="ids" item="id" open="(" separator="," close=")">
                #{id}
            </foreach>
        </if>
    </select>

    <update id="delete">
        update console_dtuic_tenant set is_deleted = 1 where dt_uic_tenant_id = #{dtUicTenantId}
    </update>

    <update id="updateByDtUicTenantId">
        update console_dtuic_tenant
        <include refid="update_fragment"/>
        where dt_uic_tenant_id = #{dtUicTenantId}
    </update>

    <select id="getOne" resultType="Tenant">
        SELECT
        <include refid="tenant_filed"/>
        FROM console_dtuic_tenant
        WHERE id=#{id} AND is_deleted=0
    </select>

    <select id="getDtUicTenantIdListByIds" resultType="java.lang.Long">
        select t.dt_uic_tenant_id
        from console_dtuic_tenant t
        where t.is_deleted = 0
        <if test="ids != null and ids.size > 0">
            and t.id IN
            <foreach collection="ids" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
    </select>

    <select id="getByDtUicTenantIds" resultType="Tenant">
        SELECT
        <include refid="tenant_filed"/>
        FROM console_dtuic_tenant
        <where>
            is_deleted=0
            <if test="dtUicTenantIds != null and dtUicTenantIds.size > 0 ">
                and dt_uic_tenant_id IN
                <foreach collection="dtUicTenantIds" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>


    <select id="listDtuicTenantIdByTenantId" resultType="com.dtstack.engine.domain.Tenant">
        SELECT
        <include refid="tenant_filed"/>
        FROM console_dtuic_tenant
        <where>
            is_deleted=0
            <if test="ids != null and ids.size > 0 ">
                and id IN
                <foreach collection="ids" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>

</mapper>
