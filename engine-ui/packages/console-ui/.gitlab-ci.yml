# Read more: https://gitlab.com/gitlab-org/gitlab-ce/tree/v8.6.4/doc/ci/yaml

cache:
  paths:
   - node_modules/

before_script:
  - "npm run install"

stages:
  - lint
  - lintdoc
  - check-types
  - test
  - deploy

code_quality: 
  stage: lint
  script: 
    - npm run lint
  only:
    # Just support (fix, dev_, feat, issue) trigger test
    - /(f|F)ix|(d|D)ev_|(f|F)eat|(i|I)ssue|ref|style|perf|next/
    - merge_requests
  except:
    - dev
    - master
    - /doc(s)/

check_types:
  stage: check-types
  script: 
    - npm run check-types
  only:
    # merge_requests not support current version
    # Just support (fix, dev_, feat, issue) trigger test
    - /(f|F)ix|(d|D)ev_|(f|F)eat|(i|I)ssue|ref|perf|next/
    - merge_requests
  except:
    - dev
    - master
    - /doc(s)/


test:
  stage: test
  script: 
    - npm run test
  only:
    # merge_requests not support current version
    # Just support (fix, dev_, feat, issue) trigger test
    - /(f|F)ix|(d|D)ev_|(f|F)eat|(i|I)ssue|ref|perf|next/
    - merge_requests
  except:
    - dev
    - master
    - /doc(s)/

doc_quality:
  stage: lintdoc
  script: 
    - npm run lint-doc
  only:
    - merge_requests # not support current version
    - /doc(s)|release/
    - master

# 开发环境更新部署
build_deploy: # deploy dev environment
  stage: build_deploy
  script:
    - npm run build
    - echo "删除原来的文件"
    - rm -rf /home/admin/app/dt-insight-front/console
    - echo "复制当前的文件"
    - cp ./dist/console -r /home/admin/app/dt-insight-front/console
    - echo "部署成功"
  only:
    - /master|dev/
