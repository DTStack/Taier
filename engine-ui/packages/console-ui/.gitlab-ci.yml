# Read more: https://gitlab.com/gitlab-org/gitlab-ce/tree/v8.6.4/doc/ci/yaml

cache:
  paths:
   - node_modules/

before_script:
  - "npm install --unsafe-perm=true --allow-root"

stages:
  - lintjs
  - lintdoc
  - test
  - deploy

code_quality: 
  stage: lintjs
  script: 
    - npm run lint-js
  only:
    # Just support (fix, dev_, feat, issue) trigger test
    - /.*((f|F)ix|(d|D)ev_|(f|F)eat|(i|I)ssue|ref|style|perf|).*$/
    - merge_requests
  except:
    - dev
    - master
    - /.*docs?.*$/

test:
  stage: test
  script: 
    - npm run check-types
    - npm run test
  only:
    # merge_requests # not support current version
    # Just support (fix, dev_, feat, issue) trigger test
    - /.*((f|F)ix|(d|D)ev_|(f|F)eat|(i|I)ssue|ref|perf).*$/
    - merge_requests
  except:
    - dev
    - master
    - /.*docs?.*$/

doc_quality:
  stage: lintdoc
  script: 
    - npm run lint-doc
  only:
    - merge_requests # not support current version
    - /.*(docs?|release).*$/
    - master

# build_to_dev: # deploy dev environment
#   stage: deploy
#   script:
#     - "./scripts/build_dev.sh"
#   only:
#     - dev
  
