(self.webpackJsonp=self.webpackJsonp||[]).push([[7,33],{"5sfi":function(e,t,a){"use strict";a.r(t);a("hr7U");var n=a("9xET"),r=a.n(n),l=(a("fv9D"),a("ZPTe")),i=a.n(l),o=a("Yz+Y"),s=a.n(o),c=a("iCc5"),u=a.n(c),d=a("V7oC"),p=a.n(d),m=a("FYw3"),h=a.n(m),E=a("mRg0"),y=a.n(E),f=a("sbe7"),v=a.n(f),b=a("/MKj"),g=a("LvDl"),T=a("7Qib"),k=a("5T+6"),S=(a("93XW"),a("d1El")),C=a.n(S),O=(a("G851"),a("ZvzK")),N=a.n(O),L=(a("MaXC"),a("4IMT")),D=a.n(L),R=(a("FGdI"),a("Pbn2")),I=a.n(R),A=(a("tL+A"),a("QpBz")),x=a.n(A),w=(a("cUip"),a("iJl9")),F=a.n(w),_=a("QbLZ"),M=a.n(_),P=(a("PFYH"),a("Jv8k")),V=a.n(P),U=(a("nTym"),a("qu0K")),j=a.n(U),H=(a("fwXI"),a("CC+v")),B=a.n(H),G=(a("Z8Mf"),a("j7zX")),q=a.n(G),W=a("dtw8"),K=a("bAm3"),Y=a("sVOr"),z=a("djHj"),Q=a("/gYX"),X=a("tHbZ"),J=a("VoFA"),$=a("ZU0t"),Z=(a("8YFG"),a("ATwu")),ee=a.n(Z),te=(a("PzEo"),a("+vAN")),ae=a.n(te),ne=(a("zmYW"),a("DtFj")),re=a.n(ne),le=a("m1cH"),ie=a.n(le),oe=a("YEIV"),se=a.n(oe),ce=(a("7kJ1"),a("qPIi")),ue=a.n(ce),de=(a("ek7I"),a("FAat")),pe=a.n(de),me=a("MgzW"),he=a.n(me),Ee=a("vbTb"),ye=a("68PS"),fe=a("fgXk"),ve=j.a.Item,be=pe.a.Option,ge=ue.a.Group,Te=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.getTableList=function(e){var t=a,n=a.props.sourceMap;(!n.type||n.type.type!==z.d.HDFS&&n.type.type!==z.d.FTP)&&a.setState({showPreview:!1},function(){Y.a.getOfflineTableList({sourceId:e,isSys:!1}).then(function(n){1===n.code&&t.setState({tableListMap:M()({},a.state.tableListMap,se()({},e,n.data||[]))})})})},a.validatePath=function(e,t,n){var r=a.props,l=r.handleTableColumnChange,i=r.form.getFieldValue,o=i("sourceId");"orc"===i("fileType")?Y.a.getOfflineTableColumn({sourceId:o,tableName:t}).then(function(e){1===e.code&&(l(e.data),n()),n("该路径无效！")}):n()},a.debounceTableSearch=Object(g.debounce)(a.changeTable,300,{maxWait:2e3}),a.debounceExtTableSearch=Object(g.debounce)(a.changeExtTable,300,{maxWait:2e3}),a.renderExtDataSource=function(){var e=a.state.selectHack,t=a.props,n=t.sourceMap,r=t.dataSourceList,l=a.props.form.getFieldDecorator,i=n.sourceList;return i?i.filter(function(e){return"main"!=e.key}).map(function(t){return v.a.createElement("div",null,v.a.createElement(ve,M()({},z.C,{label:"数据源"}),l("extSourceId."+t.key,{rules:[{required:!0,message:"数据源为必填项"}],initialValue:null==t.sourceId?null:""+t.sourceId})(v.a.createElement(pe.a,{showSearch:!0,onSelect:a.changeExtSource.bind(a,t.key),optionFilterProp:"name"},r.filter(function(e){return e.type==i[0].type}).map(function(e){var t=e.dataName+"（"+z.e[e.type]+"）",a=e.type===z.d.ES||e.type===z.d.REDIS||e.type===z.d.MONGODB;return v.a.createElement(be,{dataType:e.type,key:e.id,name:e.dataName,value:""+e.id,disabled:a},t)}))),v.a.createElement(I.a,{onClick:a.deleteExtSource.bind(a,t.key),className:"help-doc click-icon",type:"delete"})),!e&&v.a.createElement(ve,M()({},z.C,{label:"表名",key:"table"}),l("extTable."+t.key,{rules:[{required:!0,message:"数据源表为必选项！"}],initialValue:t.tables})(v.a.createElement(pe.a,{mode:"tags",showSearch:!0,showArrow:!0,onChange:a.debounceExtTableSearch.bind(a,t.key),optionFilterProp:"value"},(a.state.tableListMap[t.sourceId]||[]).map(function(e){return v.a.createElement(be,{key:"rdb-"+e,value:e},e)}))),v.a.createElement(C.a,{title:"此处可以选择多表，请保证它们的表结构一致"},v.a.createElement(I.a,{className:"help-doc",type:"question-circle-o"}))))}):[]},a.renderDynamicForm=function(){var e=a.props.form.getFieldDecorator,t=a.state.selectHack,n=a.props,l=n.sourceMap,o=(n.isCurrentTabNew,l.type&&l.type.fileType||"text"),s=z.u.indexOf(l&&l.sourceList&&l.sourceList[0].type)>-1,c=void 0;if(Object(g.isEmpty)(l))return null;switch(l.type.type){case z.d.MYSQL:case z.d.ORACLE:case z.d.SQLSERVER:case z.d.POSTGRESQL:c=[t?null:v.a.createElement(ve,M()({},z.C,{label:"表名",key:"table"}),e("table",{rules:[{required:!0,message:"数据源表为必选项！"}],initialValue:Object(g.isEmpty)(l)?"":s?l.sourceList[0].tables:l.type.table})(v.a.createElement(pe.a,{mode:s?"tags":"combobox",showSearch:!0,showArrow:!0,onChange:a.debounceTableSearch.bind(a,l.type.type),optionFilterProp:"value"},(a.state.tableListMap[l.sourceId]||[]).map(function(e){return v.a.createElement(be,{key:"rdb-"+e,value:e},e)}))),s&&v.a.createElement(C.a,{title:"此处可以选择多表，请保证它们的表结构一致"},v.a.createElement(I.a,{className:"help-doc",type:"question-circle-o"})))].concat(ie()(a.renderExtDataSource()),[s&&v.a.createElement(r.a,{style:{margin:"-14px 0px 14px 0px"}},v.a.createElement(i.a,{style:{textAlign:"left"},span:z.C.wrapperCol.sm.span,offset:z.C.labelCol.sm.span},v.a.createElement("a",{onClick:a.addDataSource.bind(a)},"添加数据源"))),v.a.createElement(ve,M()({},z.C,{label:"数据过滤",key:"where"}),e("where",{rules:[{max:1e3,message:"过滤语句不可超过1000个字符!"}],initialValue:Object(g.isEmpty)(l)?"":l.type.where})(v.a.createElement(F.a,{type:"textarea",placeholder:"请参考相关SQL语法填写where过滤语句（不要填写where关键字）。该过滤语句通常用作增量同步",onChange:a.submitForm.bind(a)})),v.a.createElement(ye.a,{doc:"dataFilterDoc"})),v.a.createElement(ve,M()({},z.C,{label:"切分键",key:"splitPK"}),e("splitPK",{rules:[],initialValue:Object(g.isEmpty)(l)?"":l.splitPK})(v.a.createElement(pe.a,{showSearch:!0,showArrow:!0,onChange:a.submitForm.bind(a)},(l.copate&&l.copate.map(function(e){return e.key}).filter(function(e,t,a){return a.indexOf(e)===t})||[]).map(function(e,t){return v.a.createElement(be,{key:"copate-"+t,value:e},e)}))),v.a.createElement(ye.a,{doc:"selectKey"}))]);break;case z.d.MAXCOMPUTE:case z.d.HIVE:var u;c=[!t&&v.a.createElement(ve,M()({},z.C,{label:"表名",key:"table"}),e("table",{rules:[{required:!0,message:"数据源表为必选项！"}],initialValue:Object(g.isEmpty)(l)?"":l.type.table})(v.a.createElement(pe.a,{showSearch:!0,mode:"combobox",onChange:a.debounceTableSearch.bind(a,null),optionFilterProp:"value"},(a.state.tableListMap[l.sourceId]||[]).map(function(e){return v.a.createElement(be,{key:"rdb-"+e,value:e},e)})))),v.a.createElement(ve,M()({},z.C,{label:"分区",key:"partition"}),e("partition",{rules:[],initialValue:Object(g.isEmpty)(l)?"":l.type.partition})(v.a.createElement(F.a,(u={placeholder:"请填写分区"},se()(u,"placeholder","pt=${bdp.system.bizdate}"),se()(u,"onChange",a.submitForm.bind(a)),u))),v.a.createElement(ye.a,{doc:"partitionDesc"}))];break;case z.d.HDFS:c=[v.a.createElement(ve,M()({},z.C,{label:"路径",key:"path"}),e("path",{rules:[{required:!0,message:"路径不得为空！"},{max:200,message:"路径不得超过200个字符！"},{validator:a.validatePath}],validateTrigger:"onSubmit",initialValue:Object(g.isEmpty)(l)?"":l.type.path})(v.a.createElement(F.a,{placeholder:"例如: /rdos/batch",onChange:a.submitForm.bind(a)})),v.a.createElement(ye.a,{doc:"hdfsPath"})),v.a.createElement(ve,M()({},z.C,{label:"文件类型",key:"fileType"}),e("fileType",{rules:[{required:!0}],initialValue:l.type&&l.type.fileType?l.type.fileType:"text"})(v.a.createElement(pe.a,{onChange:a.submitForm.bind(a)},v.a.createElement(be,{value:"orc"},"orc"),v.a.createElement(be,{value:"text"},"text")))),v.a.createElement(ve,M()({},z.C,{label:"编码",key:"encoding",style:{display:"text"===o?"block":"none"}}),e("encoding",{rules:[{required:!0}],initialValue:l.type&&l.type.encoding?l.type.encoding:"utf-8"})(v.a.createElement(pe.a,{onChange:a.submitForm.bind(a)},v.a.createElement(be,{value:"utf-8"},"utf-8"),v.a.createElement(be,{value:"gbk"},"gbk")))),v.a.createElement(ve,M()({},z.C,{style:{display:"text"===o?"block":"none"},label:"分隔符",key:"fieldDelimiter"}),e("fieldDelimiter",{rules:[],initialValue:Object(g.isEmpty)(l)?",":l.type.fieldDelimiter})(v.a.createElement(F.a,{placeholder:"若不填写，则默认为\\001",onChange:a.submitForm.bind(a)})))];break;case z.d.HBASE:c=[!t&&v.a.createElement(ve,M()({},z.C,{label:"表名",key:"table"}),e("table",{rules:[{required:!0,message:"数据源表为必选项！"}],initialValue:Object(g.isEmpty)(l)?"":l.type.table})(v.a.createElement(pe.a,{showSearch:!0,mode:"combobox",onChange:a.debounceTableSearch.bind(a,null),optionFilterProp:"value"},(a.state.tableListMap[l.sourceId]||[]).map(function(e){return v.a.createElement(be,{key:"hbase-"+e,value:e},e)})))),v.a.createElement(ve,M()({},z.C,{label:"编码",key:"encoding"}),e("encoding",{rules:[{required:!0}],initialValue:l.type&&l.type.encoding?l.type.encoding:"utf-8"})(v.a.createElement(pe.a,{onChange:a.submitForm.bind(a)},v.a.createElement(be,{value:"utf-8"},"utf-8"),v.a.createElement(be,{value:"gbk"},"gbk")))),v.a.createElement(ve,M()({},z.C,{label:"开始行健",key:"startRowkey"}),e("startRowkey",{rules:[],initialValue:l.type&&l.type.startRowkey?l.type.startRowkey:""})(v.a.createElement(F.a,{placeholder:"startRowkey",onChange:a.submitForm.bind(a)}))),v.a.createElement(ve,M()({},z.C,{label:"结束行健",key:"endRowkey"}),e("endRowkey",{rules:[],initialValue:l.type&&l.type.endRowkey?l.type.endRowkey:""})(v.a.createElement(F.a,{placeholder:"endRowkey",onChange:a.submitForm.bind(a)}))),v.a.createElement(ve,M()({},z.C,{className:"txt-left",label:"行健二进制转换",key:"isBinaryRowkey"}),e("isBinaryRowkey",{rules:[],initialValue:l.type&&l.type.isBinaryRowkey?l.type.isBinaryRowkey:"0"})(v.a.createElement(ge,{onChange:a.submitForm.bind(a)},v.a.createElement(ue.a,{value:"0",style:{float:"left"}},"FALSE"),v.a.createElement(ue.a,{value:"1",style:{float:"left"}},"TRUE")))),v.a.createElement(ve,M()({},z.C,{label:"每次RPC请求获取行数",key:"scanCacheSize"}),e("scanCacheSize",{rules:[],initialValue:l.type&&l.type.scanCacheSize?l.type.scanCacheSize:""})(v.a.createElement(F.a,{onChange:a.submitForm.bind(a),placeholder:"请输入大小, 默认为256",type:"number",min:0,suffix:"行"}))),v.a.createElement(ve,M()({},z.C,{label:"每次RPC请求获取列数",key:"scanBatchSize"}),e("scanBatchSize",{rules:[],initialValue:l.type&&l.type.scanBatchSize?l.type.scanBatchSize:""})(v.a.createElement(F.a,{onChange:a.submitForm.bind(a),placeholder:"请输入大小, 默认为100",type:"number",min:0,suffix:"列"})))];break;case z.d.FTP:c=[v.a.createElement(ve,M()({},z.C,{label:"路径",key:"path"}),e("path",{rules:[{required:!0,message:"路径不得为空！"},{max:200,message:"路径不得超过200个字符！"},{validator:a.validatePath}],validateTrigger:"onSubmit",initialValue:Object(g.isEmpty)(l)?"":l.type.path})(v.a.createElement(F.a,{placeholder:"例如: /rdos/batch",onChange:a.submitForm.bind(a)}))),v.a.createElement(ve,M()({},z.C,{style:{display:"text"===o?"block":"none"},label:"列分隔符",key:"fieldDelimiter"}),e("fieldDelimiter",{rules:[{required:!0,message:"分隔符不可为空！"}],initialValue:Object(g.isEmpty)(l)?",":l.type.fieldDelimiter})(v.a.createElement(F.a,{placeholder:"默认值为,",onChange:a.submitForm.bind(a)}))),v.a.createElement(ve,M()({},z.C,{label:"编码",key:"encoding",style:{display:"text"===o?"block":"none"}}),e("encoding",{rules:[{required:!0,message:"必须选择一种编码！"}],initialValue:l.type&&l.type.encoding?l.type.encoding:"utf-8"})(v.a.createElement(pe.a,{onChange:a.submitForm.bind(a)},v.a.createElement(be,{value:"utf-8"},"utf-8"),v.a.createElement(be,{value:"gbk"},"gbk"))))]}return c},a.state={tableListMap:{},showPreview:!1,dataSource:[],columns:[]},a}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){var e=this.props.sourceMap.sourceList;if(e)for(var t=0;t<e.length;t++){var a=e[t];null!=a.sourceId&&this.getTableList(a.sourceId)}}},{key:"componentWillUnmount",value:function(){clearInterval(this.timerID)}},{key:"getTableColumn",value:function(e,t){var a=this.props,n=a.form,r=a.handleTableColumnChange,l=a.handleTableCopateChange;if(e instanceof Array&&(e=e[0]),!e)return l([]),void n.setFields({splitPK:{value:""}});var i=this.props.sourceMap;if(!i.type||i.type.type!==z.d.HBASE){var o=n.getFieldValue("sourceId");t&&Y.a.getOfflineColumnForSyncopate({sourceId:o,tableName:e}).then(function(e){1===e.code?l(e.data):l([])}),Y.a.getOfflineTableColumn({sourceId:o,tableName:e}).then(function(e){1===e.code?r(e.data):r([])})}}},{key:"getDataObjById",value:function(e){return this.props.dataSourceList.filter(function(t){return t.id==e})[0]}},{key:"changeExtSource",value:function(e,t){this.props.changeExtDataSource(this.getDataObjById(t),e),this.getTableList(t),this.resetTable("extTable."+e)}},{key:"changeSource",value:function(e,t){var a=this,n=this.props,r=n.handleSourceChange,l=n.sourceMap,i=(l&&l.sourceList&&l.sourceList[0],t.props.dataType);z.u.indexOf(i);setTimeout(function(){a.getTableList(e)},0),r(this.getDataObjById(e)),this.resetTable()}},{key:"addDataSource",value:function(){var e="key"+~~(1e7*Math.random());this.props.addDataSource(e)}},{key:"deleteExtSource",value:function(e){this.props.deleteDataSource(e)}},{key:"resetTable",value:function(e){var t=this,a=this.props.form;this.changeTable(""),this.setState({selectHack:!0},function(){e?a.resetFields([e]):(a.resetFields(["table"]),a.resetFields(["splitPK"])),t.setState({selectHack:!1})})}},{key:"changeTable",value:function(e,t){t&&this.getTableColumn(t,e),this.submitForm(),this.setState({showPreview:!1})}},{key:"changeExtTable",value:function(e,t){this.submitForm(null,e)}},{key:"submitForm",value:function(e,t){var a=this,n=this.props,r=n.updateTaskFields,l=n.form,i=n.handleSourceMapChange,o=n.currentTab,s=(n.sourceMap,n.taskCustomParams);this.timerID=setTimeout(function(){var e=l.getFieldsValue();for(var n in e)""===e[n]&&delete e[n];if(e.where){var c=Object(fe.h)(s,e.where);c.length>0&&r({id:o,taskVariables:c})}if(e.partition){var u=Object(fe.h)(s,e.partition);u.length>0&&r({id:o,taskVariables:u})}var d=he()(e,{src:a.getDataObjById(e.sourceId)});i(d,t)},0)}},{key:"next",value:function(e){var t=this.props,a=t.form,n=t.sourceMap,r=null;n.type&&n.type.type===z.d.HDFS&&(r=["sourceId","path","fileType"],"text"===n.type.fileType&&r.push("encoding")),a.validateFieldsAndScroll(r,{force:!0},function(t,a){t||e.call(null,1)})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.props,n=a.sourceMap,r=a.dataSourceList,l=a.navtoStep,i=(a.isCurrentTabNew,Object(g.isEmpty)(n)||n.type.type===z.d.HDFS||n.type.type===z.d.HBASE||n.type.type===z.d.FTP);return v.a.createElement("div",{className:"g-step1"},v.a.createElement(j.a,null,v.a.createElement(ve,M()({},z.C,{label:"数据源"}),t("sourceId",{rules:[{required:!0,message:"数据源为必填项"}],initialValue:Object(g.isEmpty)(n)?"":""+n.sourceId})(v.a.createElement(pe.a,{showSearch:!0,onSelect:this.changeSource.bind(this),optionFilterProp:"name"},r.map(function(e){var t=e.dataName+"（"+z.e[e.type]+"）",a=e.type===z.d.ES||e.type===z.d.REDIS||e.type===z.d.MONGODB;return v.a.createElement(be,{dataType:e.type,key:e.id,name:e.dataName,value:""+e.id,disabled:a},t)})))),this.renderDynamicForm()),v.a.createElement("div",{className:"m-datapreview",style:{width:"90%",margin:"0 auto",overflow:"auto"}},v.a.createElement("p",{style:{cursor:"pointer",marginBottom:10}},v.a.createElement("a",{disabled:i,href:"javascript:void(0)",onClick:this.loadPreview.bind(this)},"数据预览",this.state.showPreview?v.a.createElement(I.a,{type:"up"}):v.a.createElement(I.a,{type:"down"}))),this.state.showPreview?v.a.createElement(re.a,{dataSource:this.state.dataSource,columns:this.state.columns,scroll:{x:200*this.state.columns.length},pagination:!1,bordered:!1}):null),!this.props.readonly&&v.a.createElement("div",{className:"steps-action"},v.a.createElement(D.a,{type:"primary",onClick:function(){return e.next(l)}},"下一步")))}},{key:"loadPreview",value:function(){var e=this,t=this.state.showPreview,a=this.props.form,n=a.getFieldValue("sourceId"),r=a.getFieldValue("table");n&&r?(r instanceof Array&&(r=r[0]),t?this.setState({showPreview:!1}):Y.a.getDataPreview({sourceId:n,tableName:r}).then(function(t){if(1===t.code){var a=t.data,n=a.columnList,r=a.dataList,l=n.map(function(e){return{title:e,dataIndex:e,key:e}}),i=r.map(function(e,t){for(var a={},r=0;r<e.length;r++)a.key=t,a[n[r]]=e[r];return a});e.setState({columns:l,dataSource:i,showPreview:!0})}})):x.a.error("数据源或表名缺失")}}]),t}(v.a.Component),ke=j.a.create()(Te),Se=function(e){function t(e){return u()(this,t),h()(this,(t.__proto__||s()(t)).call(this,e))}return y()(t,e),p()(t,[{key:"render",value:function(){return v.a.createElement("div",null,v.a.createElement(ke,this.props))}}]),t}(v.a.Component),Ce=Object(b.b)(function(e){var t=e.offlineTask,a=t.dataSync,n=t.workbench;return{isCurrentTabNew:n.isCurrentTabNew,currentTab:n.currentTab,sourceMap:a.sourceMap,dataSourceList:a.dataSourceList,taskCustomParams:n.taskCustomParams}},function(e){return{addDataSource:function(t){e({type:Ee.j.DATA_SOURCE_ADD,key:t})},deleteDataSource:function(t){e({type:Ee.j.DATA_SOURCE_DELETE,key:t})},changeExtDataSource:function(t,a){e({type:Ee.j.DATA_SOURCE_CHANGE,payload:t,key:a}),e({type:Ee.o.MAKE_TAB_DIRTY})},handleSourceChange:function(t){e({type:Ee.c.RESET_SOURCE_MAP}),e({type:Ee.c.RESET_KEYMAP}),e({type:Ee.j.DATA_SOURCE_CHANGE,payload:t}),e({type:Ee.o.MAKE_TAB_DIRTY})},handleSourceMapChange:function(t,a){e({type:Ee.j.DATA_SOURCEMAP_CHANGE,payload:t,key:a||"main"}),e({type:Ee.o.MAKE_TAB_DIRTY})},handleTableColumnChange:function(t){e({type:Ee.j.SOURCE_TABLE_COLUMN_CHANGE,payload:t}),e({type:Ee.o.MAKE_TAB_DIRTY})},handleTableCopateChange:function(t){e({type:Ee.j.SOURCE_TABLE_COPATE_CHANGE,payload:t})},updateTaskFields:function(t){e({type:Ee.o.SET_TASK_FIELDS_VALUE,payload:t})}}})(Se),Oe=a("moyJ"),Ne=a("QlaU"),Le=j.a.Item,De=pe.a.Option,Re=ue.a.Group,Ie=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.getTableList=function(e){var t=a,n=a.props.targetMap;if(n.type&&(n.type.type===z.d.HDFS||n.type.type===z.d.FTP))return!0;t.setState({tableList:[]},function(){Y.a.getOfflineTableList({sourceId:e,isSys:!1}).then(function(e){1===e.code&&t.setState({tableList:e.data})})})},a.getTableColumn=function(e){var t=a.props,n=t.form,r=t.handleTableColumnChange,l=t.targetMap,i=n.getFieldValue("sourceId");if(l.type&&l.type.type===z.d.HBASE)return!0;Y.a.getOfflineTableColumn({sourceId:i,tableName:e}).then(function(e){1===e.code?r(e.data):r([])})},a.ddlChange=function(e){a.setState({textSql:e,sync:!1})},a.debounceTableSearch=Object(g.debounce)(a.changeTable,600,{maxWait:2e3}),a.state={tableList:[],visible:!1,modalLoading:!1,loading:!1},a}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.targetMap,a=(e.isCurrentTabNew,t.sourceId);a&&this.getTableList(a)}},{key:"getDataObjById",value:function(e){return this.props.dataSourceList.filter(function(t){return t.id==e})[0]}},{key:"changeSource",value:function(e){var t=this,a=this.props,n=a.handleSourceChange;a.form;setTimeout(function(){t.getTableList(e)},0),n(this.getDataObjById(e)),this.resetTable()}},{key:"resetTable",value:function(){var e=this,t=this.props.form;this.changeTable(""),this.setState({selectHack:!0},function(){t.resetFields(["table"]),e.setState({selectHack:!1})})}},{key:"changeTable",value:function(e){e&&this.getTableColumn(e),this.submitForm()}},{key:"submitForm",value:function(){var e=this,t=this.props,a=t.taskCustomParams,n=t.updateTaskFields,r=t.form,l=t.handleTargetMapChange,i=t.currentTab;setTimeout(function(){var t=r.getFieldsValue(),o=t.preSql+" "+t.postSql;if(o){var s=Object(fe.h)(a,o);s.length>0&&n({id:i,taskVariables:s})}if(t.partition){var c=Object(fe.h)(a,t.partition);c.length>0&&n({id:i,taskVariables:c})}var u=he()(t,{src:e.getDataObjById(t.sourceId)});l(u)},0)}},{key:"prev",value:function(e){e.call(null,0)}},{key:"next",value:function(e){this.props.form.validateFields(function(t,a){t||e.call(null,2)})}},{key:"handleCancel",value:function(){this.setState({textSql:"",visible:!1})}},{key:"createTable",value:function(){var e=this,t=this.state.textSql,a=this.props.targetMap;this.setState({modalLoading:!0}),Y.a.createDdlTable({sql:t}).then(function(t){e.setState({modalLoading:!1}),1===t.code&&(e.getTableList(a.sourceId),e.changeTable(t.data.tableName),e.props.form.setFieldsValue({table:t.data.tableName}),e.setState({visible:!1}),message.success("表创建成功!"))})}},{key:"showCreateModal",value:function(){var e=this,t=this.props.sourceMap;this.setState({loading:!0});var a="string"==typeof t.type.table?t.type.table:t.type.table[0];Y.a.getCreateTargetTable({originSourceId:t.sourceId,tableName:a,partition:t.type.partition}).then(function(t){e.setState({loading:!1}),1==t.code&&e.setState({textSql:t.data,sync:!0,visible:!0})})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.state.modalLoading,n=this.props,r=n.targetMap,l=n.dataSourceList,i=n.navtoStep;n.isCurrentTabNew;return v.a.createElement("div",{className:"g-step2"},v.a.createElement(B.a,{className:"m-codemodal",title:v.a.createElement("span",null,"建表语句"),confirmLoading:a,maskClosable:!1,style:{height:424},visible:this.state.visible,onCancel:this.handleCancel.bind(this),onOk:this.createTable.bind(this)},v.a.createElement(Oe.a,{language:"dtsql",value:this.state.textSql,sync:this.state.sync,placeholder:Ne.a,onChange:this.ddlChange})),v.a.createElement(j.a,null,v.a.createElement(Le,M()({},z.C,{label:"数据同步目标"}),t("sourceId",{rules:[{required:!0}],initialValue:Object(g.isEmpty)(r)?"":""+r.sourceId})(v.a.createElement(pe.a,{showSearch:!0,onChange:this.changeSource.bind(this),optionFilterProp:"name"},l.map(function(e){var t=e.dataName+"（"+z.e[e.type]+"）",a=e.type===z.d.ES||e.type===z.d.REDIS||e.type===z.d.MONGODB;return v.a.createElement(De,{key:e.id,name:e.dataName,value:""+e.id,disabled:a},t)})))),this.renderDynamicForm()),!this.props.readonly&&v.a.createElement("div",{className:"steps-action"},v.a.createElement(D.a,{style:{marginRight:8},onClick:function(){return e.prev(i)}},"上一步"),v.a.createElement(D.a,{type:"primary",onClick:function(){return e.next(i)}},"下一步")))}},{key:"renderDynamicForm",value:function(){var e=this.props.form.getFieldDecorator,t=this.state,a=t.selectHack,n=t.loading,r=this.props,l=r.targetMap,i=(r.dataSourceList,r.isCurrentTabNew,r.project,r.sourceMap),o=i.type&&i.type.type,s=void 0,c=o==z.d.MYSQL||o==z.d.ORACLE||o==z.d.SQLSERVER||o==z.d.POSTGRESQL||o==z.d.MYSQL||o==z.d.MYSQL||o==z.d.HIVE||o==z.d.MAXCOMPUTE;if(Object(g.isEmpty)(l))return null;switch(l.type.type){case z.d.MYSQL:case z.d.ORACLE:case z.d.SQLSERVER:case z.d.POSTGRESQL:s=[!a&&v.a.createElement(Le,M()({},z.C,{label:"表名",key:"table"}),e("table",{rules:[{required:!0,message:"请选择表"}],initialValue:Object(g.isEmpty)(l)?"":l.type.table})(v.a.createElement(pe.a,{showSearch:!0,mode:"combobox",optionFilterProp:"value",onChange:this.debounceTableSearch.bind(this)},this.state.tableList.map(function(e){return v.a.createElement(De,{key:"rdb-target-"+e,value:e},e)})))),v.a.createElement(Le,M()({},z.C,{label:"导入前准备语句",key:"preSql"}),e("preSql",{rules:[],initialValue:Object(g.isEmpty)(l)?"":l.type.preSql})(v.a.createElement(F.a,{onChange:this.submitForm.bind(this),placeholder:"请输入导入数据前执行的SQL脚本",type:"textarea"}))),v.a.createElement(Le,M()({},z.C,{label:"导入后准备语句",key:"postSql"}),e("postSql",{rules:[],initialValue:Object(g.isEmpty)(l)?"":l.type.postSql})(v.a.createElement(F.a,{onChange:this.submitForm.bind(this),placeholder:"请输入导入数据后执行的SQL脚本",type:"textarea"}))),v.a.createElement(Le,M()({},z.C,{label:"主键冲突",key:"writeMode",className:"txt-left"}),e("writeMode",{rules:[{required:!0}],initialValue:l.type&&l.type.writeMode?l.type.writeMode:"insert"})(v.a.createElement(Re,{onChange:this.submitForm.bind(this)},v.a.createElement(ue.a,{value:"insert",style:{float:"left"}},"视为脏数据，保留原有数据（Insert Into）"),v.a.createElement(ue.a,{value:"replace",style:{float:"left"}},"替换原有数据（Replace Into）"))))];break;case z.d.HIVE:case z.d.MAXCOMPUTE:s=[!a&&v.a.createElement(Le,M()({},z.C,{label:"表名",key:"table"}),e("table",{rules:[{required:!0,message:"请选择表"}],initialValue:Object(g.isEmpty)(l)?"":l.type.table})(v.a.createElement(pe.a,{showSearch:!0,mode:"combobox",onChange:this.debounceTableSearch.bind(this),optionFilterProp:"value"},this.state.tableList.map(function(e){return v.a.createElement(De,{key:"rdb-target-"+e,value:e},e)}))),c&&(n?v.a.createElement(I.a,{type:"loading"}):v.a.createElement("a",{style:{top:"0px",right:"-90px"},onClick:this.showCreateModal.bind(this),className:"help-doc"},"一键生成目标表"))),v.a.createElement(Le,M()({},z.C,{label:"分区",key:"partition"}),e("partition",{rules:[],initialValue:Object(g.isEmpty)(l)?"":l.type.partition})(v.a.createElement(F.a,{onChange:this.submitForm.bind(this),placeholder:"pt=${bdp.system.bizdate}"})),v.a.createElement(ye.a,{doc:"partitionDesc"})),v.a.createElement(Le,M()({},z.C,{label:"写入模式",key:"writeMode",className:"txt-left"}),e("writeMode",{rules:[{required:!0}],initialValue:l.type&&l.type.writeMode?l.type.writeMode:"replace"})(v.a.createElement(Re,{onChange:this.submitForm.bind(this)},v.a.createElement(ue.a,{value:"replace",style:{float:"left"}},"覆盖（Insert Overwrite）"),v.a.createElement(ue.a,{value:"insert",style:{float:"left"}},"追加（Insert Into）"))))];break;case z.d.HDFS:s=[v.a.createElement(Le,M()({},z.C,{label:"路径",key:"path"}),e("path",{rules:[{required:!0}],initialValue:Object(g.isEmpty)(l)?"":l.type.path})(v.a.createElement(F.a,{placeholder:"例如: /rdos/batch",onChange:this.submitForm.bind(this)}))),v.a.createElement(Le,M()({},z.C,{label:"分隔符",key:"fieldDelimiter"}),e("fieldDelimiter",{rules:[],initialValue:Object(g.isEmpty)(l)?",":l.type.fieldDelimiter})(v.a.createElement(F.a,{placeholder:"例如: 目标为hive则 分隔符为\\001",onChange:this.submitForm.bind(this)}))),v.a.createElement(Le,M()({},z.C,{label:"编码",key:"encoding"}),e("encoding",{rules:[{required:!0}],initialValue:Object(g.isEmpty)(l)||!l.type.encoding?"utf-8":l.type.encoding})(v.a.createElement(pe.a,{onChange:this.submitForm.bind(this)},v.a.createElement(De,{value:"utf-8"},"utf-8"),v.a.createElement(De,{value:"gbk"},"gbk")))),v.a.createElement(Le,M()({},z.C,{label:"文件名",key:"fileName"}),e("fileName",{rules:[{required:!0}],initialValue:Object(g.isEmpty)(l)?"":l.type.fileName})(v.a.createElement(F.a,{onChange:this.submitForm.bind(this)}))),v.a.createElement(Le,M()({},z.C,{label:"文件类型",key:"fileType"}),e("fileType",{rules:[{required:!0}],initialValue:l.type&&l.type.fileType?l.type.fileType:"orc"})(v.a.createElement(pe.a,{onChange:this.submitForm.bind(this)},v.a.createElement(De,{value:"orc"},"orc"),v.a.createElement(De,{value:"text"},"text")))),v.a.createElement(Le,M()({},z.C,{label:"写入模式",className:"txt-left",key:"writeMode"}),e("writeMode",{rules:[{required:!0}],initialValue:l.type&&l.type.writeMode?l.type.writeMode:"APPEND"})(v.a.createElement(Re,{onChange:this.submitForm.bind(this)},v.a.createElement(ue.a,{value:"APPEND",style:{float:"left"}},"追加新数据"),v.a.createElement(ue.a,{value:"NONCONFLICT",style:{float:"left"}},"覆盖老数据"))))];break;case z.d.HBASE:s=[!a&&v.a.createElement(Le,M()({},z.C,{label:"表名",key:"table"}),e("table",{rules:[{required:!0}],initialValue:l.type&&l.type.table?l.type.table:""})(v.a.createElement(pe.a,{showSearch:!0,mode:"combobox",onChange:this.debounceTableSearch.bind(this),optionFilterProp:"value"},this.state.tableList.map(function(e){return v.a.createElement(De,{key:"hbase-target-"+e,value:e},e)})))),v.a.createElement(Le,M()({},z.C,{label:"编码",key:"encoding"}),e("encoding",{rules:[{required:!0}],initialValue:l.type&&l.type.encoding?l.type.encoding:"utf-8"})(v.a.createElement(pe.a,{onChange:this.submitForm.bind(this)},v.a.createElement(De,{value:"utf-8"},"utf-8"),v.a.createElement(De,{value:"gbk"},"gbk")))),v.a.createElement(Le,M()({},z.C,{label:"读取为空时的处理方式",key:"nullMode",className:"txt-left"}),e("nullMode",{rules:[{required:!0,message:"请选择为空时的处理方式!"}],initialValue:l.type&&l.type.nullMode?l.type.nullMode:"skip"})(v.a.createElement(Re,{onChange:this.submitForm.bind(this)},v.a.createElement(ue.a,{value:"skip",style:{float:"left"}},"SKIP"),v.a.createElement(ue.a,{value:"empty",style:{float:"left"}},"EMPTY")))),v.a.createElement(Le,M()({},z.C,{label:"写入缓存大小",key:"writeBufferSize"}),e("writeBufferSize",{rules:[],initialValue:Object(g.isEmpty)(l)?"":l.type.writeBufferSize})(v.a.createElement(F.a,{onChange:this.submitForm.bind(this),placeholder:"请输入缓存大小",type:"number",min:0,suffix:"KB"})))];break;case z.d.FTP:s=[v.a.createElement(Le,M()({},z.C,{label:"路径",key:"path"}),e("path",{rules:[{required:!0,message:"路径不得为空！"},{max:200,message:"路径不得超过200个字符！"},{validator:this.validatePath}],validateTrigger:"onSubmit",initialValue:Object(g.isEmpty)(l)?"":l.type.path})(v.a.createElement(F.a,{placeholder:"例如: /rdos/batch",onChange:this.submitForm.bind(this)}))),v.a.createElement(Le,M()({},z.C,{label:"编码",key:"encoding"}),e("encoding",{rules:[{required:!0}],initialValue:l.type&&l.type.encoding?l.type.encoding:"utf-8"})(v.a.createElement(pe.a,{onChange:this.submitForm.bind(this)},v.a.createElement(De,{value:"utf-8"},"utf-8"),v.a.createElement(De,{value:"gbk"},"gbk")))),v.a.createElement(Le,M()({},z.C,{label:"分隔符",key:"fieldDelimiter"}),e("fieldDelimiter",{rules:[],initialValue:l.type&&l.type.fieldDelimiter?l.type.fieldDelimiter:","})(v.a.createElement(F.a,{placeholder:"若不填写，则默认,",onChange:this.submitForm.bind(this)}))),v.a.createElement(Le,M()({},z.C,{label:"写入模式",className:"txt-left",key:"writeMode"}),e("writeMode",{rules:[{required:!0}],initialValue:l.type&&l.type.writeMode?l.type.writeMode:"APPEND"})(v.a.createElement(Re,{onChange:this.submitForm.bind(this)},v.a.createElement(ue.a,{value:"APPEND",style:{float:"left"}},"追加新数据"),v.a.createElement(ue.a,{value:"NONCONFLICT",style:{float:"left"}},"覆盖老数据"))))]}return s}}]),t}(v.a.Component),Ae=j.a.create()(Ie),xe=function(e){function t(e){return u()(this,t),h()(this,(t.__proto__||s()(t)).call(this,e))}return y()(t,e),p()(t,[{key:"render",value:function(){return v.a.createElement("div",null,v.a.createElement(Ae,this.props))}}]),t}(v.a.Component),we=Object(b.b)(function(e){var t=e.offlineTask,a=t.dataSync,n=t.workbench,r=n.isCurrentTabNew;return{currentTab:n.currentTab,isCurrentTabNew:r,targetMap:a.targetMap,sourceMap:a.sourceMap,dataSourceList:a.dataSourceList,taskCustomParams:n.taskCustomParams,project:e.project}},function(e){return{handleSourceChange:function(t){e({type:Ee.c.RESET_TARGET_MAP}),e({type:Ee.c.RESET_KEYMAP}),e({type:Ee.m.DATA_SOURCE_TARGET_CHANGE,payload:t}),e({type:Ee.o.MAKE_TAB_DIRTY})},handleTargetMapChange:function(t){e({type:Ee.m.DATA_TARGETMAP_CHANGE,payload:t}),e({type:Ee.o.MAKE_TAB_DIRTY})},handleTableColumnChange:function(t){e({type:Ee.m.TARGET_TABLE_COLUMN_CHANGE,payload:t}),e({type:Ee.o.MAKE_TAB_DIRTY})},updateTaskFields:function(t){e({type:Ee.o.SET_TASK_FIELDS_VALUE,payload:t})}}})(xe),Fe=a("sk9p"),_e=a.n(Fe),Me=a("EJiy"),Pe=a.n(Me),Ve=a("2fsI");function Ue(e){return v.a.createElement("input",{style:{height:"28px",margin:"5px 5px 5px 0px",width:"100%",textAlign:"left",backgroundColor:"transparent",backgroundImage:"none",border:"none"},title:e,className:"cell-input",value:e})}a("b+Mx");var je=a("5Dct"),He=a.n(je),Be=j.a.Item,Ge=pe.a.Option,qe=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.columnFamily=function(e){return e&&e.map(function(e){return v.a.createElement(Ge,{value:e},e)})},n.renderFormItems=function(){var e=n.props,t=e.keyModal,a=e.dataType,r=e.sourceColumnFamily,l=e.targetColumnFamily,i=t.isReader,o=(t.fileType,t.editField),s=n.props.form.getFieldDecorator;if(i)switch(a){case z.d.FTP:case z.d.HDFS:return[v.a.createElement(Be,M()({},z.C,{label:"索引值",key:"index"}),s("index",{rules:[{required:!0,type:"integer",message:"请按要求填写索引值！"}],initialValue:o&&o.index||""})(v.a.createElement(He.a,{style:{width:"100%"},min:0}))),v.a.createElement(Be,M()({},z.C,{label:"选择类型",key:"type"}),s("type",{rules:[{required:!0}],initialValue:o&&o.type||"STRING"})(v.a.createElement(pe.a,null,v.a.createElement(Ge,{value:"STRING"},"STRING"),v.a.createElement(Ge,{value:"LONG"},"LONG"),v.a.createElement(Ge,{value:"BOOLEAN"},"BOOLEAN"),v.a.createElement(Ge,{value:"DOUBLE"},"DOUBLE"),v.a.createElement(Ge,{value:"DATE"},"DATE"))))];case z.d.HBASE:var c=o&&"rowkey"===o.key;return[v.a.createElement(Be,M()({},z.C,{label:"列名",key:"key"}),s("key",{rules:[{required:!0,type:"string"}],initialValue:o&&o.key||""})(v.a.createElement(F.a,{style:{width:"100%"},disabled:c}))),v.a.createElement(Be,M()({},z.C,{label:"列族",key:"cf"}),s("cf",{rules:[{required:!0}],initialValue:o&&o.cf||""})(v.a.createElement(pe.a,{placeHolder:"请选择列族",disabled:c},n.columnFamily(r)))),v.a.createElement(Be,M()({},z.C,{label:"选择类型",key:"type"}),s("type",{rules:[{required:!0}],initialValue:o&&o.type||"STRING"})(v.a.createElement(pe.a,null,v.a.createElement(Ge,{value:"STRING"},"STRING"),v.a.createElement(Ge,{value:"BOOLEAN"},"BOOLEAN"),v.a.createElement(Ge,{value:"SHORT"},"SHORT"),v.a.createElement(Ge,{value:"INT"},"INT"),v.a.createElement(Ge,{value:"LONG"},"LONG"),v.a.createElement(Ge,{value:"FLOAT"},"FLOAT"),v.a.createElement(Ge,{value:"DOUBLE"},"DOUBLE"))))]}else switch(a){case z.d.FTP:case z.d.HDFS:return[v.a.createElement(Be,M()({},z.C,{label:"选择类型",key:"type"}),s("type",{rules:[{required:!0}],initialValue:o&&o.type||"STRING"})(v.a.createElement(pe.a,null,v.a.createElement(Ge,{value:"STRING"},"STRING"),v.a.createElement(Ge,{value:"BIGINT"},"BIGINT"),v.a.createElement(Ge,{value:"TIMESTAMP"},"TIMESTAMP"),v.a.createElement(Ge,{value:"VARCHAR"},"VARCHAR"),v.a.createElement(Ge,{value:"CHAR"},"CHAR"),v.a.createElement(Ge,{value:"TINYINT"},"TINYINT"),v.a.createElement(Ge,{value:"SMALLINT"},"SMALLINT"),v.a.createElement(Ge,{value:"DECIMAL"},"DECIMAL"),v.a.createElement(Ge,{value:"INT"},"INT"),v.a.createElement(Ge,{value:"FLOAT"},"FLOAT"),v.a.createElement(Ge,{value:"DOUBLE"},"DOUBLE"),v.a.createElement(Ge,{value:"DATE"},"DATE")))),v.a.createElement(Be,M()({},z.C,{label:"字段名",key:"keyName"}),s("key",{rules:[{required:!0}],initialValue:o&&o.key||""})(v.a.createElement(F.a,null)))];case z.d.HBASE:return[v.a.createElement(Be,M()({},z.C,{label:"列名",key:"key"}),s("key",{rules:[{required:!0,type:"string"}],initialValue:o&&o.key||""})(v.a.createElement(F.a,{style:{width:"100%"}}))),v.a.createElement(Be,M()({},z.C,{label:"列族",key:"cf"}),s("cf",{rules:[{required:!0}],initialValue:o&&o.cf||""})(v.a.createElement(pe.a,{placeHolder:"请选择列族"},n.columnFamily(l)))),v.a.createElement(Be,M()({},z.C,{label:"选择类型",key:"type"}),s("type",{rules:[{required:!0}],initialValue:o&&o.type||"STRING"})(v.a.createElement(pe.a,null,v.a.createElement(Ge,{value:"STRING"},"STRING"),v.a.createElement(Ge,{value:"BOOLEAN"},"BOOLEAN"),v.a.createElement(Ge,{value:"SHORT"},"SHORT"),v.a.createElement(Ge,{value:"INT"},"INT"),v.a.createElement(Ge,{value:"LONG"},"LONG"),v.a.createElement(Ge,{value:"FLOAT"},"FLOAT"),v.a.createElement(Ge,{value:"DOUBLE"},"DOUBLE"))))]}return[]},r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"shouldComponentUpdate",value:function(e){return this.props!==e}},{key:"render",value:function(){return v.a.createElement(j.a,null,this.renderFormItems())}}]),t}(v.a.Component),We=j.a.create()(qe),Ke=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.submit=function(){var e=n.props.onOk;n.Form.validateFields(function(t,a){t?e(null,t):(setTimeout(function(){n.Form.resetFields()},200),e(a))})},n.cancel=function(){(0,n.props.onCancel)(),n.Form.resetFields()},r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.title,n=t.visible,r=t.keyModal,l=t.dataType,i=t.sourceColumnFamily,o=t.targetColumnFamily;return v.a.createElement(B.a,{title:a,visible:n,onOk:this.submit,onCancel:this.cancel},v.a.createElement(We,{sourceColumnFamily:i,targetColumnFamily:o,dataType:l,keyModal:r,ref:function(t){return e.Form=t}}))}}]),t}(v.a.Component),Ye=function(){return v.a.createElement("span",null,v.a.createElement("b",null,"STRING"),",",v.a.createElement("b",null,"VARCHAR"),",",v.a.createElement("b",null,"CHAR"),",",v.a.createElement("b",null,"TINYINT"),",",v.a.createElement("b",null,"SMALLINT"),",",v.a.createElement("b",null,"DECIMAL"),",",v.a.createElement("br",null),v.a.createElement("b",null,"INT"),",",v.a.createElement("b",null,"BIGINT"),",",v.a.createElement("b",null,"FLOAT"),",",v.a.createElement("b",null,"DOUBLE"),",",v.a.createElement("b",null,"TIMESTAMP"),",",v.a.createElement("b",null,"DATE"))};function ze(e){var t=e.title,a=e.desc,n=e.visible,r=e.onOk,l=e.placeholder,i=e.value,o=e.onCancel,s=e.onChange,c=e.columnFamily;return v.a.createElement(B.a,{title:t,onOk:r,onCancel:o,visible:n},v.a.createElement("p",null,"批量导入的语法格式：",v.a.createElement("b",{style:{color:"rgb(255, 102, 0)"}},a)),v.a.createElement("p",null,"常用数据类型：",v.a.createElement("span",{style:{color:"rgb(255, 102, 0)"}},Ye())),c?v.a.createElement("p",null,"已有列族：",v.a.createElement("span",{style:{color:"rgb(255, 102, 0)"}},c.map(function(e){return e+","}))):"",v.a.createElement("br",null),v.a.createElement(F.a,{type:"textarea",rows:6,value:i,onChange:s,placeholder:l}))}var Qe=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.state={constValue:""},n.onChange=function(e){n.setState({constValue:e.target.value})},n.submit=function(){var e=n.props,t=e.onOk,a=e.onCancel,r=T.a.trim(n.state.constValue);""!==r?t&&(t({type:"string",key:r,value:r}),a()):x.a.error("常量字段不可为空！")},n.close=function(){var e=n.props.onCancel;n.setState({constValue:""},function(){e&&e()})},r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.state.constValue,t=this.props,a=t.visible;t.onCancel;return v.a.createElement(B.a,{title:"添加常量",onOk:this.submit,onCancel:this.close,visible:a},v.a.createElement(F.a,{value:e,onChange:this.onChange,placeholder:"请输入常量值"}))}}]),t}(v.a.Component),Xe={cf:"-",key:"rowkey",type:"STRING"};function Je(e,t){return Object(g.isObject)(e)&&Object(g.isObject)(t)?Object(g.isEqual)(e,t):Object(g.isObject)(e)&&!Object(g.isObject)(t)?(e.key||e.index)===t:!Object(g.isObject)(e)&&Object(g.isObject)(t)?e===(t.key||t.index):e===t}var $e=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.resize=function(){a.setState({W:a.getCanvasW()})},a.initData=function(){var e=a.props,t=e.sourceMap,n=e.sourceSrcType,r=e.addSourceKeyRow;n===z.d.HBASE&&(t.column&&0!==t.column.length||r(Xe))},a.loadColumnFamily=function(){var e=a.props,t=e.sourceMap,n=e.targetMap,r=e.sourceSrcType,l=e.targetSrcType,i=a,o=function(e,t){Y.a.getHBaseColumnFamily(e).then(function(e){1===e.code&&t(e.data)})};r===z.d.HBASE&&o({sourceId:t.sourceId,tableName:t.type.table},function(e){i.setState({sourceColumnFamily:e})}),l===z.d.HBASE&&o({sourceId:n.sourceId,tableName:n.type.table},function(e){i.setState({targetColumnFamily:e})})},a.hbaseRowKeyChange=function(e){var t=T.a.trim(e.target.value),n=a.props,r=n.handleTargetMapChange,l=n.targetMap;t&&(l.rowkey=t,r(l))},a.renderKeyModal=function(){var e=a.state,t=e.keyModal,n=e.keyModalVisible,r=e.sourceColumnFamily,l=e.targetColumnFamily,i=t.operation,o=t.isReader,s=a.props,c=s.sourceSrcType,u=s.targetSrcType,d=t.isReader?c:u,p=a.doAddkeyRow,m="添加HDFS字段";return"add"===i?d===z.d.HBASE?m="添加HBase字段":d===z.d.FTP&&(m="添加FTP字段"):"edit"===i&&(p=a.doEditKeyRow,m="修改HDFS字段",d===z.d.HBASE?m="修改HBase字段":d===z.d.FTP&&(m="添加FTP字段")),v.a.createElement(Ke,{title:m,visible:n,keyModal:t,dataType:d,sourceColumnFamily:r,targetColumnFamily:l,onOk:p,onCancel:a.hideKeyModal,key:o?"source-"+d+"-"+c:"target-"+d+"-"+u})},a.renderBatchModal=function(){var e=a.state,t=e.batchModal,n=e.batchSourceModal,r=e.sourceColumnFamily,l=e.targetColumnFamily,i=a.props,o=i.sourceSrcType,s=i.targetSrcType,c=void 0,u=void 0,d=void 0,p=void 0;switch(o){case z.d.FTP:case z.d.HDFS:c="0: STRING, 1: INTEGER,...",u="index: type, index: type";break;case z.d.HBASE:c="cf1: field1: STRING, cf1: field2: INTEGER,...",u="columnFamily: fieldName: type,"}switch(s){case z.d.FTP:case z.d.HDFS:d="field1: STRING, field2: INTEGER,...",p="fieldName: type, fieldName: type";break;case z.d.HBASE:d=c,p=u}return[v.a.createElement(ze,{key:"sourceBatchAdd",title:"批量添加源表字段",desc:u,columnFamily:r,placeholder:c,visible:n.visible,value:n.batchText,onOk:a.doBatchAddSourceFields,onCancel:a.hideBatchSourceModal,onChange:a.batchSourceTextChange}),v.a.createElement(ze,{key:"targetBatchAdd",title:"批量添加目标字段",desc:p,columnFamily:l,placeholder:d,visible:t.visible,value:t.batchText,onOk:a.doBatchImport,onCancel:a.hideBatchImportModal,onChange:a.batchTextChange})]},a.checkHBaseRowKey=function(e){var t=a.props,n=t.keymap,r=t.targetMap,l=t.sourceSrcType,i=r.type,o=n.source;if(i&&i.rowkey){var s=function(){var e=[];if(l===z.d.HBASE)for(var t=i.rowkey.match(/([\w]+:[\w]+)/g),a=function(e){var a=t[e].split(":");if(a&&2===a.length&&!o.find(function(e){return e.cf===a[0]&&e.key===a[1]}))return x.a.error("目标表rowkey在源表中并不存在！"),{v:{v:!1}}},n=0;n<t.length;n++){var r=a(n);if("object"===(void 0===r?"undefined":Pe()(r)))return r.v}else{for(var s=/\$\(([\w]+)\)/g,c=void 0;null!==(c=s.exec(i.rowkey));)e.push(c[1]);var u=function(t){if(!(Object(g.isObject)(o[0])?o.find(function(a){return""+(void 0!==a.key?a.key:a.index)==""+e[t]?a:void 0}):o.find(function(a){return a===e[t]})))return x.a.error("rowkey在已映射的字段中并未找到"+e[t]+"！"),{v:{v:!1}}};for(n=0;n<e.length;n++){var d=u(n);if("object"===(void 0===d?"undefined":Pe()(d)))return d.v}}return{v:!0}}();if("object"===(void 0===s?"undefined":Pe()(s)))return s.v}else if(!i.rowkey)return x.a.error("目标表rowkey不能为空！"),!1},a.copySourceCols=function(e){(0,a.props.addBatchTargetKeyRow)(e&&e.map(function(e){return{key:e.key||e.index,type:e.type}}))},a.batchTextChange=function(e){a.state.batchModal;a.setState({batchModal:{visible:!0,batchText:e.target.value}})},a.batchSourceTextChange=function(e){a.state.batchSourceModal;a.setState({batchSourceModal:{visible:!0,batchText:e.target.value}})},a.doBatchImport=function(){var e=a.state.batchModal.batchText,t=a.props,n=t.addBatchTargetKeyRow,r=t.targetSrcType,l=T.a.trim(e).split(","),i=[];switch(r){case z.d.FTP:case z.d.HDFS:for(var o=0;o<l.length;o++){var s=l[o];if(s){var c=s.split(":"),u=c[0],d=c[1];if(!z.D.includes(d))return void x.a.error("字段"+u+"的数据类型错误！");i.push({key:u,type:d})}}break;case z.d.HBASE:for(var p=0;p<l.length;p++){var m=l[p];if(m){var h=m.split(":"),E=T.a.trim(h[0]),y=T.a.trim(h[1]),f=T.a.trim(h[2]);if(!z.D.includes(f))return void x.a.error("字段"+y+"的数据类型错误！");i.push({cf:E,key:y,type:f})}}}n(i),a.hideBatchImportModal()},a.hideBatchImportModal=function(){a.setState({batchModal:{visible:!1,batchText:""}})},a.hideBatchSourceModal=function(){a.setState({batchSourceModal:{visible:!1,batchText:""}})},a.importFields=function(){a.setState({batchModal:{visible:!0}})},a.importSourceFields=function(){a.setState({batchSourceModal:{visible:!0}})},a.doBatchAddSourceFields=function(){var e=a.state.batchSourceModal.batchText,t=a.props,n=t.addBatchSourceKeyRow,r=t.sourceSrcType,l=(t.sourceCol,T.a.trim(e),e.split(",")),i=[];switch(r){case z.d.FTP:case z.d.HDFS:for(var o=function(e){var t=l[e];if(!t)return"continue";var a=t.split(":"),n=parseInt(T.a.trim(a[0]),10),r=T.a.trim(a[1]);return Object(g.isNaN)(n)||!Object(g.isNumber)(n)?(x.a.error("索引名称应该为整数数字！"),{v:void 0}):z.D.includes(r)?void(i.find(function(e){return e.index===n})||i.push({index:n,type:r})):(x.a.error("字段"+n+"的数据类型错误！"),{v:void 0})},s=0;s<l.length;s++){var c=o(s);switch(c){case"continue":continue;default:if("object"===(void 0===c?"undefined":Pe()(c)))return c.v}}break;case z.d.HBASE:i.push(Xe);for(s=0;s<l.length;s++){var u=l[s];if(u){var d=u.split(":"),p=T.a.trim(d[0]),m=T.a.trim(d[1]),h=T.a.trim(d[2]);if(!z.D.includes(h))return void x.a.error("字段"+m+"的数据类型错误！");i.push({cf:p,key:m,type:h})}}}n(i),a.hideBatchSourceModal()},a.initEditKeyRow=function(e,t,n,r,l){a.setState({keyModalVisible:!0,keyModal:{operation:"edit",isReader:e,fileType:t,editField:r,position:l,source:n}})},a.doAddkeyRow=function(e){var t=a.state.keyModal.isReader,n=a.props,r=n.addSourceKeyRow,l=n.addTargetKeyRow;e&&(t?r(e):l(e),a.hideKeyModal())},a.doEditKeyRow=function(e){var t=a.props,n=t.editSourceKeyRow,r=t.editTargetKeyRow,l=t.editKeyMapTarget,i=a.state.keyModal,o=i.isReader,s=i.position,c=(i.source,i.editField);e&&(o?n(e):(r({index:s,value:e}),l({old:c,replace:e})),a.hideKeyModal())},a.hideKeyModal=function(){a.setState({keyModalVisible:!1,keyModal:{operation:"add",editField:"",source:""}})},a.state={h:40,w:230,W:450,padding:10,rowMap:!1,nameMap:!1,keyModalVisible:!1,visibleConst:!1,keyModal:{operation:"add",isReader:!0,editField:"",position:-1,source:"",fileType:"orc"},batchModal:{visible:!1,batchText:""},batchSourceModal:{visible:!1,batchText:""},sourceColumnFamily:"",targetColumnFamily:""},a}return y()(t,e),p()(t,[{key:"getCanvasW",value:function(){var e=450,t=document.querySelector(".steps-content");if(t){var a=t.getBoundingClientRect().width/6*5;a>e&&(e=a)}return e}},{key:"componentDidMount",value:function(){this.$canvas=Object(Ve.b)(this.canvas),this.$activeLine=Object(Ve.b)("#activeLine"),this.setState({W:this.getCanvasW()}),this.drawSvg(),this.listenResize(),this.loadColumnFamily(),this.initData()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize,!1)}},{key:"listenResize",value:function(){window.addEventListener&&window.addEventListener("resize",this.resize,!1)}},{key:"componentDidUpdate",value:function(){this.$canvas.selectAll(".dl, .dr, .lines").remove(),this.drawSvg()}},{key:"drawSvg",value:function(){this.renderDags(),this.renderLines(),this.bindEvents()}},{key:"renderDags",value:function(){var e=this.state,t=e.w,a=e.h,n=e.W,r=e.padding,l=this.props,i=l.targetCol,o=l.sourceCol;l.keymap;this.$canvas.append("g").attr("class","dl").selectAll("g").data(o).enter().append("g").attr("class","col-dag-l").append("circle").attr("class","dag-circle").attr("cx",function(e,t){return r}).attr("cy",function(e,t){return a*(t+1.5)}).attr("r",5).attr("stroke-width",2).attr("stroke","#fff").attr("fill","#2491F7"),this.$canvas.append("g").attr("class","dr").selectAll("g").data(i).enter().append("g").attr("class","col-dag-r").append("circle").attr("class","dag-circle").attr("cx",function(e,a){return n-2*t-r}).attr("cy",function(e,t){return a*(t+1.5)}).attr("r",5).attr("stroke-width",2).attr("stroke","#fff").attr("fill","#2491F7")}},{key:"renderLines",value:function(){var e=this.state,t=e.w,a=e.h,n=e.W,r=e.padding,l=this.props,i=l.keymap,o=l.sourceSrcType,s=l.targetSrcType,c=i.source,u=i.target,d=Object(Ve.c)(".col-dag-l"),p=Object(Ve.c)(".col-dag-r"),m=[];c.forEach(function(e,l){d.each(function(i,c){var d,h,E=void 0,y=void 0,f=void 0,v=void 0;d=i,h=e,(Object(fe.g)(o)?d.key===h:Je(d,h))&&(E=r,y=(c+1.5)*a,p.each(function(i,o){var c,d;c=i,d=u[l],(Object(fe.g)(s)?c.key===d:Je(c,d))&&(f=n-2*t-r,v=(o+1.5)*a,m.push({s:{x:E,y:y},e:{x:f,y:v},dl:e,dr:u[l]}))}))})}),this.$canvas.append("g").attr("class","lines").selectAll("g").data(m).enter().append("g").attr("class","mapline").append("line").attr("x1",function(e){return e.s.x}).attr("y1",function(e){return e.s.y}).attr("x2",function(e){return e.e.x}).attr("y2",function(e){return e.e.y}).attr("stroke","#2491F7").attr("stroke-width",2).attr("marker-end","url(#arrow)")}},{key:"bindEvents",value:function(){var e=this,t=this.state,a=t.w,n=t.h,r=t.W,l=t.padding,i=this.props,o=i.addLinkedKeys,s=i.delLinkedKeys,c=i.sourceSrcType,u=i.sourceFileType,d=i.targetSrcType,p=i.targetFileType,m=this.$activeLine,h=!1,E=void 0,y=void 0;Object(Ve.c)(".col-dag-l").on("mousedown",function(e,t,a){var r=l,i=(t+1.5)*n;m.attr("x1",r).attr("y1",i).attr("x2",r).attr("y2",i),E=e,h=!0}),this.$canvas.on("mousemove",function(){if(h){var t=Object(Ve.a)(e.$canvas.node());m.attr("x2",t[0]).attr("y2",t[1])}}).on("mouseup",function(){if(h){var t=Object(Ve.a)(e.$canvas.node()),i=_e()(t,2),s=i[0],u=i[1];if(s<r-2*a-l)e.resetActiveLine();else{var p=Math.floor(u/n)-1;Object(Ve.c)(".col-dag-r").each(function(e,t){t===p&&(y=e)})}}E&&y&&(o({source:Object(fe.g)(c)?E.key:E,target:Object(fe.g)(d)?y.key:y}),e.resetActiveLine()),h=!1}),this.$canvas.selectAll(".mapline").on("mouseover",function(e,t,a){Object(Ve.b)(a[t]).select("line").attr("stroke-width",3).attr("stroke","#2491F7")}).on("mouseout",function(e,t,a){Object(Ve.b)(a[t]).select("line").attr("stroke-width",2).attr("stroke","#2491F7")}).on("click",function(e,t,a){s({source:e.dl,target:e.dr,sourceSrcType:c,sourceFileType:u,targetSrcType:d,targetFileType:p})})}},{key:"resetActiveLine",value:function(){this.$activeLine.attr("x1",-10).attr("y1",-10).attr("x2",-10).attr("y2",-10)}},{key:"renderSource",value:function(){var e=this,t=this.state,a=t.w,n=t.h,r=(t.W,t.H,t.padding),l=this.props,i=l.sourceCol,o=l.sourceSrcType,s=l.sourceFileType,c=l.removeSourceKeyRow,u=l.readonly,d={left:r,top:r,width:a,height:n},p=function(t,a,n){var r=v.a.createElement("div",{className:"remove-cell",onClick:function(){return c(a,n)}},v.a.createElement(C.a,{title:"删除当前列"},v.a.createElement(I.a,{type:"minus"})));switch(t){case z.d.HDFS:var l=a?Ue(void 0!==a.index?a.index:"'"+a.key+"'"):"索引位";return v.a.createElement("div",null,v.a.createElement("div",{className:"cell",title:l},l),v.a.createElement("div",{className:"cell"},a?a.value?"常量":a.type.toUpperCase():"类型"),"orc"!==s?v.a.createElement("div",{className:"cell"},a?r:"操作"):"");case z.d.HBASE:var i=a?Ue(a.key):"列名/行健",o=a?a.cf:"列族";return v.a.createElement("div",{className:"four-cells"},v.a.createElement("div",{className:"cell",title:o},o),v.a.createElement("div",{className:"cell",title:i},i),v.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"),v.a.createElement("div",{className:"cell"},a?v.a.createElement("div",null,"rowkey"===a.key?"":r,v.a.createElement("div",{className:"edit-cell",onClick:function(){e.initEditKeyRow(!0,t,null,a,n)}},v.a.createElement(C.a,{title:"编辑当前列"},v.a.createElement(I.a,{type:"edit"})))):"操作"));case z.d.MAXCOMPUTE:case z.d.HIVE:var u=a?Ue(a.value?"'"+a.key+"'":a.key):"字段名称";return v.a.createElement("div",null,v.a.createElement("div",{className:"cell"},u),v.a.createElement("div",{className:"cell"},a?a.value?"常量":a.type.toUpperCase():"类型"),v.a.createElement("div",{className:"cell"},a?a.value?r:"":"操作"));case z.d.FTP:var d=a?Ue(void 0!==a.index?a.index:"'"+a.key+"'"):"字段序号";return v.a.createElement("div",null,v.a.createElement("div",{className:"cell",title:d},d),v.a.createElement("div",{className:"cell"},a?a.value?"常量":a.type.toUpperCase():"类型"),v.a.createElement("div",{className:"cell"},a?r:"操作"));default:return v.a.createElement("div",null,v.a.createElement("div",{className:"cell",title:name},a?Ue(a.key):"字段名称"),v.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"))}};return v.a.createElement("div",{className:"sourceLeft"},v.a.createElement("div",{className:"m-col title pa",style:d},p(o)),i.map(function(e,t){return v.a.createElement("div",{style:{width:a,height:n,left:r,top:r+n*(t+1)},className:"m-col pa",key:"sourceLeft-"+t},p(o,e,t))}),function(t){if(!u){var l="",o=v.a.createElement("span",{onClick:function(){e.setState({visibleConst:!0})}},"+添加常量");switch(t){case z.d.MAXCOMPUTE:case z.d.HIVE:l=v.a.createElement("div",null,o);break;case z.d.HBASE:l=v.a.createElement("div",null,v.a.createElement("span",{onClick:e.initAddKeyRow.bind(e,!0,s)},"+添加字段")," ",v.a.createElement("span",{onClick:e.importSourceFields},"批量添加"));break;case z.d.HDFS:l="orc"!==s?v.a.createElement("div",null,v.a.createElement("span",{onClick:e.initAddKeyRow.bind(e,!0,s)},"+添加字段")," ",o," ",v.a.createElement("span",{onClick:e.importSourceFields},"批量添加")):null;break;case z.d.FTP:l=v.a.createElement("div",null,v.a.createElement("span",{onClick:e.initAddKeyRow.bind(e,!0,s)},"+添加字段")," ",o," ",v.a.createElement("span",{onClick:e.importSourceFields},"批量添加"));break;default:l=null}return l?v.a.createElement("div",{className:"m-col footer pa",style:{left:r,top:r+n*(i.length+1),width:a,height:n,zIndex:100}},l):null}return""}(o))}},{key:"renderTarget",value:function(){var e=this,t=this.state,a=t.w,n=t.h,r=t.W,l=(t.H,t.padding),i=this.props,o=i.targetCol,s=i.sourceCol,c=i.readonly,u=i.targetMap,d=i.targetFileType,p=i.removeTargetKeyRow,m=i.sourceSrcType,h=i.targetSrcType,E={left:r-(l+a),top:l,width:a,height:n},y=function(t,a,n){var r=v.a.createElement("div",null,v.a.createElement("div",{className:"remove-cell",onClick:function(){return p(a,n)}},v.a.createElement(C.a,{title:"删除当前列"},v.a.createElement(I.a,{type:"minus"}))),v.a.createElement("div",{className:"edit-cell",onClick:function(){e.initEditKeyRow(!1,d,s[n],a,n)}},v.a.createElement(C.a,{title:"编辑当前列"},v.a.createElement(I.a,{type:"edit"}))));switch(t){case z.d.HDFS:return v.a.createElement("div",null,v.a.createElement("div",{className:"cell"},a?Ue(a.key):"字段名称"),v.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"),v.a.createElement("div",{className:"cell"},a?r:"操作"));case z.d.HBASE:return v.a.createElement("div",{className:"four-cells"},v.a.createElement("div",{className:"cell"},a?a.cf:"列族"),v.a.createElement("div",{className:"cell"},a?Ue(a.key):"列名"),v.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"),v.a.createElement("div",{className:"cell"},a?r:"操作"));case z.d.FTP:return v.a.createElement("div",null,v.a.createElement("div",{className:"cell"},a?Ue(a.key):"字段名称"),v.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"),v.a.createElement("div",{className:"cell"},a?r:"操作"));default:return v.a.createElement("div",null,v.a.createElement("div",{className:"cell"},a?Ue(a.key):"字段名称"),v.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"))}};return v.a.createElement("div",{className:"targetRight"},v.a.createElement("div",{className:"m-col title  pa",style:E},y(h)),o.map(function(e,t){return v.a.createElement("div",{key:"targetRight-"+t,className:"m-col pa",style:{width:a,height:n,top:l+n*(t+1),left:r-(l+a)}},y(h,e,t))}),function(t){if(!c){var i="";switch(t){case z.d.HBASE:i=v.a.createElement("div",null,v.a.createElement("span",{onClick:e.initAddKeyRow.bind(e,!1,d)},"+添加字段")," ",v.a.createElement("span",{onClick:e.importFields},"批量添加"),v.a.createElement("div",{className:"m-col"},"rowkey: ",v.a.createElement(F.a,{style:{width:"160px"},defaultValue:u.type&&u.type.rowkey||"",placeholder:m===z.d.HBASE?"$(colFamily1:colName1)":"$(colName)",onChange:e.hbaseRowKeyChange})));break;case z.d.HDFS:case z.d.FTP:i=v.a.createElement("div",null,v.a.createElement("span",{onClick:e.initAddKeyRow.bind(e,!1,d)},"+添加字段")," ",v.a.createElement("span",{onClick:e.importFields},"批量添加"));break;default:i=null}return i?v.a.createElement("div",{className:"m-col footer pa",style:{top:l+n*(o.length+1),left:r-(l+a),width:a,height:n,zIndex:100}},i):""}return""}(h))}},{key:"render",value:function(){var e=this,t=this.state,a=t.w,n=t.h,l=t.W,o=t.padding,s=t.visibleConst,c=this.props,u=c.targetCol,d=c.sourceCol,p=(c.keymap,c.sourceSrcType),m=c.navtoStep,h=c.targetSrcType,E=c.addSourceKeyRow,y=n*(Math.max(u.length,d.length)+1);return v.a.createElement("div",null,v.a.createElement("p",{style:{fontSize:12,color:"#ccc",marginTop:-20}},"您要配置来源表与目标表的字段映射关系，通过连线将待同步的字段左右相连，也可以通过同行映射、同名映射批量完成映射"),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"20"},v.a.createElement("div",{className:"m-keymapbox",ref:function(t){return e.container=t},style:{width:l,minHeight:y+20}},this.renderSource(),this.renderTarget(),v.a.createElement("svg",{ref:function(t){return e.canvas=t},width:l>2*a?l-2*a:0,height:y,className:"pa m-keymapcanvas",style:{left:a,top:o}},v.a.createElement("defs",null,v.a.createElement("marker",{id:"arrow",markerUnits:"strokeWidth",markerWidth:"12",markerHeight:"12",viewBox:"0 0 12 12",refX:"6",refY:"6",orient:"auto"},v.a.createElement("path",{d:"M2,3 L9,6 L2,9 L2,6 L2,3",style:{fill:"#2491F7"}}))),v.a.createElement("g",null,v.a.createElement("line",{id:"activeLine",x1:"-10",y1:"-10",x2:"-10",y2:"-10",stroke:"#2491F7",strokeWidth:"2",markerEnd:"url(#arrow)"}))))),v.a.createElement(i.a,{span:"4"},this.props.readonly?null:v.a.createElement("div",{className:"m-buttons"},v.a.createElement(D.a,{type:this.state.rowMap?"primary":"default",onClick:this.setRowMap.bind(this)},this.state.rowMap?"取消同行映射":"同行映射"),v.a.createElement("br",null),v.a.createElement(D.a,{disabled:Object(fe.e)(p),type:this.state.nameMap?"primary":"default",onClick:this.setNameMap.bind(this)},this.state.nameMap?"取消同名映射":"同名映射"),v.a.createElement("br",null),Object(fe.e)(h)?v.a.createElement(D.a,{onClick:function(){e.copySourceCols(d)}},"拷贝源字段"):""))),this.renderKeyModal(),this.renderBatchModal(),v.a.createElement(Qe,{visible:s,onOk:E,onCancel:function(){e.setState({visibleConst:!1})}}),!this.props.readonly&&v.a.createElement("div",{className:"steps-action",style:{marginTop:80}},v.a.createElement(D.a,{style:{marginRight:8},onClick:function(){return e.prev(m)}},"上一步"),v.a.createElement(D.a,{type:"primary",onClick:function(){return e.next(m)}},"下一步")))}},{key:"prev",value:function(e){e.call(null,1)}},{key:"next",value:function(e){var t=this.props,a=t.keymap,n=t.targetSrcType,r=a.source,l=a.target;0!==r.length||0!==l.length?(n!==z.d.HBASE||this.checkHBaseRowKey())&&e.call(null,3):x.a.error("尚未配置数据同步的字段映射！")}},{key:"setRowMap",value:function(){var e,t=this.state,a=t.rowMap,n=t.nameMap,r=this.props,l=r.targetCol,i=r.sourceCol,o=r.sourceSrcType,s=r.targetSrcType;a?this.props.resetLinkedKeys():this.props.setRowMap({sourceCol:(e=i,Object(fe.g)(o)&&(e=e.map(function(e){return e.key})),e),targetCol:function(e){return Object(fe.g)(s)&&(e=e.map(function(e){return e.key})),e}(l)}),this.setState({rowMap:!a,nameMap:n?!n:n})}},{key:"setNameMap",value:function(){var e=this.state,t=e.nameMap,a=e.rowMap,n=this.props,r=n.targetCol,l=n.sourceCol,i=n.sourceSrcType,o=n.targetSrcType;t?this.props.resetLinkedKeys():this.props.setNameMap({sourceCol:l,targetCol:r,sourceSrcType:i,targetSrcType:o}),this.setState({nameMap:!t,rowMap:a?!a:a})}},{key:"initAddKeyRow",value:function(e,t){this.setState({keyModalVisible:!0,keyModal:{operation:"add",isReader:e,fileType:t}})}}]),t}(v.a.Component),Ze=Object(b.b)(function(e){var t=e.offlineTask.dataSync;return{sourceMap:t.sourceMap,targetMap:t.targetMap,targetCol:t.targetMap.column||[],targetSrcType:t.targetMap.type&&t.targetMap.type.type,targetFileType:t.sourceMap.type&&t.targetMap.type.fileType,sourceCol:t.sourceMap.column||[],sourceSrcType:t.sourceMap.type&&t.sourceMap.type.type,sourceFileType:t.sourceMap.type&&t.sourceMap.type.fileType,keymap:t.keymap}},k.a)($e),et=(a("pJsf"),a("g4D/")),tt=a.n(et),at=(a("tnQy"),a("9Hym")),nt=a.n(at),rt=a("eCZg"),lt=j.a.Item,it=pe.a.Option,ot=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.state={isRecord:!1},a.onLifeDayChange=function(e){a.props.changeChannelSetting({lifeDay:e})},a}return y()(t,e),p()(t,[{key:"render",value:function(){for(var e=this,t=this.props.form.getFieldDecorator,a=this.props,n=a.setting,r=(a.changeChannelSetting,a.navtoStep),l=(a.form,{labelCol:{sm:{span:6}},wrapperCol:{sm:{span:14}}}),i=[],o=[],s=1;s<=20;s++)i.push(v.a.createElement(it,{value:""+s,key:s},s,"MB/s"));for(var c=1;c<=5;c++)o.push(v.a.createElement(it,{value:""+c,key:c},c));return v.a.createElement("div",{className:"g-step4"},v.a.createElement(j.a,null,v.a.createElement(lt,M()({},l,{label:"作业速率上限",style:{height:"32px"}}),t("speed",{rules:[{required:!0}],initialValue:""+n.speed})(v.a.createElement(nt.a,{dataSource:i,optionLabelProp:"value"},v.a.createElement(F.a,{suffix:"MB/s"}))),v.a.createElement(ye.a,{doc:"jobSpeedLimit"})),v.a.createElement(lt,M()({},l,{label:"作业并发数",style:{height:"32px"}}),t("channel",{rules:[{required:!0}],initialValue:""+n.channel})(v.a.createElement(nt.a,{dataSource:o,optionLabelProp:"value"})),v.a.createElement(ye.a,{doc:"jobConcurrence"})),v.a.createElement(lt,M()({},l,{label:"错误记录管理",className:"txt-left"}),t("isSaveDirty",{rules:[],initialValue:n.isSaveDirty})(v.a.createElement(tt.a,{checked:n.isSaveDirty}," 记录保存 ")),v.a.createElement(ye.a,{doc:"recordDirtyData"})),n.isSaveDirty?v.a.createElement("div",null,v.a.createElement(lt,M()({},l,{label:"脏数据写入hive表"}),t("tableName",{rules:[],initialValue:n.tableName||null})(v.a.createElement(F.a,{placeholder:"默认系统分配"})),v.a.createElement(ye.a,{doc:"recordDirtyData"})),v.a.createElement(lt,M()({},l,{label:"脏数据存储生命周期",className:"txt-left"}),t("lifeDay",{rules:[{required:!0,message:"生命周期不可为空！"}],initialValue:n.lifeDay||90})(v.a.createElement(F.a,{type:"hidden"})),v.a.createElement(rt.a,{value:n.lifeDay,width:120,onChange:this.onLifeDayChange}),v.a.createElement(ye.a,{doc:"recordDirtyData"}))):"",v.a.createElement(lt,M()({},l,{label:"错误记录数超过"}),t("record",{rules:[],initialValue:n.record})(v.a.createElement(He.a,{style:{float:"left"}})),v.a.createElement("span",{style:{float:"left"}},"条, 任务自动结束",v.a.createElement(ye.a,{doc:"errorCount"}))),v.a.createElement(lt,M()({},l,{label:"错误记录比例配置"}),v.a.createElement("span",{style:{float:"left"}},"任务执行结束后，统计错误记录占比，大于"),t("percentage",{rules:[],initialValue:n.percentage})(v.a.createElement(He.a,{style:{float:"left"}})),v.a.createElement("span",{style:{float:"left"}},"%时，任务置为失败"),v.a.createElement(ye.a,{doc:"errorPercentConfig"}))),!this.props.readonly&&v.a.createElement("div",{className:"steps-action"},v.a.createElement(D.a,{style:{marginRight:8},onClick:function(){return e.prev(r)}},"上一步"),v.a.createElement(D.a,{type:"primary",onClick:function(){return e.next(r)}},"下一步")))}},{key:"prev",value:function(e){e.call(null,2)}},{key:"next",value:function(e){var t=this.props,a=t.changeChannelSetting;t.form.validateFields(function(t,n){t||(e.call(null,4),a(n))})}}]),t}(v.a.Component),st=j.a.create({onValuesChange:function(e,t){var a=e.changeChannelSetting,n=e.setting;n.isSaveDirty&&!n.lifeDay&&(t.lifeDay=90),n.isSaveDirty||(t.tableName=null),a(t)}})(ot),ct=function(e){function t(){return u()(this,t),h()(this,(t.__proto__||s()(t)).apply(this,arguments))}return y()(t,e),p()(t,[{key:"render",value:function(){return v.a.createElement("div",null,v.a.createElement(st,this.props))}}]),t}(v.a.Component),ut=Object(b.b)(function(e){var t=e.offlineTask.dataSync;return{setting:t.setting,targetMap:t.targetMap}},function(e){return{changeChannelSetting:function(t){e({type:Ee.i.CHANGE_CHANNEL_FIELDS,payload:t}),e({type:Ee.o.MAKE_TAB_DIRTY})}}})(ct),dt=(a("mN36"),a("N9UN")),pt=a.n(dt);function mt(){return v.a.createElement("div",{className:"mask-lock-layer"})}var ht,Et,yt,ft,vt,bt=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.navtoStep=a.props.navtoStep,a}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this,t=this.navtoStep,a=this.props.notSynced;return v.a.createElement("div",{className:"g-step5"},v.a.createElement("div",{className:"m-preview",style:{padding:"0 20"}},v.a.createElement(pt.a,{bordered:!1,style:{marginBottom:10},title:"选择来源",extra:v.a.createElement("a",{href:"javascript:void(0)",onClick:function(){return e.navtoStep(0)}},"修改")},v.a.createElement(Ce,{readonly:!0}),v.a.createElement(mt,null)),v.a.createElement(pt.a,{bordered:!1,style:{marginBottom:10},title:"选择目标",extra:v.a.createElement("a",{href:"javascript:void(0)",onClick:function(){return e.navtoStep(1)}},"修改")},v.a.createElement(we,{readonly:!0}),v.a.createElement(mt,null)),v.a.createElement(pt.a,{bordered:!1,style:{marginBottom:10},title:"字段映射",extra:v.a.createElement("a",{href:"javascript:void(0)",onClick:function(){return e.navtoStep(2)}},"修改")},v.a.createElement(Ze,{readonly:!0}),v.a.createElement(mt,null)),v.a.createElement(pt.a,{bordered:!1,style:{marginBottom:10},title:"通道控制",extra:v.a.createElement("a",{href:"javascript:void(0)",onClick:function(){return e.navtoStep(3)}},"修改")},v.a.createElement(ut,{readonly:!0}),v.a.createElement(mt,null))),v.a.createElement("div",{className:"steps-action"},v.a.createElement(D.a,{style:{marginRight:8},onClick:function(){return e.prev(t)}},"上一步"),v.a.createElement(D.a,{type:"primary",disabled:!a,onClick:function(){return e.save(t)}},"保存")))}},{key:"prev",value:function(e){e.call(null,3)}},{key:"save",value:function(e){this.props.saveJob(e)}}]),t}(v.a.Component),gt=ae.a.Step,Tt=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.state={currentStep:0,loading:!0},a.getJobData=function(e){var t=a.props.dataSyncSaved;Y.a.getOfflineJobData(e).then(function(e){if(t)a.props.getDataSyncSaved(t),a.setState({currentStep:t.currentStep.step});else{if(e.data){var n=e.data.sourceMap;n.sourceList&&(n.sourceList=n.sourceList.map(function(e,t){return M()({},e,{key:0==t?"main":"key"+1e7*~~Math.random()})}))}a.props.initJobData(e.data)}e.data?(a.props.setTabSaved(),t||a.navtoStep(4)):(a.props.setTabNew(),a.navtoStep(0)),a.setState({loading:!1})})},a}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){var e=this.props.id;this.getJobData({taskId:e}),this.props.setTabId(e),this.props.getDataSource()}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.id,a=e.dataSync;this.state.loading||this.props.saveDataSyncToTab({id:t,data:a})}},{key:"next",value:function(){this.setState({currentStep:this.state.currentStep+1})}},{key:"prev",value:function(){this.setState({currentStep:this.state.currentStep-1})}},{key:"navtoStep",value:function(e){this.setState({currentStep:e}),this.props.setCurrentStep(e)}},{key:"save",value:function(){var e=this.props,t=e.saveJobData,a=e.dataSync;t(this.generateRqtBody(a))}},{key:"generateRqtBody",value:function(e){var t=Object(g.cloneDeep)(e),a=this.props,n=a.tabs,r=a.currentTab,l=t.keymap,i=t.sourceMap,o=t.targetMap,s=l.source,c=l.target,u=this.props,d=u.name,p=u.id;t.sourceMap.column=s,t.targetMap.column=c,t.settingMap=t.setting,t.name=d,t.taskId=p;var m=o.type,h=i.type;for(var E in h)h.hasOwnProperty(E)&&(i[E]=h[E]);for(var y in m)m.hasOwnProperty(y)&&(o[y]=m[y]);delete t.keymap,delete t.setting,delete t.dataSourceList,delete t.currentStep;var f=Object(g.cloneDeep)(n.filter(function(e){return e.id===r})[0]);for(var v in t)t.hasOwnProperty(v)&&(f[v]=t[v]);return f.preSave=!0,f.taskVOS&&(f.dependencyTasks=f.taskVOS.map(function(e){return e}),f.taskVOS=null),f}},{key:"render",value:function(){var e=this.state,t=e.currentStep,a=e.loading,n=this.props,r=n.readWriteLockVO,l=n.notSynced,i=n.user,o=n.project,s=r&&!r.getLock,c=Object(fe.f)(o,i),u=[{title:"数据来源",content:v.a.createElement(Ce,{currentStep:t,navtoStep:this.navtoStep.bind(this)})},{title:"选择目标",content:v.a.createElement(we,{currentStep:t,navtoStep:this.navtoStep.bind(this)})},{title:"字段映射",content:v.a.createElement(Ze,{currentStep:t,navtoStep:this.navtoStep.bind(this)})},{title:"通道控制",content:v.a.createElement(ut,{currentStep:t,navtoStep:this.navtoStep.bind(this)})},{title:"预览保存",content:v.a.createElement(bt,{currentStep:t,notSynced:l,navtoStep:this.navtoStep.bind(this),saveJob:this.save.bind(this)})}];return a?null:v.a.createElement("div",{className:"m-datasync"},v.a.createElement(ae.a,{current:t},u.map(function(e){return v.a.createElement(gt,{key:e.title,title:e.title})})),v.a.createElement("div",{className:"steps-content",style:{position:"relative"}},s||!c?v.a.createElement("div",{className:"steps-mask"}):null,u[t].content))}}]),t}(v.a.Component),kt=Object(b.b)(function(e){var t=e.offlineTask.workbench.currentTab;return{dataSync:e.offlineTask.dataSync,tabs:e.offlineTask.workbench.tabs,currentTab:t,user:e.user,project:e.project}},function(e){return{getDataSource:function(){Y.a.getOfflineDataSource().then(function(t){var a=[];1===t.code&&(a=t.data),e({type:Ee.b.LOAD_DATASOURCE,payload:a})})},initJobData:function(t){e({type:Ee.c.INIT_JOBDATA,payload:t})},setTabNew:function(){e({type:Ee.o.SET_CURRENT_TAB_NEW})},setTabSaved:function(){e({type:Ee.o.SET_CURRENT_TAB_SAVED})},saveDataSyncToTab:function(t){e({type:Ee.o.SAVE_DATASYNC_TO_TAB,payload:{id:t.id,data:t.data}})},getDataSyncSaved:function(t){e({type:Ee.c.GET_DATASYNC_SAVED,payload:t})},setTabId:function(t){e({type:Ee.c.SET_TABID,payload:t})},setCurrentStep:function(t){e({type:Ee.c.SET_CURRENT_STEP,payload:t})},saveJobData:function(t){Y.a.saveOfflineJobData(t).then(function(t){1===t.code&&(x.a.success("保存成功！"),e({type:Ee.o.SET_CURRENT_TAB_SAVED}),e({type:Ee.o.MAKE_TAB_CLEAN}))})}}})(Tt),St=a("P2sY"),Ct=a.n(St),Ot=a("fvjX"),Nt=a("5012"),Lt=a("lSrH"),Dt=a("76p7"),Rt=a("Ohfy"),It=a("Nr44"),At=a("dmTY"),xt=Object(Lt.a)(ht=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.state={},n.handleEditorTxtChange=function(e,t){var a=n.props.currentTabData,r=n.props.taskCustomParams,l={merged:!1,cursorPosition:t.getPosition()};T.a.checkExist(a.taskType)?(l.sqlText=e,l.taskVariables=Object(fe.h)(r,e)):T.a.checkExist(a.type)&&(l.scriptText=e),n.props.updateTaskField(l)},n.onNeverWarning=function(e){var t=e.target.checked?1:0;n.props.updateUser({isCheckDDL:t})},n.filterSql=function(e){var t=[],a=Object(Nt.b)(e);if(a&&(a=Object(Nt.k)(a)),a&&a.length>0)for(var n=0;n<a.length;n++){var r=a[n];""!==T.a.trim(r)&&t.push(T.a.trimlr(r))}return t},n.execSQL=function(){var e=n.props,t=e.user,a=e.editor,r=e.project,l=e.currentTab,i=e.currentTabData,o={projectId:r.id,isCheckDDL:t.isCheckDDL,taskVariables:i.taskVariables},s=a.selection||i.sqlText||i.scriptText;s&&s.length>0&&(n.props.setOutput(l,"正在提交..."),n.props.addLoadingTab(l),n.reqExecSQL(i,o,[s],0))},n.reqExecSQL=function(e,t,a,r){var l=n.props,i=l.currentTab;(0,l.execSql)(i,e,t,a)},n.stopSQL=function(){var e=n.props,t=e.currentTabData,a=e.currentTab;(0,e.stopSql)(a,t)},n.execConfirm=function(){var e=n.props,t=e.currentTabData;e.user,e.editor.selection||t.sqlText||t.scriptText;n.execSQL()},n.sqlFormat=function(){var e=n.props,t=e.currentTabData,a=e.updateTaskField,r={sql:t.sqlText||t.scriptText||""};Y.a.sqlFormat(r).then(function(e){if(e.data){var n={merged:!0};t.scriptText?n.scriptText=e.data:n.sqlText=e.data,a(n)}})},n.removeConsoleTab=function(e){var t=n.props.currentTab;n.props.removeRes(t,parseInt(e,10))},n.closeConsole=function(){var e=n.props.currentTab;n.props.resetConsole(e)},n.debounceChange=Object(g.debounce)(n.handleEditorTxtChange,300,{maxWait:2e3}),n.debounceSelectionChange=Object(g.debounce)(n.props.setSelectionContent,200,{maxWait:2e3}),r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentTabData;e&&this.props.getTab(e.id)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentTabData,a=this.props.currentTabData;t&&t.id!==a.id&&this.props.getTab(t.id)}},{key:"render",value:function(){var e=this,t=this.props,a=t.editor,n=void 0===a?{}:a,r=t.currentTabData,l=t.value,i=t.mode,o=t.toolBarOptions,s=void 0===o?{}:o,c=t.project,u=t.user,d=r.id,p=n.console,m=p&&p[d]?p[d]:{results:[]},h=r.cursorPosition||void 0,E=r.readWriteLockVO&&!r.readWriteLockVO.getLock,y=Object(fe.f)(c,u),f={value:l,language:i,options:{readOnly:E||!y},cursorPosition:h,theme:n.options.theme,onChange:this.debounceChange,sync:r.merged||void 0,onCursorSelection:this.debounceSelectionChange},b=M()({enable:!0,enableRun:y,disAbleEdit:!y,isRunning:n.running.indexOf(d)>-1,onRun:this.execConfirm,onStop:this.stopSQL,onFileEdit:Object(Dt.a)(this._editor),onThemeChange:function(t){e.props.updateEditorOptions({theme:t})}},s),g={data:m,onConsoleClose:this.closeConsole,onRemoveTab:this.removeConsoleTab};return v.a.createElement("div",{className:"m-editor",style:{height:"100%"}},v.a.createElement(Rt.a,{editorInstanceRef:function(t){e._editor=t},editor:f,toolbar:b,console:g}))}}]),t}(f.Component))||ht,wt=Object(b.b)(function(e){return{editor:e.editor,project:e.project,user:e.user}},function(e){var t=Object(k.b)(e),a=Object(Ot.b)(At,e);return Ct()(a,{updateTaskField:t.updateTaskField,updateUser:function(t){e(Object(It.e)(t))}})})(xt),Ft=a("GQeE"),_t=a.n(Ft),Mt=a("wd/R"),Pt=a.n(Mt),Vt=a("TH1f"),Ut=j.a.Item,jt=pe.a.Option,Ht=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.state={sourceType:void 0,targetType:void 0},r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"newSource",value:function(){W.g.push("/database")}},{key:"sourceTypeChange",value:function(e){var t=this.props.form.setFieldsValue;this.setState({sourceType:e},function(){t({sourceId:void 0})})}},{key:"targetTypeChange",value:function(e){var t=this.props.form.setFieldsValue;this.setState({targetType:e},function(){t({targetSourceId:void 0})})}},{key:"getSourceList",value:function(){var e=this.state.sourceType;return this.props.dataSourceList.filter(function(t){return t.type==e}).map(function(e){return v.a.createElement(jt,{key:e.id,name:e.dataName,value:""+e.id},e.dataName,"( ",v.a.createElement(Vt.d,{value:e.type}),"  )")})}},{key:"getTargetList",value:function(){var e=this.state.targetType;return this.props.dataSourceList.filter(function(t){return t.type==e}).map(function(e){return v.a.createElement(jt,{key:e.id,name:e.dataName,value:""+e.id},e.dataName,"( ",v.a.createElement(Vt.d,{value:e.type})," )")})}},{key:"getTemplateFromNet",value:function(){var e=this,t=this.props.form.validateFields,a=this.props.id;t(function(t,n){if(!t){var r={id:a,sourceMap:{sourceId:n.sourceId,type:n.sourceType},targetMap:{sourceId:n.targetSourceId,type:n.targetType},taskId:a};Y.a.getSyncTemplate(r).then(function(t){1==t.code&&(x.a.success("导入成功"),e.props.onSuccess(t.data))})}})}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.props,a=(t.dataSourceList,t.execConfirmVisible),n=_t()(z.d).map(function(e){var t=z.d[e];return v.a.createElement(jt,{key:t,value:t.toString()},v.a.createElement(Vt.d,{value:t}))});return v.a.createElement(B.a,{maskClosable:!0,visible:a,title:"导入模版",onCancel:this.props.onCancel,onOk:this.getTemplateFromNet.bind(this)},v.a.createElement(j.a,null,v.a.createElement(Ut,M()({},z.C,{label:"来源类型",hasFeedback:!0}),e("sourceType",{rules:[{required:!0,message:"来源类型不可为空！"}]})(v.a.createElement(pe.a,{placeholder:"请选择来源类型",onChange:this.sourceTypeChange.bind(this)},n))),v.a.createElement(Ut,M()({style:{marginBottom:"35px"}},z.C,{label:"数据源",hasFeedback:!0}),e("sourceId",{rules:[{required:!0,message:"数据源不可为空！"}]})(v.a.createElement(pe.a,{placeholder:"请选择数据源"},this.getSourceList()))),v.a.createElement(Ut,M()({},z.C,{label:"目标类型",hasFeedback:!0}),e("targetType",{rules:[{required:!0,message:"目标类型不可为空！"}]})(v.a.createElement(pe.a,{placeholder:"请选择目标类型",onChange:this.targetTypeChange.bind(this)},n))),v.a.createElement(Ut,M()({},z.C,{label:"数据源",hasFeedback:!0}),e("targetSourceId",{rules:[{required:!0,message:"数据源不可为空！"}]})(v.a.createElement(pe.a,{placeholder:"请选择目标数据源"},this.getTargetList())))))}}]),t}(f.Component),Bt=j.a.create()(Ht),Gt=Object(b.b)(function(e){return{dataSourceList:e.offlineTask.dataSync.dataSourceList}},function(e){return{getDataSource:function(){Y.a.getOfflineDataSource().then(function(t){var a=[];1===t.code&&(a=t.data),e({type:Ee.b.LOAD_DATASOURCE,payload:a})})}}})(Et=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.state={execConfirmVisible:!1},n.onSuccess=function(e){var t=n.props.dispatch,a={merged:!0};a.sqlText=T.a.jsonFormat(e),n.setState({execConfirmVisible:!1}),t({type:Ee.o.SET_TASK_SQL_FIELD_VALUE,payload:a})},r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){(0,this.props.getDataSource)()}},{key:"importTemplate",value:function(){this.setState({execConfirmVisible:!0})}},{key:"render",value:function(){var e=this,t=this.state.execConfirmVisible;return v.a.createElement("span",null,v.a.createElement(D.a,{onClick:this.importTemplate.bind(this),title:"导入模版",icon:"plus-circle-o",style:{marginLeft:"0px"}},"导入模版"),v.a.createElement(Bt,M()({execConfirmVisible:t,onCancel:function(){e.setState({execConfirmVisible:!1})},onSuccess:this.onSuccess.bind(this)},this.props)))}}]),t}(f.Component))||Et,qt=Object(b.b)(function(e){return{project:e.project,user:e.user}},function(e){return{dispatch:e,updateTaskFields:function(t){e({type:Ee.o.SET_TASK_FIELDS_VALUE,payload:t})}}})(yt=function(e){function t(){return u()(this,t),h()(this,(t.__proto__||s()(t)).apply(this,arguments))}return y()(t,e),p()(t,[{key:"onFormat",value:function(){var e=this.props,t=e.sqlText,a=e.dispatch,n={merged:!0};n.sqlText=T.a.jsonFormat(t),n.sqlText?a({type:Ee.o.SET_TASK_SQL_FIELD_VALUE,payload:n}):message.error("您的JSON格式有误")}},{key:"getRightButton",value:function(){return v.a.createElement("span",null,v.a.createElement(I.a,{style:{color:"#2491F7",marginRight:"2px"},type:"question-circle-o"}),v.a.createElement("a",{href:z.i.DATA_SYNC,target:"blank"},"帮助文档"))}},{key:"getLeftButton",value:function(){return v.a.createElement(Gt,this.props)}},{key:"render",value:function(){var e=this.props,t=e.taskCustomParams,a=e.id,n=e.sqlText,r=e.currentTabData,l=e.project,i=e.user,o=Object(fe.f)(l,i);return v.a.createElement(wt,{mode:"json",taskCustomParams:t,key:a,value:n,currentTab:a,currentTabData:r,toolBarOptions:{enableRun:!1,enableFormat:o,disAbleEdit:!o,onFormat:this.onFormat.bind(this),rightCustomButton:this.getRightButton(),leftCustomButton:o&&this.getLeftButton()}})}}]),t}(f.Component))||yt,Wt=a("ZQcs"),Kt=j.a.Item,Yt=(pe.a.Option,ue.a.Group),zt=function(e){function t(){return u()(this,t),h()(this,(t.__proto__||s()(t)).apply(this,arguments))}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.props,a=t.taskType,n=this.props,r=n.taskTypes,l=n.isWorkflowNode,i=n.user,o=n.project,s=a===z.y.MR,c=a===z.y.PYTHON,u=a==z.y.VIRTUAL_NODE,d=a==z.y.DEEP_LEARNING,p=a==z.y.PYTHON_23,m=a==z.y.ML,h=a==z.y.HAHDOOPMR,E=m||h||s?z.q.JAR:c||p||d?z.q.PY:"",y=!(c||p||u||d),f=!u&&!p&&!d,b=d||p,g=Object(fe.f)(o,i);return v.a.createElement(j.a,null,v.a.createElement(Kt,M()({},z.C,{label:"任务名称"}),e("name",{rules:[{max:64,message:"任务名称不得超过20个字符！"}],initialValue:t.name})(v.a.createElement(F.a,{disabled:!0}))),v.a.createElement(Kt,M()({},z.C,{label:"任务类型"}),e("taskType",{rules:[{}],initialValue:a})(v.a.createElement(Yt,{disabled:!0,onChange:this.handleRadioChange},r.map(function(e){return v.a.createElement(ue.a,{key:e.key,value:e.key},e.value)})))),!u&&v.a.createElement(Kt,M()({},z.C,{label:"资源"}),e("resourceIdList",{rules:[{required:!0,message:"请选择关联资源"}],initialValue:t.resourceList.length?t.resourceList[0].id:""})(v.a.createElement(F.a,{disabled:!g,type:"hidden"})),v.a.createElement(Wt.a,{couldEdit:g,ispicker:!0,isFilepicker:!0,acceptRes:E,type:z.l.RESOURCE,treeData:this.props.resTreeData,onChange:this.handleResChange.bind(this),defaultNode:t.resourceList.length?t.resourceList[0].resourceName:""})),y&&v.a.createElement(Kt,M()({},z.C,{label:"mainClass",hasFeedback:!0}),e("mainClass",{rules:[{required:!0,message:"mainClass 不可为空！"}],initialValue:t.mainClass})(v.a.createElement(F.a,{disabled:!g,placeholder:"请输入 mainClass"}))),f&&v.a.createElement(Kt,M()({},z.C,{label:"任务参数"}),e("exeArgs",{initialValue:t.exeArgs})(v.a.createElement(F.a,{disabled:!g,placeholder:"请输入任务参数"}))),d&&v.a.createElement("span",null,v.a.createElement(Kt,M()({},z.C,{label:"数据输入路径"}),e("input",{initialValue:t.input})(v.a.createElement(F.a,{disabled:!g,placeholder:"请输入数据输入路径"}))),v.a.createElement(Kt,M()({},z.C,{label:"模型输出路径"}),e("output",{initialValue:t.output})(v.a.createElement(F.a,{disabled:!g,placeholder:"请输入模型输出路径"})))),b&&v.a.createElement(Kt,M()({},z.C,{label:"参数"}),e("options",{initialValue:t.options})(v.a.createElement(F.a,{disabled:!g,placeholder:"请输入命令行参数"}))),!l&&v.a.createElement(Kt,M()({},z.C,{label:"存储位置"}),e("nodePid",{rules:[{required:!0,message:"存储位置必选！"}],initialValue:t.nodePid})(v.a.createElement(F.a,{disabled:!g,type:"hidden"})),v.a.createElement(Wt.a,{couldEdit:g,type:z.l.TASK,ispicker:!0,isFilepicker:!1,treeData:this.props.pathTreeData,onChange:this.handlePathChange.bind(this),defaultNode:t.nodePName})),v.a.createElement(Kt,M()({},z.C,{label:"描述",hasFeedback:!0}),e("taskDesc",{rules:[{max:200,message:"描述请控制在200个字符以内！"}],initialValue:t.taskDesc})(v.a.createElement(F.a,{disabled:!g,type:"textarea",rows:4,placeholder:"请输入任务描述"}))),v.a.createElement(Kt,{style:{display:"none"}},e("computeType",{initialValue:1})(v.a.createElement(F.a,{disabled:!g,type:"hidden"}))))}},{key:"handleResChange",value:function(e){this.props.form.setFieldsValue({resourceIdList:[e]})}},{key:"handlePathChange",value:function(e){this.props.form.setFieldsValue({nodePid:e})}}]),t}(v.a.Component),Qt=j.a.create({onValuesChange:function(e,t){var a=e.setFieldsValue,n=e.taskCustomParams,r=!1;""===t.mainClass&&(r=!0),t.invalid=r,""!==t.exeArgs&&(t.taskVariables=Object(fe.h)(n,t.exeArgs)),a(t)}})(zt),Xt=function(e){function t(e){return u()(this,t),h()(this,(t.__proto__||s()(t)).call(this,e))}return y()(t,e),p()(t,[{key:"render",value:function(){return v.a.createElement("div",{className:"m-taskedit",style:{padding:60}},v.a.createElement(Qt,this.props))}}]),t}(v.a.Component),Jt=Object(b.b)(function(e,t){var a=e.offlineTask,n=e.user,r=e.project;return{resTreeData:a.resourceTree,pathTreeData:a.taskTree,taskCustomParams:a.workbench.taskCustomParams,taskTypes:a.comm.taskTypes,user:n,project:r}},function(e){return{setFieldsValue:function(t){e({type:Ee.o.SET_TASK_FIELDS_VALUE,payload:t})}}})(Xt),$t=a("FyfS"),Zt=a.n($t),ea=a("4d7F"),ta=a.n(ea),aa=a("AlEQ"),na=a("lFj+"),ra=Object(Lt.a)(ft=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.state={confirmCode:"",execConfirmVisible:!1,tableList:[],funcList:[],tableCompleteItems:[],funcCompleteItems:[],tables:[],columns:{}},n._tableColumns={},n._tableLoading={},n.handleEditorTxtChange=function(e,t){var a=n.props.currentTabData,r=n.props.taskCustomParams,l={merged:!1,cursorPosition:t.getPosition()};if(T.a.checkExist(a.taskType)){l.sqlText=e;var i=Object(Nt.b)(e);l.taskVariables=Object(fe.h)(r,i)}else T.a.checkExist(a.type)&&(l.scriptText=e);n.props.updateTaskField(l)},n.onNeverWarning=function(e){var t=e.target.checked?1:0;n.props.updateUser({isCheckDDL:t})},n.filterSql=function(e){var t=[],a=Object(Nt.b)(e);if(a&&(a=Object(Nt.k)(a)),a&&a.length>0)for(var n=0;n<a.length;n++){var r=a[n];""!==T.a.trim(r)&&t.push(T.a.trimlr(r))}return t},n.execSQL=function(){var e=n.props,t=e.user,a=e.editor,r=e.project,l=e.currentTab,i=e.currentTabData,o={projectId:r.id,isCheckDDL:t.isCheckDDL,taskVariables:i.taskVariables};n.setState({execConfirmVisible:!1});var s=a.selection||i.sqlText||i.scriptText,c=n.filterSql(s);if(c&&c.length>0){n.props.setOutput(l,"正在提交..."),n.props.addLoadingTab(l),n.reqExecSQL(i,o,c,0)}},n.reqExecSQL=function(e,t,a,r){var l=n.props,i=l.currentTab;(0,l.execSql)(i,e,t,a).then(function(e){e&&(n._tableColumns={},n.initTableList())})},n.stopSQL=function(){var e=n.props,t=e.currentTabData,a=e.currentTab;(0,e.stopSql)(a,t)},n.execConfirm=function(){var e=n.props,t=e.currentTabData,a=e.user,r=e.editor;if(1!==a.isCheckDDL){var l=r.selection||t.sqlText||t.scriptText,i=(l=Object(Nt.b)(l)).replace(/show\s+create/gi,"show");/(create|alter|drop|truncate)+\s+(external|temporary)?\s?(table)+\s+([\s\S]*?)/gi.test(i)?n.setState({execConfirmVisible:!0,confirmCode:l}):(n.execSQL(),n.setState({execConfirmVisible:!1}))}else n.execSQL()},n.sqlFormat=function(){var e=n.props,t=e.currentTabData,a=e.updateTaskField,r={sql:t.sqlText||t.scriptText||""};Y.a.sqlFormat(r).then(function(e){if(e.data){var n={merged:!0};t.scriptText?n.scriptText=e.data:n.sqlText=e.data,a(n)}})},n.removeConsoleTab=function(e){var t=n.props.currentTab;n.props.removeRes(t,parseInt(e,10))},n.closeConsole=function(){var e=n.props.currentTab;n.props.resetConsole(e)},n.debounceChange=Object(g.debounce)(n.handleEditorTxtChange,300,{maxWait:2e3}),n.debounceSelectionChange=Object(g.debounce)(n.props.setSelectionContent,200,{maxWait:2e3}),n.debounceSyntaxChange=Object(g.debounce)(n.onSyntaxChange.bind(n),200,{maxWait:2e3}),r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentTabData;e&&this.props.getTab(e.id),this.initTableList(),this.initFuncList()}},{key:"initTableList",value:function(e){var t=this;(e=e||this.props.project.id)&&Y.a.getTableListByName({appointProjectId:e}).then(function(e){if(1==e.code){var a=e.data;t.setState({tableList:a.children||[],tableCompleteItems:a.children&&a.children.map(function(e){return[e.name,"表名","1200","Field"]})})}})}},{key:"initFuncList",value:function(){var e=this;Y.a.getAllFunction().then(function(t){if(1==t.code){var a=t.data;e.setState({funcList:a||[],funcCompleteItems:a&&a.map(function(e){return[e,"函数","2000","Function"]})})}})}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentTabData,a=this.props.currentTabData,n=e.project,r=this.props.project;n.id!=r.id&&this.initTableList(n.id),t&&t.id!==a.id&&this.props.getTab(t.id)}},{key:"completeProvider",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=n.autoComplete,l=void 0===r?{}:r,i=(n.syntax,n.context),o=void 0===i?{}:i,s=(n.word,this.state),c=s.tableCompleteItems,u=s.funcCompleteItems,d=e.concat(a(c)).concat(a(u));if("."==o.completionContext.triggerCharacter&&(d=[]),l&&l.locations){var p=[],m=!0,h=!1,E=void 0;try{for(var y,f=Zt()(l.locations);!(m=(y=f.next()).done);m=!0){var v=y.value;if("table"==v.type){var b=!0,g=!1,T=void 0;try{for(var k,S=Zt()(v.identifierChain);!(b=(k=S.next()).done);b=!0){var C=k.value,O=this.getTableColumns(C.name);p.push(O)}}catch(e){g=!0,T=e}finally{try{!b&&S.return&&S.return()}finally{if(g)throw T}}}}}catch(e){h=!0,E=e}finally{try{!m&&f.return&&f.return()}finally{if(h)throw E}}ta.a.all(p).then(function(e){var n={},r=!0,l=!1,i=void 0;try{for(var s,c=function(){var e=s.value;if(!e||!e[1]||!e[1].length)return"continue";if(n[e[0]])return"continue";if(n[e[0]]=!0,o.columnContext&&o.columnContext.indexOf(e[0])>-1)d=d.concat(a(e[1].map(function(t){return[t,e[0],"100","Variable"]})));else{if("."==o.completionContext.triggerCharacter)return"continue";d=d.concat(a(e[1].map(function(t){return[t,e[0],"1100","Variable"]})))}},u=Zt()(e);!(r=(s=u.next()).done);r=!0)c()}catch(e){l=!0,i=e}finally{try{!r&&u.return&&u.return()}finally{if(l)throw i}}t(d)}).catch(function(e){t(d)})}else t(d)}},{key:"getTableColumns",value:function(e){var t=this,a=this._tableColumns;return a[e]?ta.a.resolve(a[e]):this._tableLoading[e]?this._tableLoading[e]:(this._tableLoading[e]=Y.a.getColumnsOfTable({tableName:e}).then(function(n){if(t._tableLoading[e]=null,1==n.code)return a[e]=[e,n.data],a[e]}),this._tableLoading[e])}},{key:"onSyntaxChange",value:function(e,t){var a=this,n=e.locations,r=[],l=[],i={},o={},s=!0,c=!1,u=void 0;try{for(var d,p=Zt()(n);!(s=(d=p.next()).done);s=!0){var m=d.value;if("table"==m.type){var h=!0,E=!1,y=void 0;try{for(var f,v=Zt()(m.identifierChain);!(h=(f=v.next()).done);h=!0){var b=f.value;if(!o[b.name]){o[b.name]=!0,l.push(b.name);var g=this.getTableColumns(b.name);r.push(g)}}}catch(e){E=!0,y=e}finally{try{!h&&v.return&&v.return()}finally{if(E)throw y}}}}}catch(e){c=!0,u=e}finally{try{!s&&p.return&&p.return()}finally{if(c)throw u}}this.setState({tables:l}),ta.a.all(r).then(function(e){var t=!0,n=!1,r=void 0;try{for(var l,o=Zt()(e);!(t=(l=o.next()).done);t=!0){var s=l.value;s&&s[1]&&s[1].length&&(i[s[0]]=s[1])}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}a.setState({columns:i})})}},{key:"render",value:function(){var e=this,t=this.props,a=t.editor,n=t.currentTabData,r=t.value,l=t.project,i=t.user,o=n.id,s=a.console,c=s&&s[o]?s[o]:{results:[]},u=this.state,d=u.execConfirmVisible,p=u.confirmCode,m=u.funcList,h=n.cursorPosition||void 0,E=n.readWriteLockVO&&!n.readWriteLockVO.getLock,y=Object(fe.f)(l,i),f={value:r,language:"dtsql",options:{readOnly:!y||E},customCompleteProvider:this.completeProvider.bind(this),languageConfig:M()({},aa.language,{builtinFunctions:[],windowsFunctions:[],innerFunctions:[],otherFunctions:[],customFunctions:m}),cursorPosition:h,theme:a.options.theme,onChange:this.debounceChange,onSyntaxChange:this.debounceSyntaxChange,sync:n.merged||void 0,onCursorSelection:this.debounceSelectionChange},b={enable:!0,enableRun:!0,enableFormat:y,disAbleEdit:!y,isRunning:a.running.indexOf(o)>-1,onRun:this.execConfirm,onStop:this.stopSQL,onFormat:this.sqlFormat,onFileEdit:Object(Dt.a)(this._editor),editorTheme:a.options.theme,onThemeChange:function(t){e.props.updateEditorOptions({theme:t})}},g={data:c,onConsoleClose:this.closeConsole,onRemoveTab:this.removeConsoleTab,downloadUri:na.a.DOWNLOAD_SQL_RESULT};return v.a.createElement("div",{className:"m-editor",style:{height:"100%"}},v.a.createElement(Rt.a,{editorInstanceRef:function(t){e._editor=t},editor:f,toolbar:b,console:g}),v.a.createElement("div",{id:"JS_ddl_confirm_modal"},v.a.createElement(B.a,{maskClosable:!0,visible:d,title:"执行的语句中包含DDL语句，是否确认执行？",wrapClassName:"vertical-center-modal modal-body-nopadding",getContainer:function(){return Object(Nt.c)("JS_ddl_confirm_modal")},onCancel:function(){e.setState({execConfirmVisible:!1})},footer:v.a.createElement("div",null,v.a.createElement(tt.a,{onChange:this.onNeverWarning},"不再提示"),v.a.createElement(D.a,{onClick:function(){e.setState({execConfirmVisible:!1})}},"取消"),v.a.createElement(D.a,{type:"primary",onClick:this.execSQL},"执行"))},v.a.createElement("div",{style:{height:"400px"}},v.a.createElement(Oe.a,{value:p,sync:!0,language:"dtsql",options:{readOnly:!0,minimap:{enabled:!1}}})))))}}]),t}(f.Component))||ft,la=Object(b.b)(function(e){return{editor:e.editor,project:e.project,user:e.user}},function(e){var t=Object(k.b)(e),a=Object(Ot.b)(At,e);return Ct()(a,{updateTaskField:t.updateTaskField,updateUser:function(t){e(Object(It.e)(t))}})})(ra),ia=a("gDS+"),oa=a.n(ia),sa=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.bindEvent=function(e){var t=a.props,n=t.onKeyDown,r=t.onKeyUp,l="keydown"===e.type;l&&n?n(e):!l&&r&&r(e)},a}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){addEventListener("keydown",this.bindEvent,!1),addEventListener("keyup",this.bindEvent,!1)}},{key:"componentWillUnmount",value:function(){removeEventListener("keydown",this.bindEvent,!1),removeEventListener("keyup",this.bindEvent,!1)}},{key:"render",value:function(){return this.props.children}}]),t}(v.a.Component),ca={BACKUP:8,COMMAND:91,CTRL:17},ua=a("gqQu"),da=function(e){function t(){return u()(this,t),h()(this,(t.__proto__||s()(t)).apply(this,arguments))}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.props,t=e.lockTarget,a=e.couldEdit;return t&&t.readWriteLockVO&&!t.readWriteLockVO.getLock||!a&&"boolean"==typeof a?v.a.createElement("div",{className:"cover-mask"}):null}}]),t}(f.Component),pa=a("WydL")({mxBasePath:"public/rdos/mxgraph",mxImageBasePath:"public/rdos/mxgraph/images",mxLanguage:"none",mxLoadResources:!1,mxLoadStylesheets:!1}),ma=pa.mxGraph,ha=pa.mxShape,Ea=pa.mxPoint,ya=pa.mxCell,fa=pa.mxText,va=pa.mxGeometry,ba=pa.mxUtils,ga=pa.mxEvent,Ta=pa.mxPopupMenu,ka=pa.mxDragSource,Sa=pa.mxPolyline,Ca=pa.mxConstants,Oa=pa.mxEdgeStyle,Na=pa.mxPerimeter,La=pa.mxRubberband,Da=pa.mxUndoManager,Ra=pa.mxGraphView,Ia=pa.mxGraphHandler,Aa=pa.mxEventObject,xa=pa.mxConstraintHandler,wa=pa.mxConnectionConstraint,Fa=pa.mxHierarchicalLayout,_a={width:150,height:40},Ma="#2491F7",Pa="JS_WIDGETS_",Va=pe.a.Option,Ua=function(e,t){e&&(e.style=Ct()(e.style,t),e.shape.apply(e),e.shape.redraw())},ja=Object(b.b)(function(e){var t=e.offlineTask,a=e.project,n=e.user,r=e.editor,l=t.workbench,i=t.workflow,o=l.currentTab;return{tabs:l.tabs,user:n,workflow:i,currentTab:o,editor:r,taskTypes:t.comm.taskTypes,project:a}},k.b)(vt=function(e){function t(){for(var e,a,n,r,l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return u()(this,t),a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.state={showSearch:!1,showGuidePic:!1},n.loadEditor=function(e){Ca.DEFAULT_VALID_COLOR="none",Ca.HANDLE_STROKECOLOR="#C5C5C5",Ca.CONSTRAINT_HIGHLIGHT_SIZE=4,Ca.GUIDE_COLOR=Ma,Ca.EDGE_SELECTION_COLOR=Ma,Ca.VERTEX_SELECTION_COLOR=Ma,Ca.HANDLE_FILLCOLOR=Ma,Ca.VALID_COLOR=Ma,Ca.HIGHLIGHT_COLOR=Ma,Ca.OUTLINE_HIGHLIGHT_COLOR=Ma,Ca.CONNECT_HANDLE_FILLCOLOR=Ma,xa.prototype.highlightColor=Ma,Ra.prototype.optimizeVmlReflows=!1,fa.prototype.ignoreStringSize=!0,Ia.prototype.guidesEnabled=!0,ga.disableContextMenu(e);var t=new ma(e);n.graph=t,t.panningHandler.useLeftButtonForPanning=!0,t.keepEdgesInBackground=!1,t.allowLoops=!1,t.cellsResizable=!1,t.setPanning(!0),t.setConnectable(!0),t.setTooltips(!0),t.view.setScale(1),t.setHtmlLabels(!0),t.setAllowDanglingEdges(!1),t.isCellsMovable=function(e){return!((e=t.getSelectionCell())&&e.edge)},t.isCellEditable=function(){return!1};var a=n.getDefaultEdgeStyle();t.getStylesheet().putDefaultEdgeStyle(a);var r=n.getDefaultVertexStyle();t.getStylesheet().putDefaultVertexStyle(r),t.convertValueToString=n.corvertValueToString,t.getTooltipForCell=n.formatTooltip,new La(t),n.listenConnection(),n.initDraggableToolBar(),n.initGraphLayout(),n.initUndoManager(),n.initContextMenu(),n.initGraphEvent()},n.getStyles=function(){return"whiteSpace=wrap;fillColor=#F5F5F5;strokeColor=#C5C5C5;"},n.formatTooltip=function(e){if(n.Container){var t=e.data||"";return t?t.name+(t.notSynced?" (未保存) ":""):""}},n.corvertValueToString=function(e){if(e&&e.vertex){var t=e.data;return n.convertTaskToHTML(t)}},n.convertTaskToHTML=function(e){if(e){var t=e.notSynced?'<span style="color:red;display: inline-block;vertical-align: middle;">*</span>':"",a=Object(ua.c)(e.taskType);return'<div class="vertex"><div class="vertex-title">'+t+' <span style="display: inline-block;max-width: 90%;">'+(e.name||"")+'</span></div>\n            <span class="vertex-desc">'+a+"</span>\n            </div>"}return""},n.onkeyDown=function(e){switch(e.keyCode){case ca.BACKUP:}},n.toggleCreate=function(e){var t=n.props,a=t.toggleCreateTask,r=t.updateWorkflow,l=t.data,i={workflowId:l.id,data:l,taskType:e,status:"create"};a(),r(i)},n.appendWorkflowNode=function(e){var t=n.props,a=t.data,r=t.saveTask,l=t.loadTreeNode;n.updateCellData(n._currentNewVertex,e);var i=n.getGraphData();a.sqlText=oa()(i),r(a,"noMsg"),l(a.id,z.l.TASK_DEV,{taskType:z.y.WORKFLOW,parentId:a.nodePid}),n.setState({showGuidePic:!1})},n.deleteTask=function(e){var t=n.props,a=t.delOfflineTask,r=t.data,l=n,i=e.data;i&&e.vertex?B.a.confirm({title:"注意",okText:"确认",cancelText:"取消",content:v.a.createElement("div",null,v.a.createElement("p",null,"确定是否要删除节点: ",v.a.createElement("a",null,i.name))),onOk:function(){a({taskId:i.id},r.id).then(function(t){1!==t.code&&250!==t.code||l.removeCell([e])})}}):n.removeCell([e])},n.updateCellData=function(e,t){if(e){var a=n.graph.view.getState(e);a.cell&&(a.cell.id=t.id,a.cell.data=t,n.graph.refresh())}},n.initGraphData=function(e){var t=n.props,a=t.tabs,r=t.updateTabData,l=t.data,i=[];if(e)for(var o=function(t){var n=e[t];if(n.vertex&&n.data){var r=a.find(function(e){return e.id===n.data.id});r&&(n.data=r,r.notSynced&&i.push(r))}},s=0;s<e.length;s++)o(s);n.renderData(e),r({id:l.id,toUpdateTasks:i,notSynced:i.length>0||(l.notSynced||!1)})},n.saveTask=function(e){var t=e.data||{},a=n.props,r=a.saveTask,l=a.tabs.find(function(e){return e.id===t.id});l?(l.notSynced=!1,r(l).then(function(t){1===t.code&&(n.updateCellData(e,l),n.updateGraphData())})):(t.notSynced=!1,n.updateCellData(e,t),n.updateGraphData())},n.insertItemVertex=function(e,t,a,r,l){var i=n._currentSourceType.key,o=new ya("新节点",new va(0,0,_a.width,_a.height));o.vertex=!0,o.data={taskType:i,name:"新节点"};var s=e.importCells([o],r,l,a);null!=s&&s.length>0&&(n.toggleCreate(i),n._currentNewVertex=s[0],e.scrollCellToVisible(s[0]),e.setSelectionCells(s))},n.getUnderMouseGraph=function(e){var t=ga.getClientX(e),a=ga.getClientY(e),r=document.elementFromPoint(t,a);return ba.isAncestorNode(n.graph.container,r)?n.graph:null},n.initGraphLayout=function(){var e=n.graph,t=e.getModel();n.executeLayout=function(a,n,r){var l=a||e.getDefaultParent();t.beginUpdate();try{var i=new Fa(e,"north");i.disableEdgeStyle=!1,i.interRankCellSpacing=40,i.intraCellSpacing=20,i.edgeStyle=Oa.TopToBottom,null!=n&&n(),i.execute(l)}catch(e){throw e}finally{e.getModel().endUpdate(),null!=r&&r()}}},n.initContextMenu=function(){var e=n,t=n.graph,a=n.props,r=a.openTaskInDev,l=a.data,i=a.project,o=a.user,s=Object(fe.f)(i,o),c=Ta.prototype.showMenu;Ta.prototype.showMenu=function(){if(!(this.graph.getSelectionCells().length>0))return!1;c.apply(this,arguments)},t.popupMenuHandler.autoExpand=!0,t.popupMenuHandler.factoryMethod=function(t,a,n){if(a){var i=a.data||{};!(l.readWriteLockVO&&!l.readWriteLockVO.getLock)&&s&&(a.vertex?(t.addItem("保存节点",null,function(){e.saveTask(a)},null,null,!0),t.addItem("查看节点内容",null,function(){r(i.id)},null,null,!0),t.addItem("删除节点",null,function(){e.deleteTask(a)},null,null,!0)):t.addItem("删除依赖关系",null,function(){e.deleteTask(a)},null,null,!0))}}},n.getPreviewEle=function(e){var t=Object(ua.c)(e),a=document.createElement("div");return a.style.width=_a.width+"px",a.style.height=_a.height+"px",a.className="preview-drag-vertex",a.innerHTML='<span class="preview-title">新节点</span>\n        <span class="preview-desc">'+t+"</span>",a},n.updateGraphData=function(){var e=n.props.updateTaskField,t=n.getGraphData(),a=t.filter(function(e){return e.vertex&&e.data&&!0===e.data.notSynced});n.setState({showGuidePic:!(t.length>0)}),e({sqlText:oa()(t),toUpdateTasks:a})},n.initGraphEvent=function(){var e=n.graph,t=null,a=n.props.openTaskInDev;e.addListener(ga.DOUBLE_CLICK,function(e,t){var n=t.getProperty("cell");if(n&&n.vertex){var r=n.data;a(r.id)}}),e.addListener(ga.CLICK,function(a,n){var r=n.getProperty("cell");if(r&&r.vertex){e.clearSelection();var l=e.view.getState(r),i={};i[Ca.STYLE_FILLCOLOR]="#DEEFFF",i[Ca.STYLE_STROKECOLOR]="#2491F7",Ua(l,i);var o=e.getOutgoingEdges(r),s=e.getIncomingEdges(r);e.setCellStyle("strokeColor=#2491F7;",o.concat(s)),t=r}else if(void 0===r){var c=e.getSelectionCells();e.removeSelectionCells(c)}}),e.clearSelection=function(a){if(t){var n=e.view.getState(t),r={};r[Ca.STYLE_FILLCOLOR]="#F5F5F5",r[Ca.STYLE_STROKECOLOR]="#C5C5C5",Ua(n,r);var l=e.getOutgoingEdges(t),i=e.getIncomingEdges(t);e.setCellStyle("strokeColor=#9EABB2;strokeWidth=1;",l.concat(i)),t=null}}},n.listenGraphUpdate=function(){var e=n.graph;e.addListener(ga.CELLS_MOVED,n.updateGraphData),e.addListener(ga.CELLS_REMOVED,n.updateGraphData),e.addListener(ga.CELL_CONNECTED,n.updateGraphData)},n.getGraphData=function(){for(var e=n.graph.getDefaultParent(),t=n.graph.getChildCells(e),a=[],r=function(e){return e&&{vertex:e.vertex,edge:e.edge,data:e.data,x:e.geometry.x,y:e.geometry.y,value:e.value,id:e.id}},l=0;l<t.length;l++){var i=t[l],o=r(i);i.edge&&(o.source=r(i.source),o.target=r(i.target)),a.push(o)}return a},n.renderData=function(e){var t=n.graph,a=n.graph.getDefaultParent(),r=n._cacheCells,l=n.getStyles();if(e){for(var i=0;i<e.length;i++){var o=e[i];if(o.vertex){var s=t.insertVertex(a,o.id,null,o.x,o.y,_a.width,_a.height,l);s.data=o.data,r[o.id]=s}else if(o.edge){var c=r[o.source.id],u=r[o.target.id];t.insertEdge(a,o.id,"",c,u)}}n.layoutCenter()}},n.onSearchChange=function(e){if(e){for(var t=n.graph.getDefaultParent(),a=n.graph.getChildCells(t),r=[],l=0;l<a.length;l++){var i=a[l],o=i.data;i.vertex&&o&&o.name.indexOf(e)>-1&&r.push({id:o.id,name:o.name})}n.setState({searchResult:r})}},n.debounceSearch=Object(g.debounce)(n.onSearchChange,500,{maxWait:2e3}),n.initShowSearch=function(e){n.setState({showSearch:!0,searchText:""},function(){var e=document.getElementById("JS_Search_Node");e&&(e.focus(),e.setAttribute("autocomplete","off"))})},n.onSelectResult=function(e,t){var a=t.props.data,r=n._cacheCells[a];if(r){var l=new Aa(ga.CLICK,"cell",r);n.graph.fireEvent(l),n.setState({showSearch:!1,searchText:""})}},n.renderToolBar=function(){var e=n.props,t=e.taskTypes,a=e.data,r=e.user,l=e.project.projectType==z.n.PRO,i=r.isRoot,o=!l||i,s=t.map(function(e){return e.key!==z.y.WORKFLOW&&v.a.createElement(C.a,{placement:"right",title:function(e,t){switch(e){case z.y.SQL:return"以Spark作为计算引擎，兼容HiveSQL语法";case z.y.MR:return"基于Java、Scala的Spark节点任务";case z.y.ML:return"基于Spark MLLib的机器学习节点任务";case z.y.DEEP_LEARNING:return"基于TensorFlow、MXNet的深度学习节点任务";default:return t}}(e.key,e.value)},v.a.createElement(D.a,{id:""+Pa+e.key,className:"widgets-items",key:e.key,value:e.key},e.value))});return v.a.createElement("div",{className:"graph-widgets"},v.a.createElement("header",{className:"widgets-header bd-bottom"},"节点组件"),v.a.createElement("div",{className:"widgets-content"},v.a.createElement(da,{lockTarget:a,couldEdit:o}),s))},n.hideMenu=function(){document.addEventListener("click",function(e){var t=n.graph;t.popupMenuHandler.isMenuShowing()&&t.popupMenuHandler.hideMenu()})},n.refresh=function(){n.graph.refresh()},n.zoomIn=function(){n.graph.zoomIn()},n.zoomOut=function(){n.graph.zoomOut()},n.layoutCenter=function(){n.graph.center(!0,!0,.55,.4)},n.layout=function(){n.executeLayout(null,null,function(){n.layoutCenter(),n.updateGraphData()})},n.undo=function(){n.undoMana.undo()},r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.Container.innerHTML="",this.graph=null;var e=this.Container;this._cacheCells={},this._currentNewVertex=null,this.initEditor(),this.loadEditor(e),this.hideMenu();var t=this.props.data.sqlText,a=t?JSON.parse(t):[];a&&a.length>0?(this.initGraphData(a),this.listenGraphUpdate()):this.setState({showGuidePic:!0})}},{key:"shouldComponentUpdate",value:function(e,t){return t.showSearch!==this.state.showSearch||(t.showGuidePic!==this.state.showGuidePic||t.searchResult!==this.state.searchResult)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.workflow,a=e.workflow;t!==a&&(this._currentNewVertex&&"cancel"===a.status?(this.graph.removeCells(),this._currentNewVertex=null):"created"===a.status&&this.appendWorkflowNode(a.node))}},{key:"componentWillUnmount",value:function(){this.props.resetWorkflow()}},{key:"removeCell",value:function(e){var t=e||this.graph.getSelectionCells();t&&t.length>0&&this.graph.removeCells(t)}},{key:"initUndoManager",value:function(){var e=new Da,t=this.graph;this.undoMana=e;var a=function(t,a){e.undoableEditHappened(a.getProperty("edit"))};t.getModel().addListener(ga.UNDO,a),t.getView().addListener(ga.UNDO,a)}},{key:"listenConnection",value:function(){var e=this.graph;e.isValidConnection=function(t,a){if(!t.vertex||!a.vertex)return!1;if(e.getEdgesBetween(t,a).length>0)return!1;var n=!1;return e.traverse(a,!0,function(e,a){if(t.id===e.id)return n=!0,!1}),!n}}},{key:"initDraggableToolBar",value:function(){for(var e=this,t=this,a=this.graph,n=this.props.taskTypes,r=function(r){var l=n[r],i=document.getElementById(""+Pa+l.key);if(i){var o=t.getPreviewEle(l.key);o.setAttribute("data-item",l.key);var s=ba.makeDraggable(i,e.getUnderMouseGraph,e.insertItemVertex,o,null,null,a.autoscroll,!0);s.createPreviewElement=function(e,a){return t._currentSourceType=l,o},s.isGuidesEnabled=function(){return a.graphHandler.guidesEnabled},s.createDragElement=ka.prototype.createDragElement}},l=0;l<n.length;l++)r(l)}},{key:"render",value:function(){var e=this,t=this.state,a=t.searchResult,n=t.showGuidePic,r=a&&a.map(function(e){return v.a.createElement(Va,{key:e.id,data:e.id,value:e.name},e.name)}),l="vs"!==this.props.editor.options.theme||void 0;return v.a.createElement(sa,{onKeyDown:this.onkeyDown},v.a.createElement("div",{className:"graph-editor",style:{position:"relative",overflow:"hidden"}},this.renderToolBar(),n?v.a.createElement("div",{className:"absolute-middle",style:{width:"100%",height:"100%",background:"url(/public/rdos/img/graph_guide_pic.png)",backgroundPosition:"center center",backgroundSize:"700px 500px",backgroundRepeat:"no-repeat"}}):null,v.a.createElement("div",{className:"editor pointer graph-bg",style:{height:"100%"},ref:function(t){e.Container=t}}),v.a.createElement("div",{className:"graph-toolbar"},v.a.createElement(C.a,{placement:"bottom",title:"布局"},v.a.createElement(Q.a,{type:"flowchart",onClick:this.layout,themeDark:l})),v.a.createElement(C.a,{placement:"bottom",title:"放大"},v.a.createElement(Q.a,{onClick:this.zoomIn,type:"zoom-in",themeDark:l})),v.a.createElement(C.a,{placement:"bottom",title:"缩小"},v.a.createElement(Q.a,{onClick:this.zoomOut,type:"zoom-out",themeDark:l})),v.a.createElement(C.a,{placement:"bottom",title:"搜索节点"},v.a.createElement(I.a,{type:"search",onClick:this.initShowSearch,style:{fontSize:"17px",color:l?"#ADADAD":"#333333"}}))),v.a.createElement(B.a,{closable:!1,mask:!1,style:{width:"400px",height:"80px",top:"150px",left:"100px"},bodyStyle:{padding:"10px"},visible:this.state.showSearch,onCancel:function(){return e.setState({showSearch:!1})},footer:null},v.a.createElement(pe.a,{id:"JS_Search_Node",mode:"combobox",showSearch:!0,style:{width:"100%"},placeholder:"按子节点名称搜索",notFoundContent:"没有发现相关节点",defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,autoComplete:"off",onChange:this.debounceSearch,onSelect:this.onSelectResult},r))))}},{key:"graphEnable",value:function(){var e=this.graph.isEnabled();this.graph.setEnabled(!e)}},{key:"getDefaultVertexStyle",value:function(){var e=[];return e[Ca.STYLE_SHAPE]=Ca.SHAPE_RECTANGLE,e[Ca.STYLE_PERIMETER]=Na.RectanglePerimeter,e[Ca.STYLE_STROKECOLOR]="#C5C5C5",e[Ca.STYLE_FILLCOLOR]="#F5F5F5",e[Ca.STYLE_FONTCOLOR]="#333333",e[Ca.STYLE_ALIGN]=Ca.ALIGN_CENTER,e[Ca.STYLE_VERTICAL_ALIGN]=Ca.ALIGN_MIDDLE,e[Ca.STYLE_FONTSIZE]="12",e[Ca.STYLE_FONTSTYLE]=1,e}},{key:"getDefaultEdgeStyle",value:function(){var e=[];return e[Ca.STYLE_SHAPE]=Ca.SHAPE_CONNECTOR,e[Ca.STYLE_STROKECOLOR]="#999",e[Ca.STYLE_STROKEWIDTH]=1,e[Ca.STYLE_ALIGN]=Ca.ALIGN_CENTER,e[Ca.STYLE_VERTICAL_ALIGN]=Ca.ALIGN_MIDDLE,e[Ca.STYLE_EDGE]=Oa.TopToBottom,e[Ca.STYLE_ENDARROW]=Ca.ARROW_BLOCK,e[Ca.STYLE_FONTSIZE]="10",e[Ca.STYLE_ROUNDED]=!1,e}},{key:"initEditor",value:function(){ma.prototype.getAllConnectionConstraints=function(e,t){if(null!=e&&null!=e.shape)if(null!=e.shape.stencil){if(null!=e.shape.stencil)return e.shape.stencil.constraints}else if(null!=e.shape.constraints)return e.shape.constraints;return null},ha.prototype.constraints=[new wa(new Ea(.5,0),!0),new wa(new Ea(0,.5),!0),new wa(new Ea(1,.5),!0),new wa(new Ea(.5,1),!0)],Sa.prototype.constraints=null}}]),t}(f.Component))||vt,Ha=B.a.confirm,Ba=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.unLock=function(){var e=a.props,t=e.tabData,n=e.updateTaskFields,r=e.updateCatalogue,l=e.loadTreeNode,i=e.reloadWorkflowTabNode,o=e.tabs,s=t.readWriteLockVO;Ha({title:"解锁提醒",content:"文件正在被"+s.lastKeepLockUserName+"编辑中，开始编辑时间\n                "+T.a.formatDateTime(s.gmtModified)+"。\n                强制编辑可能导致"+s.lastKeepLockUserName+"对该文件的修改无法保存！\n            ",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){var e={fileId:t.id,lockVersion:s.version};if(T.a.checkExist(t.taskType)?e.type=z.k.OFFLINE_TASK:T.a.checkExist(t.type)&&(e.type=z.k.OFFLINE_SCRIPT),t.taskType===z.y.WORKFLOW&&t.sqlText){var a=[];JSON.parse(t.sqlText).forEach(function(e){e.vertex&&e.data&&a.push(e.data.id)}),e.subFileIds=a}Y.a.unlockFile(e).then(function(a){if(1===a.code){var s=a.data;s.getLock?x.a.success("文件解锁成功！"):B.a.error({title:"解锁失败",content:"文件正在被"+s.lastKeepLockUserName+"编辑中! 开始编辑时间\n                                "+T.a.formatDateTime(s.gmtModified)+"."});var c={id:t.id};e.type===z.k.OFFLINE_TASK?(t.taskType===z.y.WORKFLOW&&(l(t.id,z.l.TASK_DEV,{taskType:z.y.WORKFLOW,parentId:t.nodePid}),i(t.id,o)),Y.a.getOfflineTaskDetail(c).then(function(e){if(1===e.code){var a=e.data;a.merged=!0;var l={id:t.id,readWriteLockVO:a.readWriteLockVO};r(l),n(a)}})):e.type===z.k.OFFLINE_SCRIPT&&Y.a.getScriptById(c).then(function(e){if(1===e.code){var a=e.data;a.merged=!0;var l={id:t.id,readWriteLockVO:a.readWriteLockVO};r(l),n(a)}})}})},onCancel:function(){}})},a}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.props.tabData;return v.a.createElement("div",{className:"m-mainbench editor-container"},e&&this.renderBench(e),e&&this.renderLock(e))}},{key:"renderLock",value:function(e){var t=e.readWriteLockVO&&!e.readWriteLockVO.getLock,a=e.createModel&&e.createModel==z.f.SCRIPT,n="lock-layer";return e.taskType==z.y.SQL||a||T.a.checkExist(e&&e.type)?n="lock-layer-editor":e.taskType==z.y.SYNC?n="lock-layer-sync":e.taskType==z.y.WORKFLOW&&(n="lock-layer-editor"),t?v.a.createElement("div",{className:n},v.a.createElement(ee.a,{style:{position:"absolute",top:"-2px",left:"35%",zIndex:"999",height:"35px"},showIcon:!0,message:v.a.createElement("span",null,"当前文件为只读状态！",v.a.createElement("a",{onClick:this.unLock},"解锁")),type:"warning"})):""}},{key:"renderBench",value:function(e){var t=this.props.taskCustomParams,a=e&&e.flowId&&0!==e.flowId;if(T.a.checkExist(e&&e.taskType))switch(e.taskType){case z.y.MR:case z.y.PYTHON:case z.y.VIRTUAL_NODE:case z.y.ML:case z.y.HAHDOOPMR:return v.a.createElement(Jt,M()({isWorkflowNode:a,key:e.id},e));case z.y.SYNC:return e.createModel&&e.createModel==z.f.SCRIPT?v.a.createElement(qt,M()({key:e.id},e,{currentTabData:e,taskCustomParams:t})):v.a.createElement(kt,M()({key:e.id},e));case z.y.SQL:return v.a.createElement(la,{taskCustomParams:t,key:e.id,value:e.sqlText,currentTab:e.id,currentTabData:e});case z.y.SHELL:return v.a.createElement(wt,{mode:"shell",taskCustomParams:t,key:e.id,value:e.sqlText,currentTab:e.id,currentTabData:e});case z.y.DEEP_LEARNING:case z.y.PYTHON_23:return e.operateModel==z.g.EDIT?v.a.createElement(wt,{mode:"python",taskCustomParams:t,key:e.id,value:e.sqlText,currentTab:e.id,currentTabData:e}):v.a.createElement(Jt,M()({key:e.id},e));case z.y.WORKFLOW:var n=e.readWriteLockVO&&!e.readWriteLockVO.getLock,r=e.id+"_"+n+"_"+e.version;return v.a.createElement(ja,{data:e,key:r});default:return v.a.createElement("p",{className:"txt-center",style:{lineHeight:"60px"}},"未知任务类型")}else if(T.a.checkExist(e&&e.type))switch(e.type){case z.t.SQL:return v.a.createElement(la,{taskCustomParams:t,key:e.id,value:e.scriptText,currentTab:e.id,currentTabData:e});case z.t.SHELL:case z.t.PYTHON2:case z.t.PYTHON3:var l="python";return""===e.type&&(l="shell"),v.a.createElement(wt,{mode:l,key:e.id,value:e.scriptText,currentTab:e.id,currentTabData:e})}}}]),t}(v.a.Component),Ga=(a("PAYn"),a("EQeY")),qa=a.n(Ga),Wa=(a("7LYo"),a("5GXF")),Ka=a.n(Wa),Ya=a("I/n2"),za=pe.a.Option,Qa=function(e){function t(){return u()(this,t),h()(this,(t.__proto__||s()(t)).apply(this,arguments))}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.props,t=e.onOk,a=e.visible,n=e.onCancel,r=e.projectUsers,l=e.onSelect,i=e.defaultValue,o=r&&r.map(function(e){return v.a.createElement(za,{key:""+e.userId,value:""+e.userId,name:e.user.userName},e.user.userName)});return v.a.createElement(B.a,{title:"选择责任人",visible:a,onOk:t,onCancel:n},v.a.createElement(pe.a,{style:{width:"100%"},showSearch:!0,defaultValue:i,onSelect:l,optionFilterProp:"name"},o))}}]),t}(v.a.Component),Xa=(a("GBD3"),a("wXtC")),Ja=a.n(Xa),$a=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.state={choosetask:[],selectedRows:[]},r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"resetState",value:function(){this.setState({choosetask:[],selectedRows:[]})}},{key:"onOk",value:function(){var e=this.state.selectedRows;0!=e.length?(this.props.onOk(e),this.resetState()):x.a.warning("请选择依赖")}},{key:"onCancel",value:function(){this.resetState(),this.props.onCancel()}},{key:"initColumns",value:function(){return[{title:"表名",dataIndex:"tableName",width:"200px"},{title:"任务名称",dataIndex:"name"}]}},{key:"rowSelection",value:function(){var e=this,t=this.props.existTask;return{selectedRowKeys:this.state.choosetask,onChange:function(t,a){e.setState({choosetask:t,selectedRows:a})},getCheckboxProps:function(e){var a=e.id,n=!1;return t&&t.map(function(e){e.id==a&&(n=!0)}),n?{disabled:!0}:{}}}}},{key:"render",value:function(){var e=this.props,t=e.visible,a=e.taskList;return v.a.createElement(B.a,{title:"推荐上游依赖",maskClosable:!1,visible:t,onCancel:this.onCancel.bind(this),onOk:this.onOk.bind(this)},v.a.createElement("p",{style:{margin:"10px 10px"}},"提示：该分析仅基于您已发布过的任务进行分析"),v.a.createElement(re.a,{className:"m-table select-all-table",columns:this.initColumns(),dataSource:a,pagination:!1,rowSelection:this.rowSelection(),scroll:{y:400}}))}}]),t}(v.a.Component),Za=Ka.a.Panel,en=pe.a.Option,tn=j.a.Item,an=ue.a.Group,nn={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}},rn=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.changeScheduleStatus=a.props.handleScheduleStatus,a.changeScheduleConf=a.props.handleScheduleConf,a.changeScheduleType=a.props.handleScheduleType,a}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.props,n=a.status,r=a.scheduleConf,l=a.isWorkflowNode,o=a.wFScheduleConf,s=r.periodType,c=o&&("0"===o.periodType||"1"===o.periodType),u=function(){for(var t=[],a=0;a<=23;a++)t.push(v.a.createElement(en,{key:a,value:""+a},a<10?"0"+a:a));return v.a.createElement(pe.a,{disabled:c,onChange:e.changeScheduleConf.bind(e)},t)},d=function(){for(var t=[],a=0;a<=59;a++)t.push(v.a.createElement(en,{key:a,value:""+a},a<10?"0"+a:a));return v.a.createElement(pe.a,{disabled:c,onChange:e.changeScheduleConf.bind(e)},t)};return v.a.createElement(j.a,{key:s,className:"schedule-form"},v.a.createElement(tn,M()({},nn,{label:"调度状态"}),t("scheduleStatus",{valuePropName:"checked",initialValue:0===n||2===n})(v.a.createElement(tt.a,{onChange:this.changeScheduleStatus.bind(this)},"冻结"))),!l&&v.a.createElement("div",null,v.a.createElement(tn,M()({},nn,{label:"生效日期"}),t("beginDate",{initialValue:Pt()(r.beginDate,"YYYY-MM-DD")})(v.a.createElement(Ja.a,{style:{width:"140px"},onChange:this.changeScheduleConf.bind(this)})),v.a.createElement("span",{className:"split-text",style:{float:"none"}},"-"),t("endDate",{initialValue:Pt()(r.endDate,"YYYY-MM-DD")})(v.a.createElement(Ja.a,{style:{width:"140px"},onChange:this.changeScheduleConf.bind(this)}))),v.a.createElement(tn,M()({},nn,{label:"调度周期"}),v.a.createElement(i.a,{span:"6"},t("periodType",{initialValue:""+r.periodType,rules:[{required:!0}]})(v.a.createElement(pe.a,{onChange:this.changeScheduleType.bind(this)},v.a.createElement(en,{key:0,value:"0"},"分钟"),v.a.createElement(en,{key:1,value:"1"},"小时"),v.a.createElement(en,{key:2,value:"2"},"天"),v.a.createElement(en,{key:3,value:"3"},"周"),v.a.createElement(en,{key:4,value:"4"},"月")))))),v.a.createElement(tn,{style:{display:"none"}},t("selfReliance",{initialValue:r.selfReliance})(v.a.createElement(F.a,{type:"hidden"}))),function(a,n){var o=void 0;switch(a){case 0:o=v.a.createElement("span",{key:a},v.a.createElement(tn,M()({},nn,{label:"开始时间"}),v.a.createElement(i.a,{span:"6"},t("beginHour",{rules:[{required:!0},{validator:n.checkTimeS.bind(n)}],initialValue:""+r.beginHour})(u())),v.a.createElement("span",{className:"split-text"},"时"),v.a.createElement(i.a,{span:"6"},t("beginMin",{rules:[{required:!0}],initialValue:"0"})(v.a.createElement(pe.a,{disabled:!0},v.a.createElement(en,{value:"0"},"0")))),v.a.createElement("span",{className:"split-text"},"分")),v.a.createElement(tn,M()({},nn,{label:"间隔时间"}),v.a.createElement(i.a,{span:"6"},t("gapMin",{rules:[{required:!0}],initialValue:""+r.gapMin})(v.a.createElement(pe.a,{onChange:n.changeScheduleConf.bind(n)},function(){for(var e=[],t=5;t<=55;t+=5)e.push(v.a.createElement(en,{key:t,value:""+t},t,"分钟"));return e}())))),v.a.createElement(tn,M()({},nn,{label:"结束时间"}),v.a.createElement(i.a,{span:"6"},t("endHour",{rules:[{required:!0},{validator:n.checkTimeE.bind(n)}],initialValue:""+r.endHour})(u())),v.a.createElement("span",{className:"split-text"},"时"),v.a.createElement(i.a,{span:"6"},t("endMin",{initialValue:"59"})(v.a.createElement(pe.a,{disabled:!0},v.a.createElement(en,{value:"59"},"59")))),v.a.createElement("span",{className:"split-text"},"分")));break;case 1:o=v.a.createElement("span",{key:a},v.a.createElement(tn,M()({},nn,{label:"开始时间"}),v.a.createElement(i.a,{span:"6"},t("beginHour",{rules:[{required:!0},{validator:n.checkTimeS1.bind(n)}],initialValue:""+r.beginHour})(u())),v.a.createElement("span",{className:"split-text"},"时"),v.a.createElement(i.a,{span:"6"},t("beginMin",{rules:[{required:!0},{validator:n.checkTimeS1.bind(n)}],initialValue:""+r.beginMin})(d())),v.a.createElement("span",{className:"split-text"},"分")),v.a.createElement(tn,M()({},nn,{label:"间隔时间"}),v.a.createElement(i.a,{span:"6"},t("gapHour",{rules:[{required:!0}],initialValue:""+r.gapHour})(v.a.createElement(pe.a,{onChange:n.changeScheduleConf.bind(n)},function(){for(var e=[],t=1;t<=23;t++)e.push(v.a.createElement(en,{key:t,value:""+t},t,"小时"));return e}())))),v.a.createElement(tn,M()({},nn,{label:"结束时间"}),v.a.createElement(i.a,{span:"6"},t("endHour",{rules:[{required:!0},{validator:n.checkTimeE1.bind(n)}],initialValue:""+r.endHour})(u())),v.a.createElement("span",{className:"split-text"},"时"),v.a.createElement(i.a,{span:"6"},t("endMin",{rules:[{required:!0}],initialValue:"59"})(v.a.createElement(pe.a,{disabled:!0},v.a.createElement(en,{value:"59"},"59")))),v.a.createElement("span",{className:"split-text"},"分")));break;case 2:var s=l?"起调":"具体";o=v.a.createElement("span",{key:a},v.a.createElement(tn,M()({},nn,{label:s+"时间"}),v.a.createElement(i.a,{span:"6"},t("hour",{rules:[{required:!0}],initialValue:""+r.hour})(u())),v.a.createElement("span",{className:"split-text"},"时"),v.a.createElement(i.a,{span:"6"},t("min",{rules:[{required:!0}],initialValue:""+r.min})(d())),v.a.createElement("span",{className:"split-text"},"分")));break;case 3:o=v.a.createElement("span",{key:a},v.a.createElement(tn,M()({},nn,{label:"选择时间"}),v.a.createElement(i.a,{span:"13"},t("weekDay",{rules:[{required:!0}],initialValue:(""+r.weekDay).split(",")})(v.a.createElement(pe.a,{mode:"multiple",style:{width:"100%"},onChange:e.changeScheduleConf.bind(e)},v.a.createElement(en,{key:1,value:"1"},"星期一"),v.a.createElement(en,{key:2,value:"2"},"星期二"),v.a.createElement(en,{key:3,value:"3"},"星期三"),v.a.createElement(en,{key:4,value:"4"},"星期四"),v.a.createElement(en,{key:5,value:"5"},"星期五"),v.a.createElement(en,{key:6,value:"6"},"星期六"),v.a.createElement(en,{key:7,value:"7"},"星期天"))))),v.a.createElement(tn,M()({},nn,{label:"具体时间"}),v.a.createElement(i.a,{span:"6"},t("hour",{rules:[{required:!0}],initialValue:""+r.hour})(u())),v.a.createElement("span",{className:"split-text"},"时"),v.a.createElement(i.a,{span:"6"},t("min",{rules:[{required:!0}],initialValue:""+r.min})(d())),v.a.createElement("span",{className:"split-text"},"分")));break;case 4:o=v.a.createElement("span",{key:a},v.a.createElement(tn,M()({},nn,{label:"选择时间"}),v.a.createElement(i.a,{span:"13"},t("day",{rules:[{required:!0}],initialValue:(""+r.day).split(",")})(function(){for(var t=[],a=1;a<=31;a++)t.push(v.a.createElement(en,{key:a,value:""+a},"每月"+a+"号"));return v.a.createElement(pe.a,{mode:"multiple",style:{width:"100%"},onChange:e.changeScheduleConf.bind(e)},t)}()))),v.a.createElement(tn,M()({},nn,{label:"具体时间"}),v.a.createElement(i.a,{span:"6"},t("hour",{rules:[{required:!0}],initialValue:""+r.hour})(u())),v.a.createElement("span",{className:"split-text"},"时"),v.a.createElement(i.a,{span:"6"},t("min",{rules:[{required:!0}],initialValue:""+r.min})(d())),v.a.createElement("span",{className:"split-text"},"分")));break;default:o=v.a.createElement("span",null,"something wrong")}return o}(+s,this))}},{key:"checkTimeS",value:function(e,t,a){+t>+this.props.form.getFieldValue("endHour")&&a("开始时间不能晚于结束时间"),a()}},{key:"checkTimeE",value:function(e,t,a){+t<+this.props.form.getFieldValue("beginHour")&&a("结束时间不能早于开始时间"),a()}},{key:"checkTimeS1",value:function(e,t,a){var n=this.props.form;60*+n.getFieldValue("beginHour")+ +n.getFieldValue("beginMin")>60*+n.getFieldValue("endHour")+59&&a("开始时间不能晚于结束时间"),a()}},{key:"checkTimeE1",value:function(e,t,a){var n=this.props.form;60*+n.getFieldValue("beginHour")+ +n.getFieldValue("beginMin")>60*+n.getFieldValue("endHour")+59&&a("结束时间不能早于开始时间"),a()}}]),t}(v.a.Component),ln=j.a.create()(rn),on=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.loadWorkflowConfig=function(){var e=a.props,t=e.tabData,n=e.isWorkflowNode,r=e.tabs;if(n){var l=t.flowId,i=r&&r.find(function(e){return e.id===l}),o=function(e){var t=JSON.parse(e.scheduleConf);a.setState({wFScheduleConf:t})};i?o(i):Y.a.getOfflineTaskDetail({id:l}).then(function(e){1===e.code&&o(e.data)})}},a.handleScheduleConf=function(){var e=a.props.tabData,t=JSON.parse(e.scheduleConf);t.periodType||(t=a.getDefaultScheduleConf(2)),setTimeout(function(){a.form.validateFields(function(e,n){if(!e){var r=a.form.getFieldsValue();r.selfReliance=a.state.selfReliance,delete(r=Ct()(t,r)).scheduleStatus,a.props.changeScheduleConf(r)}})},0)},a.state={recommentTaskModalVisible:!1,recommentTaskList:[],wFScheduleConf:void 0,selfReliance:void 0},a}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.loadWorkflowConfig();var e=this.props.tabData,t=JSON.parse(e.scheduleConf),a=0;"undefined"!==t.selfReliance&&(!0===t.selfReliance?a=1:!1===t.selfReliance?a=0:t.selfReliance&&(a=t.selfReliance)),this.setState({selfReliance:a}),this.loadWorkflowConfig()}},{key:"showRecommentTask",value:function(){var e=this,t=this.props.tabData;this.setState({loading:!0}),Y.a.getRecommentTask({taskId:t.id}).then(function(t){e.setState({loading:!1}),1==t.code&&e.setState({recommentTaskModalVisible:!0,recommentTaskList:t.data})})}},{key:"recommentTaskChoose",value:function(e){for(var t=0;t<e.length;t++)this.props.addVOS(e[t]);this.setState({recommentTaskModalVisible:!1})}},{key:"recommentTaskClose",value:function(){this.setState({recommentTaskModalVisible:!1})}},{key:"handleScheduleStatus",value:function(e){var t=e.target.checked;this.props.changeScheduleStatus(t?2:1)}},{key:"handleScheduleStatus",value:function(e){var t=this,a=e.target.checked,n=a?2:1,r=this.props.tabData,l=a?"冻结成功":"解冻成功",i=a?"冻结失败":"解冻失败";Y.a.forzenTask({taskIdList:[r.id],scheduleStatus:n}).then(function(e){1===e.code?(t.props.changeScheduleStatus(n),x.a.info(l)):x.a.err(i)})}},{key:"handleScheduleType",value:function(e){var t=this.getDefaultScheduleConf(e),a=he()({},t,{scheduleStatus:this.form.getFieldValue("scheduleStatus"),periodType:e,beginDate:this.form.getFieldValue("beginDate"),endDate:this.form.getFieldValue("endDate"),selfReliance:this.form.getFieldValue("selfReliance")});this.props.changeScheduleConf(a)}},{key:"getDefaultScheduleConf",value:function(e){return{0:{beginHour:0,gapMin:5,endHour:23,periodType:0,beginDate:"2001-01-01",endDate:"2021-01-01"},1:{beginHour:0,beginMin:0,endHour:23,gapHour:5,periodType:1},2:{min:0,hour:0,periodType:2,beginDate:"2001-01-01",endDate:"2021-01-01"},3:{weekDay:3,min:0,hour:23,periodType:3},4:{day:5,hour:0,min:23,periodType:4}}[e]}},{key:"handleDelVOS",value:function(e){this.props.delVOS(e.id)}},{key:"handleAddVOS",value:function(e){this.props.addVOS(e)}},{key:"goEdit",value:function(e){this.props.getTaskDetail(e.id)}},{key:"setSelfReliance",value:function(e){var t=e.target.value;this.setState({selfReliance:t}),this.handleScheduleConf()}},{key:"render",value:function(){var e=this,t=this.state,a=t.recommentTaskModalVisible,n=t.recommentTaskList,l=t.loading,o=t.wFScheduleConf,s=t.selfReliance,c=this.props,u=c.tabData,d=c.isWorkflowNode,p=c.couldEdit,m=u.readWriteLockVO&&!u.readWriteLockVO.getLock,h=u.taskType==z.y.SQL,E=u.scheduleConf,y=Ct()(this.getDefaultScheduleConf(0),{beginDate:"2001-01-01",endDate:"2021-01-01"});""!==E&&(y=Ct()(y,JSON.parse(E))),d&&((y=Ct()(this.getDefaultScheduleConf(2),{beginDate:"2001-01-01",endDate:"2021-01-01"},y)).periodType=2);var f=[{title:"任务名称",dataIndex:"name",key:"name",render:function(t,a){return v.a.createElement("a",{href:"javascript:void(0)",onClick:e.goEdit.bind(e,a)},t)}},{title:"责任人",dataIndex:"createUser.userName",key:"createUser.userName"},{title:"操作",key:"action",render:function(t,a){return v.a.createElement("span",null,v.a.createElement("a",{href:"javascript:void(0)",onClick:e.handleDelVOS.bind(e,a)},"删除"))}}],b={display:"block",height:"30px",lineHeight:"30px"};return v.a.createElement("div",{className:"m-scheduling",style:{position:"relative"}},m||!p?v.a.createElement("div",{className:"cover-mask"}):null,v.a.createElement(Ka.a,{bordered:!1,defaultActiveKey:["1","2","3"]},v.a.createElement(Za,{key:"1",header:"调度属性"},v.a.createElement(ln,{scheduleConf:y,wFScheduleConf:o,status:u.scheduleStatus,isWorkflowNode:d,handleScheduleStatus:this.handleScheduleStatus.bind(this),handleScheduleConf:this.handleScheduleConf.bind(this),handleScheduleType:this.handleScheduleType.bind(this),ref:function(t){return e.form=t},key:u.id+"-"+y.periodType})),!d&&u.taskType!==z.y.VIRTUAL_NODE&&v.a.createElement(Za,{key:"2",header:"任务间依赖"},h&&v.a.createElement(D.a,{loading:l,type:"primary",style:{marginBottom:"20px"},onClick:this.showRecommentTask.bind(this)},"自动推荐"),v.a.createElement(j.a,null,v.a.createElement(tn,M()({},nn,{label:"上游任务"}),v.a.createElement(sn,{onSelect:this.handleAddVOS.bind(this),taskId:u.id}))),u.taskVOS&&u.taskVOS.length>0?v.a.createElement(r.a,null,v.a.createElement(i.a,null,v.a.createElement(re.a,{className:"m-table",columns:f,bordered:!1,dataSource:u.taskVOS,rowKey:function(e){return e.id.lable}}))):""),!d&&v.a.createElement(Za,{key:"3",header:"跨周期依赖"},v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"1"}),v.a.createElement(i.a,null,v.a.createElement(an,{onChange:this.setSelfReliance.bind(this),value:s},v.a.createElement(ue.a,{style:b,value:0},"不依赖上一调度周期"),v.a.createElement(ue.a,{style:b,value:1},"自依赖，等待上一调度周期成功，才能继续运行"),v.a.createElement(ue.a,{style:b,value:3},"自依赖，等待上一调度周期结束，才能继续运行 ",v.a.createElement(ye.a,{style:{position:"inherit"},doc:"taskDependentTypeDesc"})),v.a.createElement(ue.a,{style:b,value:2},"等待下游任务的上一周期成功，才能继续运行"),v.a.createElement(ue.a,{style:b,value:4},"等待下游任务的上一周期结束，才能继续运行 ",v.a.createElement(ye.a,{style:{position:"inherit"},doc:"taskDependentTypeDesc"}))))))),v.a.createElement($a,{visible:a,taskList:n,onOk:this.recommentTaskChoose.bind(this),onCancel:this.recommentTaskClose.bind(this),existTask:u.taskVOS}))}}]),t}(v.a.Component),sn=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.searchVOS=a.fetchVOS.bind(a),a.handleClick=a.handleClick.bind(a),a.selectVOS=a.props.onSelect,a.taskId=a.props.taskId,a.state={list:[],emptyError:!1},a}return y()(t,e),p()(t,[{key:"fetchVOS",value:function(e){var t=this,a=e.target.value;if(""===a.trim())return this.setState({list:[]}),void this.resetError();Y.a.getOfflineTaskByName({name:a,taskId:this.taskId}).then(function(e){1===e.code&&(0===e.data.length&&t.setState({emptyError:!0}),t.setState({list:e.data,fetching:!1}))})}},{key:"handleClick",value:function(e){var t=this;Y.a.checkIsLoop({taskId:this.taskId,dependencyTaskId:e.id}).then(function(a){1===a.code&&(a.data?x.a.error("添加失败，该任务循环依赖任务"+(a.data.name||"")+"!"):(t.selectVOS(e),t.$input.value="",t.setState({list:[]})))})}},{key:"resetError",value:function(){this.setState({emptyError:!1})}},{key:"render",value:function(){var e=this,t=this.state,a=t.list,n=t.emptyError;return v.a.createElement("div",{className:"m-taskselector"},v.a.createElement("input",{onInput:function(t){e.resetError(),Object(fe.a)(e.searchVOS,500,{maxWait:2e3})(t)},ref:function(t){return e.$input=t},className:"ant-input",placeholder:"根据任务名称搜索"}),n&&v.a.createElement("span",{style:{position:"absolute",width:"100%",bottom:"-28px",left:"0px",color:"red"}},"没有符合条件的任务"),a.length>0&&v.a.createElement("ul",{className:"tasklist"},a.map(function(t){return v.a.createElement("li",{className:"taskitem",onClick:function(){e.handleClick(t)},key:t.id},t.name)})))}}]),t}(v.a.Component),cn=Object(b.b)(function(e,t){return M()({},t)},function(e){return{changeScheduleConf:function(t){e({type:Ee.o.CHANGE_SCHEDULE_CONF,payload:t})},changeScheduleStatus:function(t){e({type:Ee.o.CHANGE_SCHEDULE_STATUS,payload:t})},addVOS:function(t){e({type:Ee.o.ADD_VOS,payload:t})},delVOS:function(t){e({type:Ee.o.DEL_VOS,payload:t})},getTaskDetail:function(t){Y.a.getOfflineTaskDetail({id:t}).then(function(a){1===a.code&&(e({type:Ee.o.LOAD_TASK_DETAIL,payload:a.data}),e({type:Ee.o.OPEN_TASK_TAB,payload:t}))})}}})(on),un=Ka.a.Panel;function dn(e){var t=e.taskInfo,a=(e.isPro,e.couldEdit),n=e.labelPrefix||"任务";return v.a.createElement(r.a,{className:"task-info"},v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},n,"名称："),v.a.createElement(i.a,{span:"14"},t.name)),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},n,"类型："),v.a.createElement(i.a,{span:"14"},v.a.createElement(Vt.j,{value:t.taskType}))),t.resourceList.length&&v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"资源："),v.a.createElement(i.a,{span:"14t"},t.resourceList.map(function(e){return v.a.createElement(qa.a,{key:e.id,color:"blue",style:{marginTop:10}},e.resourceName)}))),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"责任人："),v.a.createElement(i.a,{span:"14",style:{position:"relative"}},v.a.createElement(da,{lockTarget:t}),t.ownerUser&&t.ownerUser.userName,a&&v.a.createElement("a",{onClick:e.modifyTaskOwner},"修改"))),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"创建时间："),v.a.createElement(i.a,{span:"14"},T.a.formatDateTime(t.gmtCreate))),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"最近修改人员："),v.a.createElement(i.a,{span:"14"},t.readWriteLockVO.lastKeepLockUserName)),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"最近修改时间："),v.a.createElement(i.a,{span:"14"},T.a.formatDateTime(t.gmtModified))),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"描述："),v.a.createElement(i.a,{span:"14",style:{lineHeight:"20px",padding:"10 0"}},t.taskDesc)))}var pn=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.state={visible:!1,selectedUser:""},a.onSelectUser=function(e){a.setState({selectedUser:e})},a.modifyTaskOwner=function(){var e=a.state.selectedUser,t=a.props.tabData.id;e?Y.a.updateTaskOwner({ownerUserId:e,taskId:t}).then(function(e){1===e.code&&(x.a.success("修改成功！"),a.props.reloadTaskTab(t),a.setState({visible:!1,selectedUser:""}))}):x.a.error("请选择所属用户！")},a.setSqlText=function(e){a.props.updateTaskField({sqlText:e,merged:!0})},a}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.props.dispatch(Object(It.a)())}},{key:"render",value:function(){var e=this,t=this.state.visible,a=this.props,n=a.tabData,r=a.projectUsers,l=a.isWorkflowNode,i=a.project,o=a.tabs,s=a.couldEdit,c=i.projectType==z.n.PRO,u=l?"节点":"任务";return v.a.createElement("div",{className:"m-taksdetail"},v.a.createElement(Ka.a,{bordered:!1,defaultActiveKey:["1","2","3"]},v.a.createElement(un,{key:"1",header:u+"属性"},v.a.createElement(dn,{couldEdit:s,isPro:c,taskInfo:n,labelPrefix:u,modifyTaskOwner:function(){e.setState({visible:!0})}}),v.a.createElement(Qa,{visible:t,projectUsers:r,onSelect:this.onSelectUser,onOk:this.modifyTaskOwner,defaultValue:""+(n.ownerUserId||""),onCancel:function(){e.setState({visible:!1})}}))),l?v.a.createElement(cn,{couldEdit:s,isWorkflowNode:l,tabData:n,tabs:o}):"",v.a.createElement(Ka.a,{bordered:!1,defaultActiveKey:["3"]},v.a.createElement(un,{key:"3",header:"历史版本"},v.a.createElement(Ya.a,{isPro:c,taskInfo:n,changeSql:this.setSqlText}))))}}]),t}(v.a.Component),mn=Object(b.b)(function(e,t){var a=e.offlineTask.workbench;return{projectUsers:e.projectUsers,project:e.project,tabs:a.tabs}},k.b)(pn),hn=Ka.a.Panel,En=function(e){function t(e){return u()(this,t),h()(this,(t.__proto__||s()(t)).call(this,e))}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.props.tabData;return v.a.createElement("div",{className:"m-taksdetail"},v.a.createElement(Ka.a,{bordered:!1,defaultActiveKey:["1","2"]},v.a.createElement(hn,{key:"1",header:"脚本属性"},v.a.createElement(r.a,{className:"task-info"},v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"脚本名称："),v.a.createElement(i.a,{span:"14"},e.name)),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"创建人员："),v.a.createElement(i.a,{span:"14"},e.createUser.userName)),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"创建时间："),v.a.createElement(i.a,{span:"14"},T.a.formatDateTime(e.gmtCreate))),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"最近修改人员："),v.a.createElement(i.a,{span:"14"},e.modifyUser.userName)),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"最近修改时间："),v.a.createElement(i.a,{span:"14"},T.a.formatDateTime(e.gmtModified))),v.a.createElement(r.a,null,v.a.createElement(i.a,{span:"10",className:"txt-right"},"描述："),v.a.createElement(i.a,{span:"14",style:{lineHeight:"20px",padding:"10 0"}},e.scriptDesc))))))}}]),t}(v.a.Component),yn=(a("nT0F"),a("MM9K")),fn=a.n(yn),vn=a("WydL")({mxBasePath:"public/rdos/mxgraph",mxImageBasePath:"public/rdos/mxgraph/images",mxLanguage:"none",mxLoadResources:!1,mxLoadStylesheets:!1}),bn=vn.mxGraph,gn=vn.mxEvent,Tn=vn.mxRubberband,kn=vn.mxConstants,Sn=vn.mxEdgeStyle,Cn=vn.mxPerimeter,On=vn.mxCompactTreeLayout,Nn={width:150,height:36},Ln=function(e){return e},Dn=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.state={selectedTask:"",data:{},loading:"success",lastVertex:"",visible:!1},n.loadTaskChidren=function(e){var t=n;n.setState({loading:"loading"}),Y.a.getTaskChildren(e).then(function(e){if(1===e.code){var a=e.data;t.setState({selectedTask:a,data:a}),t.doInsertVertex(a)}t.setState({loading:"success"})})},n.preHandGraphTree=function(e){var t=[];return function e(a,n){if(a){var r=a.taskVOS,l=a.subTaskVOS,i=Ln(a);if(a.taskType===z.y.WORKFLOW){var o=a.subNodes;o&&e(o,i)}var s={parent:n,source:i};if(t.push(s),r&&r.length>0)for(var c=0;c<r.length;c++){var u=Ln(r[c]);s.source=u,s.target=i,r[c].taskVOS&&e(r[c],n),t.push({parent:n,source:u,target:i})}if(l&&l.length>0)for(var d=0;d<l.length;d++){var p=Ln(l[d]);l[d].subTaskVOS&&e(l[d],n),t.push({parent:n,source:i,target:p})}}}(e),t},n.renderGraph=function(e){var t=n._vertexCells,a=n.graph,r=a.getDefaultParent(),l=function(e,t){if(!t)return null;var r=n.getStyles(t),l=t.taskType===z.y.WORKFLOW,i=Nn.width,o=Nn.height;l&&t.subNodes&&t.subNodes.length>0&&(i+=20,o+=100,r+="shape=swimlane;");var s=a.insertVertex(e,t.id,t,0,0,i,o,r);return s.isPart=t.flowId&&0!==t.flowId,s};if(e)for(var i=0;i<e.length;i++){var o=e[i],s=o.source,c=o.target,u=o.parent,d=s?t[s.id]:void 0,p=c?t[c.id]:void 0,m=r;if(u){var h=t[u.id];h?m=h:(m=l(r,u),t[u.id]=m)}s&&!d&&(d=l(m,s),t[s.id]=d),c&&!p&&(p=l(m,c),t[c.id]=p),0===a.getEdgesBetween(d,p).length&&a.insertEdge(r,null,"",d,p),n.executeLayout(m)}},n.doInsertVertex=function(e){var t=n.graph;n._vertexCells={};var a=t.getModel(),r=new On(t);r.horizontal=!1,r.useBoundingBox=!1,r.edgeRouting=!1,r.levelDistance=30,r.nodeDistance=10,r.resizeParent=!0,n.executeLayout=function(e,n,l){a.beginUpdate();try{null!=n&&n(),r.execute(e)}catch(e){throw e}finally{t.getModel().endUpdate(),null!=l&&l()}};var l=n.preHandGraphTree(e);n.renderGraph(l),t.center()},n.loadEditor=function(e){gn.disableContextMenu(e);var t=new bn(e);n.graph=t,t.setPanning(!0),t.panningHandler.useLeftButtonForPanning=!0,t.setConnectable(!0),t.setTooltips(!0),t.view.setScale(1),t.setHtmlLabels(!0),t.setAllowDanglingEdges(!1),t.setConnectable(!1),t.isCellsMovable=function(e){return!((e=t.getSelectionCell())&&e.edge)},t.isCellEditable=function(){return!1};var a=n.getDefaultVertexStyle();t.getStylesheet().putDefaultVertexStyle(a),t.convertValueToString=n.corvertValueToString,t.getTooltipForCell=n.formatTooltip;var r=n.getDefaultEdgeStyle();t.getStylesheet().putDefaultEdgeStyle(r),kn.HANDLE_FILLCOLOR="#ffffff",kn.HANDLE_STROKECOLOR="#2491F7",kn.VERTEX_SELECTION_COLOR="#2491F7",new Tn(t)},n.getStyles=function(e){return e.scheduleStatus===z.s.STOPPED?"whiteSpace=wrap;fillColor=#EFFFFE;strokeColor=#26DAD1;":"whiteSpace=wrap;fillColor=#E6F7FF;strokeColor=#90D5FF;"},n.formatTooltip=function(e){var t=e.value||"";return t?t.name:""},n.corvertValueToString=function(e){if(e.vertex&&e.value){var t=e.value||{},a=Object(ua.c)(t.taskType);if(t)return'<div class="vertex"><span class="vertex-title">'+(t.name||"")+'</span>\n                <span style="font-size:10px; color: #666666;">'+a+"</span>\n                </div>"}return""},n.refresh=function(){n.componentDidMount()},n.zoomIn=function(){n.graph.zoomIn()},n.zoomOut=function(){n.graph.zoomOut()},n.hideMenu=function(){document.addEventListener("click",function(e){var t=n.graph;t.popupMenuHandler.isMenuShowing()&&t.popupMenuHandler.hideMenu()})},r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.Container.innerHTML="",this.graph="";var e=this.Container,t=this.props.tabData;this.loadEditor(e),this.hideMenu(),this.loadTaskChidren({taskId:t.id,level:6})}},{key:"listenOnClick",value:function(){var e=this;this.graph.addListener(gn.onClick,function(t,a){var n=a.getProperty("cell");if(n){var r=n.getAttribute("data");r=r?JSON.parse(r):"",e.setState({selectedTask:r})}})}},{key:"graphEnable",value:function(){var e=this.graph.isEnabled();this.graph.setEnabled(!e)}},{key:"render",value:function(){var e=this;return v.a.createElement("div",{className:"graph-editor",style:{position:"relative"}},v.a.createElement(fn.a,{tip:"Loading...",size:"large",spinning:"loading"===this.state.loading},v.a.createElement("div",{className:"editor pointer",ref:function(t){e.Container=t}}),!this.state.data&&v.a.createElement("div",{className:"absolute-middle",style:{width:"100%",height:"100%"}},v.a.createElement("p",{style:{verticalAlign:"middle",textAlign:"center",lineHeight:"20"}},"“未发布”的任务无发查看依赖视图"))),v.a.createElement("div",{className:"graph-toolbar"},v.a.createElement(C.a,{placement:"bottom",title:"刷新"},v.a.createElement(I.a,{type:"reload",onClick:this.refresh,style:{color:"#333333"}})),v.a.createElement(C.a,{placement:"bottom",title:"放大"},v.a.createElement(Q.a,{onClick:this.zoomIn,type:"zoom-in"})),v.a.createElement(C.a,{placement:"bottom",title:"缩小"},v.a.createElement(Q.a,{onClick:this.zoomOut,type:"zoom-out"}))))}},{key:"getDefaultVertexStyle",value:function(){var e=[];return e[kn.STYLE_SHAPE]=kn.SHAPE_RECTANGLE,e[kn.STYLE_PERIMETER]=Cn.RectanglePerimeter,e[kn.STYLE_STROKECOLOR]="#90D5FF",e[kn.STYLE_FILLCOLOR]="#E6F7FF;",e[kn.STYLE_FONTCOLOR]="#333333;",e[kn.STYLE_ALIGN]=kn.ALIGN_CENTER,e[kn.STYLE_VERTICAL_ALIGN]=kn.ALIGN_MIDDLE,e[kn.STYLE_FONTSIZE]="12",e[kn.STYLE_FONTSTYLE]=1,e}},{key:"getDefaultEdgeStyle",value:function(){var e=[];return e[kn.STYLE_SHAPE]=kn.SHAPE_CONNECTOR,e[kn.STYLE_STROKECOLOR]="#9EABB2",e[kn.STYLE_STROKEWIDTH]=1,e[kn.STYLE_ALIGN]=kn.ALIGN_CENTER,e[kn.STYLE_VERTICAL_ALIGN]=kn.ALIGN_MIDDLE,e[kn.STYLE_EDGE]=Sn.TopToBottom,e[kn.STYLE_ENDARROW]=kn.ARROW_CLASSIC,e[kn.STYLE_FONTSIZE]="10",e[kn.STYLE_ROUNDED]=!0,e}}]),t}(f.Component),Rn=j.a.Item,In=Ka.a.Panel,An={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}},xn=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.onChange=function(e,t){var a=n.props,r=a.tabData,l=a.onChange;if(/(^\$\[(\S+\(\S*\)|[a-z0-9\+\-\/\\\*]{2,})\]$)|(^(?!\$)\S+$)/i.test(t)){var i=[].concat(ie()(r.taskVariables));i[e].paramCommand=t,l({taskVariables:i})}},n.getFormItems=function(){var e=n.props.form.getFieldDecorator,t=n.props.tabData.taskVariables,a=[],r=[],l=function(t,a){return v.a.createElement(Rn,M()({key:a.paramName},An,{label:a.paramName}),e(a.paramName,{rules:[{pattern:/(^\$\[(\S+\(\S*\)|[a-z0-9\+\-\/\\\*]{2,})\]$)|(^(?!\$)\S+$)/i,message:"参数格式不正确"}],initialValue:a.paramCommand})(v.a.createElement(F.a,{disabled:0===a.type,onChange:function(e){n.onChange(t,e.target.value)}})))};if(t)for(var i=0;i<t.length;i++){var o=t[i],s=l(i,o);0===o.type?a.push(s):1===o.type&&r.push(s)}return{sysItems:a,customItems:r}},r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.props,t=e.tabData,a=(e.isPro,e.couldEdit),n=t.readWriteLockVO&&!t.readWriteLockVO.getLock,r=this.getFormItems();return v.a.createElement(j.a,{style:{position:"relative"}},n||!a?v.a.createElement("div",{className:"cover-mask"}):null,v.a.createElement(Ka.a,{bordered:!1,defaultActiveKey:["1","2"]},v.a.createElement(In,{key:"1",header:v.a.createElement("span",null,"系统参数配置 ",v.a.createElement(ye.a,{style:{position:"inherit"},doc:"customSystemParams"}))},r.sysItems),v.a.createElement(In,{key:"2",header:v.a.createElement("span",null,"自定义参数配置 ",v.a.createElement(ye.a,{style:{position:"inherit"},doc:"customParams"}))},r.customItems)))}}]),t}(v.a.Component),wn=j.a.create()(xn),Fn=q.a.TabPane,_n=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.state={selected:"",expanded:!1},a.handleCustomParamsChange=function(e){a.props.setTaskParams(e)},a.tabClick=function(e){var t=a.state,n=t.selected,r=t.expanded;e===n&&r?(a.setState({selected:"",expanded:!1}),a.SideBench.style.width="30px"):e!==n&&(a.SideBench.style.width="500px",a.setState({selected:e,expanded:!0}))},a.getTabPanes=function(){var e=a.props,t=e.tabData,n=e.project,r=e.user,l=n.projectType==z.n.PRO,i=Object(fe.f)(n,r);if(!t)return null;var o=t&&t.readWriteLockVO&&!t.readWriteLockVO.getLock,s=t&&t.flowId&&0!==t.flowId,c=s?"节点":"任务",u=[v.a.createElement(Fn,{tab:v.a.createElement("span",{className:"title-vertical"},s?"属性与调度":"任务属性"),key:"params1"},v.a.createElement(mn,{isPro:l,couldEdit:i,isWorkflowNode:s,tabData:t}))];if(s||(u.push(v.a.createElement(Fn,{tab:v.a.createElement("span",{className:"title-vertical"},"调度依赖"),key:"params2"},v.a.createElement(cn,{isPro:l,couldEdit:i,tabData:t}))),t.taskType!==z.y.WORKFLOW&&u.push(v.a.createElement(Fn,{tab:v.a.createElement("span",{className:"title-vertical"},"依赖视图"),key:"params4"},v.a.createElement(Dn,{tabData:t,isPro:l,couldEdit:i})))),t&&T.a.checkExist(t.taskType)&&t.taskType!==z.y.VIRTUAL_NODE&&t.taskType!==z.y.WORKFLOW)u.push(v.a.createElement(Fn,{tab:v.a.createElement("span",{className:"title-vertical"},c,"参数"),key:"params5"},v.a.createElement(wn,{isPro:l,couldEdit:i,tabData:t,onChange:a.handleCustomParamsChange}))),t.taskType!==z.y.SYNC&&u.push(v.a.createElement(Fn,{tab:v.a.createElement("span",{className:"title-vertical"},"环境参数"),key:"params3"},v.a.createElement(Oe.a,{options:{readOnly:o||!i,minimap:{enabled:!1}},key:"params"+t.id,value:t.taskParams,onFocus:function(){},focusOut:function(){},language:"ini",onChange:a.handleTaskParamChange.bind(a)})));else if(T.a.checkExist(t.type))return v.a.createElement(Fn,{tab:v.a.createElement("span",{className:"title-vertical"},"脚本属性"),key:"params1"},v.a.createElement(En,{tabData:t,isPro:l,couldEdit:i}));return u},a}return y()(t,e),p()(t,[{key:"handleTaskParamChange",value:function(e){this.props.setTaskParams({taskParams:e})}},{key:"render",value:function(){var e=this;return v.a.createElement("div",{className:"m-siderbench padding-r0",ref:function(t){e.SideBench=t}},v.a.createElement(q.a,{activeKey:this.state.selected,type:"card",className:"task-params",tabPosition:"right",onTabClick:this.tabClick},this.getTabPanes()))}}]),t}(v.a.Component),Mn=Object(b.b)(function(e){return{project:e.project,user:e.user}},function(e){return{setTaskParams:function(t){e({type:Ee.o.SET_TASK_SQL_FIELD_VALUE,payload:t})}}})(_n),Pn=a("iEKX"),Vn=j.a.Item,Un=pe.a.Option,jn=ue.a.Group,Hn=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.state={radio:1},n.splitChange=function(e){n.props.changeStatus({splitSymbol:e})},n.charsetChange=function(e){n.props.changeStatus({charset:e})},n.asTitle=function(e){var t=e.target.checked;n.props.changeStatus({asTitle:t,matchType:t?1:0})},n.changeStartLine=function(e){n.props.formState;var t=parseInt(e.target.value,10);t=t<1?1:t,n.props.changeStatus({startLine:t})},n.radioChange=function(e){n.setState({radio:e.target.value})},n.generateCols=function(e,t){if(t&&t.length>0){var a=[];return e?(t.forEach(function(e,t){a.push({title:e,width:100,key:t+e,render:function(e,a){return v.a.createElement(Pn.a,{style:{minWidth:100},value:a[t]})}})}),a):(t.forEach(function(e,t){var n="col-"+(t+1);a.push({key:n,width:100,title:n,render:function(e,a){return v.a.createElement(Pn.a,{style:{minWidth:100},value:a[t]})}})}),a)}return[]},r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"getRowKey",value:function(e,t){return(e.length>0?e[0]:"")+"-"+t}},{key:"render",value:function(){var e=this,t=this.props,a=t.data,n=t.file,l=t.display,i=t.formState,o=this.generateCols(i.asTitle,a[0]),s=i.asTitle?a.slice(1):a,c=this.state.radio;return v.a.createElement("div",{style:{display:"source"===l?"block":"none"}},v.a.createElement(r.a,null,v.a.createElement(j.a,null,v.a.createElement(Vn,M()({},z.C,{label:"已选文件"}),v.a.createElement("span",{style:{fontSize:"14px"}},n.name||""),"  ",v.a.createElement("span",{style:{color:"#f60"}},"只支持.txt、.csv和.log文件类型")),v.a.createElement(Vn,M()({},z.C,{label:"分隔符"}),v.a.createElement(jn,{onChange:this.radioChange,defaultValue:1},v.a.createElement(ue.a,{value:1}),v.a.createElement(pe.a,{disabled:2===c,style:{width:"80px"},value:i.splitSymbol,onChange:this.splitChange},v.a.createElement(Un,{value:","},"逗号"),v.a.createElement(Un,{value:"tab"},"Tab"),v.a.createElement(Un,{value:";"},"分号"),v.a.createElement(Un,{value:"blank"},"空格"),v.a.createElement(Un,{value:"|"},"|"),v.a.createElement(Un,{value:"#"},"#"),v.a.createElement(Un,{value:"&"},"&")),"  ",v.a.createElement(ue.a,{value:2},"自定义"),v.a.createElement(F.a,{disabled:1===c,onChange:function(t){e.splitChange(t.target.value)},style:{width:"80px"}}))),v.a.createElement(Vn,M()({},z.C,{label:"原始字符集"}),v.a.createElement(pe.a,{value:i.charset,onChange:this.charsetChange},v.a.createElement(Un,{value:"UTF-8"},"UTF-8"),v.a.createElement(Un,{value:"GBK"},"GBK"),v.a.createElement(Un,{value:"CP936"},"CP936"),v.a.createElement(Un,{value:"ISO-8859"},"ISO-8859"))),v.a.createElement(Vn,M()({},z.C,{label:"导入起始行"}),v.a.createElement(F.a,{onChange:this.changeStartLine,type:"number",min:1,max:a.length,value:i.startLine})),v.a.createElement(Vn,M()({},z.C,{label:"首行为标题"}),v.a.createElement(tt.a,{checked:i.asTitle,onChange:this.asTitle},"是")))),v.a.createElement(r.a,{className:"no-table-padding"},v.a.createElement(re.a,{rowKey:this.getRowKey,scroll:{y:240,x:800},bordered:!0,dataSource:s,columns:o})))}}]),t}(f.Component),Bn=a("qWjE"),Gn=a("FL+A"),qn=ue.a.Group,Wn=j.a.Item,Kn=pe.a.Option,Yn=function(e){function t(){var e,a,n,l;u()(this,t);for(var i=arguments.length,o=Array(i),c=0;c<i;c++)o[c]=arguments[c];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(o))),n.state={visible:!1,pagination:{current:1,pageSize:10}},n.tableInput=function(e){var t=n.props.changeStatus;e.length>0&&Bn.a.getTablesByName({tableName:e}).then(function(e){1===e.code&&t({tableList:e.data||[]})})},n.tbNameOnChange=function(e){var t={queryTable:e};""===e&&(t.tableData={}),n.props.changeStatus(t)},n.debounceSearch=Object(g.debounce)(n.tableInput,500,{maxWait:2e3}),n.tableChange=function(e,t){var a=t.props.data,r=n.props,l=r.changeStatus,i=r.data[0]||[];Bn.a.getTable({tableId:a.id}).then(function(e){if(1===e.code){var t=e.data,n=t.column&&t.column.map(function(e){var t=e.columnName;return i.indexOf(t)>-1?t:""}),r=t.partition&&t.partition.map(function(e){return se()({},e.columnName,"")});l({targetTable:a,queryTable:a.tableName,tableData:t,hasPartition:t.partition&&t.partition.length>0,columnMap:n,originPartitions:t.partition,partitions:r,targetExchangeWarning:!1})}})},n.checkPartition=function(){for(var e=n.props.formState,t=e.targetTable,a=e.partitions,r=e.originPartitions,l=0;l<a.length;l++){var i=a[l],o=r[l].columnName;if(""===T.a.trim(i[o]))return void x.a.error("分区值不可为空！")}Bn.a.checkTablePartition({tableId:t.id,partitionInfo:a}).then(function(e){e.data?x.a.success("分区存在！"):x.a.error("分区不存在！")})},n.createTable=function(){var e=n.props.formState.sqlText;Bn.a.createDdlTable({sql:e}).then(function(e){1===e.code&&(n.setState({visible:!1,tableList:[e.data]}),n.tbNameOnChange(e.data.id),n.tableChange(e.data.id,{props:{data:e.data}}),x.a.success("表创建成功!"))})},n.handleCancel=function(){n.setState({visible:!1})},n.mapChange=function(e,t){var a=n.props,r=a.formState,l=a.changeStatus,i=[].concat(ie()(r.columnMap));i[t]=e,l({columnMap:i,targetExchangeWarning:!1})},n.changeMatchWay=function(e){n.props.formState.asTitle&&n.props.changeStatus({matchType:e.target.value,targetExchangeWarning:!1})},n.changeImportMode=function(e){n.props.changeStatus({overwriteFlag:e.target.value})},n.tablePartitionChange=function(e,t,a){var r=n.props.formState.partitions,l=[].concat(ie()(r));l[a]=se()({},t.columnName,e.target.value),n.props.changeStatus({partitions:l})},n.ddlChange=function(e){(0,n.props.changeStatus)({sqlText:e})},n.generateCols=function(e){var t=n.props,a=t.formState,r=t.warning,l=n.state.pagination,i=a.columnMap,o=e&&e.length?e[0].map(function(e,t){return v.a.createElement(Kn,{key:"col-"+t,value:e},e)}):[];return[{title:"目标字段",key:"target_part",render:function(e,t){return v.a.createElement("span",null,t.columnName)}},{title:v.a.createElement("span",null,"源字段 ",r&&v.a.createElement("span",{style:{color:"#ce3b3b",float:"right"}},"请至少选择一个源字段")),key:"source_part",render:function(e,t,r){var s=r+(l.current-1)*l.pageSize;return v.a.createElement("span",null,v.a.createElement(pe.a,{value:0===a.matchType?"":i[s],disabled:0===a.matchType,onSelect:function(e){n.mapChange(e,s)},style:{width:"200px"}},v.a.createElement(Kn,{key:"col-null",value:""},"空字段"),o))}}]},n.generatePartitions=function(e){return e.map(function(t,a){return v.a.createElement(r.a,{key:"partition-"+a},v.a.createElement("div",{className:"ellipsis",title:t.columnName,style:{width:"60px",display:"inline-block"}},t.columnName),v.a.createElement(F.a,{style:{width:"140px"},onChange:function(e){n.tablePartitionChange(e,t,a)},placeholder:"请输入分区名称"}),"  ",0===a?v.a.createElement(D.a,{type:"primary",onClick:n.checkPartition},"检测"):"",a===e.length-1?v.a.createElement("span",{style:{color:"#f60"}},v.a.createElement("br",null),'点击"检测"按钮，测试分区是否存在'):"")})},l=a,h()(n,l)}return y()(t,e),p()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.visible,a=e.visible;t==a||a||this.setState({pagination:{current:1,pageSize:10}})}},{key:"onTableChange",value:function(e){this.setState({pagination:e})}},{key:"render",value:function(){var e=this,t=this.props,a=t.data,n=(t.file,t.display),l=t.formState,i=l.tableList,o=l.tableData,s=l.queryTable,c=l.asTitle,u=this.state.pagination,d=this.generateCols(a,o),p=this.generatePartitions(o.partition||[]),m=o&&o.column,h=i.map(function(e,t){return v.a.createElement(Kn,{key:"table-"+t,data:e,value:e.tableName},e.tableName)});return v.a.createElement("div",{style:{display:"target"===n?"block":"none"}},v.a.createElement(r.a,null,v.a.createElement(j.a,null,v.a.createElement(Wn,M()({},z.C,{label:"导入至表"}),v.a.createElement("div",null,v.a.createElement(pe.a,{mode:"combobox",style:{width:"200px"},onChange:this.tbNameOnChange,onSearch:this.debounceSearch,onSelect:this.tableChange,notFoundContent:"没有发现相关表",value:s,placeholder:"请输入表名",showArrow:!1,filterOption:!1,defaultActiveFirstOption:!1},h),"  ",v.a.createElement(D.a,{type:"primary",onClick:function(){e.setState({visible:!0})}},"新建表"))),v.a.createElement(Wn,M()({},z.C,{style:{display:o.partition&&o.partition.length>0?"block":"none"},label:"分区"}),p),v.a.createElement(Wn,M()({},z.C,{label:"字段匹配"}),v.a.createElement(qn,{value:l.matchType,onChange:this.changeMatchWay},v.a.createElement(ue.a,{value:0},"按位置匹配"),v.a.createElement(ue.a,{disabled:!c,value:1},"按名称匹配"))),v.a.createElement(Wn,M()({},z.C,{label:"导入模式"}),v.a.createElement(qn,{value:l.overwriteFlag,onChange:this.changeImportMode},v.a.createElement(ue.a,{value:0},"追加"),v.a.createElement(ue.a,{value:1},"覆盖"))))),v.a.createElement(r.a,null,v.a.createElement(re.a,{className:"m-table",bordered:!0,columns:d,dataSource:m,onChange:this.onTableChange.bind(this),pagination:u})),v.a.createElement(B.a,{className:"m-codemodal",title:v.a.createElement("span",null,"建表语句",v.a.createElement(Gn.a,{title:"复制模版",style:{marginLeft:"8px"},copyText:Ne.a})),maskClosable:!1,style:{height:424},visible:this.state.visible,onCancel:this.handleCancel,onOk:this.createTable},v.a.createElement(Oe.a,{language:"dtsql",placeholder:Ne.a,onChange:this.ddlChange})))}}]),t}(f.Component),zn={file:"",startLine:1,asTitle:!0,visible:!1,sourceFile:"",data:[],splitSymbol:",",charset:"UTF-8",step:"source",tableData:{},targetTable:"",tableList:[],partitions:[],hasPartition:!1,originPartitions:[],columnMap:[],matchType:1,sqlText:"",queryTable:"",overwriteFlag:0,originLineCount:0,targetExchangeWarning:!1},Qn=function(e){function t(){var e,a,n,r;u()(this,t);for(var l=arguments.length,i=Array(l),o=0;o<l;o++)i[o]=arguments[o];return a=n=h()(this,(e=t.__proto__||s()(t)).call.apply(e,[this].concat(i))),n.state=Ct()({},zn),n.importData=function(){var e=n.getParams();n.checkParams(e)&&(e.partitions=oa()(e.partitions),e.keyRef=oa()(e.keyRef),n.setState({loading:!0}),Bn.a.importLocalData(e).then(function(e){if(n.setState({loading:!1}),1===e.code){var t="您已经成功导入"+e.data+"条数据！";x.a.success(t),n.setState({visible:!1})}}))},n.checkParams=function(e){var t=!0,a=n.state,r=a.originPartitions,l=a.columnMap,i=a.matchType,o=e.partitions;if(!e.tableId)return x.a.error("请选择要导入的目标表！"),!1;if(1==i){for(var s=!0,c=0;c<l.length;c++){if(l[c]){s=!1;break}}if(s)return n.setState({targetExchangeWarning:!0}),!1}if(r&&r.length>0){for(var u=!0,d=0;d<o.length;d++){""===o[d][r[d].columnName]&&(t=!1,u=!1)}u||x.a.error("分区每项值必填！")}return t},n.getParams=function(){var e=n.state,t=e.file,a=e.targetTable,r=e.splitSymbol,l=e.charset,i=e.startLine,o=e.asTitle,s=e.matchType,c=e.columnMap,u=e.partitions,d=e.overwriteFlag;return{tableId:a.id,separator:r,oriCharset:l,topLineIsTitle:o,keyRef:c,file:t,matchType:s,startLine:i,partitions:u,overwriteFlag:d}},n.fileChange=function(e){var t=e.target.files[0];t.size>52428800?x.a.error("本地上传文件不可超过50MB!"):n.setState({file:t},function(){n.readFile(t)})},n.fileClick=function(e){e.target.value=null,n.setState(Ct()({},zn))},n.readFile=function(e){var t=n.state.charset;if(e){var a=new FileReader;e.type.split("/")[1];a.onload=function(e){n.setState({sourceFile:e.target.result}),n.parseFile(e.target.result)},a.readAsText(e,t)}},n.changeStatus=function(e){var t=n.state.file;n.setState(e,function(){n.readFile(t)})},n.next=function(){n.setState({step:"target"})},n.prev=function(){n.setState({step:"source"})},r=a,h()(n,r)}return y()(t,e),p()(t,[{key:"parseFile",value:function(e){var t=this.state,a=t.splitSymbol,n=t.startLine,r=[],l=this.parseSplitSymbol(a);if((e=e.split("\n"))&&e[0].length>5e3)x.a.error("文件内容不正确！");else{for(var i=0;i<e.length;i++){var o=e[i].replace(/\r/,"");r.push(o.split(l))}var s=r.slice(n-1);this.setState({data:s||[],step:"source",visible:!0,originLineCount:e.length})}}},{key:"parseSplitSymbol",value:function(e){switch(e){case"blank":e=" ";break;case"tab":e="\t"}return e}},{key:"footer",value:function(){var e=this,t=this.state,a=t.step,n=t.loading;return v.a.createElement("div",null,v.a.createElement(D.a,{onClick:function(){e.setState({visible:!1})}},"取消"),v.a.createElement(D.a,{style:{display:"source"===a?"inline-block":"none"},type:"primary",onClick:this.next},"下一步"),v.a.createElement(D.a,{style:{display:"target"===a?"inline-block":"none"},type:"primary",onClick:this.prev},"上一步"),v.a.createElement(D.a,{style:{display:"target"===a?"inline-block":"none"},onClick:this.importData,loading:n,type:"primary"},"导入"))}},{key:"render",value:function(){var e=this,t=this.state,a=t.data,n=t.file,r=t.visible,l=t.step,i=t.targetExchangeWarning;return v.a.createElement("div",{id:"JS_import_modal"},v.a.createElement("input",{name:"file",type:"file",accept:".txt, .log, .csv",id:"importFile",onClick:this.fileClick,onChange:this.fileChange,style:{display:"none"}}),v.a.createElement(B.a,{maskClosable:!1,title:"本地数据导入",visible:r,onCancel:function(){e.setState({visible:!1})},footer:this.footer()},v.a.createElement(Hn,{data:a,file:n,display:l,formState:this.state,changeStatus:this.changeStatus}),v.a.createElement(Yn,{visible:r,warning:i,data:a,file:n,formState:this.state,changeStatus:function(t){e.setState(t)},display:l})))}}]),t}(f.Component),Xn=a("/x1C"),Jn=q.a.TabPane,$n=B.a.confirm,Zn=j.a.Item,er=function(e){function t(e){u()(this,t);var a=h()(this,(t.__proto__||s()(t)).call(this,e));return a.state={visible:!1,showPublish:!1,theReqIsEnd:!0},a.handleMenuClick=function(e){if("1"===e.key){var t=document.getElementById("importFile");t&&t.click()}},a.handleCreateClick=function(e){"task"===e.key?a.props.toggleCreateTask():"script"===e.key&&a.props.toggleCreateScript()},a.createMenu=function(){var e=a.props.scriptTreeData;return v.a.createElement(V.a,{onClick:a.handleCreateClick},v.a.createElement(V.a.Item,{key:"task"},"创建任务"),e&&v.a.createElement(V.a.Item,{key:"script"},"创建脚本"))},a.importMenu=function(){return v.a.createElement(V.a,{onClick:a.handleMenuClick},v.a.createElement(V.a.Item,{key:"1"},"导入本地数据"))},a.searchTask=function(){a.props.dispatch(Object(Xn.a)(!0))},a.renderPublish=function(){var e=a.props.user,t=a.state.publishDesc;return v.a.createElement(B.a,{wrapClassName:"vertical-center-modal",title:"提交任务",style:{height:"600px",width:"600px"},visible:a.state.showPublish,onCancel:a.closePublish,onOk:a.submitTab.bind(a),cancelText:"关闭"},v.a.createElement(j.a,null,v.a.createElement(Zn,M()({},z.C,{label:"提交人",hasFeedback:!0}),v.a.createElement("span",null,e.userName)),v.a.createElement(Zn,M()({},z.C,{label:v.a.createElement("span",null,"备注"),hasFeedback:!0}),v.a.createElement(F.a,{type:"textarea",value:t,name:"publishDesc",rows:4,onChange:a.publishChange}))),v.a.createElement(r.a,null,v.a.createElement(i.a,{offset:6,span:15},"注意：提交过的任务才能被调度执行及发布到其他项")))},a.publishChange=function(e){a.setState({publishDesc:e.target.value})},a.closePublish=function(){a.setState({publishDesc:"",showPublish:!1})},a}return y()(t,e),p()(t,[{key:"toPublishView",value:function(){W.g.push({pathname:"/package/create",query:{type:"offline"}})}},{key:"showPublish",value:function(){var e=this.props.currentTabData,t=!0;switch(e.taskType){case z.y.SYNC:e.createModel==z.f.SCRIPT&&(t=this.checkSyncScript(e))}t&&this.setState({showPublish:!0})}},{key:"checkSyncScript",value:function(e){var t=e.sqlText;return!!T.a.jsonFormat(t)||(x.a.error("请确认JSON格式是否正确"),!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.tabs,n=t.currentTab,l=t.currentTabData,o=t.dataSync,s=t.taskCustomParams,c=t.closeTab,u=t.closeAllorOthers,d=t.project,p=t.user,m=t.editor,h=t.dispatch,E=o.sourceMap,y=o.targetMap,f=this.state.theReqIsEnd,b=d.projectType==z.n.TEST,k=Object(fe.f)(d,p),S=!1;Object(g.isEmpty)(E)||Object(g.isEmpty)(y)||(S=!0),l&&(l.taskType!==z.y.SYNC||l.createModel==z.f.SCRIPT&&l.taskType==z.y.SYNC)&&(S=!0),S=l&&!l.invalid||!f||l&&!l.notSynced,l&&l.readWriteLockVO&&!l.readWriteLockVO.getLock&&(S=!1);var O=l&&T.a.checkExist(l.taskType),L=l&&l.flowId&&0!==l.flowId,R=!O||l.notSynced||L,A=O,x="vs"!==m.options.theme||void 0;return v.a.createElement(r.a,{className:"m-workbench task-editor"},v.a.createElement("header",{className:"toolbar clear"},v.a.createElement(i.a,{className:"left"},k&&v.a.createElement("span",null,v.a.createElement(N.a,{overlay:this.createMenu(),trigger:["click"]},v.a.createElement(D.a,{title:"创建"},v.a.createElement(Q.a,{className:"my-icon",type:"focus",themeDark:x}),"新建",v.a.createElement(I.a,{type:"down"}))),v.a.createElement(D.a,{onClick:this.saveTab.bind(this,!0),title:"保存任务",disabled:!S},v.a.createElement(Q.a,{className:"my-icon",type:"save",themeDark:x}),"保存")),v.a.createElement(N.a,{overlay:this.importMenu(),trigger:["click"]},v.a.createElement(D.a,null,v.a.createElement(Q.a,{className:"my-icon",type:"import",themeDark:x}),"导入",v.a.createElement(I.a,{type:"down"}))),v.a.createElement(D.a,{onClick:this.searchTask,title:"打开任务"},v.a.createElement(Q.a,{className:"my-icon",type:"search",themeDark:x}),"搜索"),v.a.createElement(K.a,{themeDark:x}),v.a.createElement($.a,{editorTheme:m.options.theme,onThemeChange:function(e){h(Object(At.updateEditorOptions)({theme:e}))}})),A?v.a.createElement(i.a,{className:"right"},k&&v.a.createElement("span",null,v.a.createElement(C.a,{placement:"bottom",title:"提交到调度系统",mouseLeaveDelay:0},v.a.createElement(D.a,{disabled:R,onClick:this.showPublish.bind(this)},v.a.createElement(I.a,{type:"upload",themeDark:x}),"提交")),b&&v.a.createElement(C.a,{placement:"bottom",title:"发布到目标项目",mouseLeaveDelay:0},v.a.createElement(D.a,{disabled:R,onClick:this.toPublishView.bind(this)},v.a.createElement(Q.a,{className:"my-icon",type:"fly",themeDark:x}),"发布"))),v.a.createElement("a",{href:location.pathname+"#/operation/offline-management?tname="+(l&&l.name)},v.a.createElement(D.a,{disabled:!O},v.a.createElement(Q.a,{className:"my-icon",type:"goin",themeDark:x})," 运维"))):null),v.a.createElement(r.a,{className:"task-browser"},v.a.createElement("div",{className:"browser-content"},v.a.createElement(q.a,{hideAdd:!0,onTabClick:this.switchTab.bind(this,n),activeKey:""+n,type:"editable-card",className:"browser-tabs",onEdit:function(e){return c(e,a)},tabBarExtraContent:v.a.createElement(N.a,{overlay:v.a.createElement(V.a,{style:{marginRight:2,maxHeight:"500px",overflowY:"auto"}},v.a.createElement(V.a.Item,{key:"OHTERS"},v.a.createElement("a",{onClick:function(){return u("OHTERS",a,n)}},"关闭其他")),v.a.createElement(V.a.Item,{key:"ALL"},v.a.createElement("a",{onClick:function(){return u("ALL",a,n)}},"关闭所有")),v.a.createElement(V.a.Divider,null),a.map(function(t){return v.a.createElement(V.a.Item,{key:t.id},v.a.createElement("a",{onClick:e.switchTab.bind(e,n,t.id),style:t.id==n?{color:"#2491F7"}:{}},t.name))}))},v.a.createElement(I.a,{type:"bars",size:"",style:{margin:"7 0 0 0",fontSize:18}}))},this.renderTabs(a)),v.a.createElement(Ba,{tabs:a,tabData:l,taskCustomParams:s,updateTaskFields:this.props.updateTaskField,updateCatalogue:this.props.updateCatalogue,loadTreeNode:this.props.loadTreeNode,reloadWorkflowTabNode:this.props.reloadWorkflowTabNode}),v.a.createElement(Mn,{tabData:l,key:l&&l.id}))),v.a.createElement(Qn,{visible:this.state.visible}),this.renderPublish())}},{key:"renderTabs",value:function(e){var t=this;return e&&e.length>0?e.map(function(e){var a=v.a.createElement("div",null,v.a.createElement(J.a,{tabData:e}),v.a.createElement("span",{className:"tab-ellipsis"},e.name),v.a.createElement(X.a,{notSynced:e.notSynced}));return e.flowId&&(a=v.a.createElement("div",null,v.a.createElement(J.a,{tabData:e}),v.a.createElement("a",{className:"tab-ellipsis",onClick:function(){return t.switchTab(t.props.currentTab,e.flowId)}},e.flowName),v.a.createElement("span",{className:"tab-ellipsis"}," / ",e.name),v.a.createElement(X.a,{className:"tab-ellipsis",notSynced:e.notSynced}))),v.a.createElement(Jn,{style:{height:"0px"},tab:a,key:e.id})}):[]}},{key:"saveTab",value:function(e){var t=this;this.setState({theReqIsEnd:!1});var a=this.props,n=a.saveTab,r=a.dataSync,l=a.currentTabData;if(l.taskType===z.y.WORKFLOW&&l.toUpdateTasks&&l.toUpdateTasks.length>0)return x.a.warning("您有工作流节点任务未保存！"),!1;var i=this.generateRqtBody(r),o="task";T.a.checkExist(l.taskType)||(i=l,o="script"),i.preSave=!0,i.submitStatus=0,n(i,e,o),setTimeout(function(){t.setState({theReqIsEnd:!0})},500)}},{key:"submitTab",value:function(){var e=this,t=this.props,a=t.publishTask,n=t.dataSync,r=t.currentTab,l=t.reloadTaskTab,i=(t.project.projectType,z.n.PRO,this.state.publishDesc),o=void 0===i?"":i,s=this.generateRqtBody(n);if(o.length>200)return x.a.error("备注信息不可超过200个字符！"),!1;s.preSave=!0,s.submitStatus=1,s.publishDesc=o,Y.a.publishOfflineTask(s).then(function(t){1===t.code?(x.a.success("提交成功！"),a(t),l(r),e.closePublish()):e.closePublish()})}},{key:"switchTab",value:function(e,t){var a=this.props,n=a.openTab,r=a.tabs;+t!==e&&n({id:+t,tabs:r})}},{key:"closeTab",value:function(e){var t=this.props,a=t.closeTab;t.tabs.filter(function(t){return t.id==e})[0].notSynced?$n({title:"修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃当前修改数据",onOk:function(){a(+e)},onCancel:function(){}}):a(+e)}},{key:"generateRqtBody",value:function(e){var t=Object(g.cloneDeep)(e),a=this.props,n=a.tabs,r=a.currentTab,l=a.currentTabData,i=t.keymap,o=t.sourceMap,s=t.targetMap,c=i.source,u=i.target;t.sourceMap.column=c,t.targetMap.column=u,t.settingMap=t.setting,t.name=l.name,t.taskId=l.id;var d=s.type,p=o.type;for(var m in p)p.hasOwnProperty(m)&&(o[m]=p[m]);for(var h in d)d.hasOwnProperty(h)&&(s[h]=d[h]);delete t.keymap,delete t.setting,delete t.dataSourceList;var E=Object(g.cloneDeep)(n.filter(function(e){return e.id===r})[0]);for(var y in t)t.hasOwnProperty(y)&&(E[y]=t[y]);return E.preSave=!0,E.taskVOS&&(E.dependencyTasks=E.taskVOS.map(function(e){return e}),E.taskVOS=null),delete E.taskVersions,E}}]),t}(v.a.Component),tr=Object(b.b)(function(e){var t=e.offlineTask,a=t.workbench,n=t.dataSync,r=t.scriptTree,l=a.currentTab,i=a.tabs,o=a.taskCustomParams,s=i.filter(function(e){return e.id===l})[0];return{currentTab:l,currentTabData:s,tabs:i,dataSync:n,taskCustomParams:o,user:e.user,scriptTreeData:r,project:e.project,editor:e.editor}},k.b)(er),ar=function(e){function t(){return u()(this,t),h()(this,(t.__proto__||s()(t)).apply(this,arguments))}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){var e=T.a.getParameterByName("taskId");e&&this.props.openTaskInDev(+e)}},{key:"render",value:function(){var e=this.props,t=e.workbench,a=e.scriptTree,n=e.user,l=e.editor,o=e.toggleCreateTask,s=e.toggleUpload,c=e.toggleCreateScript,u=e.project,d=Object(fe.f)(u,n),p="vs"!==l.options.theme||void 0?"/public/rdos/img/theme-dark":"/public/rdos/img";return t.tabs.length?v.a.createElement(tr,null):d&&v.a.createElement(r.a,{className:"box-card txt-left",style:{paddingTop:"30px"}},v.a.createElement(i.a,{className:"operation-card"},v.a.createElement("div",{onClick:o,className:"operation-content"},v.a.createElement("img",{src:p+"/create_task.png",className:"anticon"}),v.a.createElement("p",{className:"txt-center operation-title"},"创建离线任务"))),v.a.createElement(i.a,{className:"operation-card"},v.a.createElement("div",{onClick:s,className:"operation-content"},v.a.createElement("img",{src:p+"/upload_res.png",className:"anticon"}),v.a.createElement("p",{className:"txt-center operation-title"},"上传离线计算资源"))),!Object(g.isEmpty)(a)&&v.a.createElement(i.a,{className:"operation-card"},v.a.createElement("div",{onClick:c,className:"operation-content"},v.a.createElement("img",{src:p+"/create_script.png",className:"anticon"}),v.a.createElement("p",{className:"txt-center operation-title"},"创建脚本"))))}}]),t}(f.Component);t.default=Object(b.b)(function(e){var t=e.offlineTask.modalShow,a=t.createTask,n=t.upload,r=e.offlineTask;return{createTask:a,upload:n,workbench:r.workbench,scriptTree:r.scriptTree,project:e.project,user:e.user,editor:e.editor}},k.b)(ar)},AlEQ:function(e,t,a){"use strict";a.r(t),a.d(t,"conf",function(){return n}),a.d(t,"language",function(){return r});var n={comments:{lineComment:"--"},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}]},r={defaultToken:"",tokenPostfix:".sql",ignoreCase:!0,brackets:[{open:"[",close:"]",token:"delimiter.square"},{open:"(",close:")",token:"delimiter.parenthesis"}],keywords:["SELECT","FROM","WHERE","UNION ALL","LEFT OUTER JOIN","RIGHT OUTER JOIN","FULL OUTER JOIN","UNION","INSERT","ADD","ADMIN","AFTER","ALL","ALTER","ANALYZE","AND","ARCHIVE","ARRAY","AS","ASC","AUTHORIZATION","BEFORE","BETWEEN","BIGINT","BINARY","BOOLEAN","BOTH","BUCKET","BUCKETS","BY","CASCADE","CASE","CHANGE","CHAR","CLUSTER","CLUSTERED","CLUSTERSTATUS","COLLECTION","COLUMN","COLUMNS","COMMENT","COMPACT","COMPACTIONS","COMPUTE","CONCATENATE","CONF","CONTINUE","CREATE","CROSS","CUBE","CURRENT","CURSOR","DATA","DATABASE","DATABASES","DATE","DATETIME","DBPROPERTIES","DECIMAL","DEFERRED","DEFINED","DELETE","DELIMITED","DEPENDENCY","DESC","DESCRIBE","DIRECTORIES","DIRECTORY","DISABLE","DISTINCT","DISTRIBUTE","DOUBLE","DROP","ELEM_TYPE","ELSE","ENABLE","END","ESCAPED","EXCHANGE","EXCLUSIVE","EXISTS","EXPLAIN","EXPORT","EXTENDED","EXTERNAL","FALSE","FETCH","FIELDS","FILE","FILEFORMAT","FIRST","FLOAT","FOLLOWING","FORMAT","FORMATTED","FULL","FUNCTION","FUNCTIONS","GRANT","GROUP","GROUPING","HAVING","HOLD_DDLTIME","IDXPROPERTIES","IGNORE","IMPORT","IN","INDEX","INDEXES","INNER","INPATH","INPUTDRIVER","INPUTFORMAT","INT","INTERSECT","INTERVAL","INTO","IS","ITEMS","JOIN","JAR","KEYS","KEY_TYPE","LATERAL","LEFT","LESS","LIFECYCLE","LIKE","LIMIT","LINES","LOAD","LOCAL","LOCATION","LOCK","LOCKS","LOGICAL","LONG","MACRO","MAP","MAPJOIN","MATERIALIZED","MINUS","MORE","MSCK","NOT","NONE","NOSCAN","NO_DROP","NULL","OF","OFFLINE","ON","OPTION","OR","ORDER","OUT","OUTER","OUTPUTDRIVER","OUTPUTFORMAT","OVER","OVERWRITE","OWNER","PARTIALSCAN","PARTITION","PARTITIONED","PARTITIONS","PERCENT","PLUS","PRECEDING","PRESERVE","PRETTY","PRINCIPALS","PROCEDURE","PURGE","RANGE","READ","READONLY","READS","REBUILD","RECORDREADER","RECORDWRITER","REDUCE","REGEXP","RELOAD","RENAME","REPAIR","REPLACE","RESTRICT","REVOKE","REWRITE","RIGHT","RLIKE","ROLE","ROLES","ROLLUP","ROW","ROWS","SCHEMA","SCHEMAS","SEMI","SERDE","SERDEPROPERTIES","SERVER","SET","SETS","SHARED","SHOW","SHOW_DATABASE","SKEWED","SMALLINT","SORT","SORTED","SSL","STATISTICS","STORED","STREAMTABLE","STRING","STRUCT","TABLE","TABLES","TABLESAMPLE","TBLPROPERTIES","TEMPORARY","TERMINATED","TEXTFILE","THEN","TIMESTAMP","TINYINT","TO","TOUCH","TRANSACTIONS","TRANSFORM","TRIGGER","TRUNCATE","TRUE","UNARCHIVE","UNBOUNDED","UNDO","UNIONTYPE","UNIQUEJOIN","UNLOCK","UNSET","UNSIGNED","UPDATE","URI","USE","USER","USING","UTC","UTC_TMESTAMP","VALUES","VALUE_TYPE","VARCHAR","VIEW","WHEN","WHILE","WINDOW","WITH"],operators:["|","%","&","&&","*","+","-",".","/",";","<","<=","<>","=",">",">=","?"],builtinFunctions:["FROM_UNIXTIME","UNIX_TIMESTAMP","TO_DATE","YEAR","QUARTER","MONTH","DAY","HOUR","MINUTE","SECOND","WEEKOFYEAR","DATEDIFF","DATE_ADD","DATE_SUB","FROM_UTC_TIMESTAMP","TO_UTC_TIMESTAMP","CURRENT_DATE","CURRENT_TIMESTAMP","ADD_MONTHS","LAST_DAY","NEXT_DAY","TRUNC","MONTHS_BETWEEN","DATE_FORMAT","ROUND","BROUND","FLOOR","CEIL","RAND","EXP","LN","LOG10","LOG2","LOG","POW","SQRT","BIN","HEX","UNHEX","CONV","ABS","PMOD","SIN","ASIN","COS","ACOS","TAN","ATAN","DEGREES","RADIANS","POSITIVE","NEGATIVE","SIGN","E","PI","FACTORIAL","CBRT","SHIFTLEFT","SHIFTRIGHT","SHIFTRIGHTUNSIGNED","GREATEST","LEAST","ASCII","BASE64","CONCAT","CHR","CONTEXT_NGRAMS","CONCAT_WS","DECODE","ENCODE","FIND_IN_SET","FORMAT_NUMBER","GET_JSON_OBJECT","IN_FILE","INSTR","LENGTH","LOCATE","LOWER","LPAD","LTRIM","NGRAMS","PARSE_URL","PRINTF","REGEXP_EXTRACT","REGEXP_REPLACE","REPEAT","REVERSE","RPAD","RTRIM","SENTENCES","SPACE","SPLIT","STR_TO_MAP","SUBSTR","SUBSTRING_INDEX","TRANSLATE","TRIM","UNBASE64","UPPER","INITCAP","LEVENSHTEIN","SOUNDEX","SIZE","MAP_KEYS","MAP_VALUES","ARRAY_CONTAINS","SORT_ARRAY","ROW_NUMBER"],windowsFunctions:["COUNT","AVG","MAX","MIN","STDDEV_SAMP","SUM"],innerFunctions:["COUNT","SUM","AVG","MIN","MAX","VARIANCE","VAR_SAMP","STDDEV_POP","STDDEV_SAMP","COVAR_POP","COVAR_SAMP","CORR","PERCENTILE","EXPLODE","POSEXPLODE","STACK","JSON_TUPLE","PARSE_URL_TUPLE","INLINE"],otherFunctions:["IF","NVL","COALESCE","ISNULL","ISNOTNULL","ASSERT_TRUE","CAST","BINARY"],customFunctions:[],pseudoColumns:["$ACTION","$IDENTITY","$ROWGUID","$PARTITION"],tokenizer:{root:[{include:"@comments"},{include:"@whitespace"},{include:"@pseudoColumns"},{include:"@numbers"},{include:"@strings"},{include:"@complexIdentifiers"},{include:"@scopes"},[/[;,.]/,"delimiter"],[/[()]/,"@brackets"],[/[\w@#$]+/,{cases:{"@keywords":"keyword","@operators":"operator","@windowsFunctions":"predefined","@builtinFunctions":"predefined","@innerFunctions":"predefined","@otherFunctions":"predefined","@customFunctions":"predefined","@default":"identifier"}}],[/[<>=!%&+\-*/|~^]/,"operator"]],whitespace:[[/\s+/,"white"]],comments:[[/--+.*/,"comment"]],pseudoColumns:[[/[$][A-Za-z_][\w@#$]*/,{cases:{"@pseudoColumns":"predefined","@default":"identifier"}}]],numbers:[[/0[xX][0-9a-fA-F]*/,"number"],[/[$][+-]*\d*(\.\d*)?/,"number"],[/((\d+(\.\d*)?)|(\.\d+))([eE][\-+]?\d+)?/,"number"]],strings:[[/'$/,"string","@popall"],[/'/,"string","@stringBody"],[/"$/,"string","@popall"],[/"/,"string","@dblStringBody"]],stringBody:[[/\\./,"string"],[/'/,"string","@popall"],[/.(?=.*')/,"string"],[/.*\\$/,"string"],[/.*$/,"string","@popall"]],dblStringBody:[[/\\./,"string"],[/"/,"string","@popall"],[/.(?=.*")/,"string"],[/.*\\$/,"string"],[/.*$/,"string","@popall"]],complexIdentifiers:[[/\[/,{token:"identifier.quote",next:"@bracketedIdentifier"}],[/"/,{token:"identifier.quote",next:"@quotedIdentifier"}]],bracketedIdentifier:[[/[^\]]+/,"identifier"],[/]]/,"identifier"],[/]/,{token:"identifier.quote",next:"@pop"}]],quotedIdentifier:[[/[^"]+/,"identifier"],[/""/,"identifier"],[/"/,{token:"identifier.quote",next:"@pop"}]],scopes:[[/BEGIN\s+(DISTRIBUTED\s+)?TRAN(SACTION)?\b/i,"keyword"],[/BEGIN\s+TRY\b/i,{token:"keyword.try"}],[/END\s+TRY\b/i,{token:"keyword.try"}],[/BEGIN\s+CATCH\b/i,{token:"keyword.catch"}],[/END\s+CATCH\b/i,{token:"keyword.catch"}],[/(BEGIN|CASE)\b/i,{token:"keyword.block"}],[/END\b/i,{token:"keyword.block"}],[/WHEN\b/i,{token:"keyword.choice"}],[/THEN\b/i,{token:"keyword.choice"}]]}}}}]);