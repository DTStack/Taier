(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{"/AHB":function(e,t,a){"use strict";a.r(t);var n=a("fvjX"),r=a("L3Ur"),s=a("Aqym"),l=a("LvDl"),i={userList:[]},o=a("6EK8"),c=a("+JEa"),u=Object(n.c)({routing:r.routerReducer,user:o.a,apps:c.b,app:c.a,consoleUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments[1];switch(t.type){case s.a.SET_USER_LIST:var a=t.data,n=Object(l.cloneDeep)(e);return n.userList=a,n;default:return e}}});t.default=u},"2NsA":function(e,t,a){"use strict";a.d(t,"a",function(){return o});var n=a("dtw8"),r=(a("1ZXz"),a("TdMD")),s=a.n(r),l=a("fvjX"),i=a("L3Ur");function o(e,t){var a=function(e){return Object(l.e)(e,Object(l.a)(s.a))}(e),r=t&&"hash"===t?n.g:n.f;return{store:a,history:Object(i.syncHistoryWithStore)(r,a)}}},"3J6H":function(e,t,a){},"6EK8":function(e,t,a){"use strict";a.d(t,"a",function(){return i});var n=a("QbLZ"),r=a.n(n),s=(a("LvDl"),a("CMun")),l={id:0,dtuicUserId:0,userName:"未登录",isRoot:!1};function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments[1];switch(t.type){case s.a.GET_USER:return t.data;case s.a.UPDATE_USER:return null!==t.data?r()({},e,t.data):e;default:return e}}},"95Qq":function(e,t,a){},Aqym:function(e,t,a){"use strict";var n=a("zbcj"),r=a.n(n)()(["SET_USER_LIST"],{prefix:"console/"});t.a=r},EMQV:function(e,t,a){},FdzR:function(e,t,a){},TmhF:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a("udPp");function r(e){return{type:n.a.UPDATE_APP,data:e}}},XoD3:function(e,t,a){},YHBf:function(e,t,a){"use strict";a.r(t);var n,r,s=a("sbe7"),l=a.n(s),i=a("i8i4"),o=a.n(i),c=a("0cfB"),u=a("2NsA"),d=a("Yz+Y"),m=a.n(d),p=a("iCc5"),f=a.n(p),h=a("V7oC"),g=a.n(h),v=a("FYw3"),E=a.n(v),y=a("mRg0"),k=a.n(y),C=a("dtw8"),b=a("/MKj"),S=(a("3J6H"),a("EMQV"),a("FdzR"),a("95Qq"),a("XoD3"),a("XLg0")),_=a("2BCK"),x=a("vFRS"),U=a("NX2S"),T=a("UopC"),N=a("X9CO"),L=a("dVc0"),I=a("2Ul7"),w=a("AVFO"),P=a("17x9"),R=a.n(P),D=a("QbLZ"),M=a.n(D),O=a("pLPX"),A=Object(b.b)(function(e){return{user:e.user,apps:e.apps,routing:e.routing,common:e.common,app:e.app}})(n=function(e){function t(e){f()(this,t);var a=E()(this,(t.__proto__||m()(t)).call(this,e));return a.state={},a}return k()(t,e),g()(t,[{key:"render",value:function(){var e=this.props,t=(e.user,e.apps,"/console.html#/console"),a=[{id:"resourceManage",name:"资源管理",link:t+"/resourceManage",enable:!0},{id:"clusterManage",name:"多集群管理",link:t+"/clusterManage",enable:!0}],n=l.a.createElement("span",null,l.a.createElement("img",{style:{height:"20px",width:"20px",marginTop:"13px"},alt:"logo",src:"/public/console/img/logo.svg"}),l.a.createElement("span",{style:{fontSize:"14px",color:"#ffffff",position:"absolute",left:"80px",top:0}},"DTinsight.Console"));return l.a.createElement(O.c,M()({logoWidth:"170px",logo:n,menuItems:a},this.props))}}]),t}(s.Component))||n,F=a("TmhF"),H=a("PVY6"),q={children:R.a.node},j=Object(b.b)(function(e){return{common:e.common}})(r=function(e){function t(){return f()(this,t),E()(this,(t.__proto__||m()(t)).apply(this,arguments))}return k()(t,e),g()(t,[{key:"componentWillMount",value:function(){this.props.dispatch}},{key:"componentDidMount",value:function(){(0,this.props.dispatch)(Object(F.a)(H.h))}},{key:"render",value:function(){var e=this.props.children,t=l.a.createElement(A,null);return l.a.createElement("div",{className:"main"},t,l.a.createElement("div",{className:"container overflow-x-hidden"},e||"加载中...."))}}]),t}(s.Component))||r;j.propTypes=q,j.defaultProps={children:[]};var V=j,B=(a("zmYW"),a("DtFj")),z=a.n(B),Y=(a("mN36"),a("N9UN")),G=a.n(Y),Q=(a("ek7I"),a("FAat")),Z=a.n(Q),K=a("wd/R"),X=a.n(K),J=a("4d7F"),W=a.n(J),$=(a("pjuD"),a("rR1Q")),ee=a.n($),te=a("gDS+"),ae=a.n(te),ne=(a("bZMm"),a("wFDc")),re=(a("tL+A"),a("QpBz")),se=a.n(re),le=a("7Qib"),ie=a("OZjc"),oe={DA_GET_USER_BY_ID:H.b+"/user/getUserById",DA_GET_USER_AUTH_BY_ID:H.b+"/user/getUserById",GET_USER_LIST:H.b+"/tenant/listTenant",GET_RESOURCE_USER_LIST:H.b+"/tenant/listByQueueId",BIND_USER_TO_RESOURCE:H.b+"/tenant/addToQueue",GET_RESOURCE_LIST:H.b+"/cluster/pageQueue",GET_CLUSTER_LIST:H.b+"/cluster/pageQuery",UPDATE_CLUSTER:H.a+"/upload/cluster/update",NEW_CLUSTER:H.a+"/upload/cluster/add",TEST_CLUSTER_CONNECT:H.b+"/cluster/testConnect",UPLOAD_CLUSTER_RESOURCE:H.a+"/upload/cluster/config",GET_CLUSTER:H.b+"/cluster/getOne"},ce=APP_CONF.UIC_URL||"",ue=APP_CONF.UIC_DOMAIN||"",de={logout:function(){var e=this;he.post(oe.APP_LOGOUT).then(function(t){1===t.code&&e.openLogin()})},openLogin:function(){ie.a.clear(),le.a.deleteCookie("dt_user_id",ue,"/"),le.a.deleteCookie("dt_token",ue,"/"),le.a.deleteCookie("dt_tenant_id",ue,"/"),le.a.deleteCookie("dt_tenant_name",ue,"/"),le.a.deleteCookie("dt_username",ue,"/"),le.a.deleteCookie("dt_is_tenant_admin",ue,"/"),le.a.deleteCookie("dt_is_tenant_creator",ue,"/"),le.a.deleteCookie("project_id",ue,"/"),window.location.href=ce+"/#/login"},getLoginedUser:function(){return he.post(oe.DA_GET_USER_BY_ID)},getUserList:function(){return he.post(oe.DATA_API_GET_USER_LIST)}};function me(e){switch(e.status){case 402:case 200:return e;case 302:se.a.info("登录超时, 请重新登录！");case 500:se.a.error("服务器出现了点问题");default:return e}}function pe(e){switch(e.code){case 1:return e;case 0:return de.openLogin(),W.a.reject(e);case 3:return ee.a.error({message:"权限通知",description:e.message}),W.a.reject(e);case 16:hashHistory.push("/");default:return e.message&&se.a.error(e.message,3),e}}var fe,he=new(function(){function e(){f()(this,e)}return g()(e,[{key:"get",value:function(e,t){var a=t?this.build(e,t):e;return this.request(a,{method:"GET"})}},{key:"post",value:function(e,t){var a={method:"POST"};return t&&(a.body=ae()(t)),this.request(e,a)}},{key:"postAsFormData",value:function(e,t){var a={method:"POST"};return t&&(a.body=this.buildFormData(t)),this.request(e,a)}},{key:"postForm",value:function(e,t){var a={method:"POST"};return t&&(a.body=new FormData(t)),this.request(e,a)}},{key:"request",value:function(e,t){return ne.a.show(),t.credentials="same-origin",fetch(e,t).then(me).then(function(e){return setTimeout(function(){ne.a.hide()},300),e.json()}).then(pe).catch(function(e){return ne.a.hide(),ee.a.error({message:"请求异常",description:"服务器可能出了点问题, 请稍后再试！"}),new W.a.reject(e)})}},{key:"defaultHeader",value:function(){return{Accept:"*/*","Content-Type":"application/json"}}},{key:"build",value:function(e,t){var a=[];if(t)for(var n in t)n&&a.push(n+"="+encodeURIComponent(t[n]));return e+"?"+a.join("&")}},{key:"buildFormData",value:function(e){if(e){var t=new FormData;for(var a in e)a&&t.append(a,e[a]);return t}}}]),e}()),ge={getResourceList:function(e){return he.post(oe.GET_RESOURCE_LIST,e)},getClusterList:function(e){return he.post(oe.GET_CLUSTER_LIST,e)},uploadClusterResource:function(e){return he.postAsFormData(oe.UPLOAD_CLUSTER_RESOURCE,e)},getTenantList:function(e){return he.post(oe.GET_USER_LIST,e)},testCluster:function(e){return he.post(oe.TEST_CLUSTER_CONNECT,e)},createCluster:function(e){return he.postAsFormData(oe.NEW_CLUSTER,e)},bindUserToQuere:function(e){return he.post(oe.BIND_USER_TO_RESOURCE,e)},getClusterInfo:function(e){return he.post(oe.GET_CLUSTER,e)},updateCluster:function(e){return he.postAsFormData(oe.UPDATE_CLUSTER,e)}},ve=(a("fwXI"),a("CC+v")),Ee=a.n(ve),ye=(a("nTym"),a("qu0K")),ke=a.n(ye),Ce=a("GQeE"),be=a.n(Ce),Se=a("oF3Q"),_e=a.n(Se),xe=a("YEIV"),Ue=a.n(xe),Te=a("LvDl"),Ne={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}},Le=a("Aqym");function Ie(){return function(e){ge.getTenantList({pageSize:9999,currentPage:1}).then(function(t){if(1===t.code)return e({type:Le.a.SET_USER_LIST,data:t.data.data})})}}var we=Z.a.Option;var Pe,Re=Object(b.b)(function(e){return{consoleUser:e.consoleUser}},function(e){return{getTenantList:function(){e(Ie())}}})(fe=function(e){function t(){var e,a,n,r;f()(this,t);for(var s=arguments.length,l=Array(s),i=0;i<s;i++)l[i]=arguments[i];return a=n=E()(this,(e=t.__proto__||m()(t)).call.apply(e,[this].concat(l))),n.state={loading:!1,selectUserMap:{},selectUser:"",selectHack:!1},r=a,E()(n,r)}return k()(t,e),g()(t,[{key:"componentDidMount",value:function(){var e=this.props.resource;this.setState({selectUserMap:this.exchangeSelectMap(e.tenants)})}},{key:"componentWillReceiveProps",value:function(e){var t=e.resource,a=e.visible,n=this.props;n.resource;n.visible!=a&&a&&(this.setState({selectUserMap:this.exchangeSelectMap(t.tenants),loading:!1}),this.resetValueByHack(),this.props.getTenantList())}},{key:"exchangeSelectMap",value:function(){var e={};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(t){e[t.tenantId]={tenantName:t.tenantName}}),e}},{key:"changeUserValue",value:function(e){this.setState({selectUser:e})}},{key:"selectUser",value:function(e,t){var a=this.state.selectUserMap;this.setState({selectUser:"",selectUserMap:M()({},a,Ue()({},t.props.tenantid,{tenantName:t.props.children}))})}},{key:"removeUser",value:function(e){var t=this.state.selectUserMap;delete(t=Object(Te.cloneDeep)(t))[e],this.setState({selectUserMap:t})}},{key:"getUserOptions",value:function(){var e=[],t=this.state.selectUserMap,a=this.props,n=a.consoleUser,r=a.resource,s=n.userList,i=r.tenants||[];s=Object(Te.uniq)(s.concat(i),"tenantId");for(var o=0;o<s.length;o++){var c=s[o];t[c.tenantId]||e.push(l.a.createElement(we,{tenantid:c.tenantId,value:c.tenantName},c.tenantName))}return e}},{key:"initColumns",value:function(){return[{title:"租户名称",dataIndex:"name",className:"text-middle",render:function(e){return l.a.createElement("span",{className:"text-middle"},e)}}]}},{key:"getTableDataSource",value:function(){var e=this.state.selectUserMap;return _e()(e).map(function(e){return{id:e[0],name:e[1].tenantName}})}},{key:"getTenantsList",value:function(){var e=this.state.selectUserMap;return be()(e)}},{key:"changeResource",value:function(){var e=this;this.setState({loading:!0});var t=this.props.resource;ge.bindUserToQuere({queueId:t.queueId,tenants:this.getTenantsList()}).then(function(t){e.setState({loading:!1}),1==t.code&&(se.a.success("修改成功"),e.props.resourceUserChange())})}},{key:"onCancel",value:function(){this.props.onCancel()}},{key:"resetValueByHack",value:function(){var e=this;this.setState({selectHack:!0},function(){e.setState({selectHack:!1,selectUser:""})})}},{key:"render",value:function(){var e=this.state,t=e.selectUser,a=e.loading,n=e.selectHack,r=this.props,s=r.visible,i=r.resource,o=this.initColumns(),c=i.queueName;return l.a.createElement("div",{className:"contentBox"},l.a.createElement(Ee.a,{title:"修改 ("+c+")",visible:s,onCancel:this.onCancel.bind(this),onOk:this.changeResource.bind(this),confirmLoading:a,maskClosable:!1,className:"m-card"},l.a.createElement(ke.a.Item,M()({label:"绑定租户"},Ne),!n&&l.a.createElement(Z.a,{mode:"combobox",style:{width:"100%"},placeholder:"请选择租户",onSelect:this.selectUser.bind(this),onSearch:this.changeUserValue.bind(this),value:t},this.getUserOptions())),l.a.createElement(z.a,{className:"m-table",style:{margin:"0px 20px",marginTop:"30px"},columns:o,pagination:!1,dataSource:this.getTableDataSource(),scroll:{y:300}})))}}]),t}(l.a.Component))||fe,De=Z.a.Option,Me=function(e){function t(){var e,a,n,r;f()(this,t);for(var s=arguments.length,l=Array(s),i=0;i<s;i++)l[i]=arguments[i];return a=n=E()(this,(e=t.__proto__||m()(t)).call.apply(e,[this].concat(l))),n.state={resource:{},dataSource:[],table:{pageIndex:1,total:0,loading:!0},changeModalVisible:!1},r=a,E()(n,r)}return k()(t,e),g()(t,[{key:"componentDidMount",value:function(){this.getResourceList()}},{key:"getResourceList",value:function(){var e=this,t=this.state.table,a=t.pageIndex;ge.getResourceList({currentPage:a,pageSize:10}).then(function(a){1==a.code?e.setState({dataSource:e.exchangeDataSource(a.data.data),table:M()({},t,{loading:!1,total:a.data.totalCount})}):e.setState({table:M()({},t,{loading:!1})})})}},{key:"getPagination",value:function(){var e=this.state.table;return{current:e.pageIndex,pageSize:10,total:e.total}}},{key:"exchangeDataSource",value:function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a];t.push(M()({},n,{type:"cluster",className:null,clusterId:n.id,children:r(n.queues,0)}))}function r(e,t){var a=[];if(!e)return null;for(var n=0;n<e.length;n++){var s=e[n];a.push(M()({},s,{queueId:s.id,deepLength:t,className:"table-row-color_level"+(t+1),children:r(s.childQueues,t+1)}))}return a.length>0?a:null}return t}},{key:"initTableColumns",value:function(){var e=this;return[{title:"集群名称",dataIndex:"clusterName",width:"200px"},{title:"资源队列",dataIndex:"queueName",width:"200px",render:function(e,t){return"cluster"==t.type?null:("STOPPED"==t.queueState&&(e+="(已停用)"),l.a.createElement("span",{style:{paddingLeft:10*t.deepLength+"px"}},e))}},{title:"最小容量（%）",dataIndex:"capacity",width:"120px",render:function(e,t){return"cluster"==t.type?null:100*e}},{title:"最大容量（%）",dataIndex:"maxCapacity",width:"120px",render:function(e,t){return"cluster"==t.type?null:100*e}},{title:"绑定租户",dataIndex:"tenants",render:function(e,t){return e?e.map(function(e){return e.tenantName}).join("，")||"无":null}},{title:"修改时间",dataIndex:"gmtModified",width:"200px",render:function(e){return new X.a(e).format("YYYY-MM-DD HH:mm:ss")}},{title:"操作",dataIndex:"deal",render:function(t,a){return"STOPPED"!=a.queueState&&a.tenants?l.a.createElement("a",{onClick:e.changeResource.bind(e,a)},"修改"):null},width:"80px"}]}},{key:"changeResource",value:function(e){this.setState({resource:e,changeModalVisible:!0})}},{key:"changeUserValue",value:function(e){this.setState({selectUser:e})}},{key:"selectUser",value:function(e){var t=this.state.selectUserList;this.setState({selectUser:"",selectUserList:t.concat(e)})}},{key:"closeModal",value:function(){this.setState({changeModalVisible:!1})}},{key:"resourceUserChange",value:function(){this.setState({changeModalVisible:!1}),this.getResourceList()}},{key:"getUserOptions",value:function(){for(var e=this.state,t=e.userList,a=e.selectUserList,n=[],r=0;r<t.length;r++){var s=t[r];-1==a.indexOf(s.id)&&n.push(l.a.createElement(De,{value:s.id},s.name))}return n}},{key:"render",value:function(){var e=this.state,t=e.dataSource,a=e.table,n=e.changeModalVisible,r=e.resource,s=a.loading,i=this.initTableColumns();return l.a.createElement("div",{className:"contentBox"},l.a.createElement(G.a,{style:{width:"900px",color:"rgba(1,1,1,0.84)"},noHovering:!0},l.a.createElement("h2",null,"什么是资源管理"),l.a.createElement("p",{style:{marginTop:"20px"}},"资源管理是以租户为单位进行计算资源的分配，当您需要多个租户，并且每个租户分配不同比例的资源容量时需要使用本功能，例如：您的集群有10个节点，每个节点的配置为8核16GB内存，总资源为80核160GB内存，那么您可以新建“销售”和“开发”2个租户，为销售租户分配30%的资源容量，为开发租户分配70%的资源容量。"),l.a.createElement("p",{style:{marginTop:"20px"}},"注意:"),l.a.createElement("ul",null,l.a.createElement("li",null,"1、“资源队列”仅包括集群的内存和CPU；"),l.a.createElement("li",null,"2、只支持将资源队列绑定到租户，暂时不支持绑定到项目；"),l.a.createElement("li",null,"3、每个资源队列的最小容量之和等于100%；"),l.a.createElement("li",null,"4、以资源队列的形式分配资源，资源队列的维护在配置文件中，本模块只是将资源队列绑定到租户；"),l.a.createElement("li",null,"5、可能已有的任务占用了较多的资源，导致更新配置后不会立即生效，需要等待已占用的资源释放；"))),l.a.createElement(z.a,{rowClassName:function(e,t){return e.className},rowKey:function(e){return e.clusterId+"~"+e.queueId},style:{marginTop:"20px"},className:"m-table no-card-table",pagination:this.getPagination(),loading:s,dataSource:t,columns:i}),l.a.createElement(Re,{visible:n,onCancel:this.closeModal.bind(this),resourceUserChange:this.resourceUserChange.bind(this),resource:r}))}}]),t}(l.a.Component),Oe=(a("MaXC"),a("4IMT")),Ae=a.n(Oe),Fe=function(e){function t(){var e,a,n,r;f()(this,t);for(var s=arguments.length,l=Array(s),i=0;i<s;i++)l[i]=arguments[i];return a=n=E()(this,(e=t.__proto__||m()(t)).call.apply(e,[this].concat(l))),n.state={dataSource:[],table:{pageIndex:1,total:0,loading:!0}},r=a,E()(n,r)}return k()(t,e),g()(t,[{key:"componentDidMount",value:function(){this.getResourceList()}},{key:"getResourceList",value:function(){var e=this,t=this.state.table,a=t.pageIndex;ge.getClusterList({currentPage:a,pageSize:10}).then(function(a){1==a.code?e.setState({dataSource:a.data.data,table:M()({},t,{loading:!1,total:a.data.totalCount})}):e.setState({table:M()({},t,{loading:!1})})})}},{key:"getPagination",value:function(){var e=this.state.table;return{current:e.pageIndex,pageSize:10,total:e.total}}},{key:"initTableColumns",value:function(){var e=this;return[{title:"集群名称",dataIndex:"clusterName"},{title:"节点数量",dataIndex:"totalNode"},{title:"总资源数",dataIndex:"totalCore",width:"200px",render:function(e,t){var a=t.totalMemory/1024,n=Math.floor(a)!=a;return t.totalCore+"VCore "+(n?a.toFixed(2):a)+"GB"}},{title:"修改时间",dataIndex:"gmtModified",width:"200px",render:function(e){return new X.a(e).format("YYYY-MM-DD HH:mm:ss")}},{title:"操作",dataIndex:"deal",render:function(t,a){return l.a.createElement("div",null,l.a.createElement("a",{onClick:e.editCluster.bind(e,a)},"修改"),l.a.createElement("span",{className:"ant-divider"}),l.a.createElement("a",{onClick:e.viewCluster.bind(e,a)},"查看"))}}]}},{key:"editCluster",value:function(e){C.g.push({pathname:"/console/clusterManage/editCluster",state:{cluster:e,mode:"edit"}})}},{key:"viewCluster",value:function(e){C.g.push({pathname:"/console/clusterManage/editCluster",state:{cluster:e,mode:"view"}})}},{key:"newCluster",value:function(){C.g.push({pathname:"/console/clusterManage/editCluster"})}},{key:"render",value:function(){var e=this.state,t=e.dataSource,a=e.table.loading,n=this.initTableColumns(),r=l.a.createElement("div",null,"多集群管理 ",l.a.createElement(Ae.a,{type:"primary",onClick:this.newCluster,style:{float:"right",marginTop:"9px"}},"新增集群"));return l.a.createElement("div",{className:"contentBox m-card"},l.a.createElement(G.a,{noHovering:!0,title:r},l.a.createElement(z.a,{rowKey:function(e){return e.id},className:"m-table",pagination:this.getPagination(),loading:a,dataSource:t,columns:n})))}}]),t}(l.a.Component),He=(a("FGdI"),a("Pbn2")),qe=a.n(He),je=(a("93XW"),a("d1El")),Ve=a.n(je),Be=(a("hr7U"),a("9xET")),ze=a.n(Be),Ye=(a("fv9D"),a("ZPTe")),Ge=a.n(Ye),Qe=a("m1cH"),Ze=a.n(Qe),Ke=(a("PAYn"),a("EQeY")),Xe=a.n(Ke),Je=a("sk9p"),We=a.n(Je),$e=(a("cUip"),a("iJl9")),et=a.n($e),tt=a("ER3F"),at=ke.a.Item,nt=(et.a.TextArea,Z.a.Option),rt={NOTHING:0,SUCCESS:1,FAIL:2};function st(){return(new Date).getTime()+""+~~(1e5*Math.random())}var lt,it,ot,ct,ut,dt=Object(b.b)(function(e){return{consoleUser:e.consoleUser}},function(e){return{getTenantList:function(){e(Ie())}}})(Pe=function(e){function t(){var e,a,n,r;f()(this,t);for(var s=arguments.length,l=Array(s),i=0;i<s;i++)l[i]=arguments[i];return a=n=E()(this,(e=t.__proto__||m()(t)).call.apply(e,[this].concat(l))),n.state={selectUserMap:{},selectUser:"",file:"",zipConfig:"",uploadLoading:!1,testLoading:!1,testStatus:rt.NOTHING,flink_params:[],spark_params:[],core:null,nodeNumber:null,memory:null,extDefaultValue:{},fileHaveChange:!1},r=a,E()(n,r)}return k()(t,e),g()(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.location,n=t.form,r=a.state||{};"edit"!=r.mode&&"view"!=r.mode||ge.getClusterInfo({clusterId:r.cluster.id}).then(function(t){if(1==t.code){var a=t.data,r=a.clusterConf;r=JSON.parse(r);var s=e.exchangeServerParams(r);e.setState({core:a.totalCore,memory:a.totalMemory,nodeNumber:a.totalNode,zipConfig:ae()({yarnConf:r.yarnConf,hadoopConf:r.hadoopConf,hiveMeta:r.hiveMeta}),flink_params:s.flinkKeys,spark_params:s.sparkKeys,extDefaultValue:s.default}),n.setFieldsValue({clusterName:a.clusterName,hiveConf:r.hiveConf,sparkConf:r.sparkConf,flinkConf:r.flinkConf})}})}},{key:"exchangeServerParams",value:function(e){var t={flinkKeys:[],sparkKeys:[],default:{}},a=e.sparkConf,n=e.flinkConf;function r(e,a,n,r){_e()(e).map(function(e){var n=We()(e,2),s=n[0],l=n[1];if(!a.includes(s)){var i=st();r.push({id:i}),t.default[i]={name:s,value:l}}})}return r(a,["typeName","sparkYarnArchive","sparkSqlProxyPath","sparkPythonExtLibPath"],0,t.sparkKeys),r(n,["typeName","flinkZkAddress","flinkHighAvailabilityStorageDir","flinkZkNamespace","jarTmpDir","flinkPluginRoot","remotePluginRootDir","clusterMode"],0,t.flinkKeys),t}},{key:"getUserOptions",value:function(){for(var e=this.props.consoleUser,t=this.state.selectUserMap,a=e.userList,n=[],r=0;r<a.length;r++){var s=a[r];t[s.tenantId]||n.push(l.a.createElement(nt,{value:s.tenantId+"$$"+s.tenantName},s.tenantName))}return n}},{key:"changeUserValue",value:function(e){this.setState({selectUser:e})}},{key:"selectUser",value:function(e,t){var a=this.state.selectUserMap;this.setState({selectUser:"",selectUserMap:M()({},a,Ue()({},e.split("$$")[0],{name:t.props.children}))})}},{key:"getTableDataSource",value:function(){var e=this.state.selectUserMap;return _e()(e).map(function(e){return{id:e[0],name:e[1].name}})}},{key:"removeUser",value:function(e){var t=this.state.selectUserMap;delete(t=Object(Te.cloneDeep)(t))[e],this.setState({selectUserMap:t})}},{key:"initColumns",value:function(){var e=this;return[{title:"租户名称",dataIndex:"name",width:"150px"},{title:"操作",dataIndex:"deal",render:function(t,a){return l.a.createElement("a",{onClick:e.removeUser.bind(e,a.id)},"删除")}}]}},{key:"validateFileType",value:function(e,t,a){t&&!/\.(zip)$/.test(t.toLocaleLowerCase())&&a("配置文件只能是zip文件!"),a()}},{key:"fileChange",value:function(e){var t=this,a=e.target;this.setState({file:{},uploadLoading:!0,zipConfig:"",fileHaveChange:!0}),ge.uploadClusterResource({config:a.files[0]}).then(function(e){1==e.code?t.setState({uploadLoading:!1,file:a,zipConfig:e.data}):(t.props.form.setFieldsValue({file:null}),t.setState({uploadLoading:!1}))})}},{key:"renderTestResult",value:function(){switch(this.state.testStatus){case rt.NOTHING:return null;case rt.SUCCESS:return l.a.createElement(Xe.a,{color:"#87d068"},"连通成功");case rt.FAIL:return l.a.createElement("span",null,l.a.createElement(Xe.a,{color:"red"},"连通失败"))}}},{key:"addParam",value:function(e){var t=this.state,a=t.flink_params,n=t.spark_params;"flink"==e?this.setState({flink_params:[].concat(Ze()(a),[{id:st()}])}):this.setState({spark_params:[].concat(Ze()(n),[{id:st()}])})}},{key:"deleteParam",value:function(e,t){var a=this.state,n=a.flink_params,r=a.spark_params,s=void 0,l=void 0;"flink"==t?(l="flink_params",s=n):(l="spark_params",s=r),s=s.filter(function(t){return t.id!=e}),this.setState(Ue()({},l,s))}},{key:"renderExtraParam",value:function(e){var t=this,a=this.state,n=a.flink_params,r=a.spark_params,s=a.extDefaultValue,i=this.props.form.getFieldDecorator,o="view"==(this.props.location.state||{}).mode;return("flink"==e?n:r).map(function(a){return l.a.createElement(ze.a,{key:a.id},l.a.createElement(Ge.a,{span:Ne.labelCol.sm.span},l.a.createElement(at,{key:a.id+"-name"},i(e+"%"+a.id+"-name",{rules:[{required:!0,message:"请输入参数属性名"}],initialValue:s[a.id]&&s[a.id].name})(l.a.createElement(et.a,{disabled:o,style:{width:"calc(100% - 12px)"}})),":")),l.a.createElement(Ge.a,{span:Ne.wrapperCol.sm.span},l.a.createElement(at,{key:a.id+"-value"},i(e+"%"+a.id+"-value",{rules:[{required:!0,message:"请输入参数属性值"}],initialValue:s[a.id]&&s[a.id].value})(l.a.createElement(et.a,{disabled:o})))),o?null:l.a.createElement("a",{className:"formItem-right-text",onClick:t.deleteParam.bind(t,a.id,e)},"删除"))})}},{key:"renderZipConfig",value:function(e){var t=this.state.zipConfig;t=JSON.parse(t);var a=void 0;return"hdfs"==e?(a=_e()(t.hadoopConf),le.a.sortByCompareFunctions(a,function(e,t){var a=We()(e,2),n=a[0],r=(a[1],We()(t,2)),s=r[0];r[1];return"fs.defaultFS"==n?-1:"fs.defaultFS"==s?1:0},function(e,t){var a=We()(e,2),n=a[0],r=(a[1],We()(t,2)),s=r[0];r[1];return"dfs.nameservices"==n?-1:"dfs.nameservices"==s?1:0},function(e,t){var a=We()(e,2),n=a[0],r=(a[1],We()(t,2)),s=r[0];r[1];return n.indexOf("dfs.ha.namenodes")>-1?-1:s.indexOf("dfs.ha.namenodes")>-1?1:0},function(e,t){var a=We()(e,2),n=a[0],r=(a[1],We()(t,2)),s=r[0],l=(r[1],n.indexOf("dfs.namenode.rpc-address")>-1),i=s.indexOf("dfs.namenode.rpc-address")>-1;return l&&i?n>s?1:-1:l?-1:i?1:0})):(a=_e()(t.yarnConf),le.a.sortByCompareFunctions(a,function(e,t){var a=We()(e,2),n=a[0],r=(a[1],We()(t,2)),s=r[0];r[1];return"yarn.resourcemanager.ha.rm-ids"==n?-1:"yarn.resourcemanager.ha.rm-ids"==s?1:0},function(e,t){var a=We()(e,2),n=a[0],r=(a[1],We()(t,2)),s=r[0],l=(r[1],n.indexOf("yarn.resourcemanager.address")>-1),i=s.indexOf("yarn.resourcemanager.address")>-1;return l&&i?n>s?1:-1:l?-1:i?1:0},function(e,t){var a=We()(e,2),n=a[0],r=(a[1],We()(t,2)),s=r[0],l=(r[1],n.indexOf("yarn.resourcemanager.webapp.address")>-1),i=s.indexOf("yarn.resourcemanager.webapp.address")>-1;return l&&i?n>s?1:-1:l?-1:i?1:0})),a.map(function(e){var t=We()(e,2),a=t[0],n=t[1];return l.a.createElement(ze.a,{className:"zipConfig-item"},l.a.createElement(Ge.a,{className:"formitem-textname",span:Ne.labelCol.sm.span+4},a.length>40?l.a.createElement(Ve.a,{title:a},a.substr(0,40)+"..."):a,"："),l.a.createElement(Ge.a,{className:"formitem-textvalue",span:Ne.wrapperCol.sm.span-1},n))})}},{key:"exchangeMemory",value:function(e){if(!e)return"--";var t=e/1024;return(Math.floor(t)!=t?t.toFixed(2):t)+"GB"}},{key:"save",value:function(){var e=this,t=(this.props.location.state||{}).mode;this.props.form.validateFieldsAndScroll(null,{},function(a,n){if(!a){var r="createCluster";"edit"==t&&(r="updateCluster"),ge[r](e.getServerParams(n,!0)).then(function(t){1==t.code&&(se.a.success("保存成功"),e.props.router.goBack())})}})}},{key:"test",value:function(){var e=this;this.props.form.validateFieldsAndScroll(null,{},function(t,a){t||(e.setState({testLoading:!0}),ge.testCluster(e.getServerParams(a)).then(function(t){1==t.code?(e.setState({testLoading:!1,testStatus:rt.SUCCESS,nodeNumber:t.data.totalNode,core:t.data.totalCores,memory:t.data.totalMemory}),se.a.success("连通成功")):e.setState({testLoading:!1,testStatus:rt.FAIL})}))})}},{key:"getServerParams",value:function(e,t){var a=this.props.location.state||{},n=a.mode,r=a.cluster,s=this.getClusterConf(e),l={clusterName:e.clusterName,clusterConf:ae()(s)};if(t){var i=this.state.file;i&&(l.config=i.files[0])}return"edit"==n&&(l.id=r.id),l}},{key:"getClusterConf",value:function(e){var t=this.state.zipConfig;t=JSON.parse(t);var a={},n=this.getCustomParams(e,"spark"),r=this.getCustomParams(e,"flink");return a.hadoopConf=t.hadoopConf,a.yarnConf=t.yarnConf,a.hiveMeta=t.hiveMeta,a.hiveConf=e.hiveConf,a.sparkConf=M()({},e.sparkConf,n),a.flinkConf=M()({},e.flinkConf,r),a.hiveConf.username=a.hiveConf.username||"",a.hiveConf.password=a.hiveConf.password||"",a}},{key:"getCustomParams",value:function(e,t){var a={},n={};for(var r in e)if(r.startsWith(t+"%")){var s=r.split("%")[1].split("-"),l=s[0],i=s[1];n[l]||(n[l]={}),n[l][i]=e[r]}for(var o in n){var c=n[o];a[c.name]=c.value}return a}},{key:"render",value:function(){var e=this.state,t=(e.selectUser,e.file),a=e.zipConfig,n=e.uploadLoading,r=e.core,s=e.nodeNumber,i=e.memory,o=e.testLoading,c=e.fileHaveChange,u=this.props.form,d=u.getFieldDecorator,m=(u.getFieldValue,(this.props.location.state||{}).mode),p="view"==m,f=!("view"==m||"edit"==m);this.initColumns();return l.a.createElement("div",{className:"contentBox"},l.a.createElement("p",{className:"box-title",style:{height:"auto",paddingLeft:"20px"}},l.a.createElement(tt.a,{size:"default",type:"textButton"})),l.a.createElement(G.a,{noHovering:!0,className:"contentBox shadow"},l.a.createElement("p",{className:"config-title"},"集群信息"),l.a.createElement("div",{className:"config-content",style:{width:"680px"}},l.a.createElement(at,M()({label:"集群标识"},Ne),d("clusterName",{rules:[{required:!0,message:"请输入集群标识"},{pattern:/^[a-z0-9_]{1,64}$/i,message:"集群标识不能超过64字符，支持英文、数字、下划线"}]})(l.a.createElement(et.a,{disabled:!f,placeholder:"请输入集群标识",style:{width:"40%"}})),l.a.createElement("span",{style:{marginLeft:"30px"}},"节点数：",s||"--"," "),l.a.createElement("span",{style:{marginLeft:"10px"}},"资源数：",r||"--","VCore ",this.exchangeMemory(i)," "))),p?null:l.a.createElement("div",null,l.a.createElement("p",{className:"config-title"},"上传配置文件"),l.a.createElement("div",{className:"config-content",style:{width:"750px"}},l.a.createElement("p",{style:{marginBottom:"24px"}},"您需要获取Hadoop、Spark、Flink集群的配置文件，至少包括：",l.a.createElement("strong",null,"core-site.xml、hdfs-site.xml、hive-site.xml、yarn-site.xml"),"文件"),l.a.createElement(at,M()({label:"配置文件"},Ne),d("file",{rules:[{required:!(!c&&"edit"==m),message:"请选择上传文件"},{validator:this.validateFileType}]})(l.a.createElement("div",null,n?l.a.createElement("label",{style:{lineHeight:"28px"},className:"ant-btn disble"},"选择文件"):l.a.createElement("label",{style:{lineHeight:"28px"},className:"ant-btn",htmlFor:"myOfflinFile"},"选择文件"),n?l.a.createElement(qe.a,{className:"blue-loading",type:"loading"}):null,l.a.createElement("span",null," ",t.files&&t.files[0].name),l.a.createElement("input",{name:"file",type:"file",id:"myOfflinFile",onChange:this.fileChange.bind(this),accept:".zip",style:{display:"none"}}))),l.a.createElement("span",null,"支持扩展名：.zip")),"如何获取这些配置文件？请您参考",l.a.createElement("a",null,"《帮助文档》"))),a?l.a.createElement("div",null,l.a.createElement("p",{className:"config-title"},"HDFS"),l.a.createElement("div",{className:"config-content",style:{width:"800px"}},this.renderZipConfig("hdfs")),l.a.createElement("p",{className:"config-title"},"YARN"),l.a.createElement("div",{className:"config-content",style:{width:"800px"}},this.renderZipConfig("yarn"))):null,l.a.createElement("p",{className:"config-title"},"Hive JDBC信息"),l.a.createElement("div",{className:"config-content",style:{width:"680px"}},l.a.createElement(at,M()({label:"JDBC URL"},Ne),d("hiveConf.jdbcUrl",{rules:[{required:!0,message:"请输入jdbcUrl"}]})(l.a.createElement(et.a,{disabled:p}))),l.a.createElement(at,M()({label:"用户名"},Ne),d("hiveConf.username")(l.a.createElement(et.a,{disabled:p}))),l.a.createElement(at,M()({label:"密码"},Ne),d("hiveConf.password")(l.a.createElement(et.a,{disabled:p})))),l.a.createElement("p",{className:"config-title"},"Spark"),l.a.createElement("div",{className:"config-content",style:{width:"680px"}},l.a.createElement(at,M()({label:"版本选择"},Ne),d("sparkConf.typeName",{rules:[{required:!0,message:"请选择Spark版本"}],initialValue:"spark_yarn"})(l.a.createElement(Z.a,{disabled:p,style:{width:"100px"}},l.a.createElement(nt,{value:"spark_yarn"},"2.X")))),l.a.createElement(at,M()({label:"sparkYarnArchive"},Ne),d("sparkConf.sparkYarnArchive",{rules:[{required:!0,message:"请输入sparkYarnArchive"}],initialValue:"/sparkjars/jars"})(l.a.createElement(et.a,{disabled:p}))),l.a.createElement(at,M()({label:"sparkSqlProxyPath"},Ne),d("sparkConf.sparkSqlProxyPath",{rules:[{required:!0,message:"请输入sparkSqlProxyPath"}],initialValue:"/user/spark/spark-0.0.1-SNAPSHOT.jar"})(l.a.createElement(et.a,{disabled:p}))),l.a.createElement(at,M()({label:"sparkPythonExtLibPath"},Ne),d("sparkConf.sparkPythonExtLibPath",{rules:[{required:!0,message:"请输入sparkPythonExtLibPath"}],initialValue:"/pythons/pyspark.zip,hdfs://ns1/pythons/py4j-0.10.4-src.zip"})(l.a.createElement(et.a,{disabled:p}))),this.renderExtraParam("spark"),p?null:l.a.createElement(ze.a,null,l.a.createElement(Ge.a,{span:Ne.labelCol.sm.span}),l.a.createElement(Ge.a,{className:"m-card",span:Ne.wrapperCol.sm.span},l.a.createElement("a",{onClick:this.addParam.bind(this,"spark")},"添加自定义参数")))),l.a.createElement("p",{className:"config-title"},"Flink"),l.a.createElement("div",{className:"config-content",style:{width:"680px"}},l.a.createElement(at,M()({label:"版本选择"},Ne),d("flinkConf.typeName",{rules:[{required:!0,message:"请选择flink版本"}],initialValue:"flink140"})(l.a.createElement(Z.a,{disabled:p,style:{width:"100px"}},l.a.createElement(nt,{value:"flink140"},"1.4"),l.a.createElement(nt,{value:"flink150"},"1.5")))),l.a.createElement(at,M()({label:"clusterMode"},Ne),d("flinkConf.clusterMode",{rules:[{required:!0,message:"请选择clusterMode"}],initialValue:"yarn"})(l.a.createElement(Z.a,{disabled:p,style:{width:"100px"}},l.a.createElement(nt,{value:"standalone"},"standalone"),l.a.createElement(nt,{value:"yarn"},"yarn")))),l.a.createElement(at,M()({label:"flinkZkAddress"},Ne),d("flinkConf.flinkZkAddress",{rules:[{required:!0,message:"请输入flinkZkAddress"}]})(l.a.createElement(et.a,{disabled:p,placeholder:"hostname1:port,hostname2:port，多个地址用英文逗号隔开"}))),l.a.createElement(at,M()({label:l.a.createElement(Ve.a,{title:"flinkHighAvailabilityStorageDir"},"flinkHighAvailabilityStorageDir")},Ne),d("flinkConf.flinkHighAvailabilityStorageDir",{rules:[{required:!0,message:"请输入flinkHighAvailabilityStorageDir"}]})(l.a.createElement(et.a,{disabled:p,placeholder:"Flink高可用存储地址，例如：/flink140/ha"}))),l.a.createElement(at,M()({label:"flinkZkNamespace"},Ne),d("flinkConf.flinkZkNamespace",{rules:[{required:!0,message:"请输入flinkZkNamespace"}]})(l.a.createElement(et.a,{disabled:p,placeholder:"Flink在Zookeeper的namespace，例如：/flink140"}))),l.a.createElement(at,M()({label:"jarTmpDir"},Ne),d("flinkConf.jarTmpDir",{initialValue:"../tmp140"})(l.a.createElement(et.a,{disabled:p}))),l.a.createElement(at,M()({label:"flinkPluginRoot"},Ne),d("flinkConf.flinkPluginRoot",{initialValue:"/opt/dtstack/flinkplugin"})(l.a.createElement(et.a,{disabled:p}))),l.a.createElement(at,M()({label:"remotePluginRootDir"},Ne),d("flinkConf.remotePluginRootDir",{initialValue:"/opt/dtstack/flinkplugin"})(l.a.createElement(et.a,{disabled:p}))),this.renderExtraParam("flink"),p?null:l.a.createElement(ze.a,null,l.a.createElement(Ge.a,{span:Ne.labelCol.sm.span}),l.a.createElement(Ge.a,{className:"m-card",span:Ne.wrapperCol.sm.span},l.a.createElement("a",{onClick:this.addParam.bind(this,"flink")},"添加自定义参数")))),l.a.createElement("p",{className:"config-title"}),p?null:l.a.createElement("div",{className:"config-content",style:{width:"100%"}},l.a.createElement(Ae.a,{onClick:this.test.bind(this),loading:o,type:"primary"},"测试连通性"),l.a.createElement("span",{style:{marginLeft:"18px"}},this.renderTestResult()),l.a.createElement("span",{style:{float:"right",marginRight:"18px"}},l.a.createElement(Ae.a,{onClick:this.save.bind(this),type:"primary"},"保存"),l.a.createElement(Ae.a,{onClick:C.g.goBack,style:{marginLeft:"8px"}},"取消")))))}}]),t}(l.a.Component))||Pe,mt=ke.a.create()(dt),pt=l.a.createElement(C.d,{path:"/",component:S.a},l.a.createElement(C.a,{to:"/console"}),l.a.createElement(C.d,{path:"/message",component:_.a},l.a.createElement(C.b,{component:x.a}),l.a.createElement(C.d,{path:"list",component:x.a}),l.a.createElement(C.d,{path:"detail/:msgId",component:U.a})),l.a.createElement(C.d,{path:"/admin",component:T.a},l.a.createElement(C.b,{component:N.a}),l.a.createElement(C.d,{path:"user",component:N.a}),l.a.createElement(C.d,{path:"role",component:L.a}),l.a.createElement(C.d,{path:"role/add",component:I.a}),l.a.createElement(C.d,{path:"role/edit/:roleId",component:w.a})),l.a.createElement(C.d,{path:"/console",component:V},l.a.createElement(C.b,{component:Me}),l.a.createElement(C.d,{path:"resourceManage",component:Me}),l.a.createElement(C.d,{path:"clusterManage",component:Fe}),l.a.createElement(C.d,{path:"clusterManage/editCluster",component:mt}))),ft=function(e){function t(){return f()(this,t),E()(this,(t.__proto__||m()(t)).apply(this,arguments))}return k()(t,e),g()(t,[{key:"render",value:function(){var e=this.props,t=e.store,a=e.history;return l.a.createElement(b.a,{store:t},l.a.createElement(C.e,{routes:pt,history:a,key:Math.random(),onEnter:function(){}}))}}]),t}(l.a.Component);lt=ft,it=a("/AHB").default,ot=Object(u.a)(it,"hash"),ct=ot.store,ut=ot.history,o.a.render(l.a.createElement(c.AppContainer,null,l.a.createElement(lt,{store:ct,history:ut})),document.getElementById("app"))}},[["YHBf",19,21,20,28,22]]]);