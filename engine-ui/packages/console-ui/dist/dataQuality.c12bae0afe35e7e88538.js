(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{"2NsA":function(e,t,a){"use strict";a.d(t,"a",function(){return s});var n=a("dtw8"),r=(a("1ZXz"),a("TdMD")),i=a.n(r),o=a("fvjX"),l=a("L3Ur");function s(e,t){var a=function(e){return Object(o.e)(e,Object(o.a)(i.a))}(e),r=t&&"hash"===t?n.g:n.f;return{store:a,history:Object(l.syncHistoryWithStore)(r,a)}}},"3J6H":function(e,t,a){},"6EK8":function(e,t,a){"use strict";a.d(t,"a",function(){return l});var n=a("QbLZ"),r=a.n(n),i=(a("LvDl"),a("CMun")),o={id:0,dtuicUserId:0,userName:"未登录",isRoot:!1};function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=arguments[1];switch(t.type){case i.a.GET_USER:return t.data;case i.a.UPDATE_USER:return null!==t.data?r()({},e,t.data):e;default:return e}}},"95Qq":function(e,t,a){},EMQV:function(e,t,a){},F2FU:function(e,t,a){"use strict";var n=a("zbcj"),r=a.n(n)()(["GET_USER_LIST","GET_ALL_DICT"],{prefix:"common/"});t.a=r},"FL+A":function(e,t,a){"use strict";a.d(t,"a",function(){return N});a("93XW");var n=a("d1El"),r=a.n(n),i=(a("FGdI"),a("Pbn2")),o=a.n(i),l=a("QbLZ"),s=a.n(l),c=a("jo6Y"),u=a.n(c),d=(a("tL+A"),a("QpBz")),m=a.n(d),p=a("Yz+Y"),h=a.n(p),f=a("iCc5"),g=a.n(f),v=a("V7oC"),E=a.n(v),y=a("FYw3"),S=a.n(y),b=a("mRg0"),T=a.n(b),C=a("sbe7"),k=a.n(C),N=(a("kH9T"),function(e){function t(){var e,a,n,r;g()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=S()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(o))),n.state={},n.copy=function(e){n.removeFake(),n.fakeHandlerCallback=function(){return n.removeFake()},n.fakeHandler=document.body.addEventListener("click",n.fakeHandlerCallback)||!0,n.fakeElem=document.createElement("textarea"),n.fakeElem.style.fontSize="12pt",n.fakeElem.style.border="0",n.fakeElem.style.padding="0",n.fakeElem.style.margin="0",n.fakeElem.style.position="absolute",n.fakeElem.style.left="-9999px";var t=window.pageYOffset||document.documentElement.scrollTop;n.fakeElem.style.top=t+"px",n.fakeElem.setAttribute("readonly",""),n.fakeElem.value=e,document.body.appendChild(n.fakeElem),n.fakeElem.select(),n.copyText()},r=a,S()(n,r)}return T()(t,e),E()(t,[{key:"componentWillUnmount",value:function(){this.removeFake()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand("copy")}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(e){e?m.a.success("复制成功"):m.a.error("不支持")}},{key:"render",value:function(){var e=this.props,t=e.copyText,a=e.style,n=u()(e,["copyText","style"]);return a=s()({cursor:"pointer",fontSize:"13px"},a),k.a.createElement(r.a,{placement:"right",title:"复制"},k.a.createElement(o.a,s()({className:"copy-hover",onClick:this.copy.bind(this,t),style:a},n,{type:"copy"})))}}]),t}(C.Component))},FdzR:function(e,t,a){},KnRw:function(e,t,a){var n={"./af":"/Tvm","./af.js":"/Tvm","./ar":"yRKQ","./ar-dz":"2Mgn","./ar-dz.js":"2Mgn","./ar-kw":"SyK9","./ar-kw.js":"SyK9","./ar-ly":"Km2t","./ar-ly.js":"Km2t","./ar-ma":"k+3Q","./ar-ma.js":"k+3Q","./ar-sa":"dbzX","./ar-sa.js":"dbzX","./ar-tn":"E7L0","./ar-tn.js":"E7L0","./ar.js":"yRKQ","./az":"marO","./az.js":"marO","./be":"c9Cq","./be.js":"c9Cq","./bg":"Rxhz","./bg.js":"Rxhz","./bm":"Zf0k","./bm.js":"Zf0k","./bn":"qbSa","./bn.js":"qbSa","./bo":"aPmz","./bo.js":"aPmz","./br":"V/F2","./br.js":"V/F2","./bs":"CToL","./bs.js":"CToL","./ca":"GuxH","./ca.js":"GuxH","./cs":"qrel","./cs.js":"qrel","./cv":"wv9F","./cv.js":"wv9F","./cy":"7JVd","./cy.js":"7JVd","./da":"PtRy","./da.js":"PtRy","./de":"xhqU","./de-at":"bJtj","./de-at.js":"bJtj","./de-ch":"fRjz","./de-ch.js":"fRjz","./de.js":"xhqU","./dv":"tEna","./dv.js":"tEna","./el":"vE8+","./el.js":"vE8+","./en-au":"aGvD","./en-au.js":"aGvD","./en-ca":"TyIU","./en-ca.js":"TyIU","./en-gb":"xbvL","./en-gb.js":"xbvL","./en-ie":"8wpQ","./en-ie.js":"8wpQ","./en-nz":"mRnY","./en-nz.js":"mRnY","./eo":"nEfC","./eo.js":"nEfC","./es":"QqXE","./es-do":"OH6n","./es-do.js":"OH6n","./es-us":"VqXm","./es-us.js":"VqXm","./es.js":"QqXE","./et":"/BjE","./et.js":"/BjE","./eu":"lS/Y","./eu.js":"lS/Y","./fa":"Xl2a","./fa.js":"Xl2a","./fi":"pKmA","./fi.js":"pKmA","./fo":"1sIW","./fo.js":"1sIW","./fr":"t+gs","./fr-ca":"ApVP","./fr-ca.js":"ApVP","./fr-ch":"mR/r","./fr-ch.js":"mR/r","./fr.js":"t+gs","./fy":"zrXP","./fy.js":"zrXP","./gd":"7WNt","./gd.js":"7WNt","./gl":"EkHg","./gl.js":"EkHg","./gom-latn":"IlNN","./gom-latn.js":"IlNN","./gu":"SIlg","./gu.js":"SIlg","./he":"RWgf","./he.js":"RWgf","./hi":"fVgC","./hi.js":"fVgC","./hr":"QeL5","./hr.js":"QeL5","./hu":"UGq4","./hu.js":"UGq4","./hy-am":"powx","./hy-am.js":"powx","./id":"+gpe","./id.js":"+gpe","./is":"3azS","./is.js":"3azS","./it":"T/vC","./it.js":"T/vC","./ja":"n/+T","./ja.js":"n/+T","./jv":"pOn/","./jv.js":"pOn/","./ka":"5BLU","./ka.js":"5BLU","./kk":"i4p7","./kk.js":"i4p7","./km":"Rdvl","./km.js":"Rdvl","./kn":"x+k7","./kn.js":"x+k7","./ko":"+Fhz","./ko.js":"+Fhz","./ky":"dDLa","./ky.js":"dDLa","./lb":"Gudj","./lb.js":"Gudj","./lo":"VShb","./lo.js":"VShb","./lt":"5eMR","./lt.js":"5eMR","./lv":"JdG9","./lv.js":"JdG9","./me":"VVnP","./me.js":"VVnP","./mi":"oQ6b","./mi.js":"oQ6b","./mk":"tXUT","./mk.js":"tXUT","./ml":"uPxb","./ml.js":"uPxb","./mr":"b8N1","./mr.js":"b8N1","./ms":"Wnnz","./ms-my":"b+tO","./ms-my.js":"b+tO","./ms.js":"Wnnz","./mt":"V6YG","./mt.js":"V6YG","./my":"rt8X","./my.js":"rt8X","./nb":"xyXD","./nb.js":"xyXD","./ne":"4vTz","./ne.js":"4vTz","./nl":"6QMr","./nl-be":"LMGY","./nl-be.js":"LMGY","./nl.js":"6QMr","./nn":"Qsvx","./nn.js":"Qsvx","./pa-in":"oA7N","./pa-in.js":"oA7N","./pl":"C/jI","./pl.js":"C/jI","./pt":"V7OV","./pt-br":"b3iz","./pt-br.js":"b3iz","./pt.js":"V7OV","./ro":"TwjK","./ro.js":"TwjK","./ru":"YJSy","./ru.js":"YJSy","./sd":"4xdR","./sd.js":"4xdR","./se":"j5S3","./se.js":"j5S3","./si":"Am5L","./si.js":"Am5L","./sk":"sSmc","./sk.js":"sSmc","./sl":"9iY4","./sl.js":"9iY4","./sq":"cnMZ","./sq.js":"cnMZ","./sr":"ss7R","./sr-cyrl":"tGLK","./sr-cyrl.js":"tGLK","./sr.js":"ss7R","./ss":"mYhl","./ss.js":"mYhl","./sv":"IGtO","./sv.js":"IGtO","./sw":"p49z","./sw.js":"p49z","./ta":"VVil","./ta.js":"VVil","./te":"YQaq","./te.js":"YQaq","./tet":"2u18","./tet.js":"2u18","./th":"gJLt","./th.js":"gJLt","./tl-ph":"ogwM","./tl-ph.js":"ogwM","./tlh":"0bHV","./tlh.js":"0bHV","./tr":"BYDG","./tr.js":"BYDG","./tzl":"IUMd","./tzl.js":"IUMd","./tzm":"94jC","./tzm-latn":"Mgge","./tzm-latn.js":"Mgge","./tzm.js":"94jC","./uk":"NrFT","./uk.js":"NrFT","./ur":"U58I","./ur.js":"U58I","./uz":"orAx","./uz-latn":"jCvl","./uz-latn.js":"jCvl","./uz.js":"orAx","./vi":"t2dB","./vi.js":"t2dB","./x-pseudo":"XFnJ","./x-pseudo.js":"XFnJ","./yo":"qKGQ","./yo.js":"qKGQ","./zh-cn":"3O3J","./zh-cn.js":"3O3J","./zh-hk":"Fu0X","./zh-hk.js":"Fu0X","./zh-tw":"2Pdx","./zh-tw.js":"2Pdx"};function r(e){var t=i(e);return a(t)}function i(e){var t=n[e];if(!(t+1)){var a=new Error('Cannot find module "'+e+'".');throw a.code="MODULE_NOT_FOUND",a}return t}r.keys=function(){return Object.keys(n)},r.resolve=i,e.exports=r,r.id="KnRw"},MJ9B:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a("zbcj"),r=a.n(n)()(["CHANGE_LOADING","GET_TOP_RECORD","GET_ALARM_SUM","GET_ALARM_TREND","GET_USAGE"],{prefix:"dashBoard/"})},O6QL:function(e,t,a){},SXSo:function(e,t,a){},THQc:function(e,t,a){},TmhF:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a("udPp");function r(e){return{type:n.a.UPDATE_APP,data:e}}},WaWy:function(e,t,a){"use strict";a("FGdI");var n=a("Pbn2"),r=a.n(n),i=a("Yz+Y"),o=a.n(i),l=a("iCc5"),s=a.n(l),c=a("V7oC"),u=a.n(c),d=a("FYw3"),m=a.n(d),p=a("mRg0"),h=a.n(p),f=a("17x9"),g=a.n(f),v=a("LvDl"),E=a("sbe7"),y=a.n(E),S=(a("THQc"),g.a.oneOfType([g.a.string,g.a.number])),b={children:g.a.node,left:S,width:S,visible:g.a.bool},T=function(e){function t(e){return s()(this,t),m()(this,(t.__proto__||o()(t)).call(this,e))}return h()(t,e),u()(t,[{key:"render",value:function(){var e=this.props,t=e.children,a=e.visible,n=e.style,i=e.className,o=e.onClose,l="slide-pane",s={top:0,transform:a?"translate3d(0%, 0, 0)":"translate3d(150%, 0, 0)"};return i&&(l=l+" "+i),n&&(s=Object(v.assign)(s,n)),y.a.createElement("div",{className:l,style:s},y.a.createElement("div",{className:"slide-pane-conent"},t),y.a.createElement("span",{className:"slide-pane-toggle",onClick:o},y.a.createElement(r.a,{type:"double-right"})))}}]),t}(E.Component);T.propTypes=b,t.a=T},WyGn:function(e,t,a){},YXul:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a("zbcj"),r=a.n(n)()(["CHANGE_LOADING","GET_LIST","GET_CHECK_DETAIL","CHANGE_PARAMS","GET_SOURCE_PART","RESET_SOURCE_PART"],{prefix:"dataCheck/"})},iEKX:function(e,t,a){"use strict";a.d(t,"a",function(){return l});var n=a("QbLZ"),r=a.n(n),i=a("sbe7"),o=a.n(i);function l(e){var t=e.style,a=r()({},{textIndent:"5px",backgroundColor:"transparent",backgroundImage:"none",width:"100%",border:"none"},t);return o.a.createElement("textarea",r()({},e,{style:a}))}},j2qn:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a("zbcj"),r=a.n(n)()(["CHANGE_LOADING","GET_TASK_LIST","GET_TASK_DETAIL","GET_TASK_TABLE_REPORT","GET_TASK_ALARM_NUM"],{prefix:"taskQuery/"})},j7hF:function(e,t,a){"use strict";a.r(t);var n={};a.d(n,"dataFilterDoc",function(){return nr}),a.d(n,"switchKey",function(){return rr}),a.d(n,"hdfsPath",function(){return ir}),a.d(n,"jobSpeedLimit",function(){return or}),a.d(n,"jobConcurrence",function(){return lr}),a.d(n,"errorCount",function(){return sr}),a.d(n,"hdfsConfig",function(){return cr}),a.d(n,"rdbConfig",function(){return ur}),a.d(n,"hBaseConfig",function(){return dr}),a.d(n,"recordDirtyData",function(){return mr}),a.d(n,"errorPercentConfig",function(){return pr});var r,i,o,l=a("sbe7"),s=a.n(l),c=a("i8i4"),u=a.n(c),d=a("0cfB"),m=a("2NsA"),p=a("Yz+Y"),h=a.n(p),f=a("iCc5"),g=a.n(f),v=a("V7oC"),E=a.n(v),y=a("FYw3"),S=a.n(y),b=a("mRg0"),T=a.n(b),C=a("dtw8"),k=a("/MKj"),N=(a("3J6H"),a("EMQV"),a("FdzR"),a("95Qq"),a("t/36"),a("XLg0")),P=a("2BCK"),I=a("vFRS"),w=a("NX2S"),D=a("UopC"),x=a("X9CO"),_=a("dVc0"),R=a("2Ul7"),L=a("AVFO"),O=a("17x9"),A=a.n(O),M=a("PVY6"),j=a("QbLZ"),F=a.n(j),V=a("pLPX"),U=Object(k.b)(function(e){return{user:e.user,apps:e.apps,routing:e.routing,app:e.app}})(r=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.state={},a}return T()(t,e),E()(t,[{key:"render",value:function(){var e=this.props,t=(e.user,e.apps,"/dataQuality.html#"),a=[{id:"dq/overview",name:"概览",link:t+"/dq/overview",enable:!0},{id:"dq/taskQuery",name:"任务查询",link:t+"/dq/taskQuery",enable:!0},{id:"dq/rule",name:"规则配置",link:t+"/dq/rule",enable:!0},{id:"dq/dataCheck",name:"逐行校验",link:t+"/dq/dataCheck",enable:!0},{id:"dq/dataSource",name:"数据源管理",link:t+"/dq/dataSource",enable:!0}],n=s.a.createElement("span",null,s.a.createElement("img",{style:{height:"36px",width:"36px",marginTop:"5px"},alt:"logo",src:"/public/dataQuality/img/logo.svg"}),s.a.createElement("span",{style:{fontSize:"14px",color:"#ffffff",position:"absolute",left:"80px",top:0}},"DTinsight.Valid"));return s.a.createElement(V.c,F()({logo:n,menuItems:a},this.props))}}]),t}(l.Component))||r,G=(a("zmYW"),a("DtFj")),H=a.n(G),z=(a("mN36"),a("N9UN")),q=a.n(z),Y=(a("hr7U"),a("9xET")),K=a.n(Y),B=(a("fv9D"),a("ZPTe")),Q=a.n(B),W=a("/f1G"),J=a.n(W),X=a("GQeE"),Z=a.n(X),$=a("wd/R"),ee=a.n($),te=a("zXZS"),ae=a("YEIV"),ne=a.n(ae),re={WAIT_RUN:0,RUNNING:1,FAIL:2,PASS:3,UNPASS:4},ie="4",oe={LOOP:0,HAND:1},le=(i={},ne()(i,oe.LOOP,"周期"),ne()(i,oe.HAND,"手动"),i),se={MYSQL:1,ORACLE:2,SQLSERVER:3,HDFS:6,HIVE:7,HBASE:8,FTP:9,MAXCOMPUTE:10},ce={INITIAL:0,RUNNING:1,SUCCESS:2,FAIL:3,PASS:4,UNPASS:5,EXPIRED:6},ue=[{text:"等待运行",value:"0"},{text:"运行中",value:"1"},{text:"运行成功",value:"2"},{text:"运行失败",value:"3"},{text:"校验通过",value:"4"},{text:"校验未通过",value:"5"},{text:"校验结果失效",value:"6"}],de=[{text:"MySQL",value:1},{text:"Oracle",value:2},{text:"SQLServer",value:3},{text:"Spark",value:7},{text:"MaxCompute",value:10}],me=[{text:">",value:">"},{text:">=",value:">="},{text:"=",value:"="},{text:"<",value:"<"},{text:"<=",value:"<="},{text:"!=",value:"!="}],pe=[{text:">",value:">"},{text:">=",value:">="},{text:"=",value:"="},{text:"<",value:"<"},{text:"<=",value:"<="}],he=[{text:"今日告警数",value:"1"},{text:"最近7天告警数",value:"7"},{text:"最近30天告警数",value:"30"}],fe=[{text:"等待运行",value:re.WAIT_RUN},{text:"运行中",value:re.RUNNING},{text:"运行失败",value:re.FAIL},{text:"校验通过",value:re.PASS},{text:"校验未通过",value:re.UNPASS}],ge={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}},ve={labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:10}}},Ee={wrapperCol:{xs:{span:24,offset:0},sm:{span:14,offset:6}}},ye={labelCol:{span:0},wrapperCol:{span:24}},Se={title:{text:"堆叠区域图",textStyle:{fontSize:12},textAlign:"left"},tooltip:{trigger:"axis",axisPointer:{label:{backgroundColor:"#6a7985"}}},color:["#2491F7","#7460EF","#26DAD2","#79E079","#7A64F3","#FFDC53","#9a64fb"],legend:{data:["邮件营销","联盟广告","视频广告","直接访问","搜索引擎"]},toolbox:{feature:{saveAsImage:{show:!1}}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:[],axisTick:{show:!0},axisLine:{lineStyle:{color:"#DDDDDD"}},axisLabel:{textStyle:{color:"#666666"}},nameTextStyle:{color:"#666666"},splitLine:{color:"#666666"}}],yAxis:[{type:"value",axisLabel:{formatter:"{value} 个",textStyle:{color:"#666666",baseline:"bottom"}},nameTextStyle:{color:"#666666"},nameLocation:"end",nameGap:20,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"#DDDDDD",type:"dashed"}}}],series:[]},be=a("MJ9B"),Te=a("W95b"),Ce=a("hPfy"),ke=function(e){return Te.a.post(Ce.a.GET_TOP_RECORD,e)},Ne=function(e){return Te.a.post(Ce.a.GET_ALARM_SUM,e)},Pe=function(e){return Te.a.post(Ce.a.GET_ALARM_TREND,e)},Ie=function(e){return Te.a.post(Ce.a.GET_DASHBOARD_USAGE,e)},we=function(e){return function(t){t({type:be.a.CHANGE_LOADING}),ke(e).then(function(e){1===e.code&&t({type:be.a.GET_TOP_RECORD,payload:e.data}),t({type:be.a.CHANGE_LOADING})})}},De=function(e){return function(t){Ne(e).then(function(e){1===e.code&&t({type:be.a.GET_ALARM_SUM,payload:e.data})})}},xe=function(e){return function(t){Ie(e).then(function(e){1===e.code&&t({type:be.a.GET_USAGE,payload:e.data})})}},_e=a("ProS");a("75ce"),a("AH3D"),a("Ynxi");var Re=Object(k.b)(function(e){return{dashBoard:e.dashBoard}},function(e){return{getTopRecord:function(t){e(we(t))},getAlarmSum:function(t){e(De(t))},getUsage:function(t){e(xe(t))}}})(o=function(e){function t(){var e,a,n,r;g()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=S()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(o))),n.state={currentDate:"1"},n.resize=function(){n.state.lineChart&&n.state.lineChart.resize()},n.alarmTitle=function(e){switch(e){case"1":return"今天";case"30":return"最近30天";default:return"最近7天"}},n.initColumns=function(){var e=n.state.currentDate;return[{title:"排名",dataIndex:"rank",key:"rank",render:function(e,t,a){return s.a.createElement("div",{className:"rank-number"},a+1)},width:"10%"},{title:"类型",dataIndex:"dataSourceName",key:"dataSourceName",width:"40%"},{title:"表名",dataIndex:"tableName",key:"tableName",render:function(e,t){return s.a.createElement(C.c,{to:"/dq/taskQuery?tb="+e+"&source="+t.dataSourceType},e)},width:"35%"},{title:"告警数",dataIndex:"countByDate",key:"countByDate",filters:he,filteredValue:[e],filterMultiple:!1,render:function(e){return s.a.createElement("span",{style:{color:"#EF5350"}},e)},width:"15%"}]},n.onTableChange=function(e,t,a){var r=t.countByDate[0]||"7";n.props.getTopRecord({date:r}),n.setState({currentDate:r})},r=a,S()(n,r)}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){var e=this;this.props.getUsage(),this.props.getAlarmSum(),this.props.getTopRecord({date:7}),Pe().then(function(t){1===t.code&&e.initLineChart(t.data)})}},{key:"jumpToTaskQuery",value:function(e){var t=new ee.a,a=ee()(ee()(t).subtract(e-1,"days").format("YYYY-MM-DD"));C.g.push({pathname:"/dq/taskQuery",query:{startTime:a.valueOf(),endTime:t.valueOf(),statusFilter:[re.FAIL,re.UNPASS].join(",")}})}},{key:"initLineChart",value:function(e){var t=_e.init(document.getElementById("alarm-trend")),a=F()({},Se),n=Z()(e).map(function(e){return ee()(e).format("YYYY-MM-DD")}),r=J()(e);a.title.text="",a.tooltip.axisPointer.label.formatter="{value}",a.legend.data=["告警数"],a.xAxis[0].axisLabel.formatter="{value}",a.xAxis[0].data=e&&n?n:[],a.grid={left:"3%",right:"4%",bottom:"8%",containLabel:!0},a.yAxis[0].axisLabel.formatter="{value}",a.yAxis[0].minInterval=1,a.series=[{name:"告警数",symbol:"none",type:"line",data:r}],t.setOption(a),this.setState({lineChart:t})}},{key:"render",value:function(){var e=this.props.dashBoard,t=e.topRecords,a=(e.alarmTrend,e.alarmSum),n=e.usage,r=e.loading,i=this.state.currentDate,o=s.a.createElement(C.c,{to:"/dq/taskQuery"},"查看更多"),l={marginTop:20};return s.a.createElement(K.a,{style:{margin:20}},s.a.createElement(Q.a,{span:12,style:{paddingRight:10}},s.a.createElement(K.a,{className:"m-card shadow m-card-small"},s.a.createElement(q.a,{noHovering:!0,bordered:!1,loading:!1,title:"告警汇总",extra:o},s.a.createElement(K.a,{className:"m-count"},s.a.createElement(Q.a,{span:8},s.a.createElement("section",{className:"m-count-section",style:{width:100}},s.a.createElement("span",{className:"m-count-title"},"今日告警数"),s.a.createElement("a",{onClick:this.jumpToTaskQuery.bind(this,1),className:"m-count-content font-red"},a.countToday))),s.a.createElement(Q.a,{span:8},s.a.createElement("section",{className:"m-count-section",style:{width:100}},s.a.createElement("span",{className:"m-count-title"},"最近7天告警数"),s.a.createElement("a",{onClick:this.jumpToTaskQuery.bind(this,7),className:"m-count-content font-red"},a.countWeek))),s.a.createElement(Q.a,{span:8},s.a.createElement("section",{className:"m-count-section",style:{width:100}},s.a.createElement("span",{className:"m-count-title"},"最近30天告警数"),s.a.createElement("a",{onClick:this.jumpToTaskQuery.bind(this,30),className:"m-count-content font-red"},a.countMonth)))))),s.a.createElement(K.a,{style:l,className:"m-card shadow m-card-small"},s.a.createElement(q.a,{noHovering:!0,bordered:!1,loading:!1,title:"告警趋势(最近30天)"},s.a.createElement(te.a,{onResize:this.resize},s.a.createElement("article",{id:"alarm-trend",style:{width:"100%",height:"317px"}})))),s.a.createElement(K.a,{style:l,className:"m-card shadow m-card-small"},s.a.createElement(q.a,{noHovering:!0,bordered:!1,loading:!1,title:"使用情况"},s.a.createElement(K.a,{className:"m-count"},s.a.createElement(Q.a,{span:6},s.a.createElement("section",{className:"m-count-section",style:{width:100}},s.a.createElement("span",{className:"m-count-title"},"已配置表数"),s.a.createElement("span",{className:"m-count-content font-black"},n.tableCount))),s.a.createElement(Q.a,{span:6},s.a.createElement("section",{className:"m-count-section",style:{width:100}},s.a.createElement("span",{className:"m-count-title"},"已配置规则数"),s.a.createElement("span",{className:"m-count-content font-black"},n.ruleCount))),s.a.createElement(Q.a,{span:6},s.a.createElement("section",{className:"m-count-section",style:{width:100}},s.a.createElement("span",{className:"m-count-title"},"昨日新增表数"),s.a.createElement("span",{className:"m-count-content font-black"},n.lastTableCount))),s.a.createElement(Q.a,{span:6},s.a.createElement("section",{className:"m-count-section",style:{width:100}},s.a.createElement("span",{className:"m-count-title"},"昨日新增规则数"),s.a.createElement("span",{className:"m-count-content font-black"},n.lastRuleCount))))))),s.a.createElement(Q.a,{span:12,style:{paddingLeft:10}},s.a.createElement(K.a,{className:"m-card shadow m-card-small"},s.a.createElement(q.a,{noHovering:!0,bordered:!1,loading:!1,title:this.alarmTitle(i)+"告警TOP20"},s.a.createElement(H.a,{rowKey:"monitorId",className:"m-table trend-table",columns:this.initColumns(),loading:r,pagination:!1,dataSource:t,onChange:this.onTableChange})))))}}]),t}(l.Component))||o,Le=a("TCqc"),Oe=a("zbcj"),Ae=a.n(Oe)()(["GET_USER","UPDATE_USER","GET_NOT_PROJECT_USERS","GET_PROJECT_USERS","GET_USER_LIST"],{prefix:"user/"});var Me,je=a("oYF1"),Fe={getDataSources:function(e){return Te.a.post(Ce.a.GET_DATA_SOURCES,e)},testDSConnection:function(e){return Te.a.post(Ce.a.CHECK_CONNECTION,e)},addDataSource:function(e){return Te.a.post(Ce.a.ADD_DATA_SOURCES,e)},updateDataSource:function(e){return Te.a.post(Ce.a.UPDATE_DATA_SOURCES,e)},deleteDataSource:function(e){return Te.a.post(Ce.a.DELETE_DATA_SOURCES,e)},getDataSourcesType:function(e){return Te.a.post(Ce.a.GET_DATA_SOURCES_TYPE,e)},getDataSourcesList:function(e){return Te.a.post(Ce.a.GET_DATA_SOURCES_LIST,e)},getDataSourcesTable:function(e){return Te.a.post(Ce.a.GET_DATA_SOURCES_TABLE,e)},getDataSourcesColumn:function(e){return Te.a.post(Ce.a.GET_DATA_SOURCES_COLUMN,e)},getDataSourcesPart:function(e){return Te.a.post(Ce.a.GET_DATA_SOURCES_PART,e)},getDataSourcesPreview:function(e){return Te.a.post(Ce.a.GET_DATA_SOURCES_PREVIEW,e)}},Ve=function(e){return function(t){t({type:je.a.CHANGE_LOADING}),Fe.getDataSources(e).then(function(e){1===e.code&&t({type:je.a.GET_DATA_SOURCES,payload:e.data}),t({type:je.a.CHANGE_LOADING})})}},Ue=function(e){return function(t){Fe.getDataSourcesType(e).then(function(e){1===e.code&&t({type:je.a.GET_DATA_SOURCES_TYPE,payload:e.data})})}},Ge=function(e){return function(t){Fe.getDataSourcesList(e).then(function(e){1===e.code&&t({type:je.a.GET_DATA_SOURCES_LIST,payload:e.data})})}},He=function(e){return function(t){t({type:je.a.CHANGE_GETTABLE_LOADING}),Fe.getDataSourcesTable(e).then(function(e){1===e.code?t({type:je.a.GET_DATA_SOURCES_TABLE,payload:e.data}):t({type:je.a.GET_DATA_SOURCES_TABLE,payload:[]}),t({type:je.a.CHANGE_GETTABLE_LOADING})})}},ze=function(){return function(e){e({type:je.a.RESET_DATA_SOURCES_TABLE})}},qe=function(e){return function(t){Fe.getDataSourcesPart(e).then(function(e){1===e.code&&t({type:je.a.GET_DATA_SOURCES_PART,payload:e.data?e.data:{}})})}},Ye=function(){return function(e){e({type:je.a.RESET_DATA_SOURCES_PART})}},Ke=a("F2FU"),Be=function(){return Te.a.post(Ce.a.DQ_GET_USER_LIST)},Qe=function(){return Te.a.post(Ce.a.DQ_GET_ALL_DICT)},We=function(e){return function(t){Be(e).then(function(e){1===e.code&&t({type:Ke.a.GET_USER_LIST,payload:e.data})})}},Je=function(e){return function(t){Qe(e).then(function(e){1===e.code&&t({type:Ke.a.GET_ALL_DICT,payload:e.data})})}},Xe=a("TmhF"),Ze={children:A.a.node},$e=Object(k.b)()(Me=function(e){function t(){return g()(this,t),S()(this,(t.__proto__||h()(t)).apply(this,arguments))}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;e(function(e){Le.a.getLoginedUser().then(function(t){if(1===t.code)return e({type:Ae.GET_USER,data:t.data})})}),e(Object(Xe.a)(M.k)),e(We()),e(Je()),e(Ue())}},{key:"render",value:function(){var e=this.props.children;return s.a.createElement("div",{className:"main header-fixed"},s.a.createElement(U,null),s.a.createElement("div",{className:"container"},e||s.a.createElement(Re,null)))}}]),t}(l.Component))||Me;$e.propTypes=Ze,$e.defaultProps={children:[]};var et=$e,tt=(a("pJsf"),a("g4D/")),at=a.n(tt),nt=(a("fwXI"),a("CC+v")),rt=a.n(nt),it=(a("93XW"),a("d1El")),ot=a.n(it),lt=(a("FGdI"),a("Pbn2")),st=a.n(lt),ct=(a("GBD3"),a("wXtC")),ut=a.n(ct),dt=(a("Z8Mf"),a("j7zX")),mt=a.n(dt),pt=(a("ek7I"),a("FAat")),ht=a.n(pt),ft=(a("cUip"),a("iJl9")),gt=a.n(ft),vt=a("7Qib"),Et=a("WaWy"),yt=a("LvDl"),St=a("btJW");function bt(e){switch(e.value){case!0:return s.a.createElement("span",null,"通过");case!1:return s.a.createElement(ot.a,{title:"未通过"},s.a.createElement(st.a,{type:"close-circle-o",style:{fontSize:16,color:"#f00"}}));default:return s.a.createElement("span",null,"--")}}function Tt(e){switch(e.value){case re.WAIT_RUN:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"等待运行",style:{background:"#d9d9d9"}})," 等待运行");case re.RUNNING:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"运行中",style:{background:"#2491F7"}})," 运行中");case re.FAIL:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"运行失败",style:{background:"#EF5350"}})," 运行失败");case re.PASS:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"校验通过",style:{background:"#00A755"}})," 校验通过");case re.UNPASS:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"校验未通过",style:{background:"#F5A623"}})," 校验未通过");default:return s.a.createElement("span",{style:e.style},"--")}}function Ct(e){switch(e.value){case ce.INITIAL:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"等待运行",style:{background:"#d9d9d9"}})," 等待运行");case ce.RUNNING:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"运行中",style:{background:"#2491F7"}})," 运行中");case ce.SUCCESS:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"运行成功",style:{background:"#00A755"}})," 运行成功");case ce.FAIL:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"运行失败",style:{background:"#EF5350"}})," 运行失败");case ce.PASS:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"校验通过",style:{background:"#00A755"}})," 校验通过");case ce.UNPASS:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"校验未通过",style:{background:"#F5A623"}})," 校验未通过");case ce.EXPIRED:return s.a.createElement("span",{style:e.style},s.a.createElement(St.a,{title:"校验结果失效",style:{background:"#F5A623"}})," 校验结果失效");default:return s.a.createElement("span",{style:e.style},"--")}}var kt={getTaskList:function(e){return Te.a.post(Ce.a.GET_TASK_LIST,e)},getTaskDetail:function(e){return Te.a.post(Ce.a.GET_TASK_DETAIL,e)},getTaskTableReport:function(e){return Te.a.post(Ce.a.GET_TABLE_REPORT,e)},getTaskAlarmNum:function(e){return Te.a.post(Ce.a.GET_TASK_ALARM_NUM,e)}},Nt=a("ProS");a("75ce"),a("AH3D"),a("Ynxi"),a("laiN");var Pt=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.resize=function(){a.state.lineChart&&a.state.lineChart.resize()},a.initRulesColumns=function(){return[{title:"字段",dataIndex:"columnName",key:"columnName",render:function(e,t){var a=t.isSnapshot?" (已删除)":"";return{children:(t.isCustomizeSql?t.customizeSql:e)+a,props:{colSpan:t.isCustomizeSql?3:1}}},width:"100px"},{title:"统计函数",dataIndex:"functionId",key:"functionId",render:function(e,t){return{children:t.functionName,props:{colSpan:t.isCustomizeSql?0:1}}},width:"100px"},{title:"过滤条件",dataIndex:"filter",key:"filter",render:function(e,t){return{children:e,props:{colSpan:t.isCustomizeSql?0:1}}},width:"100px"},{title:"校验方法",dataIndex:"verifyTypeValue",key:"verifyTypeValue",width:"10%"},{title:"状态",dataIndex:"status",key:"status",render:function(e){return s.a.createElement(bt,{value:e})},width:"8%"},{title:"统计值",dataIndex:"statistic",key:"statistic",width:"8%"},{title:"阈值",dataIndex:"threshold",key:"threshold",render:function(e,t){return t.isPercentage?t.operator+"  "+e+"  %":t.operator+"  "+e},width:"8%"},{title:"最近修改人",key:"modifyUser",dataIndex:"modifyUser",width:"12%"},{title:"最近修改时间",key:"gmtModified",dataIndex:"gmtModified",width:"12%",render:function(e){return ee()(e).format("YYYY-MM-DD HH:mm")}},{title:"操作",width:"8%",render:function(e,t){return s.a.createElement("a",{onClick:a.onCheckReport.bind(a,t)},"查看趋势")}}]},a.onCheckReport=function(e){a.setState({currentRecord:e}),kt.getTaskAlarmNum({ruleId:e.id,monitorId:e.monitorId}).then(function(e){1===e.code&&(a.setState({visible:!0}),a.initLineChart(e.data))})},a.state={lineChart:"",visible:!1,taskDetail:[],currentRecord:{},showSnapshot:!1},a}return T()(t,e),E()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this,a=this.props.data,n=e.data;Object(yt.isEmpty)(n)||a===n||kt.getTaskDetail({recordId:n.id,monitorId:n.monitorId}).then(function(e){1===e.code&&t.setState({taskDetail:e.data,visible:!1})})}},{key:"isSnapshotChange",value:function(e){this.setState({showSnapshot:e.target.checked})}},{key:"initLineChart",value:function(e){var t=this.state.currentRecord,a=Nt.init(document.getElementById("TaskTrend")),n=Object(yt.cloneDeep)(Se),r=Z()(e).map(function(e){return ee()(e).format("YYYY-MM-DD HH:mm")}),i=J()(e);n.title.text="",n.tooltip.axisPointer.label.formatter="{value}",n.legend.data=["统计值"],n.xAxis[0].axisTick={show:!1,alignWithLabel:!0},n.xAxis[0].boundaryGap=["5%","5%"],n.xAxis[0].axisLabel.formatter=function(e,t){return ee()(e).format("YYYY-MM-DD HH:mm")},n.xAxis[0].data=e&&r?r:[],n.yAxis[0].axisLabel.formatter="{value}",n.yAxis[0].minInterval=1,n.series=[{name:"统计值",type:"line",smooth:!0,symbolSize:8,data:i}],Object(yt.isEmpty)(e)||(n.series[0].markLine="in"===t.operator?void 0:{silent:!0,itemStyle:{normal:{label:{formatter:function(){return"阈值"}}}},data:[{yAxis:+t.threshold}]}),a.setOption(n),this.setState({lineChart:a})}},{key:"render",value:function(){var e=this.state,t=e.visible,a=e.currentRecord,n=e.taskDetail,r=e.showSnapshot,i=n?n.filter(function(e){return!!r||0==e.isSnapshot}):[],o=Object(yt.isEmpty)(a)?"":"指标最近波动图（"+a.columnName+" -- "+a.functionName+"）";return a&&a.isCustomizeSql&&(o="指标最近波动图"),s.a.createElement("div",{style:{padding:10}},s.a.createElement(at.a,{value:r,style:{marginBottom:"10px"},onChange:this.isSnapshotChange.bind(this)},"查看历史规则"),s.a.createElement(H.a,{rowKey:"id",className:"m-table",columns:this.initRulesColumns(),pagination:!1,dataSource:i,style:{marginBottom:15},scroll:{y:250}}),t&&s.a.createElement(q.a,{noHovering:!0,bordered:!1,loading:!1,className:"shadow",title:o},s.a.createElement(te.a,{onResize:this.resize},s.a.createElement("article",{id:"TaskTrend",style:{width:"100%",height:"300px"}}))))}}]),t}(l.Component),It=a("m1cH"),wt=a.n(It),Dt=a("ProS");a("75ce"),a("AH3D"),a("Ynxi");var xt,_t,Rt=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.loadReports=function(e){kt.getTaskTableReport(e).then(function(e){1===e.code&&(a.setState({tableReport:e.data}),a.initLineChart(e.data.usage))})},a.resize=function(){a.state.lineChart&&a.state.lineChart.resize()},a.getSeries=function(e,t){var a=[];return e.length&&t.forEach(function(t){a.push({name:t.name,type:"line",smooth:!0,symbolSize:8,data:e.map(function(e){return e[t.key]})})}),a},a.initTableInfoColumns=function(){return[{title:"表名",dataIndex:"tableName",key:"tableName",width:"40%"},{title:"总分区数量",dataIndex:"partitionNum",key:"partitionNum",width:"20%"},{title:"类型",dataIndex:"dataSourceType",key:"dataSourceType",width:"40%"}]},a.initTableReportColumns=function(){return[{title:"记录数",dataIndex:"countData",key:"countData",width:"50%"},{title:"报警数",dataIndex:"countTrigger",key:"countTrigger",width:"50%"}]},a.init30TimesInfo=function(){return[{title:"记录数平均波动率",dataIndex:"standardDeviation",key:"standardDeviation"},{title:"平均记录数",dataIndex:"avgRecord",key:"avgRecord"},{title:"日平均告警数",dataIndex:"avgTrigger",key:"avgTrigger"},{title:"平均告警率",dataIndex:"alarmRate",key:"alarmRate",render:function(e){return e&&e.toFixed?e.toFixed(2):e}}]},a.init30TimesTableReport=function(){var e=a.props.data,t=[{title:"执行时间",dataIndex:"executeTime",key:"executeTime",render:function(e){return ee()(e).format("YYYY-MM-DD HH:mm:ss")},width:"40%"},{title:"记录数",dataIndex:"dayCountRecord",key:"dayCountRecord",width:"20%"},{title:"总告警数",dataIndex:"dayCountTrigger",key:"dayCountTrigger",width:"20%"}];return e.dataSourceType!==se.HIVE&&e.dataSourceType!==se.MAXCOMPUTE||t.splice(1,0,{title:"分区",dataIndex:"partition",key:"partition",width:"20%"}),t},a.state={lineChart:"",tableReport:{}},a}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){var e=this.props.data;this.loadReports({recordId:e.id,tableId:e.tableId})}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.data,a=e.data;Object(yt.isEmpty)(a)||t===a||this.loadReports({recordId:a.id,tableId:a.tableId})}},{key:"initLineChart",value:function(e){var t=Dt.init(document.getElementById("TableReportTrend")),a=Object(yt.cloneDeep)(Se),n=e.map(function(e){return ee()(e.executeTime).format("YYYY-MM-DD HH:mm")}),r=[{key:"dayCountRecord",name:"记录数"},{key:"dayCountTrigger",name:"总告警数"}];a.grid={left:20,right:20,containLabel:!0},a.title.text="",a.tooltip.axisPointer.label.formatter="{value}",a.xAxis[0].axisTick={show:!1,alignWithLabel:!0},a.xAxis[0].boundaryGap=["5%","5%"],a.xAxis[0].axisLabel.formatter=function(e,t){return ee()(e).format("MM-DD HH:mm")},a.xAxis[0].data=e&&n?n:[],a.yAxis[0].axisLabel.formatter="{value}",a.yAxis[0].minInterval=1,a.legend.data=r.map(function(e){return e.name}),a.series=this.getSeries(e,r),t.setOption(a),this.setState({lineChart:t})}},{key:"render",value:function(){var e=this.state.tableReport,t=Object(yt.isEmpty)(e)?[]:[e],a=e.usage?[].concat(wt()(e.usage)).reverse():[],n=s.a.createElement("div",null,"表级统计",s.a.createElement("span",{style:{fontSize:12,color:"#999"}},"（执行时间：",ee()(e.executeTime).format("YYYY-MM-DD HH:mm:ss"),"）"));return s.a.createElement("div",{style:{padding:20}},s.a.createElement(H.a,{rowKey:"tableName",className:"m-table txt-center-table",columns:this.initTableInfoColumns(),pagination:!1,dataSource:t}),s.a.createElement(K.a,{style:{padding:"20px 0"},gutter:16},s.a.createElement(Q.a,{span:12},s.a.createElement(q.a,{noHovering:!0,bordered:!1,loading:!1,className:"shadow",title:n},s.a.createElement(H.a,{rowKey:"tableName",className:"m-table txt-center-table",columns:this.initTableReportColumns(),pagination:!1,dataSource:t}))),s.a.createElement(Q.a,{span:12},s.a.createElement(q.a,{noHovering:!0,bordered:!1,loading:!1,className:"shadow",title:"最近30次综合报告"},s.a.createElement(H.a,{rowKey:"id",className:"m-table txt-center-table",columns:this.init30TimesInfo(),pagination:!1,dataSource:t})))),s.a.createElement(K.a,{gutter:16},s.a.createElement(Q.a,{span:12},s.a.createElement(q.a,{noHovering:!0,bordered:!1,loading:!1,className:"shadow",title:"最近30次表级统计"},s.a.createElement(H.a,{rowKey:"id",className:"m-table txt-center-table",columns:this.init30TimesTableReport(),pagination:!1,dataSource:a,scroll:{y:245}}))),s.a.createElement(Q.a,{span:12},s.a.createElement(q.a,{noHovering:!0,bordered:!1,loading:!1,className:"shadow",title:"最近30次表数据波动图",style:{width:"100%"}},s.a.createElement(te.a,{onResize:this.resize},s.a.createElement("article",{id:"TableReportTrend",style:{width:"100%",height:"280px"}}))))))}}]),t}(l.Component),Lt=a("j2qn"),Ot=function(e){return function(t){t({type:Lt.a.CHANGE_LOADING}),kt.getTaskList(e).then(function(e){1===e.code&&t({type:Lt.a.GET_TASK_LIST,payload:e.data}),t({type:Lt.a.CHANGE_LOADING})})}},At=gt.a.Search,Mt=ht.a.Option,jt=mt.a.TabPane,Ft=ut.a.RangePicker,Vt=Object(k.b)(function(e){return{taskQuery:e.taskQuery,dataSource:e.dataSource,common:e.common}},function(e){return{getTaskList:function(t){e(Ot(t))},getDataSourcesList:function(t){e(Ge(t))}}})(xt=function(e){function t(){var e,a,n,r;g()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=S()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(o))),n.state={params:{currentPage:1,pageSize:20,fuzzyName:vt.a.getParameterByName("tb")||void 0,configureId:void 0,dataSourceId:void 0,dataSourceType:vt.a.getParameterByName("source")||void 0,subscribe:void 0,executeStartTime:vt.a.getParameterByName("startTime")||void 0,executeEndTime:vt.a.getParameterByName("endTime")||void 0,bizTime:0,statusFilter:vt.a.getParameterByName("statusFilter")||""},tabKey:"1",showSlidePane:!1,currentTask:{},visibleList:[]},n.renderLogInfo=function(e,t){var a=n.state.visibleList,r="",i="close-circle-o";if(e===re.FAIL)r=s.a.createElement("a",{className:"tooltip_content_a",onClick:n.showDetailLogInfo.bind(n,t.id,t.tableName,t.logInfo)},t.logInfo||"空");else{if(e!==re.UNPASS)return null;r=s.a.createElement("span",{className:"tooltip_content_a"},t.logInfo||"空"," ",s.a.createElement("a",{onClick:n.openSlidePane.bind(n,t)},"查看详情")),i="exclamation-circle-o"}return s.a.createElement(ot.a,{placement:"right",visible:a.indexOf(t.id)>-1,onVisibleChange:n.tooltipChange.bind(n,t.id),title:r,overlayStyle:{wordBreak:"break-word"}},s.a.createElement(st.a,{className:"font-14",type:i}))},n.initColumns=function(){var e=n.state,t=(e.visibleList,e.params);return[{title:"表",dataIndex:"tableName",key:"tableName",render:function(e,t){return s.a.createElement("a",{onClick:n.openSlidePane.bind(n,t)},e)},width:"15%"},{title:"分区",dataIndex:"partationValue",key:"partationValue",render:function(e,t){return e||"--"},width:"15%"},{title:"状态",width:"10%",dataIndex:"status",key:"status",render:function(e,t){return s.a.createElement("div",null,s.a.createElement(Tt,{style:{display:"inline-block",width:"80px"},value:e}),n.renderLogInfo(e,t))},filters:fe,filteredValue:t.statusFilter?t.statusFilter.split(","):[]},{title:"规则异常数",dataIndex:"alarmSum",key:"alarmSum",width:"8%",sorter:!0,render:function(e){return null==e?"-":e}},{title:"数据源",dataIndex:"sourceTypeValue",key:"sourceTypeValue",render:function(e,t){return e?e+" / "+t.sourceName:"--"},width:"15%"},{title:"触发方式",dataIndex:"trigMode",key:"trigMode",width:"80px",render:function(e){return le[e]},filters:[{text:le[oe.LOOP],value:oe.LOOP},{text:le[oe.HAND],value:oe.HAND}],filterMultiple:!1},{title:"配置人",dataIndex:"configureUserName",key:"configureUserName",width:"150px"},{title:"执行时间",dataIndex:"executeTime",key:"executeTime",render:function(e){return e?ee()(e).format("YYYY-MM-DD HH:mm:ss"):"--"},width:"12%",sorter:!0}]},n.onTableChange=function(e,t,a){var r=a.field,i=a.order,o=F()({},n.state.params,{currentPage:e.current,statusFilter:t.status&&t.status.length>0?t.status.join(","):void 0,alarmSort:void 0,trigMode:t.trigMode&&t.trigMode.length>0?t.trigMode.join(","):void 0,executeTimeSort:void 0});r?o["alarmSum"===r?"alarmSort":"executeTimeSort"]="descend"===i?"desc":"asc":o.alarmSort=o.executeTimeSort=void 0,n.props.getTaskList(o),n.setState({params:o})},n.renderSourceType=function(e){return e.map(function(e){return s.a.createElement(Mt,{key:e.value,value:e.value.toString()},e.name)})},n.onSourceChange=function(e){var t=F()({},n.state.params,{currentPage:1,dataSourceType:e||void 0});n.props.getTaskList(t),n.setState({params:t})},n.renderUserSource=function(e){return e.map(function(e){var t=e.dataName+"（"+e.sourceTypeValue+"）";return s.a.createElement(Mt,{key:e.id,value:e.id.toString(),title:t},t)})},n.onUserSourceChange=function(e){var t=F()({},n.state.params,{currentPage:1,dataSourceId:e||void 0});n.props.getTaskList(t),n.setState({params:t})},n.renderUserList=function(e){return e.map(function(e){return s.a.createElement(Mt,{key:e.id,value:e.id.toString(),name:e.userName},e.userName)})},n.onUserChange=function(e){var t=F()({},n.state.params,{currentPage:1,configureId:e||void 0});n.props.getTaskList(t),n.setState({params:t})},n.onExecuteTimeChange=function(e,t){var a=F()({},n.state.params,{currentPage:1,executeStartTime:e&&e[0]?e[0].valueOf():null,executeEndTime:e&&e[1]?e[1].valueOf():null});n.props.getTaskList(a),n.setState({params:a})},n.onSubscribeChange=function(e){var t=F()({},n.state.params,{currentPage:1,subscribe:!!e.target.checked||void 0});n.props.getTaskList(t),n.setState({params:t})},n.onTableSearch=function(e){var t=F()({},n.state.params,{currentPage:1,fuzzyName:e||void 0});n.props.getTaskList(t),n.setState({params:t})},n.openSlidePane=function(e){n.setState({showSlidePane:!0,currentTask:e})},n.closeSlidePane=function(){n.setState({showSlidePane:!1,currentTask:{},tabKey:"1"})},n.onTabChange=function(e){n.setState({tabKey:e})},n.disabledDate=function(e){return e&&e.valueOf()>Date.now()},r=a,S()(n,r)}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){this.props.getTaskList(this.state.params),this.props.getDataSourcesList()}},{key:"showDetailLogInfo",value:function(e,t,a){this.tooltipChange(e,!1),rt.a.error({width:"70%",title:"表: "+t,content:s.a.createElement("pre",{style:{wordBreak:"break-word",whiteSpace:"pre-wrap"}},a)})}},{key:"tooltipChange",value:function(e,t){var a=this.state.visibleList;t?this.setState({visibleList:a.concat(e)}):this.setState({visibleList:a.filter(function(t){return e!=t})})}},{key:"render",value:function(){var e=this,t=this.props,a=t.dataSource,n=t.taskQuery,r=t.common,i=a.sourceType,o=a.sourceList,l=r.userList,c=n.loading,u=n.taskList,d=this.state,m=d.params,p=d.showSlidePane,h=d.tabKey,f=d.currentTask,g=m.executeStartTime,v=m.executeEndTime,E={current:m.currentPage,pageSize:m.pageSize,total:u.totalCount},y=void 0;g&&v&&(y=[ee()(parseInt(g)),ee()(parseInt(v))]);var S=s.a.createElement("div",{className:"flex font-12"},s.a.createElement(At,{placeholder:"输入表名搜索",onSearch:this.onTableSearch,defaultValue:m.fuzzyName,style:{width:200,margin:"10px 0"}}),s.a.createElement("div",{className:"m-l-8"},"类型：",s.a.createElement(ht.a,{allowClear:!0,style:{width:150},value:m.dataSourceType,placeholder:"选择数据源类型",onChange:this.onSourceChange},this.renderSourceType(i))),s.a.createElement("div",{className:"m-l-8"},"数据源：",s.a.createElement(ht.a,{allowClear:!0,showSearch:!0,style:{width:150},optionFilterProp:"title",placeholder:"选择数据源",onChange:this.onUserSourceChange},this.renderUserSource(o))),s.a.createElement("div",{className:"m-l-8"},"执行时间：",s.a.createElement(Ft,{defaultValue:y,format:"YYYY-MM-DD",placeholder:["开始日期","结束日期"],style:{width:200,verticalAlign:"middle",marginTop:"-1px"},disabledDate:this.disabledDate,onChange:this.onExecuteTimeChange})),s.a.createElement("div",{className:"m-8"},"配置人：",s.a.createElement(ht.a,{allowClear:!0,showSearch:!0,style:{width:150},placeholder:"选择配置人",optionFilterProp:"name",onChange:this.onUserChange},this.renderUserList(l))),s.a.createElement("div",{className:"m-l-8"},s.a.createElement(at.a,{onChange:this.onSubscribeChange},"我订阅的表")));return s.a.createElement("div",{className:"task-dashboard"},s.a.createElement("h1",{className:"box-title"},"任务查询 ",s.a.createElement("span",{style:{fontSize:"12px",color:"rgb(153, 153, 153)"}},"告警总数: ",u.data&&u.data[0]?u.data[0].allAlarmSum:0)),s.a.createElement("div",{className:"box-2 m-card shadow"},s.a.createElement(q.a,{title:S,extra:s.a.createElement(ot.a,{title:"刷新数据"},s.a.createElement(st.a,{type:"sync",onClick:function(){e.props.getTaskList(m)},style:{cursor:"pointer",marginTop:"18px",color:"#94A8C6"}})),noHovering:!0,bordered:!1},s.a.createElement(H.a,{rowClassName:function(e,t){return f&&f.id==e.id?"row-select":""},rowKey:"id",className:"m-table",columns:this.initColumns(),loading:c,pagination:E,dataSource:u.data,onChange:this.onTableChange}),s.a.createElement(Et.a,{onClose:this.closeSlidePane,visible:p,style:{right:"0",width:"80%",minHeight:"600px",height:"100%"}},s.a.createElement("div",{className:"m-tabs"},s.a.createElement(mt.a,{animated:!1,activeKey:h,onChange:this.onTabChange},s.a.createElement(jt,{tab:"监控报告",key:"1"},s.a.createElement(Pt,{data:f})),s.a.createElement(jt,{tab:"表级报告",key:"2"},s.a.createElement(Rt,{data:f}))))))))}}]),t}(l.Component))||xt,Ut=(a("MaXC"),a("4IMT")),Gt=a.n(Ut),Ht=(a("tL+A"),a("QpBz")),zt=a.n(Ht),qt=(a("b+Mx"),a("5Dct")),Yt=a.n(qt),Kt=(a("eOfH"),a("h0/l")),Bt=a.n(Kt),Qt=(a("nTym"),a("qu0K")),Wt=a.n(Qt),Jt=a("gDS+"),Xt=a.n(Jt),Zt={getMonitorLists:function(e){return Te.a.post(Ce.a.GET_MONITOR_LIST,e)},getRuleFunction:function(e){return Te.a.post(Ce.a.GET_RULE_FUNCTION,e)},getTableColumn:function(e){return Te.a.post(Ce.a.GET_MONITOR_TABLE_COLUMN,e)},getMonitorRule:function(e){return Te.a.post(Ce.a.GET_MONITOR_RULE,e)},saveMonitorRule:function(e){return Te.a.post(Ce.a.SAVE_MONITOR_RULE,e)},deleteMonitorRule:function(e){return Te.a.post(Ce.a.DELETE_MONITOR_RULE,e)},addMonitor:function(e){return Te.a.post(Ce.a.ADD_MONITOR,e)},updateMonitor:function(e){return Te.a.post(Ce.a.UPDATE_MONITOR,e)},subscribeTable:function(e){return Te.a.post(Ce.a.SUBSCRIBE_TABLE,e)},unSubscribeTable:function(e){return Te.a.post(Ce.a.UNSUBSCRIBE_TABLE,e)},checkSubscribe:function(e){return Te.a.post(Ce.a.CHECK_SUBSCRIBE,e)},changeMonitorStatus:function(e){return Te.a.post(Ce.a.CHANGE_MONITOR_STATUS,e)},executeMonitor:function(e){return Te.a.post(Ce.a.EXECUTE_MONITOR,e)},getMonitorDetail:function(e){return Te.a.post(Ce.a.GET_MONITOR_DETAIL,e)},getRemoteTrigger:function(e){return Te.a.post(Ce.a.GET_REMOTE_TRIGGER,e)},addRemoteTrigger:function(e){return Te.a.post(Ce.a.ADD_REMOTE_TRIGGER,e)},delRemoteTrigger:function(e){return Te.a.post(Ce.a.DEL_REMOTE_TRIGGER,e)},checkMonitor:function(e){return Te.a.post(Ce.a.CHECK_MONITOR,e)},updateTaskParams:function(e){return Te.a.post(Ce.a.UPDATE_TASK_PARAMS,e)}},$t=Wt.a.Item,ea=ht.a.Option,ta={beginDate:ee()().format("YYYY-MM-DD"),endDate:ee()().add(100,"years").format("YYYY-MM-DD"),periodType:"2",day:void 0,weekDay:void 0,hour:0,min:0,beginHour:0,beginMin:0,gapHour:void 0,endHour:0,endMin:0},aa=Object(k.b)(function(e){return{common:e.common}})(_t=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.initState=function(e){e.scheduleConf&&a.setState({scheduleConfObj:JSON.parse(e.scheduleConf),params:{monitorId:e.monitorId,sendTypes:e.sendTypes,webhook:e.webhook,notifyUser:e.notifyUser.map(function(e){return e.id}),periodType:e.periodType,scheduleConf:e.scheduleConf}})},a.resetScheduleConf=function(e){var t=F()({},ta,{periodType:e});a.setState({scheduleConfObj:t,params:F()({},a.state.params,{periodType:e,scheduleConf:Xt()(t)})})},a.renderPeriodType=function(e){return e.map(function(e){return s.a.createElement(ea,{key:e.value,value:e.value.toString()},e.name)})},a.onPeriodTypeChange=function(e){a.resetScheduleConf(e)},a.renderSendTypeList=function(e){return e&&e.map(function(e){return s.a.createElement(at.a,{key:e.value,value:e.value.toString()},e.name)})},a.onSendTypeChange=function(e){var t=a.props.form,n=t.getFieldValue("notifyUser");0===e.length&&0===n.length&&t.setFieldsValue({notifyUser:[]}),a.setState({params:F()({},a.state.params,{sendTypes:e})})},a.onWebHookChange=function(e){a.setState({params:F()({},a.state.params,{webhook:e.target.value})})},a.onBeginDateChange=function(e,t){a.changeScheduleConfTime("beginDate",t)},a.onEndDateChange=function(e,t){a.changeScheduleConfTime("endDate",t)},a.renderUserList=function(e){return e.map(function(e){return s.a.createElement(ea,{key:e.id,value:e.id.toString()},e.userName)})},a.onNotifyUserChange=function(e){var t=a.props.form,n=t.getFieldValue("sendTypes");0===e.length&&0===n.length&&t.setFieldsValue({sendTypes:[]}),a.setState({params:F()({},a.state.params,{notifyUser:e})})},a.changeScheduleConfTime=function(e,t){var n=a.state,r=n.scheduleConfObj,i=n.params,o={};o[e]=t;var l=F()({},r,o);a.setState({scheduleConfObj:l,params:F()({},i,{scheduleConf:Xt()(l)})})},a.cancel=function(){var e=a.props,t=e.form,n=e.data;t.resetFields(),a.initState(n),a.props.closeModal(!1)},a.checkTime=function(e,t,n){var r=a.props.form,i=r.getFieldValue("beginHour"),o=r.getFieldValue("beginMin"),l=r.getFieldValue("endHour"),s=r.getFieldValue("endMin");60*parseInt(i)+parseInt(o)>=60*parseInt(l)+parseInt(s)?n("开始时间不能晚于结束时间"):r.setFieldsValue({beginHour:i,beginMin:o,endHour:l,endMin:s}),n()},a.checkDate=function(e,t,n){var r=a.props.form,i=r.getFieldValue("beginDate"),o=r.getFieldValue("endDate");i&&o?i.valueOf()>o.valueOf()?n("生效日期的开始时间不能晚于结束时间"):r.setFieldsValue({beginDate:i,endDate:o}):n(),n()},a.prev=function(){var e=a.props,t=e.currentStep;(0,e.navToStep)(t-1)},a.save=function(){var e=a.props.form,t=a.state.params;e.validateFields(function(e,n){e&&e.endDate&&zt.a.error(e.endDate.errors[0].message),e||Zt.updateMonitor(t).then(function(e){1===e.code&&(zt.a.success("更新成功！"),a.props.closeModal(!0))})})},a.state={scheduleConfObj:ta,params:{monitorId:void 0,sendTypes:[],notifyUser:[],periodType:void 0,scheduleConf:void 0,webhook:void 0}},a}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){this.initState(this.props.data)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.data,a=e.data;t.monitorId!=a.monitorId&&this.initState(a)}},{key:"renderDynamic",value:function(){var e=this,t=this.props,a=t.form,n=t.common.allDict,r=a.getFieldDecorator,i=this.state.scheduleConfObj,o=(n.periodType&&n.periodType,function(t){for(var a=[],n=0;n<=23;n++)a.push(s.a.createElement(ea,{key:n,value:""+n},n<10?"0"+n:n));return s.a.createElement(ht.a,{style:{width:150},onChange:e.changeScheduleConfTime.bind(e,t)},a)}),l=function(t){for(var a=[],n=0;n<=59;n++)a.push(s.a.createElement(ea,{key:n,value:""+n},n<10?"0"+n:n));return s.a.createElement(ht.a,{style:{width:150},onChange:e.changeScheduleConfTime.bind(e,t)},a)};switch(i.periodType){case"1":return s.a.createElement("div",null,s.a.createElement($t,F()({},ge,{label:"开始时间"}),r("beginHour",{rules:[{required:!0,message:"开始时间不能为空"},{validator:this.checkTime.bind(this)}],initialValue:""+i.beginHour})(o("beginHour")),s.a.createElement("span",{className:"m-8"},"时"),r("beginMin",{rules:[{required:!0,message:"开始时间不能为空"},{validator:this.checkTime.bind(this)}],initialValue:""+i.beginMin})(l("beginMin")),s.a.createElement("span",{className:"m-8"},"分")),s.a.createElement($t,F()({},ge,{label:"间隔时间"}),r("gapHour",{rules:[{required:!0,message:"间隔时间不能为空"}],initialValue:i.gapHour?i.gapHour:""})(function(){for(var t=[],a=1;a<=23;a++)t.push(s.a.createElement(ea,{key:a,value:""+a},a,"小时"));return s.a.createElement(ht.a,{style:{width:150},onChange:e.changeScheduleConfTime.bind(e,"gapHour")},t)}())),s.a.createElement($t,F()({},ge,{label:"结束时间"}),r("endHour",{rules:[{required:!0,message:"结束时间不能为空"},{validator:this.checkTime.bind(this)}],initialValue:""+i.endHour})(o("endHour")),s.a.createElement("span",{className:"m-8"},"时"),r("endMin",{rules:[{required:!0,message:"结束时间不能为空"},{validator:this.checkTime.bind(this)}],initialValue:""+i.endMin})(l("endMin")),s.a.createElement("span",{className:"m-8"},"分")));case"2":return s.a.createElement($t,F()({},ge,{label:"起调周期"}),r("hour",{rules:[{required:!0}],initialValue:""+i.hour})(o("hour")),s.a.createElement("span",{className:"m-8"},"时"),r("min",{rules:[{required:!0}],initialValue:""+i.min})(l("min")),s.a.createElement("span",{className:"m-8"},"分"));case"3":return s.a.createElement("div",null,s.a.createElement($t,F()({},ge,{label:"选择时间"}),r("weekDay",{rules:[{required:!0,message:"周内天数不能为空"}],initialValue:i.weekDay?i.weekDay:[]})(s.a.createElement(ht.a,{mode:"multiple",style:{width:328},onChange:e.changeScheduleConfTime.bind(e,"weekDay")},s.a.createElement(ea,{key:1,value:"1"},"星期一"),s.a.createElement(ea,{key:2,value:"2"},"星期二"),s.a.createElement(ea,{key:3,value:"3"},"星期三"),s.a.createElement(ea,{key:4,value:"4"},"星期四"),s.a.createElement(ea,{key:5,value:"5"},"星期五"),s.a.createElement(ea,{key:6,value:"6"},"星期六"),s.a.createElement(ea,{key:7,value:"7"},"星期天")))),s.a.createElement($t,F()({},ge,{label:"起调周期"}),r("hour1",{rules:[{required:!0}],initialValue:""+i.hour})(o("hour")),s.a.createElement("span",{className:"m-8"},"时"),r("min1",{rules:[{required:!0}],initialValue:""+i.min})(l("min")),s.a.createElement("span",{className:"m-8"},"分")));case"4":return s.a.createElement("div",null,s.a.createElement($t,F()({},ge,{label:"选择时间"}),r("day",{rules:[{required:!0,message:"月内天数不能为空"}],initialValue:i.day?i.day:[]})(function(){for(var t=[],a=1;a<=31;a++)t.push(s.a.createElement(ea,{key:a,value:""+a},"每月"+a+"号"));return s.a.createElement(ht.a,{mode:"multiple",style:{width:328},onChange:e.changeScheduleConfTime.bind(e,"day")},t)}())),s.a.createElement($t,F()({},ge,{label:"起调周期"}),r("hour2",{rules:[{required:!0}],initialValue:""+i.hour})(o("hour")),s.a.createElement("span",{className:"m-8"},"时"),r("min2",{rules:[{required:!0}],initialValue:""+i.min})(l("min")),s.a.createElement("span",{className:"m-8"},"分")))}}},{key:"render",value:function(){var e=this.props,t=e.form,a=e.common,n=e.visible,r=t.getFieldDecorator,i=a.allDict,o=a.userList,l=this.state,c=l.scheduleConfObj,u=l.params,d=u.notifyUser,m=u.sendTypes,p=u.webhook,h=i.periodType?i.periodType:[],f=i.notifyType?i.notifyType:[],g=m?m.map(function(e){return e.toString()}):[],v=g.indexOf(ie)>-1;return s.a.createElement(rt.a,{title:"编辑调度属性",wrapClassName:"editExecuteModal",maskClosable:!1,visible:n,width:"50%",okText:"保存",cancelText:"取消",onOk:this.save,onCancel:this.cancel},s.a.createElement(Wt.a,null,s.a.createElement($t,F()({},ge,{label:"调度周期"}),r("periodType",{rules:[{required:!0,message:"执行周期不能为空"}],initialValue:""+c.periodType})(s.a.createElement(ht.a,{onChange:this.onPeriodTypeChange},this.renderPeriodType(h)))),5!=c.periodType&&s.a.createElement($t,F()({},ge,{label:"生效日期"}),r("beginDate",{rules:[{required:!0,message:"生效日期不能为空"},{validator:this.checkDate.bind(this)}],initialValue:ee()(c.beginDate)})(s.a.createElement(ut.a,{style:{width:150},format:"YYYY-MM-DD",placeholder:"开始日期",onChange:this.onBeginDateChange})),s.a.createElement("span",{className:"m-8"},"到"),r("endDate",{rules:[{required:!0,message:"生效日期不能为空"},{validator:this.checkDate.bind(this)}],initialValue:ee()(c.endDate)})(s.a.createElement(ut.a,{style:{width:150},format:"YYYY-MM-DD",placeholder:"结束日期",onChange:this.onEndDateChange}))),this.renderDynamic(),s.a.createElement($t,F()({},ge,{label:"告警方式"}),r("sendTypes",{rules:[{required:d.length,message:"选择告警方式"}],initialValue:g})(s.a.createElement(at.a.Group,{onChange:this.onSendTypeChange},this.renderSendTypeList(f)))),v&&s.a.createElement($t,F()({},ge,{label:"webhook"}),r("webhook",{rules:[{required:!0,message:"webhook不能为空"}],initialValue:p||""})(s.a.createElement(gt.a,{onChange:this.onWebHookChange}))),s.a.createElement($t,F()({},ge,{label:"告警接收人"}),r("notifyUser",{rules:[{required:m.length,message:"选择告警接收人"}],initialValue:d.map(function(e){return e.toString()})})(s.a.createElement(ht.a,{allowClear:!0,mode:"multiple",onChange:this.onNotifyUserChange},this.renderUserList(o))))))}}]),t}(l.Component))||_t;aa=Wt.a.create()(aa);var na,ra=a("tgFt"),ia=function(e){return function(t){return t({type:ra.a.CHANGE_LOADING}),Zt.getMonitorLists(e).then(function(e){if(t({type:ra.a.CHANGE_LOADING}),1===e.code)return t({type:ra.a.GET_MONITOR_LIST,payload:e.data}),e})}},oa=function(e){return function(t){Zt.getRuleFunction(e).then(function(e){1===e.code&&t({type:ra.a.GET_RULE_FUNCTION,payload:e.data})})}},la=function(e){return function(t){Zt.getTableColumn(e).then(function(e){1===e.code&&t({type:ra.a.GET_MONITOR_TABLE_COLUMN,payload:e.data})})}},sa=function(e){return function(t){Zt.addMonitor(e).then(function(e){1===e.code&&zt.a.success("添加成功！")})}},ca=function(e){return function(t){Zt.getMonitorRule(e).then(function(e){1===e.code&&t({type:ra.a.GET_MONITOR_RULE,payload:e.data})})}},ua=function(e){return function(t){Zt.changeMonitorStatus(e).then(function(e){1===e.code&&zt.a.success("操作成功！")})}},da=function(e){return function(t){Zt.getMonitorDetail(e).then(function(e){1===e.code&&t({type:ra.a.GET_MONITOR_DETAIL,payload:e.data})})}},ma=function(e){return function(t){Zt.getRemoteTrigger(e).then(function(e){1===e.code&&t({type:ra.a.GET_REMOTE_TRIGGER,payload:e.data})})}},pa=a("pKDC"),ha=a("pAlz"),fa=function(e){function t(){var e,a,n,r;g()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=S()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(o))),n.state={changeVal:""},n.onChange=function(e,t){n.setState({changeVal:t})},n.onOk=function(){var e=n.state.changeVal||n.props.value;n.props.onOk(e)},r=a,S()(n,r)}return T()(t,e),E()(t,[{key:"render",value:function(){var e=this.props,t=e.value,a=e.visible,n=e.title,r=e.key,i=e.onCancel;return s.a.createElement(rt.a,{key:r,visible:a,title:n,onOk:this.onOk,onCancel:i,bodyStyle:{height:400,padding:0}},s.a.createElement(pa.a,{options:ha.b,value:t,onChange:this.onChange,sync:!0}))}}]),t}(l.Component),ga=Wt.a.Item,va=ht.a.Option,Ea=gt.a.TextArea,ya=Object(k.b)(function(e){return{ruleConfig:e.ruleConfig,common:e.common}},function(e){return{getRuleFunction:function(t){e(oa(t))},getTableColumn:function(t){e(la(t))},getMonitorDetail:function(t){e(da(t))},changeMonitorStatus:function(t){e(ua(t))}}})(na=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.initData=function(e,t){a.props.getMonitorDetail({monitorId:e}),Zt.getMonitorRule({monitorId:e}).then(function(e){1===e.code&&a.setState({rules:e.data})}),a.props.getTableColumn({sourceId:t.sourceId,tableName:t.tableName})},a.initColumns=function(){return[{title:"字段",dataIndex:"columnName",key:"columnName",render:function(e,t){return a.renderColumns(e,t,"columnName")},width:"15%"},{title:"统计函数",dataIndex:"functionId",key:"functionId",render:function(e,t){return a.renderColumns(e,t,"functionId")},width:"15%"},{title:"过滤条件",dataIndex:"filter",key:"filter",render:function(e,t){return a.renderColumns(e,t,"filter")},width:"25%"},{title:"校验方法",dataIndex:"verifyType",key:"verifyType",render:function(e,t){return a.renderColumns(e,t,"verifyType")},width:"15%"},{title:"阈值配置（不符合阈值条件时触发告警）",dataIndex:"threshold",key:"threshold",render:function(e,t){return a.renderColumns(e,t,"threshold")},width:"20%"},{title:"操作",width:"10%",render:function(e,t){var n=t.editable;return s.a.createElement("div",null,n?s.a.createElement("span",null,s.a.createElement("a",{className:"m-r-8",onClick:function(){return a.save(t.id)}},"保存"),s.a.createElement("a",{onClick:function(){return a.cancel(t.id)}},"取消")):s.a.createElement("span",null,s.a.createElement("a",{className:"m-r-8",onClick:function(){return a.edit(t.id)}},"编辑"),s.a.createElement(Bt.a,{title:"确定要删除吗？",onConfirm:function(){return a.delete(t.id)}},s.a.createElement("a",null,"删除"))))}}]},a.changeRuleParams=function(e,t){var n={};n[e]=t.target?t.target.value:t,a.setState({currentRule:F()({},a.state.currentRule,n)})},a.onColumnNameChange=function(e){var t=a.props,n=t.form,r=t.ruleConfig,i=r.tableColumn,o=r.monitorFunction,l=a.state.currentRule,s=o[i.filter(function(t){return t.key===e})[0].type],c={};c["functionId@"+l.id]=void 0,n.setFieldsValue(c),a.setState({functionList:s,currentRule:F()({},l,{columnName:e,functionId:void 0})})},a.onFunctionChange=function(e){var t=a.props.form,n=a.state,r=n.functionList,i=n.currentRule,o=r.filter(function(t){return t.id==e})[0].isPercent,l=r.filter(function(t){return t.id==e})[0].nameZc,s="枚举值"===l,c=F()({},a.state.currentRule,{functionId:e,functionName:l,verifyType:s?"1":void 0,operator:s?"in":void 0,isPercentage:o,percentType:1===o?"limit":"free"}),u={};u["verifyType@"+i.id]=s?"1":void 0,u["operator@"+i.id]=void 0,t.setFieldsValue(u),a.setState({currentRule:c})},a.onVerifyTypeChange=function(e){var t=F()({},a.state.currentRule,{verifyType:e});"limit"!==t.percentType&&(t.isPercentage=1==e?0:1),a.setState({currentRule:t})},a.renderEditTD=function(e,t,n){var r,i=a.props,o=i.form,l=i.common,c=i.ruleConfig,u=o.getFieldDecorator,d=c.tableColumn,m=l.allDict.verifyType,p=a.state,h=p.currentRule,f=p.functionList,g="字符串最大长度"===(r=h.functionName)||"字符串最小长度"===r?pe:me;switch(n){case"columnName":return t.isCustomizeSql?s.a.createElement(ga,F()({},ye,{className:"rule-edit-td cell-center"}),u("customizeSql@"+t.id,{rules:[{required:!0,message:"自定义SQL不可为空"}],initialValue:t.customizeSql})(t.isCustomizeSql?s.a.createElement(Ea,{style:{resize:"vertical"},autosize:{minRows:3,maxRows:8},placeholder:"查询结果为一个数值类型",onChange:a.changeRuleParams.bind(a,"customizeSql")}):s.a.createElement(gt.a,{placeholder:"查询结果为一个数值类型",onChange:a.changeRuleParams.bind(a,"customizeSql")}))):s.a.createElement(ga,F()({},ye,{className:"rule-edit-td cell-center"}),u("columnName@"+t.id,{rules:[{required:!0,message:"字段不可为空"}],initialValue:t.columnName})(s.a.createElement(ht.a,{showSearch:!0,onChange:a.onColumnNameChange,disabled:t.isTable||1==t.level},d.map(function(e){return s.a.createElement(va,{key:e.key,value:e.key},e.key)}))));case"functionId":return s.a.createElement(ga,F()({},ye,{className:"rule-edit-td cell-center"}),u("functionId@"+t.id,{rules:[{required:!0,message:"统计函数不可为空"}],initialValue:"edit"===t.editStatus?t.functionName:t.functionId})(s.a.createElement(ht.a,{onChange:a.onFunctionChange},f.map(function(e){return s.a.createElement(va,{key:e.id,value:e.id.toString()},e.nameZc)}))));case"filter":return s.a.createElement(ga,F()({},ye,{className:"rule-edit-td cell-center"}),u("filter@"+t.id,{rules:[],initialValue:t.filter})(s.a.createElement(gt.a,{placeholder:'"and"开头的条件语句，如and col = "val"',onChange:a.changeRuleParams.bind(a,"filter")})));case"verifyType":return s.a.createElement(ga,F()({},ye,{className:"rule-edit-td cell-center"}),u("verifyType@"+t.id,{rules:[{required:!0,message:"校验方法不可为空"}],initialValue:t.verifyType?t.verifyType.toString():void 0})(s.a.createElement(ht.a,{onChange:a.onVerifyTypeChange},m.map(function(e){return s.a.createElement(va,{key:e.value,value:e.value.toString()},e.name)}))));case"threshold":return"in"===h.operator?s.a.createElement(ga,F()({},ye,{className:"rule-edit-td"}),u("thresholdEnum@"+t.id,{rules:[{required:!0,message:"不可为空"}],initialValue:t.threshold})(s.a.createElement(gt.a,{placeholder:"枚举格式为(value1,value2,.....)",onChange:a.changeRuleParams.bind(a,"threshold")}))):s.a.createElement("div",{className:"cell-center-box"},s.a.createElement(ga,{className:"cell-multiple-center"},u("operator@"+t.id,{rules:[{required:!0,message:"不可为空"}],initialValue:t.operator})(s.a.createElement(ht.a,{style:{width:65},onChange:a.changeRuleParams.bind(a,"operator")},g.map(function(e){return s.a.createElement(va,{key:e.value,value:e.value},e.text)})))),s.a.createElement(ga,{className:"cell-multiple-center"},u("threshold@"+t.id,{rules:[{required:!0,message:"不可为空"}],initialValue:t.threshold})(s.a.createElement(Yt.a,{style:{width:65},onChange:a.changeRuleParams.bind(a,"threshold")}))),1===h.isPercentage&&s.a.createElement("span",{style:{height:32,lineHeight:"32px"}},"%"))}},a.renderTD=function(e,t,a){switch(a){case"columnName":return t.isCustomizeSql?t.customizeSql:e;case"functionId":return t.functionName;case"verifyType":return t.verifyTypeValue;case"threshold":var n=t.operator+"  "+e;return t.isPercentage?n+" %":n;default:return e}},a.addNewRule=function(e){var t=a.props,n=t.form,r=t.data,i=t.ruleConfig,o=a.state,l=o.currentRule,s=o.rules,c=s?[].concat(wt()(s)):[];Object(yt.isEmpty)(l)||("edit"===l.editStatus?(delete l.editable,delete l.editStatus):(c.shift(),n.resetFields(),a.setState({currentRule:{},functionList:[]})));var u={id:0,editStatus:"new",editable:!0,filter:"",verifyType:void 0,operator:void 0,threshold:void 0};switch(e){case"column":u.isCustomizeSql=0,u.columnName=void 0,u.functionId=void 0;break;case"SQL":u.isCustomizeSql=1,u.customizeSql=void 0;break;case"table":u.isTable=!0,u.isCustomizeSql=0,u.columnName=r.tableName,u.functionId=void 0,a.setState({functionList:i.monitorFunction.all.filter(function(e){return 1===e.level})})}c.unshift(u),a.setState({currentRule:u,rules:c})},a.onMonitorIdChange=function(e){var t=e;a.props.getMonitorDetail({monitorId:t}),Zt.getMonitorRule({monitorId:t}).then(function(e){1===e.code&&a.setState({rules:e.data})}),a.setState({monitorId:t,currentRule:{}})},a.executeMonitor=function(e){a.props.data;Zt.executeMonitor({monitorId:e}).then(function(e){1===e.code?(zt.a.success("操作成功，稍后可在任务查询中查看详情"),a.props.closeSlidePane()):zt.a.error("执行失败")})},a.changeMonitorStatus=function(e){Zt.changeMonitorStatus({monitorId:e}).then(function(t){1===t.code&&(zt.a.success("操作成功"),a.props.getMonitorDetail({monitorId:e}))})},a.updateEnvParams=function(e){if(e){var t=a.state.monitorId;Zt.updateTaskParams({monitorId:t,taskParams:e}).then(function(e){1===e.code&&(zt.a.success("修改环境参数成功"),a.setState({visibleEnvModal:!1}),a.props.getMonitorDetail({monitorId:t}))})}else zt.a.error("环境参数为空！")},a.openExecuteModal=function(){a.setState({showExecuteModal:!0})},a.closeExecuteModal=function(e){var t=a.state.monitorId;e&&a.props.getMonitorDetail({monitorId:t}),a.setState({showExecuteModal:!1})},a.state={enumFields:["columnName","functionId","thresholdEnum"],SQLFields:["customizeSql","verifyType","operator","threshold"],columnFields:["columnName","functionId","verifyType","operator","threshold"],rules:[],currentRule:{},functionList:[],monitorId:void 0,havePart:!1,showExecuteModal:!1,visibleEnvModal:!1},a}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){this.props.getRuleFunction()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.data,a=e.data;if(!Object(yt.isEmpty)(a)&&t.tableId!==a.tableId){var n=a.monitorPartVOS[0].monitorId;this.initData(n,a),this.setState({monitorId:n,havePart:!1,currentRule:{},functionList:[]}),7!==a.dataSourceType&&10!==a.dataSourceType||this.setState({havePart:!0})}}},{key:"renderColumns",value:function(e,t,a){var n={children:s.a.createElement(Wt.a,{layout:"inline"},t.editable?this.renderEditTD(e,t,a):this.renderTD(e,t,a)),props:{}};if(t.isCustomizeSql)switch(a){case"columnName":n.props.colSpan=3;break;case"functionId":case"filter":n.props.colSpan=0}return n}},{key:"edit",value:function(e){var t=this.state,a=t.currentRule,n=t.rules,r=this.props.ruleConfig,i=r.monitorFunction,o=r.tableColumn,l=[],s=[].concat(wt()(n)),c=s.filter(function(t){return e===t.id})[0];if(Object(yt.isEmpty)(a)||("edit"===a.editStatus?(delete a.editable,delete a.editStatus):s.shift()),c){if(c.editable=!0,c.editStatus="edit",!c.isCustomizeSql)if(c.isTable||1==c.level)l=i.all.filter(function(e){return 1===e.level});else l=i[o.filter(function(e){return e.key===c.columnName})[0].type];this.setState({currentRule:c,rules:s,functionList:l})}}},{key:"cancel",value:function(e){var t=[].concat(wt()(this.state.rules)),a=t.filter(function(t){return e===t.id})[0],n=t.indexOf(a);"edit"===a.editStatus?(delete a.editable,delete a.editStatus):t.splice(n,1),this.setState({currentRule:{},rules:t})}},{key:"delete",value:function(e){var t=this,a=this.state.monitorId;[].concat(wt()(this.state.rules)).filter(function(t){return e===t.id})[0]&&Zt.deleteMonitorRule({ruleIds:[e],monitorId:a}).then(function(e){1===e.code&&(zt.a.success("删除成功"),Zt.getMonitorRule({monitorId:a}).then(function(e){1===e.code&&(t.setState({rules:e.data}),Object(yt.isNull)(e.data)&&t.props.refresh())}))})}},{key:"save",value:function(e){var t=this,a=this.state,n=a.currentRule,r=a.enumFields,i=a.SQLFields,o=a.columnFields,l=a.monitorId,s=n.isCustomizeSql?i:o;"in"===n.operator&&(s=r),this.props.form.validateFields(s,{force:!0},function(e,a){e||("new"===n.editStatus&&(n.monitorId=l,delete n.id),delete n.isTable,delete n.editable,delete n.editStatus,delete n.percentType,Zt.saveMonitorRule(F()({},n)).then(function(e){1===e.code&&(zt.a.success("保存成功"),Zt.getMonitorRule({monitorId:l}).then(function(e){1===e.code&&t.setState({rules:e.data,currentRule:{}})}))}))})}},{key:"render",value:function(){var e=this,t=this.props,a=t.data,n=t.ruleConfig.monitorDetail,r=this.state,i=r.rules,o=r.monitorId,l=r.havePart,c=r.showExecuteModal,u=r.visibleEnvModal,d=i?i.filter(function(e){return 0==e.isSnapshot||"new"==e.editStatus}):[],m=a.monitorPartVOS?a.monitorPartVOS:[];return s.a.createElement("div",{className:"rule-manage"},s.a.createElement(K.a,null,s.a.createElement(Q.a,{span:12,className:"txt-left"},l&&s.a.createElement("div",null,"分区：",s.a.createElement(ht.a,{style:{width:150},value:o?o.toString():void 0,onChange:this.onMonitorIdChange},m.map(function(e){return s.a.createElement(va,{key:e.monitorId,value:e.monitorId.toString()},e.partValue?e.partValue:"全表")})))),s.a.createElement(Q.a,{span:12,className:"txt-right"},s.a.createElement(Gt.a,{type:"primary",onClick:this.executeMonitor.bind(this,o)},"立即执行"),s.a.createElement(Gt.a,{className:"m-l-8",type:"primary",onClick:this.openExecuteModal},"编辑调度属性"),s.a.createElement(Gt.a,{className:"m-l-8",type:"primary",onClick:this.changeMonitorStatus.bind(this,o)},n.isClosed?"开启检测":"关闭检测"),n&&n.sourceType===se.HIVE&&s.a.createElement(Gt.a,{className:"m-l-8",type:"primary",onClick:function(){e.setState({visibleEnvModal:!0})}},"环境参数"))),s.a.createElement("div",{className:"monitor-info-table"},s.a.createElement("table",{width:"100%",cellPadding:"0",cellSpacing:"0"},s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("th",null,"执行周期"),s.a.createElement("td",{className:"width-3"},n.periodTypeName),s.a.createElement("th",null,"告警方式"),s.a.createElement("td",{className:"width-3"},n.sendTypeNames)),s.a.createElement("tr",null,s.a.createElement("th",null,"执行时间"),s.a.createElement("td",{className:"width-3"},n.executeTime),s.a.createElement("th",null,"接收人"),s.a.createElement("td",{className:"width-3"},n.notifyUser?n.notifyUser.map(function(e){return e.name}).join("，"):""))))),s.a.createElement("div",{className:"txt-right"},s.a.createElement(Gt.a,{type:"primary",onClick:this.addNewRule.bind(this,"table")},"添加表级规则"),s.a.createElement(Gt.a,{className:"m-l-8",type:"primary",onClick:this.addNewRule.bind(this,"column")},"添加字段级规则"),s.a.createElement(Gt.a,{className:"m-l-8",type:"primary",onClick:this.addNewRule.bind(this,"SQL")},"添加自定义SQL")),s.a.createElement(H.a,{rowKey:"id",className:"m-table rule-edit-table",style:{padding:"20px 0"},pagination:!1,dataSource:d,columns:this.initColumns(),scroll:{y:361}}),s.a.createElement(aa,{data:n,visible:c,closeModal:this.closeExecuteModal}),s.a.createElement(fa,{key:"ruleConfigEnvModal",title:"配置环境参数",visible:u,onCancel:function(){return e.setState({visibleEnvModal:!1})},value:n.taskParams,onOk:this.updateEnvParams}))}}]),t}(l.Component))||na;ya=Wt.a.create()(ya);var Sa,ba=function(e){function t(){var e,a,n,r;g()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=S()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(o))),n.state={},n.copy=function(e){n.removeFake(),n.fakeHandlerCallback=function(){return n.removeFake()},n.fakeHandler=document.body.addEventListener("click",n.fakeHandlerCallback)||!0,n.fakeElem=document.createElement("textarea"),n.fakeElem.style.fontSize="12pt",n.fakeElem.style.border="0",n.fakeElem.style.padding="0",n.fakeElem.style.margin="0",n.fakeElem.style.position="absolute",n.fakeElem.style.left="-9999px";var t=window.pageYOffset||document.documentElement.scrollTop;n.fakeElem.style.top=t+"px",n.fakeElem.setAttribute("readonly",""),n.fakeElem.value=e,document.body.appendChild(n.fakeElem),n.fakeElem.select(),n.copyText()},r=a,S()(n,r)}return T()(t,e),E()(t,[{key:"componentWillUnmount",value:function(){this.removeFake()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand("copy")}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(e){e?zt.a.success("复制成功"):zt.a.error("不支持")}},{key:"render",value:function(){var e=this.props.value;return s.a.createElement(ot.a,{placement:"right",overlayClassName:"copy-area",overlayStyle:{cursor:"pointer"},title:s.a.createElement("span",{onClick:this.copy.bind(this,e)},"复制")},e)}}]),t}(l.Component),Ta=ht.a.Option,Ca=gt.a.TextArea,ka=Wt.a.Item,Na=APP_CONF&&APP_CONF.API_SERVER?APP_CONF.API_SERVER:"",Pa=Object(k.b)(function(e){return{ruleConfig:e.ruleConfig}},function(e){return{getRemoteTrigger:function(t){e(ma(t))},getMonitorRule:function(t){e(ca(t))}}})(Sa=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.initTriggerColumns=function(){var e=[{title:"触发规则数",dataIndex:"ruleNumber",key:"ruleNumber",width:"120px"},{title:"触发接口",dataIndex:"url",key:"url",width:"200px",render:function(e){return s.a.createElement(ba,{value:""+Na+e})}},{title:"结果获取接口",dataIndex:"viewStateUrl",key:"viewStateUrl",width:"200px",render:function(e){return s.a.createElement(ba,{value:""+Na+e})}},{title:"请求方式",dataIndex:"method",key:"method",width:"80px",render:function(e){return"POST"}},{title:"最近修改人",key:"modifyUser",dataIndex:"modifyUser",width:"160px"},{title:"最近修改时间",key:"gmtModified",dataIndex:"gmtModified",width:"12%",render:function(e){return ee()(e).format("YYYY-MM-DD HH:mm")}},{title:"备注",dataIndex:"remark",key:"remark",width:"170px"},{title:"操作",width:"120px",render:function(e,t){return s.a.createElement("div",null,s.a.createElement("a",{className:"m-r-8",onClick:function(){return a.editTrigger(t)}},"编辑"),s.a.createElement(Bt.a,{title:"确定要删除吗？",onConfirm:function(){return a.deleteTrigger(t.id)}},s.a.createElement("a",null,"删除")))}}];return a.state.havePart&&e.splice(0,0,{title:"分区",dataIndex:"partitionValue",key:"partitionValue",width:"12%"}),e},a.editTrigger=function(e){a.showRemoteModal(),a.props.getMonitorRule({monitorId:e.monitorId}),a.setState({monitorId:e.monitorId,chooseRule:e,selectedIds:e.ruleIds,remark:e.remark})},a.deleteTrigger=function(e){var t=a.props.data;Zt.delRemoteTrigger({remoteId:e}).then(function(e){1===e.code&&(zt.a.success("删除成功！"),a.props.getRemoteTrigger({tableId:t.tableId}))})},a.initRulesColumns=function(){return[{title:"字段",dataIndex:"columnName",key:"columnName",render:function(e,t){return{children:t.isCustomizeSql?t.customizeSql:e,props:{colSpan:t.isCustomizeSql?3:1}}},width:"15%"},{title:"统计函数",dataIndex:"functionId",key:"functionId",render:function(e,t){return{children:t.functionName,props:{colSpan:t.isCustomizeSql?0:1}}},width:"13%"},{title:"过滤条件",dataIndex:"filter",key:"filter",render:function(e,t){return{children:e,props:{colSpan:t.isCustomizeSql?0:1}}},width:"20%"},{title:"校验方法",dataIndex:"verifyTypeValue",key:"verifyTypeValue",width:"12%"},{title:"阈值配置",dataIndex:"threshold",key:"threshold",render:function(e,t){var a=t.operator+"  "+e;return t.isPercentage?a+" %":a},width:"12%"},{title:"最近修改人",key:"modifyUser",dataIndex:"modifyUser",width:"14%"},{title:"最近修改时间",key:"gmtModified",dataIndex:"gmtModified",width:"14%",render:function(e){return ee()(e).format("YYYY-MM-DD HH:mm")}}]},a.onMonitorIdChange=function(e){var t=e;a.props.getMonitorRule({monitorId:t}),a.setState({monitorId:t,selectedIds:[],remark:void 0})},a.onRemarkChange=function(e){a.setState({remark:e.target.value})},a.newRemoteTrigger=function(){var e=a.state.monitorId;a.props.getMonitorRule({monitorId:e}),a.showRemoteModal()},a.showRemoteModal=function(){a.setState({visible:!0})},a.closeRemoteModal=function(){a.setState({visible:!1,selectedIds:[],chooseRule:{}}),a.props.form.resetFields()},a.saveRemoteTrigger=function(){var e=a.state,t=e.selectedIds,n=e.monitorId,r=e.remark,i=e.chooseRule,o=void 0===i?{}:i,l=a.props,s=l.data,c=l.form,u=l.getRemoteTrigger;t.length?c.validateFields(function(e,i){e||Zt.addRemoteTrigger({remoteId:o.id,monitorId:n,ruleIds:t,remark:r}).then(function(e){1===e.code&&(a.setState({chooseRule:{},selectedIds:[],remark:null}),zt.a.success("操作成功！"),a.closeRemoteModal(),u({tableId:s.tableId}))})}):zt.a.error("请选择一个监控规则！")},a.state={visible:!1,havePart:!1,selectedIds:[],remark:void 0,monitorId:void 0},a}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){var e=this.props.data,t=e.monitorPartVOS[0].monitorId;this.props.getRemoteTrigger({tableId:e.tableId});var a={monitorId:t};e.dataSourceType!==se.HIVE&&e.dataSourceType!==se.MAXCOMPUTE||(a.havePart=!0),this.setState(a)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.data,a=e.data;if(!Object(yt.isEmpty)(a)&&t.tableId!==a.tableId){var n=a.monitorPartVOS[0].monitorId;this.props.getRemoteTrigger({tableId:a.tableId}),this.setState({monitorId:n,havePart:!1,remark:void 0,selectedIds:[]}),a.dataSourceType!==se.HIVE&&a.dataSourceType!==se.MAXCOMPUTE||this.setState({havePart:!0})}}},{key:"render",value:function(){var e=this,t=this.props,a=t.data,n=t.ruleConfig,r=t.form.getFieldDecorator,i=n.triggerList,o=n.monitorRules,l=this.state,c=l.monitorId,u=l.havePart,d=l.visible,m=l.selectedIds,p=l.remark,h=a.monitorPartVOS?a.monitorPartVOS:[],f={selectedRowKeys:m,onChange:function(t){e.setState({selectedIds:t})}};return s.a.createElement("div",{className:"trigger-box"},s.a.createElement("div",{style:{overflow:"hidden",padding:"0px 10px 10px 0px"}},s.a.createElement(Gt.a,{type:"primary",onClick:this.newRemoteTrigger,style:{float:"right"}},"新增远程触发")),i.length>0&&s.a.createElement(H.a,{rowKey:"id",className:"m-table",columns:this.initTriggerColumns(),pagination:!1,dataSource:i,scroll:{y:300}}),s.a.createElement("h2",null,"什么是远程触发？"),s.a.createElement("p",null,"您可以在自建的大数据平台或公有云平台上通过接口调用的形式,触发本系统中的数据质量校验任务执行。"),s.a.createElement("p",null,"典型的场景：您自建的大数据平台上对某张表进行ETL任务处理，需要在ETL任务处理前， 对此表的数据质量进行校验，校验通过后再启动后续的计算任务 （防止错误数据流入下一个计算环节，同时可以节约计算资源）。"),s.a.createElement("p",{style:{marginTop:10}},"配置的流程如下："),s.a.createElement("p",null,"1、在本平台配置表的数据质量检测任务，并在本页面开启远程触发"),s.a.createElement("p",null,"2、在您自建的大数据平台上，新建一个脚本任务，并编写调用的代码，详细的使用教程请参考",s.a.createElement("a",null,"《帮助文档》"),"；"),s.a.createElement("p",null,"3、在您自建的大数据平台上，将数据处理任务作为脚本任务的下游任务；"),s.a.createElement(rt.a,{title:"配置远程调用",wrapClassName:"remoteTriggerModal",width:"85%",visible:d,maskClosable:!1,okText:"生成远程调用API",cancelText:"取消",onOk:this.saveRemoteTrigger,onCancel:this.closeRemoteModal},u&&s.a.createElement("div",null,"分区：",s.a.createElement(ht.a,{style:{width:150},value:c?c.toString():void 0,onChange:this.onMonitorIdChange},h.map(function(e){return s.a.createElement(Ta,{key:e.monitorId,value:e.monitorId.toString()},e.partValue?e.partValue:"全表")}))),s.a.createElement(H.a,{rowKey:"id",className:"m-table select-all-table",style:{padding:"16px 0"},pagination:!1,rowSelection:f,dataSource:o,columns:this.initRulesColumns()}),s.a.createElement(Wt.a,null,s.a.createElement(ka,F()({},ye,{style:{marginBottom:0}}),r("remark",{rules:[{max:100,message:"备注不能超过100个字符"}],initialValue:p})(s.a.createElement(Ca,{placeholder:"备注信息",className:"trigger-remarks",autosize:{minRows:3,maxRows:6},onChange:this.onRemarkChange}))))))}}]),t}(l.Component))||Sa;Pa=Wt.a.create()(Pa);a("SXSo");var Ia,wa,Da,xa=gt.a.Search,_a=ht.a.Option,Ra=mt.a.TabPane,La=Object(k.b)(function(e){return{ruleConfig:e.ruleConfig,dataSource:e.dataSource,common:e.common}},function(e){return{getMonitorLists:function(t){return e(ia(t))},getDataSourcesList:function(t){e(Ge(t))}}})(Ia=function(e){function t(){var e,a,n,r;g()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=S()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(o))),n.state={params:{pageIndex:1,pageSize:20,tableName:vt.a.getParameterByName("tableName")||void 0,modifyUserId:void 0,sourceType:void 0,dataSourceId:void 0,isSubscribe:void 0,periodType:void 0},tabKey:"1",showSlidePane:!1,currentMonitor:{}},n.initColumns=function(){return[{title:"表",dataIndex:"tableName",key:"tableName",render:function(e,t){return s.a.createElement("a",{onClick:n.openSlidePane.bind(n,t)},e)}},{title:"类型",dataIndex:"sourceTypeName",key:"sourceTypeName",render:function(e,t){return e?e+" / "+t.dataName:"--"}},{title:"执行周期",dataIndex:"periodTypeName",key:"periodTypeName"},{title:"最近30天告警数",dataIndex:"recentNotifyNum",key:"recentNotifyNum",sorter:!0},{title:"远程触发",dataIndex:"isRemoteTrigger",key:"isRemoteTrigger",render:function(e){return e?"已开启":""}},{title:"最近修改人",dataIndex:"modifyUser",key:"modifyUser"},{title:"最近修改时间",dataIndex:"gmtModified",key:"gmtModified",render:function(e){return e?ee()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}},{title:"操作",width:"10%",render:function(e,t){return s.a.createElement("span",null,s.a.createElement("a",{onClick:n.onSubscribe.bind(n,t)},t.isSubscribe?"取消订阅":"订阅"))}}]},n.onSubscribe=function(e){var t=n.state.params;e.isSubscribe?Zt.unSubscribeTable({tableId:e.tableId}).then(function(e){1===e.code&&(zt.a.success("取消订阅成功"),n.props.getMonitorLists(t))}):Zt.subscribeTable({tableId:e.tableId}).then(function(e){1===e.code&&(zt.a.success("订阅成功"),n.props.getMonitorLists(t))})},n.onTableChange=function(e,t,a){var r=F()({},n.state.params,{pageIndex:e.current,sort:a.columnKey?"descend"===a.order?"desc":"asc":void 0});n.setState({params:r}),n.props.getMonitorLists(r)},n.renderSourceType=function(e){return e.map(function(e){return s.a.createElement(_a,{key:e.value,value:e.value.toString()},e.name)})},n.onSourceChange=function(e){var t=F()({},n.state.params,{pageIndex:1,sourceType:e||void 0});n.props.getMonitorLists(t),n.setState({params:t})},n.renderUserSource=function(e){return e.map(function(e){var t=e.dataName+"（"+e.sourceTypeValue+"）";return s.a.createElement(_a,{key:e.id,value:e.id.toString(),title:t},t)})},n.onUserSourceChange=function(e){var t=F()({},n.state.params,{pageIndex:1,dataSourceId:e||void 0});n.props.getMonitorLists(t),n.setState({params:t})},n.renderPeriodType=function(e){return e.map(function(e){return s.a.createElement(_a,{key:e.value,value:e.value.toString()},e.name)})},n.onPeriodTypeChange=function(e){var t=F()({},n.state.params,{pageIndex:1,periodType:e||void 0});n.props.getMonitorLists(t),n.setState({params:t})},n.renderUserList=function(e){return e.map(function(e){return s.a.createElement(_a,{key:e.id,value:e.id.toString(),name:e.userName},e.userName)})},n.onUserChange=function(e){var t=F()({},n.state.params,{pageIndex:1,lastModifyUserId:e||void 0});n.props.getMonitorLists(t),n.setState({params:t})},n.onDateChange=function(e,t){var a=F()({},n.state.params,{pageIndex:1,executeTime:e?e.valueOf():void 0});n.props.getMonitorLists(a),n.setState({params:a})},n.onSubscribeChange=function(e){var t=F()({},n.state.params,{pageIndex:1,isSubscribe:e.target.checked?1:void 0});n.props.getMonitorLists(t),n.setState({params:t})},n.handleSearch=function(e){var t=F()({},n.state.params,{pageIndex:1,tableName:e||void 0});n.props.getMonitorLists(t),n.setState({params:t})},n.openSlidePane=function(e){n.setState({showSlidePane:!0,currentMonitor:e})},n.closeSlidePane=function(){n.setState({showSlidePane:!1,currentMonitor:{},tabKey:"1"})},n.refresh=function(){n.closeSlidePane(),n.props.getMonitorLists(n.state.params)},n.onTabChange=function(e){n.setState({tabKey:e})},r=a,S()(n,r)}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){var e=this;this.props.getDataSourcesList(),this.props.getMonitorLists(this.state.params).then(function(t){if(t&&t.data&&t.data.data){var a=t.data.data.filter(function(e){return e.tableId==vt.a.getParameterByName("tableId")});a&&a.length>0&&e.openSlidePane(a[0])}e.props.router.replace("/dq/rule")})}},{key:"render",value:function(){var e=this.props.ruleConfig,t=e.monitorList,a=e.loading,n=this.props.dataSource,r=n.sourceType,i=n.sourceList,o=this.props.common,l=o.userList,c=o.allDict,u=this.state,d=u.params,m=u.showSlidePane,p=u.currentMonitor,h=u.tabKey,f={current:d.pageIndex,pageSize:d.pageSize,total:t?t.totalCount:0},g=c.periodType?c.periodType:[],v=s.a.createElement("div",{className:"flex font-12"},s.a.createElement(xa,{placeholder:"输入表名搜索",onSearch:this.handleSearch,defaultValue:d.tableName,style:{width:200,margin:"10px 0"}}),s.a.createElement("div",{className:"m-l-8"},"类型：",s.a.createElement(ht.a,{allowClear:!0,style:{width:150},placeholder:"选择数据源类型",onChange:this.onSourceChange},this.renderSourceType(r))),s.a.createElement("div",{className:"m-l-8"},"数据源：",s.a.createElement(ht.a,{allowClear:!0,showSearch:!0,style:{width:150},optionFilterProp:"title",placeholder:"选择数据源",onChange:this.onUserSourceChange},this.renderUserSource(i))),s.a.createElement("div",{className:"m-l-8"},"执行周期：",s.a.createElement(ht.a,{allowClear:!0,style:{width:150},placeholder:"选择执行周期",onChange:this.onPeriodTypeChange},this.renderPeriodType(g))),s.a.createElement("div",{className:"m-8"},"最近修改人：",s.a.createElement(ht.a,{allowClear:!0,showSearch:!0,style:{width:150},optionFilterProp:"name",placeholder:"选择最近修改人",onChange:this.onUserChange},this.renderUserList(l))),s.a.createElement("div",{className:"m-l-8"},s.a.createElement(at.a,{onChange:this.onSubscribeChange},"我订阅的表"))),E=s.a.createElement(Gt.a,{type:"primary",style:{margin:"10px 0"}},s.a.createElement(C.c,{to:"/dq/rule/add"},"新建监控规则"));return s.a.createElement("div",{className:"rule-dashboard"},s.a.createElement("h1",{className:"box-title"},"监控规则"),s.a.createElement("div",{className:"box-2 m-card shadow"},s.a.createElement(q.a,{title:v,extra:E,noHovering:!0,bordered:!1},s.a.createElement(H.a,{rowClassName:function(e,t){return p&&p.tableId==e.tableId?"row-select":""},rowKey:"tableId",className:"m-table",columns:this.initColumns(),loading:a,pagination:f,dataSource:t.data,onChange:this.onTableChange}),s.a.createElement(Et.a,{onClose:this.closeSlidePane,visible:m,className:"slide-pane-box",style:{right:"0px",width:"80%",height:"100%",minHeight:"650px"}},s.a.createElement("div",{className:"m-tabs"},s.a.createElement(mt.a,{animated:!1,activeKey:h,onChange:this.onTabChange},s.a.createElement(Ra,{tab:"规则管理",key:"1"},s.a.createElement(ya,{data:p,closeSlidePane:this.closeSlidePane,refresh:this.refresh})),s.a.createElement(Ra,{tab:"远程触发",key:"2"},s.a.createElement(Pa,{data:p,closeSlidePane:this.closeSlidePane}))))))))}}]),t}(l.Component))||Ia,Oa=(a("PzEo"),a("+vAN")),Aa=a.n(Oa),Ma=(a("Hjg5"),a("rmht")),ja=a.n(Ma),Fa=a("iEKX"),Va=Wt.a.Item,Ua=ht.a.Option,Ga=ja.a.TreeNode,Ha=Object(k.b)(function(e){return{dataSource:e.dataSource}},function(e){return{getDataSourcesList:function(t){e(Ge(t))},getDataSourcesTable:function(t){e(He(t))},resetDataSourcesTable:function(){e(ze())},getDataSourcesPart:function(t){e(qe(t))},resetDataSourcesPart:function(){e(Ye())}}})(wa=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.renderSourceType=function(e){return e.map(function(e){var t=e.dataName+"（"+e.sourceTypeValue+"）";return s.a.createElement(Ua,{key:e.id,value:e.id.toString(),title:t},t)})},a.renderSourceTable=function(e){return e.map(function(e){return s.a.createElement(Ua,{key:e,value:e},e)})},a.renderTreeSelect=function(e){if(!Object(yt.isEmpty)(e))return e.children.map(function(e){var t=e.partName,n=e.partValue,r=n?"分区字段："+t+"  分区值："+n:t;return e.children.length?s.a.createElement(Ga,{key:e.nodeId,title:r,value:e.partColumn,dataRef:e},a.renderTreeSelect(e)):s.a.createElement(Ga,{key:e.nodeId,title:r,value:e.partColumn,dataRef:e,isLeaf:!0})})},a.havePartition=function(e){a.props.dataSource.sourceList.forEach(function(t){t.id==e&&a.props.changeHavePart(7===t.type||10===t.type)})},a.onSourceTypeChange=function(e){var t=a.props,n=t.form,r=t.havePart,i=(t.editParams,{dataSourceId:e,rules:[],partition:void 0});a.havePartition(e),a.props.resetDataSourcesTable(),a.props.getDataSourcesTable({sourceId:e}),n.setFieldsValue({sourceTable:void 0}),r&&(a.props.resetDataSourcesPart(),n.setFieldsValue({partition:void 0,partitionInput:"column=${sys.recentPart}"})),a.setState({showPreview:!1,sourcePreview:{}}),a.props.changeParams(i)},a.onTableChange=function(e){var t=a.props,n=t.form,r=t.havePart,i=t.editParams,o={tableName:e,rules:[],partition:void 0};r&&(a.props.resetDataSourcesPart(),n.setFieldsValue({partition:void 0,partitionInput:"column=${sys.recentPart}"}),a.props.getDataSourcesPart({sourceId:i.dataSourceId,table:e})),a.setState({showPreview:!1,sourcePreview:{}}),a.props.changeParams(o)},a.onSourcePreview=function(){var e=a.props.editParams,t=e.dataSourceId,n=e.tableName,r=e.partition,i=a.state.showPreview;t&&n?(i||Fe.getDataSourcesPreview({sourceId:t,tableName:n,partition:r}).then(function(e){if(1===e.code){var t=e.data,n=t.columnList,r=t.dataList;e.data.dataList=r.map(function(e,t){var a={};return e.forEach(function(e,r){a.key=t,a[n[r]]=e}),a}),a.setState({sourcePreview:e.data})}}),a.setState({showPreview:!i})):zt.a.error("未选择数据源或表")},a.handlePartChange=function(e,t,n){var r=e?n.triggerNode.props.dataRef.partColumn:void 0;a.props.changeParams({partition:r})},a.handleInputPartChange=function(e){var t=e.target.value?e.target.value:void 0;a.props.changeParams({partition:t})},a.partHintText=function(){return s.a.createElement("p",{className:"font-14"},"支持填写系统参数，格式为：column=${sys.recentPart}，column为分区字段名，需要您根据情况修改，${sys.recentPart}为系统参数，系统每次执行时会对最新的1个分区的数据做校验。除此之外还支持${bdp.system.premonth}、${bdp.system.cyctime}、${bdp.system.bizdate}、${bdp.system.currmonth}")},a.next=function(){var e=a.props,t=e.currentStep,n=e.navToStep;e.form.validateFields({force:!0},function(e,r){e||a.checkMonitor().then(function(e){if(e){var r=rt.a.warning({title:"该规则配置已存在",content:s.a.createElement("span",null,"该规则配置已存在，您可以直接前往",s.a.createElement("a",{onClick:a.jumpToEditRule.bind(a,e)}," 编辑"))});a.modal=r}else n(t+1)})})},a.previewTableColumns=function(e){if(e)return e.map(function(e){return{title:e,key:e,dataIndex:e,width:8*e.length+28+"px",render:function(e){return s.a.createElement(Fa.a,{className:"no-scroll-bar",value:e||void 0,readOnly:!0,style:{minWidth:80,width:"100%",resize:"none"}})}}})},a.onSubscribeChange=function(e){var t=e.target.checked?1:0;a.props.changeParams({isSubscribe:t})},a.renderColumnPart=function(){var e=a.props,t=e.editParams,n=e.form,r=e.dataSource,i=e.useInput,o=t.partition,l=r.sourcePart,c=n.getFieldDecorator;return i?s.a.createElement(Va,F()({},ge,{label:"输入分区",extra:a.partHintText()}),c("partitionInput",{rules:[],initialValue:o||"column=${sys.recentPart}"})(s.a.createElement(gt.a,{style:{width:"85%",marginRight:15},placeholder:"手动输入分区的格式为：分区字段=分区值，如column=${sys.recentPart}",onChange:a.handleInputPartChange})),s.a.createElement("a",{onClick:a.onPartitionTypeChange},"选择已有分区")):s.a.createElement(Va,F()({},ge,{label:"选择分区"}),c("partition",{rules:[],initialValue:o})(s.a.createElement(ja.a,{allowClear:!0,showSearch:!0,placeholder:"分区列表",treeNodeLabelProp:"value",style:{width:"85%",marginRight:15},dropdownStyle:{maxHeight:400,overflow:"auto"},onChange:a.handlePartChange},a.renderTreeSelect(l))),s.a.createElement("a",{onClick:a.onPartitionTypeChange},"手动输入"))},a.onPartitionTypeChange=function(){var e=a.props.useInput;a.props.changeParams({partition:void 0}),a.props.changeUseInput(!e)},a.state={showPreview:!1,sourcePreview:{},loading:!1},a}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){this.props.getDataSourcesList()}},{key:"checkMonitor",value:function(){var e=this,t=this.props,a=t.editParams,n=t.havePart,r={tableName:a.tableName,dataSourceId:a.dataSourceId,partition:n?a.partition:void 0};return this.setState({loading:!0}),Zt.checkMonitor(r).then(function(t){if(e.setState({loading:!1}),t&&t.data)return t.data;if(1!=t.code)throw new Error(t.message);return null})}},{key:"jumpToEditRule",value:function(e,t){this.modal&&this.modal.destroy(),C.g.push({pathname:"/dq/rule",query:{tableName:e.tableName,tableId:e.tableId}})}},{key:"getScroll",value:function(){var e=100,t=this.state.sourcePreview&&this.state.sourcePreview.columnList;for(var a in t){e=e+8*t[a].length+28}return e+"px"}},{key:"render",value:function(){var e=this.props,t=e.form,a=e.editParams,n=e.dataSource,r=e.havePart,i=t.getFieldDecorator,o=a.dataSourceId,l=a.tableName,c=n.sourceList,u=n.sourceTable,d=n.tableLoading,m=this.state,p=m.showPreview,h=m.sourcePreview,f=m.loading;return s.a.createElement("div",null,s.a.createElement("div",{className:"steps-content"},s.a.createElement(Wt.a,null,s.a.createElement(Va,F()({},ge,{label:"选择数据源"}),i("sourceId",{rules:[{required:!0,message:"请选择数据源"}],initialValue:o?o.toString():o})(s.a.createElement(ht.a,{showSearch:!0,optionFilterProp:"title",style:{width:"85%",marginRight:15},onChange:this.onSourceTypeChange,disabled:d},this.renderSourceType(c)))),s.a.createElement(Va,F()({},ge,{label:"选择数据表"}),i("sourceTable",{rules:[{required:!0,message:"请选择数据表"}],initialValue:l})(s.a.createElement(ht.a,{mode:"combobox",showSearch:!0,style:{width:"85%",marginRight:15},onChange:this.onTableChange},this.renderSourceTable(u))),l&&s.a.createElement(at.a,{checked:!0,onChange:this.onSubscribeChange},"订阅")),r&&this.renderColumnPart(),s.a.createElement("div",{className:"txt-center font-14"},s.a.createElement("a",{onClick:this.onSourcePreview},"数据预览",s.a.createElement(st.a,{type:"down",style:{marginLeft:5}}))),p&&s.a.createElement(H.a,{rowKey:"key",className:"m-table m-cells preview-table",columns:this.previewTableColumns(h.columnList),dataSource:h.dataList,pagination:!1,scroll:{x:this.getScroll()}}))),s.a.createElement("div",{className:"steps-action"},s.a.createElement(Gt.a,null,s.a.createElement(C.c,{to:"/dq/rule"},"取消")),s.a.createElement(Gt.a,{loading:f,className:"m-l-8",type:"primary",onClick:this.next},"下一步")))}}]),t}(l.Component))||wa;Ha=Wt.a.create()(Ha);var za,qa=Wt.a.Item,Ya=ht.a.Option,Ka=gt.a.TextArea,Ba=Object(k.b)(function(e){return{ruleConfig:e.ruleConfig,common:e.common}},function(e){return{getRuleFunction:function(t){e(oa(t))},getTableColumn:function(t){e(la(t))}}})(Da=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.prev=function(){var e=a.props,t=e.currentStep,n=e.navToStep,r=a.state.currentRule;Object(yt.isEmpty)(r)?n(t-1):(a.cancel(r.id),n(t-1))},a.next=function(){var e=a.props,t=e.currentStep,n=e.navToStep,r=e.editParams,i=a.state.currentRule;r.rules.length?Object(yt.isEmpty)(i)?n(t+1):a.save(i.id,function(){n(t+1)}):zt.a.error("请添加监控规则")},a.initColumns=function(){return[{title:"字段/数据表",dataIndex:"columnName",key:"columnName",render:function(e,t){return a.renderColumns(e,t,"columnName")},width:"15%"},{title:"统计函数",dataIndex:"functionId",key:"functionId",render:function(e,t){return a.renderColumns(e,t,"functionId")},width:"15%"},{title:"过滤条件",dataIndex:"filter",key:"filter",render:function(e,t){return a.renderColumns(e,t,"filter")},width:"25%"},{title:"校验方法",dataIndex:"verifyType",key:"verifyType",render:function(e,t){return a.renderColumns(e,t,"verifyType")},width:"15%"},{title:"阈值配置（不符合阈值条件时触发告警）",dataIndex:"threshold",key:"threshold",render:function(e,t){return a.renderColumns(e,t,"threshold")},width:"20%"},{title:"操作",width:"10%",render:function(e,t){var n=t.editable;return s.a.createElement("div",null,n?s.a.createElement("span",null,s.a.createElement("a",{className:"m-r-8",onClick:function(){return a.save(t.id)}},"保存"),s.a.createElement("a",{onClick:function(){return a.cancel(t.id)}},"取消")):s.a.createElement("span",null,s.a.createElement("a",{className:"m-r-8",onClick:function(){return a.edit(t.id)}},"编辑"),s.a.createElement(Bt.a,{title:"确定要删除吗？",onConfirm:function(){return a.delete(t.id)}},s.a.createElement("a",null,"删除"))))}}]},a.changeRuleParams=function(e,t){var n={};n[e]=t.target?t.target.value:t,a.setState({currentRule:F()({},a.state.currentRule,n)})},a.onColumnNameChange=function(e){var t=a.state.currentRule,n=a.props,r=n.form,i=n.ruleConfig,o=i.tableColumn,l=i.monitorFunction[o.filter(function(t){return t.key===e})[0].type],s={};s["functionId@"+t.id]=void 0,r.setFieldsValue(s),a.setState({functionList:l,currentRule:F()({},t,{columnName:e,functionId:void 0})})},a.onFunctionChange=function(e){var t=a.props.form,n=a.state,r=n.functionList,i=n.currentRule,o=r.filter(function(t){return t.id==e})[0].isPercent,l=r.filter(function(t){return t.id==e})[0].nameZc,s="枚举值"===l,c=F()({},a.state.currentRule,{functionId:e,functionName:l,verifyType:s?"1":void 0,operator:s?"in":void 0,isPercentage:o,percentType:1===o?"limit":"free"}),u={};u["verifyType@"+i.id]=s?"1":void 0,u["operator@"+i.id]=void 0,t.setFieldsValue(u),a.setState({currentRule:c})},a.onVerifyTypeChange=function(e){var t=a.props.common.allDict.verifyType,n=F()({},a.state.currentRule,{verifyType:e,verifyTypeValue:t.filter(function(t){return t.value==e})[0].name});"limit"!==n.percentType&&(n.isPercentage=1==e?0:1),a.setState({currentRule:n})},a.renderEditTD=function(e,t,n){var r,i=a.props,o=i.form,l=i.common,c=i.ruleConfig,u=o.getFieldDecorator,d=c.tableColumn,m=l.allDict.verifyType,p=a.state,h=p.currentRule,f=p.functionList,g="字符串最大长度"===(r=h.functionName)||"字符串最小长度"===r?pe:me;switch(n){case"columnName":return t.isCustomizeSql?s.a.createElement(qa,F()({},ye,{className:"rule-edit-td cell-center"}),u("customizeSql@"+t.id,{rules:[{required:!0,message:"自定义SQL不可为空"}],initialValue:t.customizeSql})(t.isCustomizeSql?s.a.createElement(Ka,{style:{resize:"vertical"},autosize:{minRows:3,maxRows:8},placeholder:"查询结果为一个数值类型",onChange:a.changeRuleParams.bind(a,"customizeSql")}):s.a.createElement(gt.a,{placeholder:"查询结果为一个数值类型",onChange:a.changeRuleParams.bind(a,"customizeSql"),disabled:"edit"===t.editStatus}))):s.a.createElement(qa,F()({},ye,{className:"rule-edit-td cell-center"}),u("columnName@"+t.id,{rules:[{required:!0,message:"字段不可为空"}],initialValue:t.columnName})(s.a.createElement(ht.a,{showSearch:!0,onChange:a.onColumnNameChange,disabled:t.isTable},d.map(function(e){return s.a.createElement(Ya,{key:e.key,value:e.key},e.key)}))));case"functionId":return s.a.createElement(qa,F()({},ye,{className:"rule-edit-td cell-center"}),u("functionId@"+t.id,{rules:[{required:!0,message:"统计函数不可为空"}],initialValue:t.functionId})(s.a.createElement(ht.a,{onChange:a.onFunctionChange},f.map(function(e){return s.a.createElement(Ya,{key:e.id,value:e.id.toString()},e.nameZc)}))));case"filter":return s.a.createElement(qa,F()({},ye,{className:"rule-edit-td cell-center"}),u("filter@"+t.id,{rules:[],initialValue:t.filter})(s.a.createElement(gt.a,{placeholder:'以"and"开头的条件语句，例：and colA = "value"',onChange:a.changeRuleParams.bind(a,"filter")})));case"verifyType":return s.a.createElement(qa,F()({},ye,{className:"rule-edit-td cell-center"}),u("verifyType@"+t.id,{rules:[{required:!0,message:"校验方法不可为空"}],initialValue:t.verifyType})(s.a.createElement(ht.a,{onChange:a.onVerifyTypeChange,disabled:"in"===h.operator},m.map(function(e){return s.a.createElement(Ya,{key:e.value,value:e.value.toString()},e.name)}))));case"threshold":return"in"===h.operator?s.a.createElement(qa,F()({},ye,{className:"rule-edit-td cell-center"}),u("thresholdEnum@"+t.id,{rules:[{required:!0,message:"范围不可为空"}],initialValue:t.threshold})(s.a.createElement(gt.a,{placeholder:"枚举格式为(value1,value2,.....)",onChange:a.changeRuleParams.bind(a,"threshold")}))):s.a.createElement("div",{className:"cell-center-box"},s.a.createElement(qa,{className:"cell-multiple-center"},u("operator@"+t.id,{rules:[{required:!0,message:"设置不可为空"}],initialValue:t.operator})(s.a.createElement(ht.a,{style:{width:80},onChange:a.changeRuleParams.bind(a,"operator")},g.map(function(e){return s.a.createElement(Ya,{key:e.value,value:e.value},e.text)})))),s.a.createElement(qa,{className:"cell-multiple-center"},u("threshold@"+t.id,{rules:[{required:!0,message:"阈值不可为空"}],initialValue:t.threshold})(s.a.createElement(Yt.a,{style:{width:80,marginRight:10},onChange:a.changeRuleParams.bind(a,"threshold")}))),1===h.isPercentage&&s.a.createElement("span",{style:{height:32,lineHeight:"32px"}},"%"))}},a.renderTD=function(e,t,a){switch(a){case"columnName":return t.isCustomizeSql?t.customizeSql:e;case"functionId":return t.functionName;case"verifyType":return t.verifyTypeValue;case"threshold":var n=(t.operator?t.operator:"")+"  "+e;return t.isPercentage?n+" %":n;default:return e}},a.addNewRuleWrap=function(e){var t=a.state.currentRule;Object(yt.isEmpty)(t)?a.addNewRule(e):a.save(t.id,function(){a.addNewRule(e)})},a.addNewRule=function(e){var t=a.props,n=t.form,r=t.editParams,i=t.ruleConfig.monitorFunction,o=a.state.currentRule,l=[].concat(wt()(r.rules));Object(yt.isEmpty)(o)||("edit"===o.editStatus?(delete o.editable,delete o.editStatus):(l.shift(),n.resetFields(),a.setState({currentRule:{},functionList:[]})));var s={id:l[0]?l[0].id+1:1,editStatus:"new",editable:!0,filter:"",verifyType:void 0,operator:void 0,threshold:void 0};switch(e){case"column":s.isCustomizeSql=!1,s.columnName=void 0,s.functionId=void 0;break;case"SQL":s.isCustomizeSql=!0,s.customizeSql=void 0;break;case"table":s.isTable=!0,s.isCustomizeSql=!1,s.columnName=r.tableName,s.functionId=void 0,a.setState({functionList:i.all.filter(function(e){return 1===e.level})})}l.unshift(s),a.setState({currentRule:s}),a.props.changeParams({rules:l})},a.state={currentRule:{},functionList:[],enumFields:["columnName","functionId","thresholdEnum"],SQLFields:["customizeSql","verifyType","operator","threshold"],columnFields:["columnName","functionId","verifyType","operator","threshold"]},a}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){var e=this.props.editParams;this.props.getRuleFunction(),this.props.getTableColumn({sourceId:e.dataSourceId,tableName:e.tableName})}},{key:"renderColumns",value:function(e,t,a){var n={children:s.a.createElement(Wt.a,{layout:"inline"},t.editable?this.renderEditTD(e,t,a):this.renderTD(e,t,a)),props:{}};if(t.isCustomizeSql)switch(a){case"columnName":n.props.colSpan=3;break;case"functionId":case"filter":n.props.colSpan=0}return n}},{key:"edit",value:function(e){var t=this.state.currentRule,a=this.props.ruleConfig,n=a.monitorFunction,r=a.tableColumn,i=[],o=[].concat(wt()(this.props.editParams.rules)),l=o.filter(function(t){return e===t.id})[0];if(!Object(yt.isEmpty)(t)){var s=o.filter(function(e){return t.id===e.id})[0];"edit"===s.editStatus?(delete s.editable,delete s.editStatus):o.shift()}if(l){if(l.editable=!0,l.editStatus="edit",!l.isCustomizeSql)if(l.isTable)i=n.all.filter(function(e){return 1===e.level});else i=n[r.filter(function(e){return e.key===l.columnName})[0].type];this.setState({currentRule:l,functionList:i}),this.props.changeParams({rules:o})}}},{key:"cancel",value:function(e){var t=[].concat(wt()(this.props.editParams.rules)),a=t.filter(function(t){return e===t.id})[0],n=t.indexOf(a);"edit"===a.editStatus?(delete a.editable,delete a.editStatus):t.splice(n,1),this.setState({currentRule:{}}),this.props.changeParams({rules:t})}},{key:"delete",value:function(e){var t=[].concat(wt()(this.props.editParams.rules)),a=t.filter(function(t){return e===t.id})[0],n=t.indexOf(a);a&&(t.splice(n,1),this.props.changeParams({rules:t}))}},{key:"checkRepeat",value:function(){for(var e=this.state.currentRule,t=[].concat(wt()(this.props.editParams.rules)),a=["columnName","filter","functionId","verifyType","customizeSql","operator"],n=!0,r=0;r<t.length;r++){var i=t[r],o=!1;if(i.id!=e.id){for(var l=0;l<a.length;l++){var s=a[l];if(e[s]!=i[s]){o=!0;break}}if(!o){n=!1;break}}}return n}},{key:"save",value:function(e,t){var a=this,n=this.state,r=n.currentRule,i=n.enumFields,o=n.SQLFields,l=n.columnFields,s=[].concat(wt()(this.props.editParams.rules)),c=s.filter(function(t){return e===t.id})[0],u=s.indexOf(c);r.isCustomizeSql;r.operator,this.checkRepeat()?this.props.form.validateFields(null,{force:!0},function(e,n){e||(delete r.editStatus,delete r.editable,s[u]=r,a.setState({currentRule:{}},function(){t&&t()}),a.props.changeParams({rules:s}))}):zt.a.error("规则不能重复！")}},{key:"render",value:function(){var e=this.props.editParams.rules;return s.a.createElement("div",null,s.a.createElement("div",{className:"steps-content"},s.a.createElement("div",{className:"rule-action"},s.a.createElement(Gt.a,{type:"primary",onClick:this.addNewRuleWrap.bind(this,"table")},"添加表级规则"),s.a.createElement(Gt.a,{type:"primary",className:"m-l-8",onClick:this.addNewRuleWrap.bind(this,"column")},"添加字段级规则"),s.a.createElement(Gt.a,{type:"primary",className:"m-l-8",onClick:this.addNewRuleWrap.bind(this,"SQL")},"添加自定义SQL")),s.a.createElement(H.a,{rowKey:"id",className:"m-table rule-edit-table",style:{margin:"0 20px"},columns:this.initColumns(),pagination:!1,dataSource:e,onChange:this.onTableChange})),s.a.createElement("div",{className:"steps-action"},s.a.createElement(Gt.a,{onClick:this.prev},"上一步"),s.a.createElement(Gt.a,{className:"m-l-8",type:"primary",onClick:this.next},"下一步")))}}]),t}(l.Component))||Da;Ba=Wt.a.create()(Ba);var Qa=Wt.a.Item,Wa=ht.a.Option,Ja={beginDate:ee()().format("YYYY-MM-DD"),endDate:ee()().add(100,"years").format("YYYY-MM-DD"),periodType:"2",day:void 0,weekDay:void 0,hour:0,min:0,beginHour:0,beginMin:0,gapHour:void 0,endHour:0,endMin:0},Xa=Object(k.b)(function(e){return{common:e.common}},function(e){return{addMonitor:function(t){e(sa(t))}}})(za=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.initState=function(){var e=a.props.editParams.scheduleConf;e&&a.setState({scheduleConfObj:JSON.parse(e)})},a.resetScheduleConf=function(e){var t=F()({},Ja,{periodType:e});a.setState({scheduleConfObj:t}),a.props.changeParams({scheduleConf:Xt()(t)})},a.renderPeriodType=function(e){return e.map(function(e){return s.a.createElement(Wa,{key:e.value,value:e.value.toString()},e.name)})},a.onPeriodTypeChange=function(e){a.resetScheduleConf(e)},a.renderSendTypeList=function(e){return e&&e.map(function(e){return s.a.createElement(at.a,{key:e.value,value:e.value.toString()},e.name)})},a.onSendTypeChange=function(e){var t=a.props.form,n=t.getFieldValue("notifyUser");0===e.length&&0===n.length&&t.setFieldsValue({notifyUser:[]}),a.props.changeParams({sendTypes:e})},a.renderUserList=function(e){return e.map(function(e){return s.a.createElement(Wa,{key:e.id,value:e.id.toString()},e.userName)})},a.onNotifyUserChange=function(e){var t=a.props.form,n=t.getFieldValue("sendTypes");0===e.length&&0===n.length&&t.setFieldsValue({sendTypes:[]}),a.props.changeParams({notifyUser:e})},a.changeScheduleConfTime=function(e,t){var n=a.state.scheduleConfObj,r={};r[e]=t;var i=F()({},n,r);a.setState({scheduleConfObj:i}),a.props.changeParams({scheduleConf:Xt()(i)})},a.onBeginDateChange=function(e,t){a.changeScheduleConfTime("beginDate",t)},a.onEndDateChange=function(e,t){a.changeScheduleConfTime("endDate",t)},a.onWebHookChange=function(e){a.props.changeParams({webhook:e.target.value})},a.checkTime=function(e,t,n){var r=a.props.form,i=r.getFieldValue("beginHour"),o=r.getFieldValue("beginMin"),l=r.getFieldValue("endHour"),s=r.getFieldValue("endMin");60*parseInt(i)+parseInt(o)>=60*parseInt(l)+parseInt(s)?n("开始时间不能晚于结束时间"):r.setFieldsValue({beginHour:i,beginMin:o,endHour:l,endMin:s}),n()},a.checkDate=function(e,t,n){var r=a.props.form,i=r.getFieldValue("beginDate"),o=r.getFieldValue("endDate");i&&o?i.valueOf()>o.valueOf()?n("生效日期的开始时间不能晚于结束时间"):r.setFieldsValue({beginDate:i,endDate:o}):n(),n()},a.prev=function(){var e=a.props,t=e.currentStep;(0,e.navToStep)(t-1)},a.save=function(){var e=a.props,t=e.form,n=e.editParams,r=e.havePart;t.validateFields(function(e,t){e&&e.endDate&&zt.a.error(e.endDate.errors[0].message),e||(n.rules.forEach(function(e){delete e.id,delete e.isTable,delete e.percentType,delete e.functionName,delete e.verifyTypeValue}),r||(n.partition=void 0),a.props.addMonitor(F()({},n)),setTimeout(function(){C.g.push("/dq/rule")},1e3))})},a.state={scheduleConfObj:Ja},a}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){this.initState()}},{key:"renderDynamic",value:function(){var e=this,t=this.props,a=t.form,n=t.common.allDict,r=a.getFieldDecorator,i=this.state.scheduleConfObj,o=(n.periodType&&n.periodType,function(t){for(var a=[],n=0;n<=23;n++)a.push(s.a.createElement(Wa,{key:n,value:""+n},n<10?"0"+n:n));return s.a.createElement(ht.a,{style:{width:200},onChange:e.changeScheduleConfTime.bind(e,t)},a)}),l=function(t){for(var a=[],n=0;n<=59;n++)a.push(s.a.createElement(Wa,{key:n,value:""+n},n<10?"0"+n:n));return s.a.createElement(ht.a,{style:{width:200},onChange:e.changeScheduleConfTime.bind(e,t)},a)};switch(i.periodType){case"1":return s.a.createElement("div",null,s.a.createElement(Qa,F()({},ve,{label:"开始时间"}),r("beginHour",{rules:[{required:!0,message:"开始时间不能为空"},{validator:this.checkTime.bind(this)}],initialValue:""+i.beginHour})(o("beginHour")),s.a.createElement("span",{className:"m-8"},"时"),r("beginMin",{rules:[{required:!0,message:"开始时间不能为空"},{validator:this.checkTime.bind(this)}],initialValue:""+i.beginMin})(l("beginMin")),s.a.createElement("span",{className:"m-8"},"分")),s.a.createElement(Qa,F()({},ve,{label:"间隔时间"}),r("gapHour",{rules:[{required:!0,message:"间隔时间不能为空"}],initialValue:i.gapHour?i.gapHour:""})(function(){for(var t=[],a=1;a<=23;a++)t.push(s.a.createElement(Wa,{key:a,value:""+a},a,"小时"));return s.a.createElement(ht.a,{style:{width:200},onChange:e.changeScheduleConfTime.bind(e,"gapHour")},t)}())),s.a.createElement(Qa,F()({},ve,{label:"结束时间"}),r("endHour",{rules:[{required:!0,message:"结束时间不能为空"},{validator:this.checkTime.bind(this)}],initialValue:""+i.endHour})(o("endHour")),s.a.createElement("span",{className:"m-8"},"时"),r("endMin",{rules:[{required:!0,message:"结束时间不能为空"},{validator:this.checkTime.bind(this)}],initialValue:""+i.endMin})(l("endMin")),s.a.createElement("span",{className:"m-8"},"分")));case"2":return s.a.createElement(Qa,F()({},ve,{label:"起调时间"}),r("hour",{rules:[{required:!0}],initialValue:""+i.hour})(o("hour")),s.a.createElement("span",{className:"m-8"},"时"),r("min",{rules:[{required:!0}],initialValue:""+i.min})(l("min")),s.a.createElement("span",{className:"m-8"},"分"));case"3":return s.a.createElement("div",null,s.a.createElement(Qa,F()({},ve,{label:"选择时间"}),r("weekDay",{rules:[{required:!0,message:"周内天数不能为空"}],initialValue:i.weekDay?i.weekDay:[]})(s.a.createElement(ht.a,{mode:"multiple",style:{width:428},onChange:e.changeScheduleConfTime.bind(e,"weekDay")},s.a.createElement(Wa,{key:1,value:"1"},"星期一"),s.a.createElement(Wa,{key:2,value:"2"},"星期二"),s.a.createElement(Wa,{key:3,value:"3"},"星期三"),s.a.createElement(Wa,{key:4,value:"4"},"星期四"),s.a.createElement(Wa,{key:5,value:"5"},"星期五"),s.a.createElement(Wa,{key:6,value:"6"},"星期六"),s.a.createElement(Wa,{key:7,value:"7"},"星期天")))),s.a.createElement(Qa,F()({},ve,{label:"起调时间"}),r("hour1",{rules:[{required:!0}],initialValue:""+i.hour})(o("hour")),s.a.createElement("span",{className:"m-8"},"时"),r("min1",{rules:[{required:!0}],initialValue:""+i.min})(l("min")),s.a.createElement("span",{className:"m-8"},"分")));case"4":return s.a.createElement("div",null,s.a.createElement(Qa,F()({},ve,{label:"选择时间"}),r("day",{rules:[{required:!0,message:"月内天数不能为空"}],initialValue:i.day?i.day:[]})(function(){for(var t=[],a=1;a<=31;a++)t.push(s.a.createElement(Wa,{key:a,value:""+a},"每月"+a+"号"));return s.a.createElement(ht.a,{mode:"multiple",style:{width:428},onChange:e.changeScheduleConfTime.bind(e,"day")},t)}())),s.a.createElement(Qa,F()({},ve,{label:"起调时间"}),r("hour2",{rules:[{required:!0}],initialValue:""+i.hour})(o("hour")),s.a.createElement("span",{className:"m-8"},"时"),r("min2",{rules:[{required:!0}],initialValue:""+i.min})(l("min")),s.a.createElement("span",{className:"m-8"},"分")))}}},{key:"render",value:function(){var e=this.props,t=e.form,a=e.common,n=e.editParams,r=t.getFieldDecorator,i=a.allDict,o=a.userList,l=n.notifyUser,c=n.sendTypes,u=n.webhook,d=this.state.scheduleConfObj,m=i.periodType?i.periodType:[],p=i.notifyType?i.notifyType:[],h=c?c.map(function(e){return e.toString()}):[],f=h.indexOf(ie)>-1;return s.a.createElement("div",null,s.a.createElement("div",{className:"steps-content"},s.a.createElement(Wt.a,null,s.a.createElement(Qa,F()({},ve,{label:"调度周期"}),r("periodType",{rules:[{required:!0,message:"执行周期不能为空"}],initialValue:""+d.periodType})(s.a.createElement(ht.a,{onChange:this.onPeriodTypeChange},this.renderPeriodType(m)))),5!=d.periodType&&s.a.createElement(Qa,F()({},ve,{label:"生效日期"}),r("beginDate",{rules:[{required:!0,message:"生效日期不能为空"},{validator:this.checkDate.bind(this)}],initialValue:ee()(d.beginDate)})(s.a.createElement(ut.a,{style:{width:200},format:"YYYY-MM-DD",placeholder:"开始日期",onChange:this.onBeginDateChange})),s.a.createElement("span",{className:"m-8"},"到"),r("endDate",{rules:[{required:!0,message:"生效日期不能为空"},{validator:this.checkDate.bind(this)}],initialValue:ee()(d.endDate)})(s.a.createElement(ut.a,{style:{width:200},format:"YYYY-MM-DD",placeholder:"结束日期",onChange:this.onEndDateChange}))),this.renderDynamic(),s.a.createElement(Qa,F()({},ve,{label:"告警方式"}),r("sendTypes",{rules:[{required:l.length,message:"选择告警方式"}],initialValue:h})(s.a.createElement(at.a.Group,{onChange:this.onSendTypeChange},this.renderSendTypeList(p)))),f&&s.a.createElement(Qa,F()({},ve,{label:"webhook"}),r("webhook",{rules:[{required:!0,message:"webhook不能为空"}],initialValue:u||""})(s.a.createElement(gt.a,{onChange:this.onWebHookChange}))),s.a.createElement(Qa,F()({},ve,{label:"告警接收人"}),r("notifyUser",{rules:[{required:c.length,message:"选择告警接收人"}],initialValue:l.map(function(e){return e.toString()})})(s.a.createElement(ht.a,{allowClear:!0,mode:"multiple",onChange:this.onNotifyUserChange},this.renderUserList(o)))))),s.a.createElement("div",{className:"steps-action"},s.a.createElement(Gt.a,{onClick:this.prev},"上一步"),s.a.createElement(Gt.a,{className:"m-l-8",type:"primary",onClick:this.save},"新建")))}}]),t}(l.Component))||za;Xa=Wt.a.create()(Xa);var Za,$a,en,tn=a("ER3F"),an=Aa.a.Step,nn=function(e){function t(){var e,a,n,r;g()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=S()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(o))),n.state={current:0,editParams:{dataSourceId:void 0,tableName:void 0,partition:"column=${sys.recentPart}",isSubscribe:1,scheduleConf:"",sendTypes:[],webhook:"",notifyUser:[],rules:[]},havePart:!1,useInput:!0},n.changeParams=function(e){var t=F()({},n.state.editParams,e);n.setState({editParams:t})},n.changeHavePart=function(e){n.setState({havePart:e})},n.changeUseInput=function(e){n.setState({useInput:e})},n.navToStep=function(e){n.setState({current:e})},r=a,S()(n,r)}return T()(t,e),E()(t,[{key:"render",value:function(){var e=this.state,t=e.current,a=e.editParams,n=e.havePart,r=e.useInput,i=[{title:"监控对象",content:s.a.createElement(Ha,{currentStep:t,navToStep:this.navToStep,havePart:n,useInput:r,editParams:a,changeParams:this.changeParams,changeHavePart:this.changeHavePart,changeUseInput:this.changeUseInput})},{title:"监控规则",content:s.a.createElement(Ba,{currentStep:t,navToStep:this.navToStep,editParams:a,changeParams:this.changeParams})},{title:"调度属性",content:s.a.createElement(Xa,{currentStep:t,havePart:n,navToStep:this.navToStep,editParams:a,changeParams:this.changeParams})}];return s.a.createElement("div",{className:"box-1 rule-edit"},s.a.createElement("h1",{className:"box-title"},s.a.createElement(tn.a,null),s.a.createElement("span",{className:"m-l-8"},"新建质量监控")),s.a.createElement("div",{className:"steps-container"},s.a.createElement(Aa.a,{current:t},i.map(function(e){return s.a.createElement(an,{key:e.title,title:e.title})})),i[t].content))}}]),t}(l.Component),rn=(a("G851"),a("ZvzK")),on=a.n(rn),ln=(a("PFYH"),a("Jv8k")),sn=a.n(ln),cn=a("YXul"),un={getLists:function(e){return Te.a.post(Ce.a.GET_CHECK_LIST,e)},getCheckDetail:function(e){return Te.a.post(Ce.a.GET_CHECK_DETAIL,e)},addCheck:function(e){return Te.a.post(Ce.a.ADD_CHECK,e)},updateCheck:function(e){return Te.a.post(Ce.a.UPDATE_CHECK,e)},deleteCheck:function(e){return Te.a.post(Ce.a.DELETE_CHECK,e)},getCheckReport:function(e){return Te.a.post(Ce.a.GET_CHECK_REPORT,e)},getCheckReportTable:function(e){return Te.a.post(Ce.a.GET_CHECK_REPORT_TABLE,e)},updateTaskParams:function(e){return Te.a.post(Ce.a.UPDATE_CHECK_ENV_PARAMS,e)}},dn=function(e){return function(t){t({type:cn.a.CHANGE_LOADING}),un.getLists(e).then(function(e){1===e.code&&t({type:cn.a.GET_LIST,payload:e.data}),t({type:cn.a.CHANGE_LOADING})})}},mn=function(e,t){return function(a){Fe.getDataSourcesPart(e).then(function(e){1===e.code&&a({type:cn.a.GET_SOURCE_PART,payload:{data:e.data?e.data:[],type:t}})})}},pn=function(e){return function(t){t({type:cn.a.RESET_SOURCE_PART,payload:e})}},hn=(a("WyGn"),gt.a.Search),fn=ht.a.Option,gn=Object(k.b)(function(e){return{dataCheck:e.dataCheck,dataSource:e.dataSource,common:e.common}},function(e){return{getLists:function(t){e(dn(t))},getDataSourcesList:function(t){e(Ge(t))}}})(Za=function(e){function t(){var e,a,n,r;g()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=S()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(o))),n.state={params:{currentPage:1,pageSize:20,tableName:void 0,lastModifyUserId:void 0,executeTime:void 0,visibleEnvModal:!1,selectedRecord:""}},n.initColumns=function(){return[{title:"左侧表",dataIndex:"originTableName",key:"originTableName",width:"11%"},{title:"分区",dataIndex:"originPartition",key:"originPartition",width:"11%",render:function(e,t){return e||"--"}},{title:"右侧表",dataIndex:"targetTableName",key:"targetTableName",width:"11%"},{title:"分区",dataIndex:"targetPartition",key:"targetPartition",width:"11%",render:function(e,t){return e||"--"}},{title:"类型",dataIndex:"sourceTypeName",key:"sourceTypeName",width:"11%",render:function(e,t){return e||"--"}},{title:s.a.createElement("span",null,"校验结果",s.a.createElement(ot.a,{placement:"bottom",overlayClassName:"m-tooltip",title:s.a.createElement("div",null,s.a.createElement("p",null,"以下条件同时满足计为校验通过："),s.a.createElement("p",null,"1、逻辑主键匹配，但数据不匹配=0"),s.a.createElement("p",null,"2、max（左表数据在右表未找到，右表数据在左表未找到）<（右表记录数*记录数差异比例配置）"))},s.a.createElement(st.a,{className:"font-12 m-l-8",type:"question-circle-o"}))),dataIndex:"status",key:"status",width:"10%",render:function(e,t){return 3==e?s.a.createElement("span",null,s.a.createElement(Ct,{style:{flexBasis:"60%"},value:e})," ",s.a.createElement(ot.a,{placement:"right",title:t.report,overlayClassName:"m-tooltip"},s.a.createElement(st.a,{className:"font-14",type:"info-circle-o"}))):s.a.createElement(Ct,{value:e})}},{title:s.a.createElement("div",null,"差异总数",s.a.createElement(ot.a,{placement:"bottom",overlayClassName:"m-tooltip",title:"差异总数 = 逻辑主键匹配但数据不匹配 + 左表数据在右表未找到 + 右表数据在左表未找到"},s.a.createElement(st.a,{className:"font-12 m-l-8",type:"question-circle-o"}))),dataIndex:"diverseNum",key:"diverseNum",width:"8%"},{title:s.a.createElement("div",null,"差异比例",s.a.createElement(ot.a,{placement:"bottom",overlayClassName:"m-tooltip",title:"统计左右2表的记录数最大值，统计整体匹配条数，整体匹配条数/记录数最大值为匹配率，差异比例=1-匹配率"},s.a.createElement(st.a,{className:"font-12 m-l-8",type:"question-circle-o"}))),dataIndex:"diverseRatio",key:"diverseRatio",width:"8%",render:function(e){return e?e+" %":e}},{title:"最近修改人",dataIndex:"modifyUserName",key:"modifyUserName",width:"11%"},{title:"执行时间",dataIndex:"executeTimeFormat",key:"executeTimeFormat",render:function(e,t){return e||"--"},width:"11%"},{title:"操作",width:"8%",render:function(e,t){var a=s.a.createElement(sn.a,null,n.enableCheckReport(t.status)&&s.a.createElement(sn.a.Item,null,s.a.createElement(C.c,{to:"dq/dataCheck/report/"+t.id},"查看报告")),s.a.createElement(sn.a.Item,null,s.a.createElement(C.c,{to:"dq/dataCheck/edit/"+t.verifyId},"再次运行")),t.dataSourceType===se.HIVE&&s.a.createElement(sn.a.Item,null,s.a.createElement("a",{onClick:function(){n.setState({selectedRecord:t,visibleEnvModal:!0})}},"环境参数")));return s.a.createElement(on.a,{overlay:a,trigger:["click"]},s.a.createElement(Gt.a,null,"操作",s.a.createElement(st.a,{type:"down"})))}}]},n.enableCheckReport=function(e){return e===ce.SUCCESS||e===ce.PASS||e===ce.UNPASS||e===ce.EXPIRED},n.deleteDataCheck=function(e){un.deleteCheck({verifyRecordId:e}).then(function(e){1===e.code&&(zt.a.success("删除成功！"),n.props.getLists(n.state.params))})},n.updateEnvParams=function(e){if(e){var t=n.state.selectedRecord;un.updateTaskParams({verifyId:t.verifyId,taskParams:e}).then(function(e){1===e.code&&(zt.a.success("修改环境参数成功"),n.setState({visibleEnvModal:!1,selectedRecord:""}),n.props.getLists(n.state.params))})}else zt.a.error("环境参数为空！")},n.onTableChange=function(e,t,a){var r=F()({},n.state.params,{currentPage:e.current});n.props.getLists(r),n.setState({params:r})},n.renderUserSource=function(e){return e.map(function(e){var t=e.dataName+"（"+e.sourceTypeValue+"）";return s.a.createElement(fn,{key:e.id,value:e.id.toString(),title:t},t)})},n.onUserSourceChange=function(e){var t=F()({},n.state.params,{currentPage:1,dataSourceId:e||void 0});n.props.getLists(t),n.setState({params:t})},n.renderCheckStatus=function(e){return e.map(function(e){return s.a.createElement(fn,{key:e.value,value:e.value,title:e.text},e.text)})},n.onCheckStatusChange=function(e){var t=F()({},n.state.params,{currentPage:1,status:e||void 0});n.props.getLists(t),n.setState({params:t})},n.renderUserList=function(e){return e.map(function(e){return s.a.createElement(fn,{key:e.id,value:e.id.toString(),name:e.userName},e.userName)})},n.onUserChange=function(e){var t=F()({},n.state.params,{currentPage:1,lastModifyUserId:e||void 0});n.props.getLists(t),n.setState({params:t})},n.onDateChange=function(e,t){var a=F()({},n.state.params,{currentPage:1,executeTime:e?e.valueOf():void 0});n.props.getLists(a),n.setState({params:a})},n.onTableSearch=function(e){var t=F()({},n.state.params,{currentPage:1,tableName:e||void 0});n.props.getLists(t),n.setState({params:t})},n.disabledDate=function(e){return e&&e.valueOf()>Date.now()},r=a,S()(n,r)}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){this.props.getDataSourcesList(),this.props.getLists(this.state.params)}},{key:"render",value:function(){var e=this,t=this.props,a=t.dataCheck,n=t.dataSource,r=t.common.userList,i=n.sourceList,o=a.lists,l=a.loading,c=this.state,u=c.params,d=c.visibleEnvModal,m=c.selectedRecord,p={current:u.currentPage,pageSize:u.pageSize,total:o.totalCount},h=s.a.createElement("div",{className:"flex font-12"},s.a.createElement(hn,{placeholder:"输入表名搜索",onSearch:this.onTableSearch,style:{width:200,margin:"10px 0"}}),s.a.createElement("div",{className:"m-l-8"},"数据源：",s.a.createElement(ht.a,{allowClear:!0,showSearch:!0,style:{width:150},optionFilterProp:"title",placeholder:"选择数据源类型",onChange:this.onUserSourceChange},this.renderUserSource(i))),s.a.createElement("div",{className:"m-l-8"},"校验结果：",s.a.createElement(ht.a,{allowClear:!0,style:{width:150},placeholder:"选择校验结果",onChange:this.onCheckStatusChange},this.renderCheckStatus(ue))),s.a.createElement("div",{className:"m-l-8"},"最近修改人：",s.a.createElement(ht.a,{allowClear:!0,showSearch:!0,style:{width:150},optionFilterProp:"name",placeholder:"选择最近修改人",onChange:this.onUserChange},this.renderUserList(r))),s.a.createElement("div",{className:"m-l-8"},"执行时间：",s.a.createElement(ut.a,{format:"YYYY-MM-DD",style:{width:150},placeholder:"选择日期",onChange:this.onDateChange,disabledDate:this.disabledDate})),s.a.createElement("div",{className:"m-l-8"},s.a.createElement(ot.a,{title:"刷新数据"},s.a.createElement(st.a,{type:"sync",onClick:function(){e.props.getLists(u)},style:{cursor:"pointer",marginTop:"18px",color:"#94A8C6"}})))),f=s.a.createElement(Gt.a,{type:"primary",style:{margin:"10px 0"}},s.a.createElement(C.c,{to:"/dq/dataCheck/add"},"新建逐行校验"));return s.a.createElement("div",{className:"check-dashboard"},s.a.createElement("h1",{className:"box-title"},"逐行校验"),s.a.createElement("div",{className:"box-2 m-card shadow"},s.a.createElement(q.a,{title:h,extra:f,noHovering:!0,bordered:!1},s.a.createElement(H.a,{rowKey:"id",className:"m-table",columns:this.initColumns(),loading:l,pagination:p,dataSource:o.data,onChange:this.onTableChange}))),s.a.createElement(fa,{key:"ruleConfigEnvModal",title:"配置环境参数",visible:d,onCancel:function(){return e.setState({visibleEnvModal:!1})},value:m&&m.taskParams,onOk:this.updateEnvParams}))}}]),t}(l.Component))||Za,vn=Wt.a.Item,En=ht.a.Option,yn=ja.a.TreeNode,Sn=Object(k.b)(function(e){return{dataCheck:e.dataCheck,dataSource:e.dataSource}},function(e){return{getDataSourcesList:function(t){e(Ge(t))},getDataSourcesTable:function(t){e(He(t))},resetDataSourcesTable:function(){e(ze())},getSourcePart:function(t,a){e(mn(t,a))},resetSourcePart:function(t){e(pn(t))}}})($a=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.renderSourceType=function(e){return e.map(function(e){var t=e.dataName+"（"+e.sourceTypeValue+"）";return s.a.createElement(En,{key:e.id,value:e.id.toString(),title:t},t)})},a.renderSourceTable=function(e){return e.map(function(e){return s.a.createElement(En,{key:e,value:e},e)})},a.renderTreeSelect=function(e){if(!Object(yt.isEmpty)(e))return e.children.map(function(e){var t=e.partName,n=e.partValue,r=n?"分区字段："+t+"  分区值："+n:t;return e.children.length?s.a.createElement(yn,{key:e.nodeId,title:r,value:e.partColumn,dataRef:e},a.renderTreeSelect(e)):s.a.createElement(yn,{key:e.nodeId,title:r,value:e.partColumn,dataRef:e,isLeaf:!0})})},a.havePartition=function(e){a.props.dataSource.sourceList.forEach(function(t){t.id==e&&a.props.changeHavePart(7===t.type||10===t.type)})},a.onSourceTypeChange=function(e){var t=a.props,n=t.form,r=t.havePart,i=(t.editParams,{dataSourceId:e});a.havePartition(e),a.props.resetDataSourcesTable(),a.props.getDataSourcesTable({sourceId:e}),n.setFieldsValue({originTable:void 0}),r&&(a.props.resetSourcePart("origin"),n.setFieldsValue({originPartition:void 0})),a.setState({showPreview:!1,sourcePreview:{}}),a.props.changeParams({origin:i,target:i,mappedPK:{}})},a.onOriginTableChange=function(e){var t=a.props,n=t.form,r=t.havePart,i=t.editParams.origin.dataSourceId,o={dataSourceId:i,table:e};r&&(a.props.resetSourcePart("origin"),n.setFieldsValue({originPartition:void 0}),a.props.getSourcePart({sourceId:i,table:e},"origin")),a.setState({showPreview:!1,sourcePreview:{}}),a.props.changeParams({origin:o,mappedPK:{}})},a.onSourcePreview=function(){var e=a.props.editParams.origin,t=e.dataSourceId,n=e.table,r=e.partition,i=a.state.showPreview;t&&n?(i||Fe.getDataSourcesPreview({sourceId:t,tableName:n,partition:r}).then(function(e){if(1===e.code){var t=e.data,n=t.columnList,r=t.dataList;e.data.dataList=r.map(function(e,t){var a={};return e.forEach(function(e,r){a.key=t,a[n[r]]=e}),a}),a.setState({sourcePreview:e.data})}}),a.setState({showPreview:!i})):zt.a.error("未选择数据源或数据表")},a.handlePartChange=function(e,t,n){var r=a.props.editParams.origin,i=e?n.triggerNode.props.dataRef.partColumn:void 0;a.props.changeParams({origin:F()({},r,{partition:i})})},a.next=function(){var e=a.props,t=e.currentStep,n=e.navToStep;e.form.validateFields({force:!0},function(e,a){e||n(t+1)})},a.previewTableColumns=function(e){return e&&e.map(function(e){return{title:e,key:e,dataIndex:e,width:8*e.length+28+"px",render:function(e){return s.a.createElement(Fa.a,{className:"no-scroll-bar",value:e||void 0,readOnly:!0,style:{minWidth:80,width:"100%",resize:"none"}})}}})},a.state={showPreview:!1,sourcePreview:{}},a}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){"new"===this.props.editStatus&&this.props.getDataSourcesList()}},{key:"getScroll",value:function(){var e=100,t=this.state.sourcePreview&&this.state.sourcePreview.columnList;for(var a in t){e=e+8*t[a].length+28}return e+"px"}},{key:"render",value:function(){var e=this.props,t=e.editStatus,a=e.editParams,n=e.form,r=e.dataSource,i=e.dataCheck,o=e.havePart,l=i.originPart,c=n.getFieldDecorator,u=r.sourceList,d=r.sourceTable,m=r.tableLoading,p=a.origin,h=p.dataSourceId,f=p.table,g=p.partition,v=this.state,E=v.sourcePreview,y=v.showPreview;return s.a.createElement("div",null,s.a.createElement("div",{className:"steps-content"},s.a.createElement(Wt.a,null,s.a.createElement(vn,F()({},ge,{label:"选择数据源"}),c("sourceId",{rules:[{required:!0,message:"请选择数据源"}],initialValue:h?h.toString():void 0})(s.a.createElement(ht.a,{showSearch:!0,optionFilterProp:"title",style:{width:"85%",marginRight:15},onChange:this.onSourceTypeChange,disabled:"edit"===t||m},this.renderSourceType(u))),s.a.createElement(C.c,{to:"/dq/dataSource"},"添加数据源")),s.a.createElement(vn,F()({},ge,{label:"选择左侧表"}),c("originTable",{rules:[{required:!0,message:"请选择左侧表"}],initialValue:f})(s.a.createElement(ht.a,{showSearch:!0,style:{width:"85%"},onChange:this.onOriginTableChange,disabled:"edit"===t},this.renderSourceTable(d)))),(o||g)&&s.a.createElement(vn,F()({},ge,{label:"选择分区"}),c("originPartition",{rules:[],initialValue:g})(s.a.createElement(ja.a,{allowClear:!0,showSearch:!0,placeholder:"分区列表",treeNodeLabelProp:"value",disabled:"edit"===t,style:{width:"85%"},dropdownStyle:{maxHeight:400,overflow:"auto"},onChange:this.handlePartChange},this.renderTreeSelect(l)))),s.a.createElement("div",{className:"txt-center font-14"},s.a.createElement("a",{onClick:this.onSourcePreview},"数据预览",s.a.createElement(st.a,{type:"down",style:{marginLeft:5}}))),y&&s.a.createElement(H.a,{rowKey:"key",className:"m-table m-cells",columns:this.previewTableColumns(E.columnList),dataSource:E.dataList,pagination:!1,scroll:{x:this.getScroll()}}))),s.a.createElement("div",{className:"steps-action"},s.a.createElement(Gt.a,null,s.a.createElement(C.c,{to:"/dq/dataCheck"},"取消")),s.a.createElement(Gt.a,{className:"m-l-8",type:"primary",onClick:this.next},"下一步")))}}]),t}(l.Component))||$a;Sn=Wt.a.create()(Sn);var bn=Wt.a.Item,Tn=ht.a.Option,Cn=ja.a.TreeNode,kn=Object(k.b)(function(e){return{dataCheck:e.dataCheck,dataSource:e.dataSource}},function(e){return{getSourcePart:function(t,a){e(mn(t,a))},resetSourcePart:function(t){e(pn(t))}}})(en=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.renderTargetTable=function(e){return e.map(function(e){return s.a.createElement(Tn,{key:e,value:e},e)})},a.onTargetTableChange=function(e){var t=a.props,n=t.form,r=t.havePart,i=t.editParams.target.dataSourceId,o={dataSourceId:i,table:e};r&&(a.props.resetSourcePart("target"),n.setFieldsValue({targetPartition:void 0}),a.props.getSourcePart({sourceId:i,table:e},"target")),a.setState({showPreview:!1,sourcePreview:{}}),a.props.changeParams({target:o,mappedPK:{}})},a.onSourcePreview=function(){var e=a.props.editParams.target,t=e.dataSourceId,n=e.table,r=e.partition,i=a.state.showPreview;n?(i||Fe.getDataSourcesPreview({sourceId:t,tableName:n,partition:r}).then(function(e){if(1===e.code){var t=e.data,n=t.columnList,r=t.dataList;e.data.dataList=r.map(function(e,t){var a={};return e.forEach(function(e,r){a.key=t,a[n[r]]=e}),a}),a.setState({sourcePreview:e.data})}}),a.setState({showPreview:!i})):zt.a.error("未选择数据表")},a.renderTreeSelect=function(e){if(!Object(yt.isEmpty)(e))return e.children.map(function(e){var t=e.partName,n=e.partValue,r=n?"分区字段："+t+"  分区值："+n:t;return e.children.length?s.a.createElement(Cn,{key:e.nodeId,title:r,value:e.partColumn,dataRef:e},a.renderTreeSelect(e.children)):s.a.createElement(Cn,{key:e.nodeId,title:r,value:e.partColumn,dataRef:e,isLeaf:!0})})},a.handlePartChange=function(e,t,n){var r=a.props.editParams.target,i=e?n.triggerNode.props.dataRef.partColumn:void 0;a.props.changeParams({target:F()({},r,{partition:i})})},a.prev=function(){var e=a.props,t=e.currentStep;(0,e.navToStep)(t-1)},a.next=function(){var e=a.props,t=e.currentStep,n=e.navToStep;e.form.validateFields({force:!0},function(e,a){e||n(t+1)})},a.previewTableColumns=function(e){return e&&e.map(function(e){return{title:e,key:e,dataIndex:e,width:80,render:function(e){return s.a.createElement(Fa.a,{className:"no-scroll-bar",value:e||void 0,readOnly:!0,style:{minWidth:80,width:"100%",resize:"none"}})}}})},a.state={showPreview:!1,sourcePreview:{}},a}return T()(t,e),E()(t,[{key:"render",value:function(){var e=this.props,t=e.form,a=e.editStatus,n=e.editParams,r=e.dataSource,i=e.dataCheck,o=e.havePart,l=i.targetPart,c=r.sourceTable,u=t.getFieldDecorator,d=n.target,m=d.table,p=d.partition,h=this.state,f=h.sourcePreview,g=h.showPreview;return s.a.createElement("div",null,s.a.createElement("div",{className:"steps-content"},s.a.createElement(Wt.a,null,s.a.createElement(bn,F()({},ge,{label:"选择右侧表"}),u("table",{rules:[{required:!0,message:"请选择右侧表"}],initialValue:m})(s.a.createElement(ht.a,{showSearch:!0,style:{width:"85%"},onChange:this.onTargetTableChange,disabled:"edit"===a},this.renderTargetTable(c)))),(o||p)&&s.a.createElement(bn,F()({},ge,{label:"选择分区"}),u("targetPartition",{rules:[],initialValue:p})(s.a.createElement(ja.a,{allowClear:!0,showSearch:!0,placeholder:"分区列表",treeNodeLabelProp:"value",disabled:"edit"===a,style:{width:"85%",marginRight:15},dropdownStyle:{maxHeight:400,overflow:"auto"},onChange:this.handlePartChange},this.renderTreeSelect(l)))),s.a.createElement("div",{className:"txt-center font-14"},s.a.createElement("a",{onClick:this.onSourcePreview},"数据预览",s.a.createElement(st.a,{type:"down",style:{marginLeft:5}}))),g&&s.a.createElement(H.a,{rowKey:"key",className:"m-table m-cells",columns:this.previewTableColumns(f.columnList),dataSource:f.dataList,pagination:!1,scroll:{x:1e3}}))),s.a.createElement("div",{className:"steps-action"},s.a.createElement(Gt.a,{onClick:this.prev},"上一步"),s.a.createElement(Gt.a,{className:"m-l-8",type:"primary",onClick:this.next},"下一步")))}}]),t}(l.Component))||en;kn=Wt.a.create()(kn);var Nn,Pn=a("sk9p"),In=a.n(Pn),wn=a("oF3Q"),Dn=a.n(wn),xn=a("FyfS"),_n=a.n(xn),Rn=a("2fsI"),Ln=a("u+gO"),On=Wt.a.Item,An=Object(k.b)(function(e){return{keymap:e.keymap}},function(e){return{addLinkedKeys:function(t){e({type:Ln.a.ADD_LINKED_KEYS,payload:t})},delLinkedKeys:function(t){e({type:Ln.a.DEL_LINKED_KEYS,payload:t})},setEditMap:function(t){e({type:Ln.a.SET_EDIT_MAP,payload:t})},setRowMap:function(t){e({type:Ln.a.SET_ROW_MAP,payload:t})},setNameMap:function(t){e({type:Ln.a.SET_NAME_MAP,payload:t})},resetLinkedKeys:function(){e({type:Ln.a.RESET_LINKED_KEYS})}}})(Nn=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.resize=function(){a.setState({W:a.getCanvasW(),H:a.getCanvasH()})},a.getColumnData=function(){var e=a.props.editParams,t=e.origin,n=e.target;Fe.getDataSourcesColumn({sourceId:t.dataSourceId,tableName:t.table}).then(function(e){1===e.code&&(a.setState({originColumn:e.data}),a.resize())}),Fe.getDataSourcesColumn({sourceId:n.dataSourceId,tableName:n.table}).then(function(e){1===e.code&&(a.setState({targetColumn:e.data}),a.resize())})},a.setEditKeymapData=function(){var e=a.props.editParams,t=e.origin,n=e.target;t.column&&n.column&&a.props.setEditMap({source:t.column,target:n.column})},a.setSettingTableFields=function(){var e=a.props.editParams.setting,t=a.props.form;if(!Object(yt.isEmpty)(e)){var n=[],r={};Z()(e).forEach(function(t){e[t]&&(n.push(t),"matchCase"!=t&&"matchNull"!=t&&(r[t]=e[t]))}),t.setFieldsValue(r),a.setState({selectedSetting:n})}},a.setKeymapCheckData=function(){var e=a.props.editParams.mappedPK;if(!Object(yt.isEmpty)(e)){var t=[],n=[],r=!0,i=!1,o=void 0;try{for(var l,s=_n()(Dn()(e));!(r=(l=s.next()).done);r=!0){var c=In()(l.value,2),u=c[0],d=c[1];t.push(u),n.push(d)}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}a.setState({selectedSource:t,selectedTarget:n})}},a.initDiverseSetting=function(){return[{title:"差异特征",dataIndex:"setting",key:"setting",render:function(e,t){return a.getSettingItem(e)},width:"95%"}]},a.initDiverseData=function(){return[{id:1,setting:"diverseNum"},{id:2,setting:"diverseRatio"},{id:3,setting:"diverseAbsolute"},{id:4,setting:"decimalRetain"},{id:5,setting:"matchCase"},{id:6,setting:"matchNull"}]},a.getSettingItem=function(e){var t=a.props.form.getFieldDecorator,n=a.props.editParams.setting;switch(e){case"diverseNum":return s.a.createElement(On,{style:{marginBottom:0}},"记录数差异，对比左右表的总记录数，差距小于",t("diverseNum",{rules:[{required:!0,message:"不能为空"}],initialValue:n.diverseNum})(s.a.createElement(Yt.a,{size:"default",min:1,step:1})),"%时候，计为成功匹配");case"diverseRatio":return s.a.createElement(On,{style:{marginBottom:0}},"数值差异百分比，对比左右表的数值型数据时，差距百分比小于",t("diverseRatio",{rules:[{required:!0,message:"不能为空"}],initialValue:n.diverseRatio})(s.a.createElement(Yt.a,{size:"default",min:1,step:1})),"%时候，计为成功匹配");case"diverseAbsolute":return s.a.createElement(On,{style:{marginBottom:0}},"数值差异绝对值，对比左右表的数值型数据时，差距绝对值小于",t("diverseAbsolute",{rules:[{required:!0,message:"不能为空"}],initialValue:n.diverseAbsolute})(s.a.createElement(Yt.a,{size:"default",min:1,step:1})),"时候，计为成功匹配");case"decimalRetain":return s.a.createElement(On,{style:{marginBottom:0}},"数值对比忽略小数点，忽略小数点后",t("decimalRetain",{rules:[{required:!0,message:"不能为空"}],initialValue:n.decimalRetain})(s.a.createElement(Yt.a,{size:"default",min:1,step:1,precision:0})),"位");case"matchCase":return s.a.createElement("p",null,"字符不区分大小写，对比左右表的字符串型数据时，不区分大小写");case"matchNull":return s.a.createElement("p",null,"空值与NULL等价，对比左右表的数据时，认为空值与NULL值是相等的")}},a.keymapTableColumn=function(e){return[{title:"left"===e?"左侧表字段":"右侧表字段",dataIndex:"key",key:"key",width:"45%"},{title:"类型",dataIndex:"type",key:"type",width:"40%"}]},a.prev=function(){var e=a.props,t=e.currentStep;(0,e.navToStep)(t-1)},a.next=function(){var e=a.props,t=e.form,n=e.editParams,r=e.keymap,i=e.currentStep,o=a.state.selectedSetting;r.source.length?Object(yt.isEmpty)(n.mappedPK)?zt.a.error("请选择逻辑主键"):(Z()(t.getFieldsValue()).forEach(function(e){o.indexOf(e)<0&&t.resetFields([e])}),t.validateFields(o,function(e,t){e?zt.a.error("请填写已选中的差异设置"):(Z()(t).forEach(function(e){"matchCase"!==e&&"matchNull"!==e||(t[e]=!0)}),a.props.changeParams({setting:t}),a.props.navToStep(i+1))})):zt.a.error("请连接要比对的字段")},a.setRowMap=function(){var e=a.state,t=e.rowMap,n=e.nameMap,r=e.originColumn,i=e.targetColumn;t?(a.props.resetLinkedKeys(),a.setState({selectedSource:[],selectedTarget:[]}),a.props.changeParams({mappedPK:{}})):a.props.setRowMap({sourceKeyCol:r.map(function(e){return e.key}),targetKeyCol:i.map(function(e){return e.key})}),a.setState({rowMap:!t,nameMap:n?!n:n})},a.setNameMap=function(){var e=a.state,t=e.nameMap,n=e.rowMap,r=e.originColumn,i=e.targetColumn,o=a.props.editParams;o.origin,o.target;t?(a.props.resetLinkedKeys(),a.setState({selectedSource:[],selectedTarget:[]}),a.props.changeParams({mappedPK:{}})):a.props.setNameMap({sourceKeyCol:r.map(function(e){return e.key}),targetKeyCol:i.map(function(e){return e.key})}),a.setState({nameMap:!t,rowMap:n?!n:n})},a.state={selectedSetting:[],selectedSource:[],selectedTarget:[],h:40,W:0,H:0,originColumn:[],targetColumn:[],rowMap:!1,nameMap:!1},a}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){this.initDiverseData(),this.$canvas=Object(Rn.b)(this.canvas),this.$activeLine=Object(Rn.b)("#activeLine"),this.listenResize(),this.getColumnData(),this.setEditKeymapData(),this.setKeymapCheckData(),this.setSettingTableFields(),this.drawSvg()}},{key:"componentWillReceiveProps",value:function(e){var t=e.keymap,a=this.props.keymap;if(t.source.length!=a.source.length){var n=this.props.editParams,r=n.origin,i=n.target;this.props.changeParams({origin:F()({},r,{column:t.source}),target:F()({},i,{column:t.target})})}}},{key:"componentDidUpdate",value:function(){this.$canvas.selectAll(".dl, .dr, .lines").remove(),this.drawSvg()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize,!1),this.props.resetLinkedKeys()}},{key:"listenResize",value:function(){window.addEventListener("resize",this.resize,!1)}},{key:"drawSvg",value:function(){this.renderDags(),this.renderLines(),this.bindEvents()}},{key:"renderDags",value:function(){var e=this.state,t=e.h,a=e.W,n=e.originColumn,r=e.targetColumn;this.$canvas.append("g").attr("class","dl").selectAll("g").data(n).enter().append("g").attr("class","col-dag-l").append("circle").attr("class","dag-circle").attr("cx",function(e,t){return 15}).attr("cy",function(e,a){return t*(a+1.5)}).attr("r",5).attr("stroke-width",2).attr("stroke","#fff").attr("fill","#2491F7"),this.$canvas.append("g").attr("class","dr").selectAll("g").data(r).enter().append("g").attr("class","col-dag-r").append("circle").attr("class","dag-circle").attr("cx",function(e,t){return a-15}).attr("cy",function(e,a){return t*(a+1.5)}).attr("r",5).attr("stroke-width",2).attr("stroke","#fff").attr("fill","#2491F7")}},{key:"renderLines",value:function(){var e=this.state,t=e.h,a=e.W,n=this.props.keymap,r=n.source,i=n.target,o=Object(Rn.c)(".col-dag-l"),l=Object(Rn.c)(".col-dag-r"),s=[];r.forEach(function(e,n){o.each(function(r,o){var c=void 0,u=void 0,d=void 0,m=void 0;r.key===e&&(c=15,u=(o+1.5)*t,l.each(function(r,o){r.key===i[n]&&(d=a-15,m=(o+1.5)*t,s.push({s:{x:c,y:u},e:{x:d,y:m},dl:e,dr:i[n]}))}))})});var c=this.$canvas.append("g").attr("class","lines").selectAll("g").data(s).enter().append("g").attr("class","mapline");c.append("line").attr("x1",function(e){return e.s.x}).attr("y1",function(e){return e.s.y}).attr("x2",function(e){return e.e.x}).attr("y2",function(e){return e.e.y}).attr("stroke","#2491F7").attr("stroke-width",2).attr("marker-end","url(#arrow)"),c.append("rect").attr("x",function(e){return e.s.x}).attr("y",function(e){return e.s.y>e.e.y?e.s.y-15:e.s.y-10}).attr("width",function(e){return Math.pow(Math.pow(e.e.x-e.s.x,2)+Math.pow(e.e.y-e.s.y,2),.5)}).attr("transform",function(e){return"rotate(\n                            "+180/(Math.PI/Math.atan((e.e.y-e.s.y)/(e.e.x-e.s.x)))+"\n                        )"}).attr("transform-origin",function(e){var t=e.s.y>e.e.y?15:10;return e.s.x+" "+(e.s.y-t)}).attr("height",function(e){return e.s.y>e.e.y?"20px":"15px"}).attr("fill","transparent")}},{key:"bindEvents",value:function(){var e=this,t=this.state,a=t.h,n=t.W,r=t.selectedSource,i=t.selectedTarget,o=this.$activeLine,l=Object(Rn.c)(".col-dag-l"),s=Object(Rn.c)(".col-dag-r"),c=!1,u=void 0,d=void 0;l.on("mousedown",function(e,t,n){u=e,c=!0;var r=(t+1.5)*a;o.attr("x1",15).attr("y1",r).attr("x2",15).attr("y2",r)}),this.$canvas.on("mousemove",function(){if(c){var t=Object(Rn.a)(e.$canvas.node());o.attr("x2",t[0]).attr("y2",t[1])}}).on("mouseup",function(){if(c){var t=Object(Rn.a)(e.$canvas.node()),r=In()(t,2),i=r[0],o=r[1];if(i<n-30)e.resetActiveLine();else{var l=Math.floor(o/a)-1;s.each(function(e,t){t===l&&(d=e)})}}u&&d&&(e.props.addLinkedKeys({source:u.key,target:d.key}),e.resetActiveLine()),c=!1}),this.$canvas.selectAll(".mapline").on("mouseover",function(e,t,a){Object(Rn.b)(a[t]).select("line").attr("stroke-width",4).attr("stroke","#2491F7")}).on("mouseout",function(e,t,a){Object(Rn.b)(a[t]).select("line").attr("stroke-width",2).attr("stroke","#2491F7")}).on("click",function(t,a,n){e.props.delLinkedKeys({source:t.dl,target:t.dr});var o=[].concat(wt()(r)),l=[].concat(wt()(i)),s={};o=o.filter(function(e){return e!==t.dl}),l=l.filter(function(e){return e!==t.dr}),e.setState({selectedSource:o,selectedTarget:l}),o.forEach(function(e,t){s[e]=l[t]}),e.props.changeParams({mappedPK:s})})}},{key:"resetActiveLine",value:function(){this.$activeLine.attr("x1",-10).attr("y1",-10).attr("x2",-10).attr("y2",-10)}},{key:"getCanvasW",value:function(){return document.querySelector(".keymap-svg").getBoundingClientRect().width}},{key:"getCanvasH",value:function(){var e=document.querySelectorAll(".keymap-table")[0].getBoundingClientRect().height,t=document.querySelectorAll(".keymap-table")[1].getBoundingClientRect().height;return e>t?e:t}},{key:"render",value:function(){var e=this,t=this.state,a=t.selectedSetting,n=t.selectedSource,r=t.selectedTarget,i=(t.h,t.W,t.H),o=t.originColumn,l=t.targetColumn,c=t.nameMap,u=t.rowMap,d=this.props.keymap,m=d.source,p=d.target,h={selectedRowKeys:n,getCheckboxProps:function(e){return{disabled:!m.includes(e.key)}},onSelect:function(t,a,i){var o=[].concat(wt()(n)),l=[].concat(wt()(r)),s={};a?(o.push(t.key),l.push(p[m.indexOf(t.key)])):(o.splice(o.indexOf(t.key),1),l.splice(l.indexOf(t.key),1)),e.setState({selectedSource:o,selectedTarget:l}),o.forEach(function(e,t){s[e]=l[t]}),e.props.changeParams({mappedPK:s})}},f={selectedRowKeys:r,getCheckboxProps:function(e){return{disabled:!p.includes(e.key)}},onSelect:function(t,a,i){var o=[].concat(wt()(n)),l=[].concat(wt()(r)),s={};a?(l.push(t.key),o.push(m[p.indexOf(t.key)])):(l.splice(l.indexOf(t.key),1),o.splice(o.indexOf(t.key),1)),e.setState({selectedSource:o,selectedTarget:l}),o.forEach(function(e,t){s[e]=l[t]}),e.props.changeParams({mappedPK:s})}},g={selectedRowKeys:a,onChange:function(t){e.setState({selectedSetting:t})}};return s.a.createElement("div",null,s.a.createElement("div",{className:"steps-content"},s.a.createElement("p",{className:"keymap-title"},"提示：您要配置来源表与目标表的字段映射关系，通过连线将待同步的字段左右相连，也可以通过同行映射、同名映射批量完成映射,同时，您需要添加主键"),s.a.createElement(K.a,{className:"keymap-content"},s.a.createElement(Q.a,{span:3},s.a.createElement("div",{className:"keymap-action"},s.a.createElement(Gt.a,{type:u?"primary":"default",onClick:this.setRowMap},u?"取消同行映射":"同行映射"),s.a.createElement("br",null),s.a.createElement(Gt.a,{type:c?"primary":"default",onClick:this.setNameMap},c?"取消同名映射":"同名映射"))),s.a.createElement(Q.a,{span:6},s.a.createElement(H.a,{className:"keymap-table m-table table-select-text-key",rowKey:function(e){return e.key},columns:this.keymapTableColumn("left"),dataSource:o,rowSelection:h,pagination:!1})),s.a.createElement(Q.a,{span:8,className:"canvas-content"},s.a.createElement("svg",{ref:function(t){return e.canvas=t},width:"100%",height:i,className:"keymap-svg"},s.a.createElement("defs",null,s.a.createElement("marker",{id:"arrow",markerUnits:"strokeWidth",markerWidth:"12",markerHeight:"12",viewBox:"0 0 12 12",refX:"6",refY:"6",orient:"auto"},s.a.createElement("path",{d:"M2,3 L9,6 L2,9 L2,3",style:{fill:"#2491F7"}}))),s.a.createElement("g",null,s.a.createElement("line",{id:"activeLine",x1:"-10",y1:"-10",x2:"-10",y2:"-10",stroke:"#2491F7",strokeWidth:"2",markerEnd:"url(#arrow)"})))),s.a.createElement(Q.a,{span:6},s.a.createElement(H.a,{className:"keymap-table m-table table-select-text-key",rowKey:function(e){return e.key},columns:this.keymapTableColumn("right"),dataSource:l,rowSelection:f,pagination:!1}))),s.a.createElement(K.a,{className:"keymap-content"},s.a.createElement(Q.a,{offset:2,span:20},s.a.createElement(H.a,{className:"m-table setting-table",showHeader:!1,rowKey:function(e){return e.setting},columns:this.initDiverseSetting(),dataSource:this.initDiverseData(),rowSelection:g,pagination:!1})))),s.a.createElement("div",{className:"steps-action"},s.a.createElement(Gt.a,{onClick:this.prev},"上一步"),s.a.createElement(Gt.a,{className:"m-l-8",type:"primary",onClick:this.next},"下一步")))}}]),t}(l.Component))||Nn;An=Wt.a.create()(An);a("mxgt");var Mn,jn=a("4ZwL"),Fn=a.n(jn),Vn=(a("7kJ1"),a("qPIi")),Un=a.n(Vn),Gn=Wt.a.Item,Hn=Un.a.Group,zn=ht.a.Option,qn={beginDate:ee()().format("YYYY-MM-DD"),hour:0,min:0,endDate:ee()().add(100,"years").format("YYYY-MM-DD"),periodType:"2"},Yn=Object(k.b)(function(e){return{common:e.common}})(Mn=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.resetScheduleConf=function(){var e=qn;a.setState({scheduleConfObj:e}),a.props.changeParams({scheduleConf:Xt()(e)})},a.onExecuteTypeChange=function(e){0===e.target.value&&a.resetScheduleConf(),a.props.changeParams({executeType:e.target.value})},a.onInformChange=function(e){a.setState({isInform:e.target.checked}),e.target.checked||a.props.changeParams({notifyVO:null})},a.onInformTypeChange=function(e){var t=a.props.editParams.notifyVO;a.props.changeParams({notifyVO:F()({},t,{sendTypes:e})})},a.onWebHookChange=function(e){var t=a.props.editParams.notifyVO;a.props.changeParams({notifyVO:F()({},t,{webhook:e.target.value})})},a.changeScheduleConfTime=function(e,t,n){var r=a.state.scheduleConfObj,i={};i[e]=n,a.setState({scheduleConfObj:F()({},r,i)}),a.props.changeParams({scheduleConf:Xt()(F()({},r,i))})},a.onInformUserChange=function(e){var t=a.props.editParams.notifyVO;a.props.changeParams({notifyVO:F()({},t,{receivers:e})})},a.renderUserList=function(e){return e.map(function(e){return s.a.createElement(zn,{key:e.id,value:e.id.toString()},e.userName)})},a.renderSendTypeList=function(e){return e&&e.map(function(e){return s.a.createElement(at.a,{key:e.value,value:e.value.toString()},e.name)})},a.disabledDate=function(e){return e&&e.valueOf()<ee()().startOf("day").valueOf()},a.prev=function(){var e=a.props,t=e.currentStep;(0,e.navToStep)(t-1)},a.save=function(){var e=a.props,t=e.form,n=e.editParams;t.validateFields({force:!0},function(e,t){e&&(e.beginDate||e.hour||e.min)&&zt.a.error("执行时间不能为空"),e||(n.id?un.updateCheck(n).then(function(e){1===e.code&&(zt.a.success("操作成功"),setTimeout(function(){C.g.push("/dq/dataCheck")},1e3))}):un.addCheck(n).then(function(e){1===e.code&&(zt.a.success("操作成功"),setTimeout(function(){C.g.push("/dq/dataCheck")},1e3))}))})},a.state={isInform:!1,scheduleConfObj:qn},a}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){var e=this.props.editParams,t=e.scheduleConf,a=e.notifyVO,n=this.state.scheduleConfObj;t?this.setState({scheduleConfObj:JSON.parse(t)}):this.props.changeParams({scheduleConf:Xt()(n)}),a&&this.setState({isInform:!0})}},{key:"render",value:function(){var e=this.props,t=e.form,a=e.common,n=e.editParams,r=e.editStatus,i=a.userList,o=a.allDict,l=t.getFieldDecorator,c=n.executeType,u=n.notifyVO,d=this.state,m=d.isInform,p=d.scheduleConfObj,h=u?u.sendTypes:void 0,f=u?u.receivers:void 0,g=u?u.webhook:void 0,v=o.notifyType?o.notifyType:[],E=(h?h.map(function(e){return e.toString()}):[]).indexOf(ie)>-1;return s.a.createElement("div",null,s.a.createElement("div",{className:"steps-content"},s.a.createElement(Wt.a,null,s.a.createElement(Gn,F()({},ge,{label:"执行时间"}),l("executeType",{rules:[{required:!0,message:"不能为空"}],initialValue:c})(s.a.createElement(Hn,{onChange:this.onExecuteTypeChange},s.a.createElement(Un.a,{value:0},"立即执行"),s.a.createElement(Un.a,{value:1},"定时执行")))),1===c&&s.a.createElement(K.a,{style:{marginBottom:24}},s.a.createElement(Q.a,{span:12,offset:6},l("beginDate",{rules:[{required:!0}],initialValue:ee()(p.beginDate)})(s.a.createElement(ut.a,{format:"YYYY-MM-DD",placeholder:"开始时间",style:{width:150,marginRight:15},disabledDate:this.disabledDate,onChange:this.changeScheduleConfTime.bind(this,"beginDate")})),l("hour",{rules:[{required:!0}],initialValue:ee()(p.hour,"HH")})(s.a.createElement(Fn.a,{format:"HH",placeholder:"小时",style:{marginRight:15},onChange:this.changeScheduleConfTime.bind(this,"hour")})),l("min",{rules:[{required:!0}],initialValue:ee()(p.min,"mm")})(s.a.createElement(Fn.a,{format:"mm",placeholder:"分钟",onChange:this.changeScheduleConfTime.bind(this,"min")})))),s.a.createElement(Gn,F()({},ge,{label:"通知设置"}),s.a.createElement(at.a,{value:m,onChange:this.onInformChange},"执行完成后发送通知")),!0===m&&s.a.createElement("div",null,s.a.createElement(Gn,F()({},ge,{label:"通知方式"}),l("sendTypes",{rules:[{required:!0,message:"选择通知方式"}],initialValue:h?h.map(function(e){return e.toString()}):[]})(s.a.createElement(at.a.Group,{onChange:this.onInformTypeChange},this.renderSendTypeList(v)))),E&&s.a.createElement(Gn,F()({},ge,{label:"webhook"}),l("webhook",{rules:[{required:!0,message:"webhook不能为空"}],initialValue:g||""})(s.a.createElement(gt.a,{onChange:this.onWebHookChange}))),s.a.createElement(Gn,F()({},ge,{label:"通知接收人"}),l("receivers",{rules:[{required:!0,message:"选择接收人"}],initialValue:f?f.map(function(e){return e.toString()}):[]})(s.a.createElement(ht.a,{allowClear:!0,mode:"multiple",onChange:this.onInformUserChange},this.renderUserList(i))))))),s.a.createElement("div",{className:"steps-action"},s.a.createElement(Gt.a,{onClick:this.prev},"上一步"),s.a.createElement(Gt.a,{type:"primary",className:"m-l-8",onClick:this.save},"edit"===r?"保存":"新建")))}}]),t}(l.Component))||Mn;Yn=Wt.a.create()(Yn);var Kn,Bn,Qn,Wn,Jn,Xn,Zn,$n=Aa.a.Step,er=function(e){function t(){var e,a,n,r;g()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=S()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(o))),n.state={current:0,editParams:{origin:{},target:{},mappedPK:{},executeType:0,setting:{},scheduleConf:void 0,notifyVO:null},editStatus:"new",havePart:!1},n.changeParams=function(e){var t=F()({},n.state.editParams,e);n.setState({editParams:t})},n.changeHavePart=function(e){n.setState({havePart:e})},n.navToStep=function(e){n.setState({current:e})},r=a,S()(n,r)}return T()(t,e),E()(t,[{key:"componentWillMount",value:function(){var e=this,t=this.props.routeParams.verifyId,a=this.state.editParams;t&&(this.setState({editStatus:"edit"}),un.getCheckDetail({verifyId:t}).then(function(t){if(1===t.code){var n=t.data;e.setState({editParams:F()({},a,{id:n.id,origin:n.origin,target:n.target,setting:n.setting,mappedPK:n.mappedPK,notifyVO:n.notifyVO,executeType:n.executeType,scheduleConf:n.scheduleConf})})}}))}},{key:"render",value:function(){var e=this.state,t=e.current,a=e.editParams,n=e.editStatus,r=e.havePart,i=[{title:"选择左侧表",content:s.a.createElement(Sn,{currentStep:t,navToStep:this.navToStep,havePart:r,editParams:a,editStatus:n,changeParams:this.changeParams,changeHavePart:this.changeHavePart})},{title:"选择右侧表",content:s.a.createElement(kn,{currentStep:t,navToStep:this.navToStep,havePart:r,editParams:a,editStatus:n,changeParams:this.changeParams})},{title:"选择字段",content:s.a.createElement(An,{currentStep:t,navToStep:this.navToStep,editParams:a,editStatus:n,changeParams:this.changeParams})},{title:"执行配置",content:s.a.createElement(Yn,{currentStep:t,navToStep:this.navToStep,editParams:a,editStatus:n,changeParams:this.changeParams})}];return s.a.createElement("div",{className:"box-1 check-setting"},s.a.createElement("h1",{className:"box-title"},s.a.createElement(tn.a,null),s.a.createElement("span",{className:"m-l-8"},"new"===n?"新建逐行校验":"编辑逐行校验")),s.a.createElement("div",{className:"steps-container"},s.a.createElement(Aa.a,{current:t},i.map(function(e){return s.a.createElement($n,{key:e.title,title:e.title})})),i[t].content))}}]),t}(l.Component),tr=function(e){function t(e){g()(this,t);var a=S()(this,(t.__proto__||h()(t)).call(this,e));return a.initColumns=function(e){return e.length&&e.map(function(e){return{title:e,key:e,dataIndex:e,width:8*e.length+28+"px",render:function(e){return s.a.createElement(Fa.a,{className:"no-scroll-bar",value:e||void 0,readOnly:!0,style:{minWidth:80,width:"100%",resize:"none"}})}}})},a.onTableChange=function(e,t,n){var r=F()({},a.state.params,{currentPage:e.current});un.getCheckReportTable(r).then(function(e){1===e.code&&a.setState({params:r,tableData:e.data})})},a.handleDownload=function(){var e=a.state.params,t="verifyRecordId="+e.verifyRecordId+"&currentPage="+e.currentPage+"&pageSize="+e.pageSize;window.open("/api/dq/export/verify/doExport?"+t)},a.state={params:{currentPage:1,pageSize:20,verifyRecordId:a.props.routeParams.verifyRecordId},tableData:{},reportData:{}},a}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state.params,a=t.verifyRecordId;un.getCheckReport({verifyRecordId:a}).then(function(t){1===t.code&&e.setState({reportData:t.data})}),un.getCheckReportTable(t).then(function(t){1===t.code&&e.setState({tableData:t.data})})}},{key:"getScroll",value:function(){var e=100,t=this.state.tableData.attachment;for(var a in t){e=e+8*t[a].length+28}return e+"px"}},{key:"render",value:function(){var e=this.state,t=e.params,a=e.tableData,n=e.reportData,r=n.verifyVO,i=n.lAll,o=n.rAll,l=n.mapSuccess,c=n.mapFailure,u=n.rightUnfound,d=n.leftUnfound,m=n.dataSourceEN,p={current:t.currentPage,pageSize:t.pageSize,total:a.totalCount},h="/api/dq/export/verify/doExport?"+("verifyRecordId="+t.verifyRecordId+"&currentPage="+t.currentPage+"&pageSize="+t.pageSize);return s.a.createElement("div",{className:"box-1"},s.a.createElement("h1",{className:"box-title"},s.a.createElement(tn.a,null),s.a.createElement("span",{className:"m-l-8"},"查看报告")),s.a.createElement("div",{className:"report-content"},s.a.createElement("h3",null,"整体校验"),s.a.createElement("table",{className:"report-table"},s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("th",null),s.a.createElement("th",null,"左侧表"),s.a.createElement("th",null,"右侧表")),s.a.createElement("tr",null,s.a.createElement("th",null,"表名"),s.a.createElement("td",null,r?r.originTableName:""),s.a.createElement("td",null,r?r.targetTableName:"")),s.a.createElement("tr",null,s.a.createElement("th",null,"分区名"),s.a.createElement("td",null,r?r.originPartition:" -- "),s.a.createElement("td",null,r?r.targetPartition:" -- ")),s.a.createElement("tr",null,s.a.createElement("th",null,"类型"),s.a.createElement("td",null,m),s.a.createElement("td",null,m)),s.a.createElement("tr",null,s.a.createElement("th",null,"总记录数"),s.a.createElement("td",null,i),s.a.createElement("td",null,o))))),s.a.createElement("div",{className:"report-content"},s.a.createElement("h3",null,"未匹配数据报告"),s.a.createElement("table",{className:"report-table"},s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("th",null,"匹配成功"),s.a.createElement("td",{className:"width-30"},l),s.a.createElement("th",null,"左表数据在右表未找到"),s.a.createElement("td",{className:"width-30"},u)),s.a.createElement("tr",null,s.a.createElement("th",null,"逻辑主键匹配，但数据不匹配"),s.a.createElement("td",{className:"width-30"},c),s.a.createElement("th",null,"右表数据在左表未找到"),s.a.createElement("td",{className:"width-30"},d))))),s.a.createElement("div",{className:"report-content"},s.a.createElement("h3",{className:"flex",style:{justifyContent:"space-between"}},"具体差异",s.a.createElement("a",{href:h,download:!0},s.a.createElement(st.a,{type:"download",style:{fontSize:16,marginRight:25,cursor:"pointer"}}))),s.a.createElement(H.a,{className:"m-cells m-table",scroll:{x:this.getScroll()},pagination:p,dataSource:a.data?a.data:[],columns:this.initColumns(a.attachment?a.attachment:[]),onChange:this.onTableChange})))}}]),t}(l.Component),ar=a("FL+A"),nr=s.a.createElement("div",null,"where 条件即针对源头数据筛选条件，根据指定的 column、table、where 条件拼接 SQL 进行数据抽取，暂时不支持limit关键字过滤。利用 where 条件可进行全量同步和增量同步，具体说明如下：",s.a.createElement("br",null),s.a.createElement("ul",null,s.a.createElement("li",null,"1）全量同步：第一次做数据导入时通常为全量导入，可不用设置 where 条件。"),s.a.createElement("li",null,"2）增量同步：增量导入在实际业务场景中，往往会选择当天的数据进行同步，通常需要编写 where 条件语句，请先确认表中描述增量字段（时间戳）为哪一个。如tableA增量的字段为create_time，则填写create_time > 您需要的日期，如果需要日期动态变化，请参考帮助文档。"))),rr=s.a.createElement("ul",null,s.a.createElement("li",null,"MySQL：支持数值型切分键"),s.a.createElement("li",null,"Oracle：支持数值型、字符串类型切分键")),ir=s.a.createElement("div",null,"user/hive/warehouse/projectName.db/",s.a.createElement("br",null),"tableName 是RD-OS默认的HDFS文件组织方式，projectName为项目名， 其中每个tableName是HDFS内的一个目录，储存着一张表的数据。 如果此表的数据存储在当前项目空间内，只需修改tableName即可， 否则需要根据HDFS的存储位置填写。"),or=s.a.createElement("div",null,"设置作业速率上限，则数据同步作业的总速率将尽可能按照这个上限进行同步， 需根据实际硬件配置调整，默认为1"),lr=s.a.createElement("ul",null,s.a.createElement("li",null," 1.作业速率上限=作业并发数单作业的传输速率，当作业速率上限已定，选择的并发数越高则单并发的速率越低，同时所占用的内存会越高，这可以根据你的业务需求选择设定的值"),s.a.createElement("li",null,"2.作业并发数下拉框选择对象，取决作业速率上限。作业速率上限选择值nMB/s，作业并发数最大能选择n")),sr=s.a.createElement("div",null,"表示脏数据的最大容忍条数，如果您配置0， 则表示严格不允许脏数据存在；如果不填则代表容忍脏数据"),cr=s.a.createElement("div",null,"高可用模式下的填写规则：",s.a.createElement("ul",null,s.a.createElement("li",null,"1、分别要填写：nameservice名称、 namenode名称（多个以逗号分隔）、proxy.provider参数；"),s.a.createElement("li",null,"2、所有参数以JSON格式填写；"),s.a.createElement("li",null,"3、格式为：",s.a.createElement("br",null),'"dfs.nameservices": "nameservice名称", "dfs.ha.namenodes.nameservice名称": "namenode名称，以逗号分隔", "dfs.namenode.rpc-address.nameservice名称.namenode名称": "", "dfs.namenode.rpc-address.nameservice名称.namenode名称": "", "dfs.client.failover.proxy.provider.',s.a.createElement("br",null),'nameservice名称": "org.apache.hadoop.',s.a.createElement("br",null),"hdfs.server.namenode.ha.",s.a.createElement("br",null),'ConfiguredFailoverProxyProvider"'),s.a.createElement("li",null,"4、详细参数含义请参考《帮助文档》或",s.a.createElement("a",{href:"http://hadoop.apache.org/docs/r2.7.4/hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html",target:"blank"},"Hadoop官方文档")))),ur=s.a.createElement("div",null,"JDBC URL配置参考：",s.a.createElement("ul",null,s.a.createElement("li",null,"MySQL: jdbc:mysql://host:port/batch?useCursorFetch=true"),s.a.createElement("li",null,"Oracle: jdbc:oracle:thin:@host:port:ORCL"),s.a.createElement("li",null,"Hive: jdbc:hive2://host:port/projectName"))),dr=s.a.createElement("div",null,"HBase配置说明：",s.a.createElement("ul",null,s.a.createElement("li",null,'1、Zookeeper 集群的地址，多个地址间用逗号分割。例 如：" IP1:Port, IP2:Port, IP3:Port/子目录".默认是 localhost,是给伪分布式用的。要修改才能在完全分布式的情况下使用。如果在hbase-env.sh设置了HBASEMANAGESZK， 这些ZooKeeper节点就会和HBase一起启动'),s.a.createElement("li",null,"2、Port: ZooKeeper的zoo.conf中的配置。客户端连接的端口， 默认2181"),s.a.createElement("li",null,"3、子目录：HBase在ZooKeeper中配置的子目录"))),mr=s.a.createElement("div",null,s.a.createElement("p",null,"保存到默认位置，您可以在“数据管理-脏数据管理”中查看，表名：defaultName（生命周期：30天）")),pr=s.a.createElement("div",null,s.a.createElement("p",null,"任务执行结束后统计错误记录占比，当比例过高时，将此任务实例置为失败")),hr=function(e){function t(){return g()(this,t),S()(this,(t.__proto__||h()(t)).apply(this,arguments))}return T()(t,e),E()(t,[{key:"render",value:function(){var e=this.props.doc;return s.a.createElement(ot.a,{key:e,title:n[e]},s.a.createElement(st.a,F()({className:"help-doc"},this.props.style,{type:"question-circle-o"})))}}]),t}(s.a.Component),fr=Wt.a.Item,gr=ht.a.Option,vr='{\n    "defaultFS": "",\n    "hadoopConfig": {\n        "dfs.nameservices": "defaultDfs", \n        "dfs.ha.namenodes.defaultDfs": "namenode1", \n        "dfs.namenode.rpc-address.defaultDfs.namenode1": "", \n        "dfs.client.failover.proxy.provider.defaultDfs": "org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider" \n    }\n}',Er=Object(k.b)(function(e){return{dataSource:e.dataSource}},function(e){return{getDataSourcesType:function(t){e(Ue(t))}}})(Kn=function(e){function t(){var e,a,n,r;g()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=S()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(o))),n.state={sourceType:void 0,hasHdfsConfig:!1,hadoopConfig:"defaultDfs"},n.onOk=function(e){var t=n.props,a=t.editDataSource,r=t.form;r.validateFields(function(e,t){e||(t.dataJson.jdbcUrl&&(t.dataJson.jdbcUrl=vt.a.trim(t.dataJson.jdbcUrl)),t.dataJson.defaultFS&&(t.dataJson.defaultFS=vt.a.trim(t.dataJson.defaultFS)),a(t,r))})},n.testConnection=function(){var e=n.state.sourceType,t=n.props.form,a=void 0;e===se.MAXCOMPUTE&&(a=["type","dataName","dataJson.project","dataJson.endPoint","dataJson.accessKey","dataJson.accessId"]),t.validateFields(a,function(e,t){e||Fe.testDSConnection(t).then(function(e){e.data?zt.a.success("数据源连接正常！"):zt.a.error("数据库连接失败！")})})},n.cancel=function(){var e=n.props,t=e.form,a=e.handCancel;t.resetFields(),a()},n.sourceChange=function(e){n.setState({sourceType:parseInt(e)}),n.props.form.resetFields()},n.enableHdfsConfig=function(e){n.setState({hasHdfsConfig:!e.target.value})},n.renderSourceType=function(e){return e.map(function(e){return s.a.createElement(gr,{key:e.value,value:e.value.toString()},e.name)})},r=a,S()(n,r)}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.sourceData,a=e.sourceData;a&&a!==t&&(7===a.type?this.setState({sourceType:a.type||1,hasHdfsConfig:!0}):this.setState({sourceType:a.type||1}))}},{key:"renderDynamic",value:function(){var e=this.state,t=e.hasHdfsConfig,a=e.sourceType,n=this.props,r=n.form,i=n.sourceData,o=r.getFieldDecorator,l=i.dataJson||{};switch(a){case se.HIVE:return s.a.createElement("div",null,s.a.createElement(fr,F()({},ge,{label:"JDBC URL",hasFeedback:!0}),o("dataJson.jdbcUrl",{rules:[{required:!0,message:"jdbcUrl不可为空！"}],initialValue:l.jdbcUrl||""})(s.a.createElement(gt.a,{autoComplete:"off"}))),s.a.createElement(fr,F()({},ge,{label:"用户名"}),o("dataJson.username",{rules:[],initialValue:l.username||""})(s.a.createElement(gt.a,{autoComplete:"off"}))),s.a.createElement(fr,F()({},ge,{label:"密码"}),o("dataJson.password",{rules:[],initialValue:""})(s.a.createElement(gt.a,{type:"password"}))),s.a.createElement(fr,F()({},ge,{label:"defaultFS",hasFeedback:!0}),o("dataJson.defaultFS",{rules:[{required:!0,message:"defaultFS不可为空！"}],initialValue:l.defaultFS||""})(s.a.createElement(gt.a,{placeholder:"hdfs://host:port"}))),s.a.createElement(fr,Ee,o("hasHdfsConfig",{initialValue:!1})(s.a.createElement(at.a,{checked:t,onChange:this.enableHdfsConfig},"高可用配置"))),s.a.createElement(fr,F()({},ge,{label:"高可用配置",style:{display:t?"block":"none"}}),o("dataJson.hadoopConfig",{rules:[],initialValue:l.hadoopConfig||""})(s.a.createElement(gt.a,{type:"textarea",rows:5,placeholder:vr})),s.a.createElement(hr,{doc:"hdfsConfig"}),s.a.createElement(ar.a,{style:{position:"absolute",right:"-20px",bottom:"0px"},copyText:vr})));case se.MAXCOMPUTE:return s.a.createElement("div",null,s.a.createElement(fr,F()({},ge,{label:"AccessId",hasFeedback:!0}),o("dataJson.accessId",{rules:[{required:!0,message:"access ID不可为空！"}],initialValue:l.accessId||""})(s.a.createElement(gt.a,{autoComplete:"off"}))),s.a.createElement(fr,F()({},ge,{label:"AccessKey",hasFeedback:!0}),o("dataJson.accessKey",{rules:[{required:!0,message:"access Key不可为空！"}],initialValue:l.accessKey||""})(s.a.createElement(gt.a,{type:"password",autoComplete:"off"}))),s.a.createElement(fr,F()({},ge,{label:"Project Name",hasFeedback:!0}),o("dataJson.project",{rules:[{required:!0,message:"Project Name不可为空！"}],initialValue:l.project||""})(s.a.createElement(gt.a,{autoComplete:"off"}))),s.a.createElement(fr,F()({},ge,{label:"End Point",hasFeedback:!0}),o("dataJson.endPoint",{rules:[{required:!0,message:"End Point不可为空！"}],initialValue:l.endPoint||""})(s.a.createElement(gt.a,{autoComplete:"off"}))));case se.MYSQL:case se.ORACLE:case se.SQLSERVER:return s.a.createElement("div",null,s.a.createElement(fr,F()({},ge,{label:"JDBC URL",hasFeedback:!0}),o("dataJson.jdbcUrl",{rules:[{required:!0,message:"jdbcUrl不可为空！"}],initialValue:l.jdbcUrl||""})(s.a.createElement(gt.a,{autoComplete:"off"}))),s.a.createElement(fr,F()({},ge,{label:"用户名",hasFeedback:!0}),o("dataJson.username",{rules:[{required:!0,message:"用户名不可为空！"}],initialValue:l.username||""})(s.a.createElement(gt.a,{autoComplete:"off"}))),s.a.createElement(fr,F()({},ge,{label:"密码",hasFeedback:!0}),o("dataJson.password",{rules:[{required:!0,message:"密码不可为空！"}],initialValue:""})(s.a.createElement(gt.a,{type:"password"}))))}}},{key:"render",value:function(){var e=this.props,t=e.visible,a=e.form,n=e.title,r=e.sourceData,i=e.status,o=e.dataSource,l=(this.state.hasHdfsConfig,a.getFieldDecorator);return s.a.createElement(rt.a,{title:n,maskClosable:!1,wrapClassName:"vertical-center-modal",visible:t,onCancel:this.cancel,footer:!1},s.a.createElement(Wt.a,null,s.a.createElement(fr,F()({},ge,{label:"数据源类型",hasFeedback:!0}),l("type",{rules:[{required:!0,message:"数据源类型不可为空！"}],initialValue:r.type?r.type.toString():"1"})(s.a.createElement(ht.a,{onChange:this.sourceChange,disabled:"edit"===i},this.renderSourceType(o.sourceType)))),s.a.createElement(fr,F()({},ge,{label:"数据源名称",hasFeedback:!0}),l("dataName",{rules:[{required:!0,message:"数据源名称不可为空！"},{max:128,message:"数据源名称不得超过128个字符！"},{pattern:/^[A-Za-z0-9_]+$/,message:"名称只能由字母与数字、下划线组成"}],initialValue:r.dataName||""})(s.a.createElement(gt.a,{autoComplete:"off",disabled:"edit"===i}))),s.a.createElement(fr,F()({},ge,{label:"数据源描述",hasFeedback:!0}),l("dataDesc",{rules:[{max:200,message:"描述请控制在200个字符以内！"}],initialValue:r.dataDesc||""})(s.a.createElement(gt.a,{type:"textarea",rows:4}))),this.renderDynamic(),s.a.createElement(fr,Ee,s.a.createElement(Gt.a,{icon:"sync",type:"primary","data-target":"test",onClick:this.testConnection,style:{marginRight:"10px"}},"测试连通性"),s.a.createElement(Gt.a,{type:"primary",style:{marginRight:"10px"},onClick:this.onOk},"确定"),s.a.createElement(Gt.a,{onClick:this.cancel},"取消"))))}}]),t}(l.Component))||Kn,yr=Wt.a.create()(Er),Sr=gt.a.Search,br=Object(k.b)(function(e){return{dataSource:e.dataSource}},function(e){return{getDataSources:function(t){e(Ve(t))}}})(Bn=function(e){function t(){var e,a,n,r;g()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=S()(this,(e=t.__proto__||h()(t)).call.apply(e,[this].concat(o))),n.state={visible:!1,title:"新增数据源",status:"add",source:{},params:{currentPage:1,pageSize:20,name:void 0,type:void 0,active:void 0}},n.searchDataSources=function(e){var t=F()({},n.state.params,{name:e||void 0,currentPage:1});n.setState({params:t}),n.props.getDataSources(t)},n.editDataSource=function(e,t){var a=n.state,r=a.title,i=a.status,o=a.source,l=a.params;"edit"===i?Fe.updateDataSource(F()({},o,e)).then(function(e){1===e.code&&(t.resetFields(),n.setState({visible:!1}),zt.a.success(r+"成功！"),n.props.getDataSources(l))}):Fe.addDataSource(e).then(function(e){1===e.code&&(t.resetFields(),n.setState({visible:!1}),zt.a.success(r+"成功！"),n.props.getDataSources(l))})},n.remove=function(e){1!==e.active?Fe.deleteDataSource({sourceId:e.id}).then(function(e){1===e.code&&(zt.a.success("移除数据源成功！"),n.props.getDataSources(n.state.params))}):zt.a.info("此数据源已在任务中被引用，无法删除!")},n.handleTableChange=function(e,t){var a=t.active,r=t.type,i=F()({},n.state.params,{currentPage:e.current,active:a?a[0]:void 0,type:r?r[0]:void 0});n.setState({params:i}),n.props.getDataSources(i)},n.initEdit=function(e){n.setState({visible:!0,title:"编辑数据源",status:"edit",source:e})},n.initColumns=function(){return[{title:"数据源名称",dataIndex:"dataName",key:"dataName",width:"18%",render:function(e){return s.a.createElement("div",{className:"ellipsis-td",title:e},e)}},{title:"类型",dataIndex:"type",key:"type",filters:de,filterMultiple:!1,width:"10%",render:function(e,t){return t.sourceTypeValue}},{title:"描述信息",dataIndex:"dataDesc",key:"dataDesc",width:"22%"},{title:"最近修改人",dataIndex:"modifyUserName",key:"modifyUserName",width:"15%"},{title:"最近修改时间",dataIndex:"gmtModified",key:"gmtModified",render:function(e){return ee()(e).format("YYYY-MM-DD HH:mm:ss")},width:"15%"},{title:"应用状态",dataIndex:"active",key:"active",filters:[{text:"未使用",value:0},{text:"使用中",value:1}],filterMultiple:!1,render:function(e){return 1===e?"使用中":"未使用"},width:"10%"},{title:s.a.createElement(ot.a,{placement:"top",title:"系统每隔10分钟会尝试连接一次数据源，如果无法连通，则会显示连接失败的状态。数据源连接失败会导致同步任务执行失败。",arrowPointAtCenter:!0},s.a.createElement("span",null,"连接状态  ",s.a.createElement(st.a,{type:"question-circle-o"}))),dataIndex:"linkState",key:"linkState",width:"10%",render:function(e){return 1===e?s.a.createElement("span",null,s.a.createElement(St.a,{style:{background:"#00A755"}})," 正常"):s.a.createElement("span",null,s.a.createElement(St.a,{style:{background:"#EF5350"}})," 连接失败")}},{title:"操作",width:"10%",render:function(e,t){return s.a.createElement("span",null,s.a.createElement("a",{onClick:function(){n.initEdit(t)}},"编辑"),s.a.createElement("span",{className:"ant-divider"}),s.a.createElement(Bt.a,{title:"确定删除此数据源？",okText:"确定",cancelText:"取消",onConfirm:function(){n.remove(t)}},s.a.createElement("a",null,"删除")))}}]},r=a,S()(n,r)}return T()(t,e),E()(t,[{key:"componentDidMount",value:function(){this.props.getDataSources(this.state.params)}},{key:"render",value:function(){var e=this,t=this.state,a=t.visible,n=t.title,r=t.status,i=t.source,o=t.params,l=this.props.dataSource,c=l.sourceQuery,u=l.loading,d={current:o.currentPage,pageSize:o.pageSize,total:c.totalCount},m=s.a.createElement(Sr,{placeholder:"数据源名称",style:{width:200,margin:"10px 0"},onSearch:this.searchDataSources}),p=s.a.createElement(Gt.a,{type:"primary",style:{margin:"10px 0"},className:"right",onClick:function(){e.setState({visible:!0,source:{},status:"add",title:"添加数据源"})}},"新增数据源");return s.a.createElement("div",{className:"source-page"},s.a.createElement("h1",{className:"box-title"},"数据源管理"),s.a.createElement("div",{className:"box-2 m-card shadow"},s.a.createElement(q.a,{noHovering:!0,bordered:!1,title:m,extra:p},s.a.createElement(H.a,{rowKey:"id",loading:u,className:"m-table fixed-table",pagination:d,columns:this.initColumns(),dataSource:c.data,onChange:this.handleTableChange}))),s.a.createElement(yr,{title:n,status:r,visible:a,sourceData:i,editDataSource:this.editDataSource,handCancel:function(){e.setState({visible:!1,source:{}})}}))}}]),t}(l.Component))||Bn,Tr=s.a.createElement(C.d,{path:"/",component:N.a},s.a.createElement(C.b,{component:et}),s.a.createElement(C.d,{path:"/message",component:P.a},s.a.createElement(C.b,{component:I.a}),s.a.createElement(C.d,{path:"list",component:I.a}),s.a.createElement(C.d,{path:"detail/:msgId",component:w.a})),s.a.createElement(C.d,{path:"/admin",component:D.a},s.a.createElement(C.b,{component:x.a}),s.a.createElement(C.d,{path:"user",component:x.a}),s.a.createElement(C.d,{path:"role",component:_.a}),s.a.createElement(C.d,{path:"role/add",component:R.a}),s.a.createElement(C.d,{path:"role/edit/:roleId",component:L.a})),s.a.createElement(C.d,{path:"/dq",component:et},s.a.createElement(C.b,{component:Re}),s.a.createElement(C.d,{path:"overview",component:Re}),s.a.createElement(C.d,{path:"taskQuery",component:Vt}),s.a.createElement(C.d,{path:"rule",component:La}),s.a.createElement(C.d,{path:"rule/add",component:nn}),s.a.createElement(C.d,{path:"rule/edit/:id",component:nn}),s.a.createElement(C.d,{path:"dataCheck",component:gn}),s.a.createElement(C.d,{path:"dataCheck/add",component:er}),s.a.createElement(C.d,{path:"dataCheck/edit/:verifyId",component:er}),s.a.createElement(C.d,{path:"dataCheck/report/:verifyRecordId",component:tr}),s.a.createElement(C.d,{path:"dataSource",component:br}))),Cr=function(e){function t(){return g()(this,t),S()(this,(t.__proto__||h()(t)).apply(this,arguments))}return T()(t,e),E()(t,[{key:"render",value:function(){var e=this.props,t=e.store,a=e.history;return s.a.createElement(k.a,{store:t},s.a.createElement(C.e,{routes:Tr,history:a,key:Math.random()}))}}]),t}(s.a.Component);Qn=Cr,Wn=a("swku").default,Jn=Object(m.a)(Wn,"hash"),Xn=Jn.store,Zn=Jn.history,u.a.render(s.a.createElement(d.AppContainer,null,s.a.createElement(Qn,{store:Xn,history:Zn})),document.getElementById("app"))},kH9T:function(e,t,a){},oYF1:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a("zbcj"),r=a.n(n)()(["CHANGE_LOADING","GET_DATA_SOURCES","GET_DATA_SOURCES_TYPE","GET_DATA_SOURCES_LIST","CHANGE_GETTABLE_LOADING","GET_DATA_SOURCES_TABLE","RESET_DATA_SOURCES_TABLE","GET_DATA_SOURCES_COLUMN","GET_DATA_SOURCES_PART","RESET_DATA_SOURCES_PART","GET_DATA_SOURCES_PREVIEW"],{prefix:"dataSource/"})},pAlz:function(e,t,a){"use strict";a.d(t,"a",function(){return n}),a.d(t,"b",function(){return r});var n={mode:"text/x-sql",lint:!0,indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,autofocus:!1},r={mode:"text/x-properties",lint:!0,indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,autofocus:!1}},pKDC:function(e,t,a){"use strict";var n,r=a("P2sY"),i=a.n(r),o=a("FyfS"),l=a.n(o),s=a("Yz+Y"),c=a.n(s),u=a("iCc5"),d=a.n(u),m=a("V7oC"),p=a.n(m),h=a("FYw3"),f=a.n(h),g=a("mRg0"),v=a.n(g),E=a("sbe7"),y=a.n(E),S=a("pAlz"),b=a("lSrH"),T=(a("p77/"),a("DdDu"),a("O6QL"),a("w3QJ")),C=a("VrN/");a("/9rB"),a("25Eh"),a("+dQi"),a("3Fvf"),a("19Vz"),a("jDMi");var k=Object(b.a)(n=function(e){function t(){return d()(this,t),f()(this,(t.__proto__||c()(t)).apply(this,arguments))}return v()(t,e),p()(t,[{key:"componentDidMount",value:function(){var e=this.Editor,t=this.props.options||S.a,a=this.getCodeMirrorIns(),n=this.props,r=n.value,i=n.onChange,o=n.onFocus,l=n.cursor,s=n.focusOut,c=n.cursorActivity;e&&(this.self=a.fromTextArea(e,t),this.renderTextMark(),l&&this.self.doc.setCursor(l),this.self.on("change",function(e){i&&i(r,e.getValue(),e)}),this.self.on("focus",function(e){o&&o(r,e.getValue())}),this.self.on("blur",function(e){s&&s(r,e.getValue())}),this.self.on("cursorActivity",function(e){c&&c(r,e)}))}},{key:"componentWillReceiveProps",value:function(e){var t=e.value,a=e.sync,n=e.cursor,r=(e.placeholder,e.cursorAlwaysInEnd),i=e.options;i&&this.self.setOption("readOnly",i.readOnly),this.props.value!==t&&(n&&this.self.doc.setCursor(n),a&&(t?this.self.setValue(t):this.self.setValue(""),r&&this.self.doc.setCursor(this.self.doc.lineCount(),null)),this.renderTextMark())}},{key:"renderTextMark",value:function(){var e=this.self.doc.getAllMarks(),t=!0,a=!1,n=void 0;try{for(var r,i=l()(e);!(t=(r=i.next()).done);t=!0){r.value.clear()}}catch(e){a=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(a)throw n}}for(var o=this.self.getValue(),s=Object(T.b)(o),c=0;c<s.length;c++){var u=s[c];this.self.doc.markText(this.self.doc.posFromIndex(u.start),this.self.doc.posFromIndex(u.end),{replacedWith:u.node})}}},{key:"getCodeMirrorIns",value:function(){return this.self||C}},{key:"render",value:function(){var e=this,t=this.props,a=t.className,n=t.style,r="code-editor";r=a?r+" "+a:r;var o={position:"relative",minHeight:"400px"};return o=n?i()(o,n):o,y.a.createElement("div",{className:r,style:o},y.a.createElement("textarea",{ref:function(t){e.Editor=t},name:"code",placeholder:this.props.placeholder||"",defaultValue:this.props.value||""}))}}]),t}(E.Component))||n;t.a=k},swku:function(e,t,a){"use strict";a.r(t);var n=a("fvjX"),r=a("L3Ur"),i=a("6EK8"),o=a("+JEa"),l=a("MJ9B"),s=a("LvDl"),c={loading:!1,topRecords:[],alarmTrend:[],alarmSum:{},usage:{}};var u=a("j2qn"),d={loading:!1,taskList:[],taskDetail:[],tableReport:{},alarmNum:[]};var m=a("YXul"),p={loading:!1,lists:[],checkReport:{},originPart:[],targetPart:[],reportTable:{}};var h=a("oYF1"),f={loading:!1,tableLoading:!1,sourceQuery:[],sourceType:[],sourceList:[],sourceTable:[],sourceColumn:[],sourcePart:[],sourcePreview:{}};var g=a("tgFt"),v={loading:!1,monitorList:[],monitorFunction:[],tableColumn:[],monitorRules:[],monitorDetail:{},triggerList:[]};var E=a("m1cH"),y=a.n(E),S=a("u+gO"),b={source:[],target:[]};var T=a("F2FU"),C={userList:[],allDict:{}};var k=Object(n.c)({routing:r.routerReducer,user:i.a,app:o.a,apps:o.b,dashBoard:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,t=arguments[1],a=t.type,n=t.payload;switch(a){case l.a.CHANGE_LOADING:var r=Object(s.cloneDeep)(e),i=r.loading;return r.loading=!i,r;case l.a.GET_TOP_RECORD:var o=Object(s.cloneDeep)(e);return o.topRecords,o.topRecords=n,o;case l.a.GET_ALARM_SUM:var u=Object(s.cloneDeep)(e);return u.alarmSum,u.alarmSum=n,u;case l.a.GET_ALARM_TREND:var d=Object(s.cloneDeep)(e);return d.alarmTrend,d.alarmTrend=n,d;case l.a.GET_USAGE:var m=Object(s.cloneDeep)(e);return m.usage,m.usage=n,m;default:return e}},taskQuery:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments[1],a=t.type,n=t.payload;switch(a){case u.a.CHANGE_LOADING:var r=Object(s.cloneDeep)(e),i=r.loading;return r.loading=!i,r;case u.a.GET_TASK_LIST:var o=Object(s.cloneDeep)(e);return o.taskList,o.taskList=n,o;case u.a.GET_TASK_DETAIL:var l=Object(s.cloneDeep)(e);return l.taskDetail,l.taskDetail=n,l;case u.a.GET_TASK_TABLE_REPORT:var c=Object(s.cloneDeep)(e);return c.tableReport,c.tableReport=n,c;case u.a.GET_TASK_ALARM_NUM:var m=Object(s.cloneDeep)(e);return m.alarmNum,m.alarmNum=n,m;default:return e}},dataCheck:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments[1],a=t.type,n=t.payload;switch(a){case m.a.CHANGE_LOADING:var r=Object(s.cloneDeep)(e),i=r.loading;return r.loading=!i,r;case m.a.GET_LIST:var o=Object(s.cloneDeep)(e);return o.lists,o.lists=n,o;case m.a.GET_SOURCE_PART:var l=Object(s.cloneDeep)(e);return l.originPart,l.targetPart,"origin"===n.type?l.originPart=n.data:l.targetPart=n.data,l;case m.a.RESET_SOURCE_PART:var c=Object(s.cloneDeep)(e);return c.originPart,c.targetPart,"origin"===n?c.originPart=[]:c.targetPart=[],c;default:return e}},dataSource:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments[1],a=t.type,n=t.payload;switch(a){case h.a.CHANGE_LOADING:var r=Object(s.cloneDeep)(e),i=r.loading;return r.loading=!i,r;case h.a.CHANGE_GETTABLE_LOADING:var o=Object(s.cloneDeep)(e),l=o.tableLoading;return o.tableLoading=!l,o;case h.a.GET_DATA_SOURCES:var c=Object(s.cloneDeep)(e);return c.sourceQuery,c.sourceQuery=n,c;case h.a.GET_DATA_SOURCES_TYPE:var u=Object(s.cloneDeep)(e);return u.sourceType,u.sourceType=n,u;case h.a.GET_DATA_SOURCES_LIST:var d=Object(s.cloneDeep)(e);return d.sourceList,d.sourceList=n,d;case h.a.GET_DATA_SOURCES_TABLE:var m=Object(s.cloneDeep)(e);return m.sourceTable,m.sourceTable=n,m;case h.a.RESET_DATA_SOURCES_TABLE:var p=Object(s.cloneDeep)(e);return p.sourceTable,p.sourceTable=[],p;case h.a.GET_DATA_SOURCES_COLUMN:var g=Object(s.cloneDeep)(e);return g.sourceColumn,g.sourceColumn=n,g;case h.a.GET_DATA_SOURCES_PART:var v=Object(s.cloneDeep)(e);return v.sourcePart,v.sourcePart=n,v;case h.a.RESET_DATA_SOURCES_PART:var E=Object(s.cloneDeep)(e);return E.sourcePart,E.sourcePart=[],E;case h.a.GET_DATA_SOURCES_PREVIEW:var y=Object(s.cloneDeep)(e);return y.sourcePreview,y.sourcePreview=n,y;default:return e}},ruleConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments[1],a=t.type,n=t.payload;switch(a){case g.a.CHANGE_LOADING:var r=Object(s.cloneDeep)(e),i=r.loading;return r.loading=!i,r;case g.a.GET_MONITOR_LIST:var o=Object(s.cloneDeep)(e);return o.monitorList,o.monitorList=n,o;case g.a.GET_MONITOR_TABLE_COLUMN:var l=Object(s.cloneDeep)(e);return l.tableColumn,l.tableColumn=n,l;case g.a.GET_RULE_FUNCTION:var c=Object(s.cloneDeep)(e);return c.monitorFunction,c.monitorFunction=n,c;case g.a.GET_MONITOR_RULE:var u=Object(s.cloneDeep)(e);return u.monitorRules,u.monitorRules=n,u;case g.a.GET_MONITOR_DETAIL:var d=Object(s.cloneDeep)(e);return d.monitorDetail,d.monitorDetail=n,d;case g.a.GET_REMOTE_TRIGGER:var m=Object(s.cloneDeep)(e);return m.triggerList,m.triggerList=n,m;default:return e}},common:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments[1],a=t.type,n=t.payload;switch(a){case T.a.GET_USER_LIST:var r=Object(s.cloneDeep)(e);return r.userList,r.userList=n,r;case T.a.GET_ALL_DICT:var i=Object(s.cloneDeep)(e);return i.allDict,i.allDict=n,i;default:return e}},keymap:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments[1];switch(t.type){case S.a.ADD_LINKED_KEYS:var a=t.payload,n=Object(s.cloneDeep)(e),r=n.source,i=n.target,o=function(e,t){return e.indexOf(t)>-1};return o(r,a.source)?e:o(i,a.target)?e:(n.source=[].concat(y()(n.source),[a.source]),n.target=[].concat(y()(n.target),[a.target]),n);case S.a.DEL_LINKED_KEYS:var l=t.payload,c=Object(s.cloneDeep)(e),u=c.source,d=c.target;return u.splice(u.indexOf(l.source),1),d.splice(d.indexOf(l.target),1),c.source=u,c.target=d,c;case S.a.SET_EDIT_MAP:var m=t.payload,p=Object(s.cloneDeep)(e);return p.source=m.source,p.target=m.target,p;case S.a.SET_ROW_MAP:var h=t.payload,f=h.sourceKeyCol,g=h.targetKeyCol,v=[],E=[];return f.forEach(function(e,t){g[t]&&(v.push(e),E.push(g[t]))}),{source:v,target:E};case S.a.SET_NAME_MAP:var T=t.payload,C=T.sourceKeyCol,k=T.targetKeyCol,N=[],P=[];return C.forEach(function(e,t){k.indexOf(e)>-1&&(N.push(e),P.push(e))}),{source:N,target:P};case S.a.RESET_LINKED_KEYS:return{source:[],target:[]};default:return e}}});t.default=k},"t/36":function(e,t,a){},tgFt:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a("zbcj"),r=a.n(n)()(["CHANGE_LOADING","GET_MONITOR_LIST","GET_RULE_FUNCTION","GET_MONITOR_TABLE_COLUMN","CHANGE_PARAMS","GET_MONITOR_RULE","GET_MONITOR_DETAIL","GET_REMOTE_TRIGGER"],{prefix:"ruleConfig/"})},"u+gO":function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a("zbcj"),r=a.n(n)()(["ADD_LINKED_KEYS","DEL_LINKED_KEYS","SET_EDIT_MAP","SET_ROW_MAP","SET_NAME_MAP","RESET_LINKED_KEYS","EDIT_KEYMAP_TARGET","REMOVE_KEYMAP"],{prefix:"dataSource/keyMap/"})},w3QJ:function(e,t,a){"use strict";a.d(t,"a",function(){return d}),a.d(t,"b",function(){return m});var n=a("sk9p"),r=a.n(n),i=a("FyfS"),o=a.n(i),l=a("oF3Q"),s=a.n(l),c=a("gDS+"),u=a.n(c);function d(e){return"#link#"+u()(e)+"#link#"}function m(e){var t=/#link#(.+)#link#/g,a=[],n=void 0;for(n=t.exec(e);n;){var i=document.createElement("a"),l=JSON.parse(n[1]),c=s()(l),u=!0,d=!1,m=void 0;try{for(var p,h=o()(c);!(u=(p=h.next()).done);u=!0){var f=r()(p.value,2),g=f[0],v=f[1];i.setAttribute(g,v)}}catch(e){d=!0,m=e}finally{try{!u&&h.return&&h.return()}finally{if(d)throw m}}i.className="editor_custom_link",i.innerHTML="logDownload",a.push({start:n.index,end:n.index+n[0].length,node:i}),n=t.exec(e)}return a}},zXZS:function(e,t,a){"use strict";a.d(t,"a",function(){return h});var n=a("Yz+Y"),r=a.n(n),i=a("iCc5"),o=a.n(i),l=a("V7oC"),s=a.n(l),c=a("FYw3"),u=a.n(c),d=a("mRg0"),m=a.n(d),p=a("sbe7"),h=function(e){function t(){var e,a,n,i;o()(this,t);for(var l=arguments.length,s=Array(l),c=0;c<l;c++)s[c]=arguments[c];return a=n=u()(this,(e=t.__proto__||r()(t)).call.apply(e,[this].concat(s))),n.resize=function(){var e=n.props.onResize;e&&e()},i=a,u()(n,i)}return m()(t,e),s()(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resize,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize,!1)}},{key:"render",value:function(){return this.props.children}}]),t}(p.Component)}},[["j7hF",19,21,20,23,24,26,29,22]]]);