(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"5GXF":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=a("eKCK"),i=(n=r)&&n.__esModule?n:{default:n};t.default=i.default,e.exports=t.default},"7LYo":function(e,t,a){"use strict";a("VEUW"),a("n3pV")},E1MH:function(e,t,a){"use strict";a.r(t);var n=a("sbe7"),r=a.n(n),i=a("17x9"),o=a.n(i),l=a("TSYQ"),s=a.n(l),c=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n["Component"]),c(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.isActive||e.isActive}},{key:"render",value:function(){var e;if(this._isActived=this._isActived||this.props.isActive,!this._isActived)return null;var t=this.props,a=t.prefixCls,n=t.isActive,i=t.children,o=t.destroyInactivePanel,l=s()((p(e={},a+"-content",!0),p(e,a+"-content-active",n),p(e,a+"-content-inactive",!n),e)),c=!n&&o?null:r.a.createElement("div",{className:a+"-content-box"},i);return r.a.createElement("div",{className:l,role:"tabpanel"},c)}}]),t}();u.propTypes={prefixCls:o.a.string,isActive:o.a.bool,children:o.a.any,destroyInactivePanel:o.a.bool};var m=u,d=a("MFj2"),y=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();function h(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n["Component"]),y(t,[{key:"handleItemClick",value:function(){this.props.onItemClick&&this.props.onItemClick()}},{key:"render",value:function(){var e,t=this.props,a=t.className,n=t.id,i=t.style,o=t.prefixCls,l=t.header,c=t.headerClass,p=t.children,u=t.isActive,y=t.showArrow,f=t.destroyInactivePanel,v=t.disabled,g=s()(o+"-header",h({},c,c)),b=s()((h(e={},o+"-item",!0),h(e,o+"-item-active",u),h(e,o+"-item-disabled",v),e),a);return r.a.createElement("div",{className:b,style:i,id:n,role:"tablist"},r.a.createElement("div",{className:g,onClick:this.handleItemClick.bind(this),role:"tab","aria-expanded":u},y&&r.a.createElement("i",{className:"arrow"}),l),r.a.createElement(d.default,{showProp:"isActive",exclusive:!0,component:"",animation:this.props.openAnimation},r.a.createElement(m,{prefixCls:o,isActive:u,destroyInactivePanel:f},p)))}}]),t}();f.propTypes={className:o.a.oneOfType([o.a.string,o.a.object]),id:o.a.string,children:o.a.any,openAnimation:o.a.object,prefixCls:o.a.string,header:o.a.oneOfType([o.a.string,o.a.number,o.a.node]),headerClass:o.a.string,showArrow:o.a.bool,isActive:o.a.bool,onItemClick:o.a.func,style:o.a.object,destroyInactivePanel:o.a.bool,disabled:o.a.bool},f.defaultProps={showArrow:!0,isActive:!1,destroyInactivePanel:!1,onItemClick:function(){},headerClass:""};var v=f,g=a("J9Du");function b(e,t,a,n){var r=void 0;return Object(g.default)(e,a,{start:function(){t?(r=e.offsetHeight,e.style.height=0):e.style.height=e.offsetHeight+"px"},active:function(){e.style.height=(t?r:0)+"px"},end:function(){e.style.height="",n()}})}var C=function(e){return{enter:function(t,a){return b(t,!0,e+"-anim",a)},leave:function(t,a){return b(t,!1,e+"-anim",a)}}},T=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();function E(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function O(e){var t=e;return Array.isArray(t)||(t=t?[t]:[]),t}var k=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n=a.props,r=n.activeKey,i=n.defaultActiveKey;return"activeKey"in a.props&&(i=r),a.state={openAnimation:a.props.openAnimation||C(a.props.prefixCls),activeKey:O(i)},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n["Component"]),T(t,[{key:"componentWillReceiveProps",value:function(e){"activeKey"in e&&this.setState({activeKey:O(e.activeKey)}),"openAnimation"in e&&this.setState({openAnimation:e.openAnimation})}},{key:"onClickItem",value:function(e){var t=this.state.activeKey;if(this.props.accordion)t=t[0]===e?[]:[e];else{var a=(t=[].concat(function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}(t))).indexOf(e);a>-1?t.splice(a,1):t.push(e)}this.setActiveKey(t)}},{key:"getItems",value:function(){var e=this,t=this.state.activeKey,a=this.props,i=a.prefixCls,o=a.accordion,l=a.destroyInactivePanel,s=[];return n.Children.forEach(this.props.children,function(a,n){if(a){var c=a.key||String(n),p=a.props,u=p.header,m=p.headerClass,d=p.disabled,y=!1;y=o?t[0]===c:t.indexOf(c)>-1;var h={key:c,header:u,headerClass:m,isActive:y,prefixCls:i,destroyInactivePanel:l,openAnimation:e.state.openAnimation,children:a.props.children,onItemClick:d?null:function(){return e.onClickItem(c)}};s.push(r.a.cloneElement(a,h))}}),s}},{key:"setActiveKey",value:function(e){"activeKey"in this.props||this.setState({activeKey:e}),this.props.onChange(this.props.accordion?e[0]:e)}},{key:"render",value:function(){var e,t=this.props,a=t.prefixCls,n=t.className,i=t.style,o=s()((E(e={},a,!0),E(e,n,!!n),e));return r.a.createElement("div",{className:o,style:i},this.getItems())}}]),t}();k.propTypes={children:o.a.any,prefixCls:o.a.string,activeKey:o.a.oneOfType([o.a.string,o.a.arrayOf(o.a.string)]),defaultActiveKey:o.a.oneOfType([o.a.string,o.a.arrayOf(o.a.string)]),openAnimation:o.a.object,onChange:o.a.func,accordion:o.a.bool,className:o.a.string,style:o.a.object,destroyInactivePanel:o.a.bool},k.defaultProps={prefixCls:"rc-collapse",onChange:function(){},accordion:!1,destroyInactivePanel:!1},k.Panel=v;var P=k;a.d(t,"Panel",function(){return x});t.default=P;var x=P.Panel},UCWl:function(e,t,a){"use strict";a.r(t);a("hr7U");var n,r,i,o,l=a("9xET"),s=a.n(l),c=(a("fv9D"),a("ZPTe")),p=a.n(c),u=(a("MaXC"),a("4IMT")),m=a.n(u),d=(a("cUip"),a("iJl9")),y=a.n(d),h=a("QbLZ"),f=a.n(h),v=a("4d7F"),g=a.n(v),b=a("P2sY"),C=a.n(b),T=(a("PAYn"),a("EQeY")),E=a.n(T),O=(a("tL+A"),a("QpBz")),k=a.n(O),P=a("Yz+Y"),x=a.n(P),S=a("iCc5"),I=a.n(S),w=a("V7oC"),N=a.n(w),_=a("FYw3"),A=a.n(_),K=a("mRg0"),D=a.n(K),L=(a("nTym"),a("qu0K")),V=a.n(L),F=(a("fwXI"),a("CC+v")),R=a.n(F),j=a("sbe7"),M=a.n(j),q=a("/MKj"),z=a("dtw8"),U=a("LvDl"),W=a("7Qib"),Y=a("bAm3"),H=a("sVOr"),Q=a("/gYX"),B=a("dDU9"),G=a("2KkY"),J=a("W9Sf"),X=a("5Gkw"),Z=a("djHj"),$=(a("G851"),a("ZvzK")),ee=a.n($),te=(a("FGdI"),a("Pbn2")),ae=a.n(te),ne=(a("PFYH"),a("Jv8k")),re=a.n(ne),ie=a("FyfS"),oe=a.n(ie),le=(a("8YFG"),a("ATwu")),se=a.n(le),ce=(a("Z8Mf"),a("j7zX")),pe=a.n(ce),ue=a("tHbZ"),me=a("moyJ"),de=(a("7kJ1"),a("qPIi")),ye=a.n(de),he=V.a.Item,fe=ye.a.Group,ve=function(e){function t(){return I()(this,t),A()(this,(t.__proto__||x()(t)).apply(this,arguments))}return D()(t,e),N()(t,[{key:"render",value:function(){var e=this.props,t=e.form,a=e.currentPage,n=t.getFieldDecorator;return M.a.createElement("div",{style:{padding:"60px"}},M.a.createElement(V.a,null,M.a.createElement(he,f()({},Z.y,{label:"任务名称",hasFeedback:!0}),n("name",{rules:[{required:!0,message:"任务名称不可为空！"},{max:64,message:"任务名称不得超过64个字符！"}],initialValue:a?a.name:""})(M.a.createElement(y.a,null))),M.a.createElement(he,f()({},Z.y,{label:"任务类型"}),n("taskType",{rules:[],initialValue:a?a.taskType:0})(M.a.createElement(fe,{disabled:!0},M.a.createElement(ye.a,{value:0},"SQL任务"),M.a.createElement(ye.a,{value:1},"MR任务")))),M.a.createElement(he,f()({},Z.y,{label:"资源",hasFeedback:!0}),a&&a.resourceList&&a.resourceList.length>0?a.resourceList[0].resourceName:""),M.a.createElement(he,f()({},Z.y,{label:"mainClass"}),n("mainClass",{rules:[{}],initialValue:a&&a.mainClass})(M.a.createElement(y.a,{placeholder:"请输入mainClass"}))),M.a.createElement(he,f()({},Z.y,{label:"参数"}),n("exeArgs",{rules:[{}],initialValue:a&&a.exeArgs})(M.a.createElement(y.a,{placeholder:"请输入任务参数"}))),M.a.createElement(he,f()({},Z.y,{label:"描述",hasFeedback:!0}),n("taskDesc",{rules:[],initialValue:a?a.taskDesc:""})(M.a.createElement(y.a,{type:"textarea",rows:4})))))}}]),t}(j.Component),ge=V.a.create({onValuesChange:function(e,t){var a=e.dispatch,n=e.currentPage,r=!1;""===t.name&&(r=!0),t.invalid=r;var i=C()(n,t);a(G.x(i)),a(G.B(i))}})(ve),be=a("fvjX"),Ce=a("76p7"),Te=a("Ohfy"),Ee=a("dmTY"),Oe=Object(q.b)(function(e){return{editor:e.editor}},function(e){var t=Object(be.b)(Ee,e);return C()(t,{setCurrentPage:function(t){e(Object(G.x)(t))}})})(n=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=A()(this,(e=t.__proto__||x()(t)).call.apply(e,[this].concat(o))),n.onContentChange=function(e,t){(0,n.props.editorChange)({merged:!1,sqlText:e,cursorPosition:t.getPosition()})},n.sqlFormat=function(){var e=n.props,t=e.currentPage,a=e.setCurrentPage,r={sql:t.sqlText||""};H.a.streamSqlFormat(r).then(function(e){if(e.data){var n={merged:!0,sqlText:e.data,id:t.id},r=C()(t,n);a(r)}})},n.debounceSelectionChange=Object(U.debounce)(n.props.setSelectionContent,200,{maxWait:2e3}),r=a,A()(n,r)}return D()(t,e),N()(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.currentPage,n=t.editor,r=a.cursorPosition||void 0,i=a.readWriteLockVO&&!a.readWriteLockVO.getLock,o={value:a.sqlText,language:"dtsql",options:{readOnly:i},cursorPosition:r,theme:n.options.theme,onChange:this.onContentChange,sync:a.merged||void 0,onCursorSelection:this.debounceSelectionChange},l={enable:!0,enableRun:!1,enableFormat:!0,onFileEdit:Object(Ce.a)(this._editor),onFormat:this.sqlFormat,onThemeChange:function(t){e.props.updateEditorOptions({theme:t})}};return M.a.createElement(Te.a,{editor:o,toolbar:l,key:"main-editor-"+a.id,editorInstanceRef:function(t){e._editor=t}})}}]),t}(j.Component))||n,ke=function(e){function t(){return I()(this,t),A()(this,(t.__proto__||x()(t)).apply(this,arguments))}return D()(t,e),N()(t,[{key:"render",value:function(){var e=this.props.currentPage.taskType===Z.v.SQL?M.a.createElement(Oe,this.props):M.a.createElement(ge,this.props);return M.a.createElement("div",{className:"editor-container"},e)}}]),t}(j.Component),Pe=(a("7LYo"),a("5GXF")),xe=a.n(Pe),Se=(a("ek7I"),a("FAat")),Ie=a.n(Se),we=a("I/n2"),Ne=Ie.a.Option,_e=xe.a.Panel,Ae=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=A()(this,(e=t.__proto__||x()(t)).call.apply(e,[this].concat(o))),n.state={visibleAlterRes:!1,resList:[]},n.handleChange=function(e){n.setState({resList:e})},n.alterRes=function(){var e=n,t=n.props.currentPage,a=n.state.resList;0!==(a=Array.isArray(a)?a:[a]).length?t&&t.id&&a.length>0&&H.a.updateTaskRes({id:t.id,resources:a}).then(function(a){1===a.code&&(k.a.success("资源修改成功！"),e.reloadTask(t.id),e.setState({visibleAlterRes:!1,resList:[]}))}):k.a.info("您没有选择任何资源！")},r=a,A()(n,r)}return D()(t,e),N()(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;if(t.id!==a.id){var n=t.resourceList.length>0?t.resourceList.map(function(e){return e.id}):[];this.setState({resList:n})}}},{key:"reloadTask",value:function(e){var t=this.props.dispatch;H.a.getTask({taskId:e}).then(function(e){1===e.code&&(t(G.x(e.data)),t(G.B(e.data)))})}},{key:"render",value:function(){var e=this,t=this.state,a=t.visibleAlterRes,n=t.resList,r=this.props,i=r.resources,o=r.currentPage,l=r.editorChange,c=o.resourceList&&o.resourceList.map(function(e){return M.a.createElement(E.a,{key:e.id,color:"blue"},e.resourceName)}),u=i&&i.map(function(e){return M.a.createElement(Ne,{value:e.id,key:e.id,name:e.resourceName},e.resourceName)});return M.a.createElement("div",{className:"m-taksdetail"},M.a.createElement(xe.a,{bordered:!1,defaultActiveKey:["1","2"]},M.a.createElement(_e,{key:"1",header:"任务属性"},M.a.createElement(s.a,{className:"task-info"},M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"任务名称："),M.a.createElement(p.a,{span:"14"},o.name)),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"任务类型："),M.a.createElement(p.a,{span:"14"},0===o.taskType?"SQL任务":"MR任务")),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"资源："),M.a.createElement(p.a,{span:"14",style:{marginTop:"10px"}},c)),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"创建人员："),M.a.createElement(p.a,{span:"14"},o.createUserName)),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"创建时间："),M.a.createElement(p.a,{span:"14"},W.a.formatDateTime(o.gmtCreate))),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"最近修改时间："),M.a.createElement(p.a,{span:"14"},W.a.formatDateTime(o.gmtModified))),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"描述："),M.a.createElement(p.a,{span:"14"},o.taskDesc)),M.a.createElement(R.a,{title:"修改任务资源",wrapClassName:"vertical-center-modal",visible:a,onCancel:function(){e.setState({visibleAlterRes:!1})},onOk:this.alterRes},M.a.createElement(Ie.a,{mode:0===o.taskType?"multiple":"",style:{width:"100%"},showSearch:!0,value:n,placeholder:"请选择资源",optionFilterProp:"name",onChange:this.handleChange},u)))),M.a.createElement(_e,{key:"2",header:"历史发布版本"},M.a.createElement(we.a,{taskInfo:o,changeSql:l,taskType:"realTimeTask"}))))}}]),t}(j.Component),Ke=(a("/xgg"),a("aOJk")),De=a.n(Ke),Le=a("gDS+"),Ve=a.n(Le),Fe=a("YEIV"),Re=a.n(Fe),je=(a("b+Mx"),a("5Dct")),Me=a.n(je),qe=(a("93XW"),a("d1El")),ze=a.n(qe),Ue=(a("zmYW"),a("DtFj")),We=a.n(Ue),Ye=a("DE4S"),He=Ie.a.Option,Qe=xe.a.Panel,Be=ye.a.Group,Ge=(We.a.Column,We.a.ColumnGroup,V.a.Item),Je=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=A()(this,(e=t.__proto__||x()(t)).call.apply(e,[this].concat(o))),n.checkParams=function(){var e=n.props,t=e.index,a=(e.panelColumn[t].columns,{});return n.props.form.validateFields(function(e,t){a.status=!e}),a},n.originOption=function(e,t){switch(e){case"originType":return t.map(function(e){return M.a.createElement(He,{key:e,value:""+e.id},e.name)});case"currencyType":return t.map(function(e){return M.a.createElement(He,{key:e,value:""+e},e)});case"eventTime":return t.map(function(e,t){return M.a.createElement(He,{key:t,value:""+e.column},e.column)});default:return null}},r=a,A()(n,r)}return D()(t,e),N()(t,[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"editorParamsChange",value:function(e,t,a){var n=this.props,r=n.handleInputChange,i=n.index;this._syncEditor=!1,r("columnsText",i,t)}},{key:"render",value:function(){var e=this.props,t=e.handleInputChange,a=e.index,n=e.panelColumn,r=e.sync,i=e.timeColumoption,o=void 0===i?[]:i,l=e.originOptionType,c=void 0===l?[]:l,u=e.topicOptionType,m=void 0===u?[]:u,d=this.originOption("originType",c[a]||[]),h=this.originOption("currencyType",m[a]||[]),v=this.originOption("eventTime",o[a]||[]),g=this.props.form.getFieldDecorator,b={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}};return M.a.createElement(s.a,{className:"title-content"},M.a.createElement(V.a,null,M.a.createElement(Ge,f()({},b,{label:"类型"}),g("type",{rules:[{required:!0,message:"请选择类型"}]})(M.a.createElement(Ie.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("type",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},M.a.createElement(He,{value:"14"},"Kafka")))),M.a.createElement(Ge,f()({},b,{label:"数据源"}),g("sourceId",{rules:[{required:!0,message:"请选择数据源"}]})(M.a.createElement(Ie.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("sourceId",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},d))),M.a.createElement(Ge,f()({},b,{label:"Topic"}),g("topic",{rules:[{required:!0,message:"请选择Topic"}]})(M.a.createElement(Ie.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("topic",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},h))),M.a.createElement(Ge,f()({},b,{label:M.a.createElement("span",null,"映射表 ",M.a.createElement(ze.a,{title:"该表是kafka中的topic映射而成，可以以SQL的方式使用它。"},M.a.createElement(ae.a,{type:"question-circle-o"})))}),g("table")(M.a.createElement(y.a,{placeholder:"请输入映射表名",className:"right-input",onChange:function(e){return t("table",a,e.target.value)}}))),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"6"},M.a.createElement("span",{style:{color:"rgba(0, 0, 0, 0.85)",paddingRight:10,float:"right"}},"字段 :")),M.a.createElement(p.a,{span:"18",style:{marginBottom:20,height:202}},M.a.createElement(Ye.a,{style:{minHeight:202,border:"1px solid #ddd"},key:"params-editor",sync:r,placeholder:"字段 类型, 比如 id int 一行一个字段",value:n[a].columnsText,onChange:this.editorParamsChange.bind(this)}))),M.a.createElement(Ge,f()({},b,{label:"时间特征"}),g("timeType")(M.a.createElement(Be,{className:"right-select",onChange:function(e){t("timeType",a,e.target.value)}},M.a.createElement(ye.a,{value:1},"ProcTime"),M.a.createElement(ye.a,{value:2},"EventTime")))),2===n[a].timeType?M.a.createElement(Ge,f()({},b,{label:"时间列"}),g("timeColumn",{rules:[{required:!0,message:"请选择时间列"}]})(M.a.createElement(Ie.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("timeColumn",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},v))):void 0,2===n[a].timeType?M.a.createElement(Ge,f()({},b,{label:M.a.createElement("span",null,"偏移量(ms) ",M.a.createElement(ze.a,{title:"watermark值与event time值的偏移量"},M.a.createElement(ae.a,{type:"question-circle-o"})))}),g("offset",{rules:[{required:!0,message:"请输入时间偏移量"}]})(M.a.createElement(Me.a,{className:"number-input",min:0,onChange:function(e){return t("offset",a,e)}}))):void 0,M.a.createElement(Ge,f()({},b,{label:"并行度"}),g("parallelism")(M.a.createElement(Me.a,{className:"number-input",min:1,onChange:function(e){return t("parallelism",a,e)}})))))}}]),t}(j.Component),Xe=V.a.create({mapPropsToFields:function(e){var t=e.panelColumn[e.index];return{type:{value:t.type},sourceId:{value:t.sourceId},topic:{value:t.topic},table:{value:t.table},columns:{value:t.columns},timeType:{value:t.timeType},timeColumn:{value:t.timeColumn},offset:{value:t.offset},columnsText:{value:t.columnsText},parallelism:{value:t.parallelism}}}})(Je),Ze=(r={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(r,"popoverVisible",[]),Re()(r,"panelColumn",[]),Re()(r,"checkFormParams",[]),Re()(r,"timeColumoption",[]),Re()(r,"topicOptionType",[]),Re()(r,"originOptionType",[]),r),$e=function(e){function t(e){var a;I()(this,t);var n=A()(this,(t.__proto__||x()(t)).call(this,e));return n.currentInitData=function(e){var t=n.state,a=t.tabTemplate,r=t.panelColumn;e.map(function(e,t){a.push(Xe),r.push(e),n.getTypeOriginData(t,e.type),n.parseColumnsText(t,e.columnsText),n.getTopicType(t,e.sourceId)}),n.setCurrentSource({tabTemplate:a,panelColumn:r}),n.setState({tabTemplate:a,panelColumn:r})},n.parseColumnsText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=n.state,r=a.timeColumoption,i=a.panelColumn,o=t.split("\n").filter(function(e){return!!e}).map(function(e){var t=void 0;return{column:(t=e.trim().includes(" as ")?e.trim().split(" as "):e.trim().split(" "))[0],type:t[1]}}),l=o.filter(function(e){return e.column&&e.type});r[e]=l;var s=l.filter(function(t){return t.column===i[e].timeColumn})[0];i[e].timeColumn=s&&s.column||void 0,n.setCurrentSource({timeColumoption:r}),n.setState({timeColumoption:r})},n.getTypeOriginData=function(e,t){var a=n.state.originOptionType;H.a.getTypeOriginData({type:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setCurrentSource({originOptionType:a}),n.setState({originOptionType:a})})},n.getTopicType=function(e,t){var a=n.state.topicOptionType;t?H.a.getTopicType({sourceId:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setCurrentSource({topicOptionType:a}),n.setState({topicOptionType:a})}):("add"===e?a.push([]):a[e]=[],n.setCurrentSource({topicOptionType:a}),n.setState({topicOptionType:a}))},n.getCurrentData=function(e,t){var a=t.dispatch,r=t.inputData,i=t.currentPage.source;if(!r[e]&&i.length>0)n.receiveState(e,i,a);else{var o=JSON.parse(Ve()(Ze)),l=r[e]||o;n.setState(f()({},l))}},n.receiveState=function(e,t,a){var r=[],i=[],o=[],l=[],s=[],c=[],p=[],u=[];t.map(function(e){r.push(Xe),i.push(e)}),a(G.z({taskId:e,source:{tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,timeColumoption:c,originOptionType:p,topicOptionType:u}})),n.setState({tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,originOptionType:p,topicOptionType:u,timeColumoption:c},function(){t.map(function(e,t){n.getTypeOriginData(t,e.type),n.getTopicType(t,e.sourceId),n.parseColumnsText(t,e.columnsText)})})},n.changeInputTabs=function(e,t){var a={type:"14",sourceId:void 0,topic:void 0,table:void 0,timeType:1,timeColumn:void 0,offset:0,columnsText:void 0,parallelism:1},r=n.state,i=r.tabTemplate,o=r.panelActiveKey,l=r.popoverVisible,s=r.panelColumn,c=r.checkFormParams,p=r.originOptionType,u=r.topicOptionType;if("add"===e){i.push(Xe),s.push(a),n.getTypeOriginData("add",a.type),n.getTopicType("add",a.topic);var m=""+i.length;o.push(m)}else i.splice(t,1),s.splice(t,1),p.splice(t,1),u.splice(t,1),c.pop(),o=n.changeActiveKey(t),l[t]=!1;n.props.tableParamsChange(),n.setCurrentSource({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,originOptionType:p,topicOptionType:u}),n.setState({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,checkFormParams:c,originOptionType:p,topicOptionType:u})},n.setCurrentSource=function(e){var t=n.props,a=t.dispatch,r=t.currentPage,i=f()({},n.state,e);a(G.z({taskId:r.id,source:i}))},n.changeActiveKey=function(e){var t=n.state.panelActiveKey,a=""+(e+1),r=t.indexOf(a);return r>-1&&t.splice(r,1),t.map(function(t){return Number(t)>Number(e)?""+(Number(t)-1):t})},n.handleActiveKey=function(e){var t=n.state.panelActiveKey;t=e,n.setCurrentSource({panelActiveKey:t}),n.setState({panelActiveKey:t})},n.handleInputChange=function(e,t,a){var r=n.state,i=r.panelColumn,o=r.timeColumoption,l=r.originOptionType,s=r.topicOptionType,c=["type","sourceId","topic","table","columns","timeType","timeColumn","offset","columnsText","parallelism"];"columnsText"===e&&(n._syncEditor=!1,n.parseColumnsText(t,a,"changeText")),i[t][e]=a,"type"===e?(n._syncEditor=!0,o[t]=[],l[t]=[],s[t]=[],c.map(function(e){"type"!=e&&(i[t][e]="columns"==e?[]:"timeType"==e?1:"parallelism"==e?1:void 0)}),n.getTypeOriginData(t,a)):"sourceId"===e?(n._syncEditor=!0,o[t]=[],s[t]=[],c.map(function(e){"type"!=e&&"sourceId"!=e&&(i[t][e]="columns"==e?[]:"timeType"==e?1:"parallelism"==e?1:void 0)}),n.getTopicType(t,a)):"topic"===e&&(n._syncEditor=!0,o[t]=[],c.map(function(e){"type"!=e&&"sourceId"!=e&&"topic"!=e&&(i[t][e]="columns"==e?[]:"timeType"==e?1:"parallelism"==e?1:void 0)})),n.props.tableParamsChange(),n.setCurrentSource({panelColumn:i}),n.setState({panelColumn:i})},n.clearCurrentInfo=function(e,t,a){var r=n.state,i=r.panelColumn,o=r.topicOptionType,l=r.originOptionType,s={type:void 0,sourceId:void 0,topic:void 0,table:void 0,timeType:1,timeColumn:void 0,offset:0,columnsText:void 0,parallelism:1};"type"===e?(s.type=a,i[t]=s,o[t]=[],l[t]=[]):"sourceId"===e&&(s.type=i[t].type,s.sourceId=a,i[t]=s,o[t]=[]),n.setCurrentSource({panelColumn:i,topicOptionType:o,originOptionType:l}),n.setState({panelColumn:i,topicOptionType:o,originOptionType:l})},n.handlePopoverVisibleChange=function(e,t,a){var r=n.state.popoverVisible;r[t]=a,e&&(e.stopPropagation(),a&&(r=r.map(function(e,a){return t==a}))),n.setCurrentSource({popoverVisible:r}),n.setState({popoverVisible:r})},n.panelHeader=function(e){var t=n.state.popoverVisible,a=M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("div",{style:{padding:"8 0 12"}}," ",M.a.createElement(ae.a,{type:"exclamation-circle",style:{color:"#faad14"}}),"  你确定要删除此输入源吗？"),M.a.createElement("div",{style:{textAlign:"right",padding:"0 0 8"}},M.a.createElement(m.a,{style:{marginRight:8},size:"small",onClick:function(){n.handlePopoverVisibleChange(null,e,!1)}},"取消"),M.a.createElement(m.a,{type:"primary",size:"small",onClick:function(){n.changeInputTabs("delete",e)}},"确定")));return M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("span",null," 输入源 "+(e+1)+" "),M.a.createElement(De.a,{trigger:"click",placement:"topLeft",content:a,visible:t[e],onClick:function(a){n.handlePopoverVisibleChange(a,e,!t[e])}},M.a.createElement("span",{className:"title-icon input-panel-title"},M.a.createElement(ae.a,{type:"delete"}))))},n.recordForm=function(e){var t=n.state.checkFormParams;t.push(e),n.setCurrentSource({checkFormParams:t}),n.setState({checkFormParams:t})},n.state=(a={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(a,"popoverVisible",[]),Re()(a,"panelColumn",[]),Re()(a,"checkFormParams",[]),Re()(a,"timeColumoption",[]),Re()(a,"topicOptionType",[]),Re()(a,"originOptionType",[]),a),n}return D()(t,e),N()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentPage.source;e&&e.length>0&&this.currentInitData(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;t.id!==a.id&&(this._syncEditor=!0,this.getCurrentData(t.id,e))}},{key:"render",value:function(){var e=this,t=this.state,a=t.tabTemplate,n=t.panelActiveKey,r=t.panelColumn,i=t.timeColumoption,o=t.topicOptionType,l=t.originOptionType;return M.a.createElement("div",{className:"m-taksdetail panel-content"},M.a.createElement(xe.a,{activeKey:n,bordered:!1,onChange:this.handleActiveKey},a.map(function(t,a){return M.a.createElement(Qe,{header:e.panelHeader(a),key:a+1,style:{borderRadius:5},className:"input-panel"},M.a.createElement(Xe,{sync:e._syncEditor,index:a,key:a+1,handleInputChange:e.handleInputChange,panelColumn:r,onRef:e.recordForm,editorParamsChange:e.props.editorParamsChange,timeColumoption:i,topicOptionType:o,originOptionType:l}))})),M.a.createElement(m.a,{className:"stream-btn",onClick:function(){e.changeInputTabs("add")},style:{borderRadius:5}},M.a.createElement(ae.a,{type:"plus"}),M.a.createElement("span",null," 添加输入")))}}]),t}(j.Component),et=Ie.a.Option,tt=xe.a.Panel,at=(ye.a.Group,We.a.Column),nt=(We.a.ColumnGroup,V.a.Item),rt=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=A()(this,(e=t.__proto__||x()(t)).call.apply(e,[this].concat(o))),n.checkParams=function(e){var t=n.props,a=t.index,r=(t.panelColumn[a].columns,{});return n.props.form.validateFields(function(e,t){r.status=!e}),r},n.originOption=function(e,t){switch(e){case"originType":return t.map(function(e){return M.a.createElement(et,{key:e,value:""+e.id},e.name)});case"currencyType":return t.map(function(e){return M.a.createElement(et,{key:e,value:""+e},e)});case"columnType":return t.map(function(e,t){return M.a.createElement(et,{key:t,value:""+e.key},e.key)});case"primaryType":return t.map(function(e,t){return M.a.createElement(et,{key:t,value:""+e.column},e.column)});default:return null}},r=a,A()(n,r)}return D()(t,e),N()(t,[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"editorParamsChange",value:function(e,t,a){var n=this.props,r=n.handleInputChange,i=n.index;this._syncEditor=!1,r("columnsText",i,t)}},{key:"render",value:function(){var e=this.props,t=e.handleInputChange,a=e.index,n=e.sync,r=e.originOptionType,i=e.tableOptionType,o=e.panelColumn,l=e.tableColumnOptionType,c=this.props.form.getFieldDecorator,u=this.originOption("originType",r[a]||[]),d=this.originOption("currencyType",i[a]||[]),h=this.originOption("columnType",l[a]||[]),v=this.originOption("primaryType",o[a].columns||[]),g={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}};return M.a.createElement(s.a,{className:"title-content"},M.a.createElement(nt,f()({},g,{label:"存储类型"}),c("type",{rules:[{required:!0,message:"请选择存储类型"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("type",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},M.a.createElement(et,{value:"1"},"MySQL"),M.a.createElement(et,{value:"8"},"HBase"),M.a.createElement(et,{value:"11"},"ElasticSearch")))),M.a.createElement(nt,f()({},g,{label:"数据源"}),c("sourceId",{initialValue:"disabled",rules:[{required:!0,message:"请选择数据源"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("sourceId",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},u))),"1"==o[a].type||"8"==o[a].type?M.a.createElement(nt,f()({},g,{label:"表"}),c("table",{initialValue:"disabled",rules:[{required:!0,message:"请选择表"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("table",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},d))):"","11"==o[a].type?M.a.createElement(nt,f()({},g,{label:"索引"}),c("index",{rules:[{required:!0,message:"请输入索引"}]})(M.a.createElement(y.a,{placeholder:"请输入索引",onChange:function(e){return t("index",a,e.target.value)}}))):"","11"==o[a].type?M.a.createElement(nt,f()({},g,{label:M.a.createElement("span",null,"id ",M.a.createElement(ze.a,{title:"id生成规则：填写字段的索引位置（从0开始)"},M.a.createElement(ae.a,{type:"question-circle-o"}))," ")}),c("esId")(M.a.createElement(y.a,{placeholder:"请输入id",onChange:function(e){return t("esId",a,e.target.value)}}))):"","11"==o[a].type?M.a.createElement(nt,f()({},g,{label:"索引类型"}),c("esType",{rules:[{required:!0,message:"请输入索引类型"}]})(M.a.createElement(y.a,{placeholder:"请输入索引类型",onChange:function(e){return t("esType",a,e.target.value)}}))):"","8"==o[a].type?M.a.createElement(nt,f()({},g,{label:"rowKey"}),c("rowKey",{rules:[{required:!0,message:"请输入rowKey"}]})(M.a.createElement(y.a,{placeholder:" rowKey 格式：填写字段1 , 填写字段2 ",onChange:function(e){return t("rowKey",a,e.target.value)}}))):"",M.a.createElement(nt,f()({},g,{label:"映射表"}),c("tableName",{rules:"11"===o[a].type?[{required:!0,message:"请输入映射表名"}]:[]})(M.a.createElement(y.a,{placeholder:"请输入映射表名",onChange:function(e){return t("tableName",a,e.target.value)}}))),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"6"},M.a.createElement("span",{style:{color:"rgba(0, 0, 0, 0.85)",paddingRight:10,float:"right"}},"字段 :")),"1"==o[a].type?M.a.createElement(p.a,{span:"18",style:{marginBottom:20,border:"1px solid #ddd"}},M.a.createElement(We.a,{dataSource:o[a].columns,className:"table-small",pagination:!1,size:"small"},M.a.createElement(at,{title:"字段",dataIndex:"column",key:"字段",width:"50%",render:function(e,n,r){return M.a.createElement(Ie.a,{className:"sub-right-select",value:e,onChange:function(e){t("subColumn",a,r,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},h)}}),M.a.createElement(at,{title:"类型",dataIndex:"type",key:"类型",width:"40%",render:function(e,t,a){return M.a.createElement(y.a,{value:e,disabled:!0})}}),M.a.createElement(at,{key:"delete",render:function(e,n,r){return M.a.createElement(ae.a,{type:"close",style:{fontSize:16,color:"#888"},onClick:function(){t("deleteColumn",a,r)}})}})),M.a.createElement("div",{style:{padding:"0 20 20"}},M.a.createElement(m.a,{className:"stream-btn",type:"dashed",style:{borderRadius:5},onClick:function(){t("columns",a,{})}},M.a.createElement(ae.a,{type:"plus"}),M.a.createElement("span",null," 添加输入")))):M.a.createElement(p.a,{span:"18",style:{marginBottom:20,height:200}},M.a.createElement(Ye.a,{style:{minHeight:202,border:"1px solid #ddd"},key:"params-editor",sync:n,placeholder:"字段 类型, 比如 id int 一行一个字段",value:o[a].columnsText,onChange:this.editorParamsChange.bind(this)}))),"1"==o[a].type?M.a.createElement(nt,f()({},g,{label:"主键"}),c("primaryKey")(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("primaryKey",a,e)},mode:"multiple",showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},v))):"",M.a.createElement(nt,f()({},g,{label:"并行度"}),c("parallelism")(M.a.createElement(Me.a,{className:"number-input",min:1,onChange:function(e){return t("parallelism",a,e)}}))))}}]),t}(j.Component),it=V.a.create({mapPropsToFields:function(e){var t=e.panelColumn[e.index];return{type:{value:t.type},sourceId:{value:t.sourceId},table:{value:t.table},columns:{value:t.columns},columnsText:{value:t.columnsText},id:{value:t.id},index:{value:t.index},writePolicy:{value:t.writePolicy},esId:{value:t.esId},esType:{value:t.esType},parallelism:{value:t.parallelism},tableName:{value:t.tableName},primaryKey:{value:t.primaryKey},rowKey:{value:t.rowKey}}}})(rt),ot=(i={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(i,"popoverVisible",[]),Re()(i,"panelColumn",[]),Re()(i,"checkFormParams",[]),Re()(i,"originOptionType",[]),Re()(i,"tableOptionType",[]),Re()(i,"tableColumnOptionType",[]),i),lt=function(e){function t(e){var a;I()(this,t);var n=A()(this,(t.__proto__||x()(t)).call(this,e));return n.currentInitData=function(e){var t=n.state,a=t.tabTemplate,r=t.panelColumn;e.map(function(e,t){a.push(it),r.push(e),n.getTypeOriginData(t,e.type),"1"!=e.type&&"8"!=e.type||(n.getTableType(t,e.sourceId),"1"==e.type&&n.getTableColumns(t,e.sourceId,e.table))}),n.setOutputData({tabTemplate:a,panelColumn:r}),n.setState({tabTemplate:a,panelColumn:r})},n.getCurrentData=function(e,t){var a=t.currentPage,r=t.outputData,i=t.dispatch,o=a.sink;if(!r[e]&&o.length>0)n.receiveState(e,o,i);else{var l=JSON.parse(Ve()(ot)),s=r[e]||l;n.setState(f()({},s))}},n.receiveState=function(e,t,a){var r=[],i=[],o=[],l=[],s=[],c=[],p=[],u=[];t.map(function(e){r.push(it),i.push(e)}),a(G.A({taskId:e,sink:{tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u}})),n.setState({tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u},function(){t.map(function(e,t){n.getTypeOriginData(t,e.type),"1"!=e.type&&"8"!=e.type||(n.getTableType(t,e.sourceId),"1"==e.type&&n.getTableColumns(t,e.sourceId,e.table))})})},n.getTypeOriginData=function(e,t){var a=n.state.originOptionType;H.a.getTypeOriginData({type:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setOutputData({originOptionType:a}),n.setState({originOptionType:a})})},n.getTableType=function(e,t){var a=n.state.tableOptionType;t?H.a.getStremTableType({sourceId:t,isSys:!1}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setOutputData({tableOptionType:a}),n.setState({tableOptionType:a})}):("add"===e?a.push([]):a[e]=[],n.setOutputData({tableOptionType:a}),n.setState({tableOptionType:a}))},n.getTableColumns=function(e,t,a){var r=n.state.tableColumnOptionType;H.a.getStreamTableColumn({sourceId:t,tableName:a}).then(function(t){1===t.code?r[e]=t.data:r[e]=[],n.setOutputData({tableColumnOptionType:r}),n.setState({tableColumnOptionType:r})})},n.changeInputTabs=function(e,t){var a={type:"1",columns:[],sourceId:void 0,table:void 0,columnsText:void 0,esId:void 0,esType:void 0,writePolicy:void 0,index:void 0,id:void 0,parallelism:1,tableName:void 0,primaryKey:void 0,rowKey:void 0},r=n.state,i=r.tabTemplate,o=r.panelActiveKey,l=r.popoverVisible,s=r.panelColumn,c=r.checkFormParams,p=r.originOptionType,u=r.tableOptionType,m=r.tableColumnOptionType;if("add"===e){i.push(it),s.push(a),n.getTypeOriginData("add",a.type),n.getTableType("add",a.table),m.push([]);var d=""+i.length;o.push(d)}else i.splice(t,1),s.splice(t,1),p.splice(t,1),u.splice(t,1),m.splice(t,1),c.pop(),o=n.changeActiveKey(t),l[t]=!1;n.props.tableParamsChange(),n.setOutputData({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,tableColumnOptionType:m}),n.setState({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,checkFormParams:c,originOptionType:p,tableOptionType:u,tableColumnOptionType:m})},n.setOutputData=function(e){var t=n.props,a=t.dispatch,r=t.currentPage,i=f()({},n.state,e);a(G.A({taskId:r.id,sink:i}))},n.changeActiveKey=function(e){var t=n.state.panelActiveKey,a=""+(e+1),r=t.indexOf(a);return r>-1&&t.splice(r,1),t.map(function(t){return Number(t)>Number(e)?""+(Number(t)-1):t})},n.handleActiveKey=function(e){var t=n.state.panelActiveKey;t=e,n.setOutputData({panelActiveKey:t}),n.setState({panelActiveKey:t})},n.tableColumnType=function(e,t){return n.state.tableColumnOptionType[e].filter(function(e){return e.key===t})[0].type},n.filterPrimaryKey=function(e,t){return t.filter(function(t){var a=!1;return e.map(function(e){e.column===t&&(a=!0)}),a})},n.handleInputChange=function(e,t,a,r){n._syncEditor=!0;var i=n.state,o=i.panelColumn,l=i.originOptionType,s=i.tableOptionType,c=i.tableColumnOptionType;if("columns"===e)o[t][e].push(a);else if("deleteColumn"===e){o[t].columns.splice(a,1);var p=n.filterPrimaryKey(o[t].columns,o[t].primaryKey||[]);o[t].primaryKey=p}else if("subColumn"===e){o[t].columns[a].column=r;var u=n.tableColumnType(t,r);o[t].columns[a].type=u}else o[t][e]=a;"columnsText"===e&&(n._syncEditor=!1);var m=["type","sourceId","table","columns","columnsText","id","index","writePolicy","esId","esType","parallelism","tableName","primaryKey","rowKey"];if("type"===e)n._syncEditor=!0,l[t]=[],s[t]=[],c[t]=[],m.map(function(e){o[t][e]="type"===e?a:"parallelism"==e?1:"columns"==e?[]:void 0}),n.getTypeOriginData(t,a);else if("sourceId"===e)s[t]=[],c[t]=[],m.map(function(e){n._syncEditor=!0,"type"!==e&&"sourceId"!=e&&(o[t][e]="columns"==e?[]:"parallelism"==e?1:void 0)}),"1"!=o[t].type&&"8"!=o[t].type||n.getTableType(t,a);else if("table"===e){n._syncEditor=!0,c[t]=[];var d=o[t].sourceId;o[t].columns=[],m.map(function(e){"type"!=e&&"sourceId"!=e&&"table"!=e&&(o[t][e]="columns"==e?[]:"parallelism"==e?1:void 0)}),"1"==o[t].type&&n.getTableColumns(t,d,a)}n.props.tableParamsChange(),n.setOutputData({panelColumn:o}),n.setState({panelColumn:o})},n.clearCurrentInfo=function(e,t,a){var r=n.state,i=r.panelColumn,o=r.tableOptionType,l=r.originOptionType,s={type:void 0,columns:[],sourceId:void 0,table:void 0,columnsText:void 0,esId:void 0,esType:void 0,writePolicy:void 0,index:void 0,id:void 0,parallelism:1,tableName:void 0,rowKey:void 0,primaryKey:void 0};"type"===e?(s.type=a,l[t]=[],o[t]=[],i[t]=s):"sourceId"===e&&(s.type=i[t].type,s.sourceId=a,o[t]=[],i[t]=s),n.setOutputData({panelColumn:i,tableOptionType:o,originOptionType:l}),n.setState({panelColumn:i,tableOptionType:o,originOptionType:l})},n.handlePopoverVisibleChange=function(e,t,a){var r=n.state.popoverVisible;r[t]=a,e&&(e.stopPropagation(),a&&(r=r.map(function(e,a){return t==a}))),n.setOutputData({popoverVisible:r}),n.setState({popoverVisible:r})},n.panelHeader=function(e){var t=n.state.popoverVisible,a=M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("div",{style:{padding:"8 0 12"}}," ",M.a.createElement(ae.a,{type:"exclamation-circle",style:{color:"#faad14"}}),"  你确定要删除此输出源吗？"),M.a.createElement("div",{style:{textAlign:"right",padding:"0 0 8"}},M.a.createElement(m.a,{style:{marginRight:8},size:"small",onClick:function(){n.handlePopoverVisibleChange(null,e,!1)}},"取消"),M.a.createElement(m.a,{type:"primary",size:"small",onClick:function(){n.changeInputTabs("delete",e)}},"确定")));return M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("span",null," 输出源 "+(e+1)+" "),M.a.createElement(De.a,{trigger:"click",placement:"topLeft",content:a,visible:t[e],onClick:function(a){n.handlePopoverVisibleChange(a,e,!t[e])}},M.a.createElement("span",{className:"title-icon input-panel-title"},M.a.createElement(ae.a,{type:"delete"}))))},n.recordForm=function(e){var t=n.state.checkFormParams;t.push(e),n.setOutputData({checkFormParams:t}),n.setState({checkFormParams:t})},n.state=(a={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(a,"popoverVisible",[]),Re()(a,"panelColumn",[]),Re()(a,"checkFormParams",[]),Re()(a,"originOptionType",[]),Re()(a,"tableOptionType",[]),Re()(a,"tableColumnOptionType",[]),a),n}return D()(t,e),N()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentPage.sink;e&&e.length>0&&this.currentInitData(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;t.id!==a.id&&(this._syncEditor=!0,this.getCurrentData(t.id,e))}},{key:"render",value:function(){var e=this,t=this.state,a=t.tabTemplate,n=t.panelActiveKey,r=t.panelColumn,i=t.originOptionType,o=t.tableOptionType,l=t.tableColumnOptionType;return M.a.createElement("div",{className:"m-taksdetail panel-content"},M.a.createElement(xe.a,{activeKey:n,bordered:!1,onChange:this.handleActiveKey},a.map(function(t,a){return M.a.createElement(tt,{header:e.panelHeader(a),key:a+1,style:{borderRadius:5},className:"input-panel"},M.a.createElement(it,{sync:e._syncEditor,index:a,handleInputChange:e.handleInputChange,panelColumn:r,originOptionType:i,tableOptionType:o,tableColumnOptionType:l,onRef:e.recordForm,editorParamsChange:e.props.editorParamsChange}))})),M.a.createElement(m.a,{className:"stream-btn",onClick:function(){e.changeInputTabs("add")},style:{borderRadius:5}},M.a.createElement(ae.a,{type:"plus"}),M.a.createElement("span",null," 添加输入")))}}]),t}(j.Component),st=Ie.a.Option,ct=xe.a.Panel,pt=(ye.a.Group,We.a.Column),ut=(We.a.ColumnGroup,V.a.Item),mt=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=A()(this,(e=t.__proto__||x()(t)).call.apply(e,[this].concat(o))),n.checkParams=function(e){var t=n.props,a=t.index,r=(t.panelColumn[a].columns,{});return n.props.form.validateFields(function(e,t){r.status=!e}),r},n.originOption=function(e,t){switch(e){case"originType":return t.map(function(e){return M.a.createElement(st,{key:e,value:""+e.id},e.name)});case"currencyType":return t.map(function(e){return M.a.createElement(st,{key:e,value:""+e},e)});case"columnType":return t.map(function(e,t){return M.a.createElement(st,{key:t,value:""+e.key},e.key)});case"primaryType":return t.map(function(e,t){return M.a.createElement(st,{key:t,value:""+e.column},e.column)});default:return null}},r=a,A()(n,r)}return D()(t,e),N()(t,[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"render",value:function(){var e=this.props,t=e.handleInputChange,a=e.index,n=e.originOptionType,r=e.tableOptionType,i=e.panelColumn,o=e.tableColumnOptionType,l=this.props.form.getFieldDecorator,c=this.originOption("originType",n[a]||[]),u=this.originOption("currencyType",r[a]||[]),d=this.originOption("columnType",o[a]||[]),h=this.originOption("primaryType",i[a].columns||[]),v={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}};return M.a.createElement(s.a,{className:"title-content"},M.a.createElement(ut,f()({},v,{label:"存储类型"}),l("type",{rules:[{required:!0,message:"请选择存储类型"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("type",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},M.a.createElement(st,{value:"1"},"MySQL")))),M.a.createElement(ut,f()({},v,{label:"数据源"}),l("sourceId",{initialValue:"disabled",rules:[{required:!0,message:"请选择数据源"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("sourceId",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},c))),M.a.createElement(ut,f()({},v,{label:"表"}),l("table",{rules:[{required:!0,message:"请选择表"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("table",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},u))),M.a.createElement(ut,f()({},v,{label:"映射表"}),l("tableName")(M.a.createElement(y.a,{placeholder:"请输入映射表名",onChange:function(e){return t("tableName",a,e.target.value)}}))),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"6"},M.a.createElement("span",{style:{color:"rgba(0, 0, 0, 0.85)",paddingRight:10,float:"right"}},"字段 :")),M.a.createElement(p.a,{span:"18",style:{marginBottom:20,border:"1px solid #ddd"}},M.a.createElement(We.a,{dataSource:i[a].columns,className:"table-small",pagination:!1,size:"small"},M.a.createElement(pt,{title:"字段",dataIndex:"column",key:"字段",width:"50%",render:function(e,n,r){return M.a.createElement(Ie.a,{className:"sub-right-select",value:e,onChange:function(e){t("subColumn",a,r,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},d)}}),M.a.createElement(pt,{title:"类型",dataIndex:"type",key:"类型",width:"40%",render:function(e,t,a){return M.a.createElement(y.a,{value:e,disabled:!0})}}),M.a.createElement(pt,{key:"delete",render:function(e,n,r){return M.a.createElement(ae.a,{type:"close",style:{fontSize:16,color:"#888"},onClick:function(){t("deleteColumn",a,r)}})}})),M.a.createElement("div",{style:{padding:"0 20 20"}},M.a.createElement(m.a,{className:"stream-btn",type:"dashed",style:{borderRadius:5},onClick:function(){t("columns",a,{})}},M.a.createElement(ae.a,{type:"plus"}),M.a.createElement("span",null," 添加输入"))))),M.a.createElement(ut,f()({},v,{label:"主键"}),l("primaryKey",{rules:[{required:!0,message:"请选择主键"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("primaryKey",a,e)},mode:"multiple",showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},h))),M.a.createElement(ut,f()({},v,{label:"并行度"}),l("parallelism")(M.a.createElement(Me.a,{className:"number-input",min:1,onChange:function(e){return t("parallelism",a,e)}}))),M.a.createElement(ut,f()({},v,{label:"缓存策略"}),l("cache",{rules:[{required:!0,message:"请选择缓存策略"}]})(M.a.createElement(Ie.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("cache",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},M.a.createElement(st,{key:"None",value:"None"},"None"),M.a.createElement(st,{key:"LRU",value:"LRU"},"LRU")))),"LRU"===i[a].cache?M.a.createElement(ut,f()({},v,{label:"缓存大小(行)"}),l("cacheSize",{rules:[{required:!0,message:"请输入缓存大小"}]})(M.a.createElement(Me.a,{className:"number-input",min:0,onChange:function(e){return t("cacheSize",a,e)}}))):void 0,"LRU"===i[a].cache?M.a.createElement(ut,f()({},v,{label:"缓存超时时间(ms)"}),l("cacheTTLMs",{rules:[{required:!0,message:"请输入缓存超时时间"}]})(M.a.createElement(Me.a,{className:"number-input",min:0,onChange:function(e){return t("cacheTTLMs",a,e)}}))):void 0)}}]),t}(j.Component),dt=V.a.create({mapPropsToFields:function(e){var t=e.panelColumn[e.index],a=t.type,n=t.sourceId,r=t.table,i=t.columns,o=t.parallelism,l=t.cache,s=t.cacheSize,c=t.cacheTTLMs;return{type:{value:a},sourceId:{value:n},table:{value:r},tableName:{value:t.tableName},columns:{value:i},parallelism:{value:o},cache:{value:l},cacheSize:{value:s},cacheTTLMs:{value:c},primaryKey:{value:t.primaryKey}}}})(mt),yt=(o={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(o,"popoverVisible",[]),Re()(o,"panelColumn",[]),Re()(o,"checkFormParams",[]),Re()(o,"originOptionType",[]),Re()(o,"tableOptionType",[]),Re()(o,"tableColumnOptionType",[]),o),ht=function(e){function t(e){var a;I()(this,t);var n=A()(this,(t.__proto__||x()(t)).call(this,e));return n.currentInitData=function(e){var t=n.state,a=t.tabTemplate,r=t.panelColumn;e.map(function(e,t){a.push(dt),r.push(e),n.getTypeOriginData(t,e.type),n.getTableType(t,e.sourceId),n.getTableColumns(t,e.sourceId,e.table)}),n.setOutputData({tabTemplate:a,panelColumn:r}),n.setState({tabTemplate:a,panelColumn:r})},n.getCurrentData=function(e,t){var a=t.currentPage,r=t.dimensionData,i=t.dispatch,o=a.side;if(!r[e]&&o.length>0)n.receiveState(e,o,i);else{var l=JSON.parse(Ve()(yt)),s=r[e]||l;n.setState(f()({},s))}},n.receiveState=function(e,t,a){var r=[],i=[],o=[],l=[],s=[],c=[],p=[],u=[];t.map(function(e){r.push(dt),i.push(e)}),a(G.y({taskId:e,side:{tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u}})),n.setState({tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u},function(){t.map(function(e,t){n.getTypeOriginData(t,e.type),n.getTableType(t,e.sourceId),n.getTableColumns(t,e.sourceId,e.table)})})},n.getTypeOriginData=function(e,t){var a=n.state.originOptionType;H.a.getTypeOriginData({type:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setOutputData({originOptionType:a}),n.setState({originOptionType:a})})},n.getTableType=function(e,t,a){var r=n.state.tableOptionType;t?H.a.getStremTableType({sourceId:t,isSys:!1}).then(function(t){"add"===e?1===t.code?r.push(t.data):r.push([]):1===t.code?r[e]=t.data:r[e]=[],n.setOutputData({tableOptionType:r}),n.setState({tableOptionType:r})}):((e="add")?r.push([]):r[e]=[],n.setOutputData({tableOptionType:r}),n.setState({tableOptionType:r}))},n.getTableColumns=function(e,t,a){var r=n.state.tableColumnOptionType;H.a.getStreamTableColumn({sourceId:t,tableName:a}).then(function(t){1===t.code?r[e]=t.data:r[e]=[],n.setOutputData({tableColumnOptionType:r}),n.setState({tableColumnOptionType:r})})},n.changeInputTabs=function(e,t){var a={type:"1",columns:[],sourceId:void 0,table:void 0,tableName:void 0,primaryKey:void 0,parallelism:1,cache:"LRU",cacheSize:1e4,cacheTTLMs:6e4},r=n.state,i=r.tabTemplate,o=r.panelActiveKey,l=r.popoverVisible,s=r.panelColumn,c=r.checkFormParams,p=r.originOptionType,u=r.tableOptionType,m=r.tableColumnOptionType;if("add"===e){i.push(dt),s.push(a),n.getTypeOriginData("add",a.type),n.getTableType("add",a.table),m.push([]);var d=""+i.length;o.push(d)}else i.splice(t,1),s.splice(t,1),p.splice(t,1),u.splice(t,1),m.splice(t,1),c.pop(),o=n.changeActiveKey(t),l[t]=!1;n.props.tableParamsChange(),n.setOutputData({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,checkFormParams:c,originOptionType:p,tableOptionType:u,tableColumnOptionType:m}),n.setState({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,checkFormParams:c,originOptionType:p,tableOptionType:u,tableColumnOptionType:m})},n.setOutputData=function(e){var t=n.props,a=t.dispatch,r=t.currentPage,i=f()({},n.state,e);a(G.y({taskId:r.id,side:i}))},n.changeActiveKey=function(e){var t=n.state.panelActiveKey,a=""+(e+1),r=t.indexOf(a);return r>-1&&t.splice(r,1),t.map(function(t){return Number(t)>Number(e)?""+(Number(t)-1):t})},n.handleActiveKey=function(e){var t=n.state.panelActiveKey;t=e,n.setOutputData({panelActiveKey:t}),n.setState({panelActiveKey:t})},n.tableColumnType=function(e,t){return n.state.tableColumnOptionType[e].filter(function(e){return e.key===t})[0].type},n.filterPrimaryKey=function(e,t){return t.filter(function(t){var a=!1;return e.map(function(e){e.column===t&&(a=!0)}),a})},n.handleInputChange=function(e,t,a,r){var i=n.state,o=i.panelColumn,l=i.originOptionType,s=i.tableOptionType,c=i.tableColumnOptionType;if("columns"===e)o[t][e].push(a);else if("deleteColumn"===e){o[t].columns.splice(a,1);var p=n.filterPrimaryKey(o[t].columns,o[t].primaryKey||[]);o[t].primaryKey=p}else if("subColumn"===e){o[t].columns[a].column=r;var u=n.tableColumnType(t,r);o[t].columns[a].type=u}else o[t][e]=a;var m=["type","sourceId","table","columns","parallelism","cache","cacheSize","cacheTTLMs","tableName","primaryKey"];if("type"===e)l[t]=[],s[t]=[],c[t]=[],m.map(function(e){"type"!=e&&(o[t][e]="parallelism"==e?1:"columns"==e?[]:"cache"==e?"LRU":"cacheSize"==e?1e4:"cacheTTLMs"==e?6e4:void 0)}),n.getTypeOriginData(t,a);else if("sourceId"===e)s[t]=[],c[t]=[],o[t].columns=[],m.map(function(e){"type"!=e&&"sourceId"!=e&&(o[t][e]="parallelism"==e?1:"columns"==e?[]:"cache"==e?"LRU":"cacheSize"==e?1e4:"cacheTTLMs"==e?6e4:void 0)}),n.getTableType(t,a,e);else if("table"===e){c[t]=[],m.map(function(e){"type"!=e&&"sourceId"!=e&&"table"!=e&&(o[t][e]="parallelism"==e?1:"columns"==e?[]:"cache"==e?"LRU":"cacheSize"==e?1e4:"cacheTTLMs"==e?6e4:void 0)});var d=o[t].sourceId;n.getTableColumns(t,d,a)}n.props.tableParamsChange(),n.setOutputData({panelColumn:o}),n.setState({panelColumn:o})},n.clearCurrentInfo=function(e,t,a){var r=n.state,i=r.panelColumn,o=r.originOptionType,l=r.tableOptionType,s={type:void 0,columns:[],sourceId:void 0,table:void 0,tableName:void 0,parallelism:1,cache:"LRU",cacheSize:1e4,cacheTTLMs:6e4};"type"===e?(s.type=a,i[t]=s,o[t]=[],l[t]=[]):"sourceId"===e&&(s.type=i[t].type,s.sourceId=a,i[t]=s,l[t]=[]),n.setOutputData({panelColumn:i,originOptionType:o,tableOptionType:l}),n.setState({panelColumn:i,originOptionType:o,tableOptionType:l})},n.handlePopoverVisibleChange=function(e,t,a){var r=n.state.popoverVisible;r[t]=a,e&&(e.stopPropagation(),a&&(r=r.map(function(e,a){return t==a}))),n.setOutputData({popoverVisible:r}),n.setState({popoverVisible:r})},n.panelHeader=function(e){var t=n.state.popoverVisible,a=M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("div",{style:{padding:"8 0 12"}}," ",M.a.createElement(ae.a,{type:"exclamation-circle",style:{color:"#faad14"}}),"  你确定要删除此输出源吗？"),M.a.createElement("div",{style:{textAlign:"right",padding:"0 0 8"}},M.a.createElement(m.a,{style:{marginRight:8},size:"small",onClick:function(){n.handlePopoverVisibleChange(null,e,!1)}},"取消"),M.a.createElement(m.a,{type:"primary",size:"small",onClick:function(){n.changeInputTabs("delete",e)}},"确定")));return M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("span",null," 维表 "+(e+1)),M.a.createElement(De.a,{trigger:"click",placement:"topLeft",content:a,visible:t[e],onClick:function(a){n.handlePopoverVisibleChange(a,e,!t[e])}},M.a.createElement("span",{className:"title-icon input-panel-title"},M.a.createElement(ae.a,{type:"delete"}))))},n.recordForm=function(e){var t=n.state.checkFormParams;t.push(e),n.setOutputData({checkFormParams:t}),n.setState({checkFormParams:t})},n.state=(a={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(a,"popoverVisible",[]),Re()(a,"panelColumn",[]),Re()(a,"checkFormParams",[]),Re()(a,"originOptionType",[]),Re()(a,"tableOptionType",[]),Re()(a,"tableColumnOptionType",[]),a),n}return D()(t,e),N()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentPage.side;e&&e.length>0&&this.currentInitData(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;t.id!==a.id&&this.getCurrentData(t.id,e)}},{key:"render",value:function(){var e=this,t=this.state,a=t.tabTemplate,n=t.panelActiveKey,r=t.panelColumn,i=t.originOptionType,o=t.tableOptionType,l=t.tableColumnOptionType;return M.a.createElement("div",{className:"m-taksdetail panel-content"},M.a.createElement(xe.a,{activeKey:n,bordered:!1,onChange:this.handleActiveKey},a.map(function(t,a){return M.a.createElement(ct,{header:e.panelHeader(a),key:a+1,style:{borderRadius:5},className:"input-panel"},M.a.createElement(dt,{index:a,handleInputChange:e.handleInputChange,panelColumn:r,originOptionType:i,tableOptionType:o,tableColumnOptionType:l,onRef:e.recordForm}))})),M.a.createElement(m.a,{className:"stream-btn",onClick:function(){e.changeInputTabs("add")},style:{borderRadius:5}},M.a.createElement(ae.a,{type:"plus"}),M.a.createElement("span",null," 添加输入")))}}]),t}(j.Component),ft=pe.a.TabPane,vt=R.a.confirm,gt=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=A()(this,(e=t.__proto__||x()(t)).call.apply(e,[this].concat(o))),n.state={selected:"",expanded:!1},n.onChange=function(e){var t=n.props,a=t.dispatch,r=t.pages,i=parseInt(e,10),o=r&&r.find(function(e){return e.id===i});o&&(a(G.x(o)),a(G.p()),a(G.q()),a(G.o()))},n.onEdit=function(e,t){var a=n.props,r=a.pages,i=a.dispatch,o=r.filter(function(t){return t.id==e})[0]||{};switch(t){case"remove":o.notSynced?vt({title:"部分任务修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃这些修改数据",onOk:function(){i(G.l(parseInt(e,10),r,o)),i(G.f(o.id)),i(G.g(o.id)),i(G.e(o.id))},onCancel:function(){}}):(i(G.l(parseInt(e,10),r,o)),i(G.f(o.id)),i(G.g(o.id)),i(G.e(o.id)))}},n.mapPanels=function(e){return e&&e.length>0?e.map(function(e){var t=M.a.createElement("span",null,M.a.createElement(ue.a,{notSynced:e.notSynced}),e.name);return M.a.createElement(ft,{style:{height:"0px"},tab:t,key:e.id})}):[]},n.tabClick=function(e){var t=n.state,a=t.selected,r=t.expanded;e===a&&r?(n.setState({selected:"",expanded:!1}),n.SideBench.style.width="30px"):e!==a&&(n.SideBench.style.width="500px",n.setState({selected:e,expanded:!0}))},n.unLock=function(){var e=n.props,t=e.currentPage,a=e.dispatch,r=t.readWriteLockVO;vt({title:"解锁提醒",content:"文件正在被"+r.lastKeepLockUserName+"编辑中，开始编辑时间\n                "+W.a.formatDateTime(r.gmtModified)+"。\n                强制编辑可能导致"+r.lastKeepLockUserName+"对该文件的修改无法保存！\n            ",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){var e={fileId:t.id,type:Z.j.STREAM_TASK,lockVersion:r.version};H.a.unlockFile(e).then(function(e){if(1===e.code){var n=e.data;n.getLock?k.a.success("文件解锁成功！"):R.a.error({title:"解锁失败",content:"文件正在被"+n.lastKeepLockUserName+"编辑中!开始编辑时间\n                                "+W.a.formatDateTime(n.gmtModified)+"."});var r={id:t.id};H.a.getTask(r).then(function(e){if(1===e.code){var n=e.data;n.merged=!0;var r={id:t.id,readWriteLockVO:n.readWriteLockVO};a(G.x(n)),a(Object(J.f)(r))}})}})},onCancel:function(){}})},n.handleCustomParamsChange=function(e){var t=n.props,a=t.currentPage,r=t.dispatch,i=C()(a,e);r(G.x(i))},n.tableParamsChange=function(){n.props.editorChange()},r=a,A()(n,r)}return D()(t,e),N()(t,[{key:"componentWillReceiveProps",value:function(e){e.currentPage!=this.props.currentPage&&(this._syncEditor=!0)}},{key:"renderLock",value:function(e){return e.readWriteLockVO&&!e.readWriteLockVO.getLock?M.a.createElement("div",{className:"lock-layer"},M.a.createElement(se.a,{style:{position:"absolute",top:"10px",left:"35%",zIndex:"999"},showIcon:!0,message:M.a.createElement("span",null,"当前文件为只读状态！",M.a.createElement("a",{onClick:this.unLock},"解锁")),type:"warning"})):null}},{key:"closeAllorOthers",value:function(e){var t=e.key,a=this.props,n=a.pages,r=a.currentPage,i=a.dispatch;if("ALL"===t){var o=!0,l=!0,s=!1,c=void 0;try{for(var p,u=oe()(n);!(l=(p=u.next()).done);l=!0){if(p.value.notSynced){o=!1;break}}}catch(e){s=!0,c=e}finally{try{!l&&u.return&&u.return()}finally{if(s)throw c}}o?(i(G.a()),i(G.c()),i(G.d()),i(G.b())):vt({title:"部分任务修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃所有修改数据",onOk:function(){i(G.a()),i(G.c()),i(G.d()),i(G.b())},onCancel:function(){}})}else{var m=!0,d=!0,y=!1,h=void 0;try{for(var f,v=oe()(n);!(d=(f=v.next()).done);d=!0){var g=f.value;if(g.notSynced&&g.id!==r.id){m=!1;break}}}catch(e){y=!0,h=e}finally{try{!d&&v.return&&v.return()}finally{if(y)throw h}}m?(i(G.k(r)),i(G.i(r.id)),i(G.j(r.id)),i(G.h(r.id))):vt({title:"部分任务修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃这些修改数据",onOk:function(){i(G.k(r)),i(G.i(r.id)),i(G.j(r.id)),i(G.h(r.id))},onCancel:function(){}})}}},{key:"editorParamsChange",value:function(e){var t;this._syncEditor?(this._syncEditor=!1,(t=this.props).editorParamsChange.apply(t,arguments)):this.props.editorChange(e)}},{key:"render",value:function(){var e=this,t=this.props,a=t.currentPage,n=t.pages,r=t.router;t.editorFocus,t.editorFocusOut;0===n.length&&r.push("/realtime");var i=this.mapPanels(n);return M.a.createElement(s.a,{className:"task-browser"},M.a.createElement("div",{className:"browser-content"},M.a.createElement(pe.a,{hideAdd:!0,onTabClick:this.onChange,activeKey:""+a.id,type:"editable-card",className:"browser-tabs",onEdit:this.onEdit,tabBarExtraContent:M.a.createElement(ee.a,{overlay:M.a.createElement(re.a,{style:{marginRight:2},onClick:this.closeAllorOthers.bind(this)},M.a.createElement(re.a.Item,{key:"OHTERS"},"关闭其他"),M.a.createElement(re.a.Item,{key:"ALL"},"关闭所有"))},M.a.createElement(ae.a,{type:"bars",style:{margin:"10 0 0 0"}}))},i),this.renderLock(a),M.a.createElement(ke,this.props),M.a.createElement("div",{className:"m-siderbench bd-left",ref:function(t){e.SideBench=t}},M.a.createElement(pe.a,{activeKey:this.state.selected,type:"card",className:"task-params",tabPosition:"right",onTabClick:this.tabClick},M.a.createElement(ft,{tab:M.a.createElement("span",{className:"title-vertical"},"任务详情"),key:"params1"},M.a.createElement(Ae,this.props)),0===a.taskType?M.a.createElement(ft,{tab:M.a.createElement("span",{className:"title-vertical tabpanel-content"},"源表"),key:"params3"},M.a.createElement($e,f()({},this.props,{tableParamsChange:this.tableParamsChange}))):"",0===a.taskType?M.a.createElement(ft,{tab:M.a.createElement("span",{style:{marginTop:10},className:"title-vertical tabpanel-content"},"结果表"),key:"params4"},M.a.createElement(lt,f()({},this.props,{tableParamsChange:this.tableParamsChange}))):"",0===a.taskType?M.a.createElement(ft,{tab:M.a.createElement("span",{className:"title-vertical tabpanel-content"},"维表"),key:"params5"},M.a.createElement(ht,f()({},this.props,{tableParamsChange:this.tableParamsChange}))):"",M.a.createElement(ft,{tab:M.a.createElement("span",{className:"title-vertical"},"环境参数"),key:"params2"},M.a.createElement(me.a,{key:"params-editor",sync:this._syncEditor,value:a.taskParams,onChange:this.editorParamsChange.bind(this),language:"ini"}))))))}}]),t}(j.Component),bt=R.a.confirm,Ct=V.a.Item,Tt=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=A()(this,(e=t.__proto__||x()(t)).call.apply(e,[this].concat(o))),n.state={publishDesc:"",showPublish:!1},n.saveTask=function(){for(var e=n.props,t=e.currentPage,a=e.dispatch,r=e.inputData,i=e.outputData,o=e.dimensionData,l=r[t.id]||{},s=l.checkFormParams,c=void 0===s?[]:s,p=l.panelColumn,u=void 0===p?[]:p,m=i[t.id]||{},d=m.checkFormParams,y=void 0===d?[]:d,h=m.panelColumn,f=void 0===h?[]:h,v=o[t.id]||{},g=v.checkFormParams,b=void 0===g?[]:g,C=v.panelColumn,T=void 0===C?[]:C,O=0,P=c.length;O<P;O++){var x=c[O].checkParams();if(!x.status)return k.a.error("源表--输入源"+(c[O].props.index+1)+": "+(x.message||"您还有未填选项"))}if(y.length>0)for(var S=0,I=y.length;S<I;S++){var w=y[S].checkParams();if(!w.status)return k.a.error("结果表--输出源"+(y[S].props.index+1)+": "+(w.message||"您还有未填选项"))}if(b.length>0)for(var N=0,_=b.length;N<_;N++){var A=b[N].checkParams();if(!A.status)return k.a.error("维表--维表"+(b[N].props.index+1)+": "+(A.message||"您还有未填选项"))}var K=t.resourceList;K&&K.length>0&&(t.resourceIdList=K.map(function(e){return e.id})),u.length>0&&(t.source=u),f.length>0&&(t.sink=f),T.length>0&&(t.side=T),t.lockVersion=t.readWriteLockVO.version,H.a.saveTask(t).then(function(e){var n=function(e){k.a.success("任务保存成功"),e.notSynced=!1,a(G.x(e)),t.taskType===Z.v.MR&&a(J.a({id:e.parentId,catalogueType:Z.k.TASK}))};if(1===e.code){var r=e.data.readWriteLockVO,i=r.result;0===i?n(e.data):1===i?bt({title:"锁定提醒",content:M.a.createElement("span",null,"文件正在被",r.lastKeepLockUserName,"编辑中，开始编辑时间为",W.a.formatDateTime(r.gmtModified),"。 强制保存可能导致",r.lastKeepLockUserName,"对文件的修改无法正常保存！"),okText:"确定保存",okType:"danger",cancelText:"取消",onOk:function(){H.a.forceUpdateTask(t).then(function(e){1===e.code&&n(e.data)})}}):2===i&&bt({title:"保存警告",content:M.a.createElement("span",null,"文件已经被",r.lastKeepLockUserName,"编辑过，编辑时间为",W.a.formatDateTime(r.gmtModified),"。 点击确认按钮会",M.a.createElement(E.a,{color:"orange"},"覆盖"),"您本地的代码，请您提前做好备份！"),okText:"确定覆盖",okType:"danger",cancelText:"取消",onOk:function(){var e={id:t.id,lockVersion:r.version};H.a.getTask(e).then(function(e){if(1===e.code){var t=e.data;t.merged=!0,n(t)}})}})}})},n.editorChange=function(e){var t=n.props,a=t.currentPage,r=t.dispatch;a=Object(U.cloneDeep)(a),(a=C()(a,e)).notSynced=!0,r(G.x(a))},n.debounceChange=Object(U.debounce)(n.editorChange,300,{maxWait:2e3}),n.editorParamsChange=function(e,t){var a=n.props,r=a.currentPage,i=a.dispatch;e!==t&&(r.taskParams=t,i(G.x(r)))},n.startTask=function(){var e=n.props,t=e.currentPage,a=e.dispatch;H.a.startTask({id:t.id,isRestoration:0}).then(function(e){1===e.code&&(t.status=10,a(G.x(C()({},t))),k.a.success("任务已经成功提交！"))})},n.loadTreeData=function(e){var t=n.props.dispatch,a=e.props.data;return new g.a(function(e){t(J.a(a)),e()})},n.closePublish=function(){n.setState({publishDesc:"",showPublish:!1})},n.publishChange=function(e){n.setState({publishDesc:e.target.value})},n.renderPublish=function(){var e=n.props.user,t=n.state.publishDesc;return M.a.createElement(R.a,{wrapClassName:"vertical-center-modal",title:"发布任务",style:{height:"600px",width:"600px"},visible:n.state.showPublish,onCancel:n.closePublish,onOk:n.submitTab.bind(n),cancelText:"关闭"},M.a.createElement(V.a,null,M.a.createElement(Ct,f()({},Z.y,{label:"发布人",hasFeedback:!0}),M.a.createElement("span",null,e.userName)),M.a.createElement(Ct,f()({},Z.y,{label:M.a.createElement("span",{className:"ant-form-item-required"},"备注"),hasFeedback:!0}),M.a.createElement(y.a,{type:"textarea",value:t,name:"publishDesc",rows:4,onChange:n.publishChange}))))},r=a,A()(n,r)}return D()(t,e),N()(t,[{key:"componentDidMount",value:function(){}},{key:"autoSaveTask",value:function(){var e=this;this.timerID=setInterval(function(){if("edit"===e.state.editorState){var t=e.props.currentPage;H.a.saveTask(t).then(function(e){1===e.code&&k.a.success("任务已自动保存")})}},3e4)}},{key:"submitTab",value:function(){var e=this,t=this.props,a=t.currentPage,n=t.dispatch,r=this.state.publishDesc,i=Object(U.cloneDeep)(a);return r?r.length>200?(k.a.error("备注信息不可超过200个字符！"),!1):(i.publishDesc=r,i.preSave=!0,i.submitStatus=1,void G.w(i).then(function(t){e.closePublish(),t&&(k.a.success("发布成功！"),H.a.getTask({id:a.id}).then(function(e){if(1===e.code){var t=e.data;t.merged=!0,t.notSynced=!1,n(G.x(t))}}))})):(k.a.error("发布备注不可为空！"),!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.dispatch,n=t.currentPage,r=n.notSynced;return M.a.createElement(s.a,{className:"task-editor"},M.a.createElement("header",{className:"toolbar bd-bottom clear"},M.a.createElement(p.a,{className:"left"},M.a.createElement(m.a,{onClick:function(){a(B.a(X.b.ADD_TASK_VISIBLE))},title:"创建任务"},M.a.createElement(Q.a,{className:"my-icon",type:"focus"})," 新建任务"),M.a.createElement(m.a,{disabled:n.invalid,onClick:this.saveTask,title:"保存任务"},M.a.createElement(Q.a,{className:"my-icon",type:"save"}),"保存"),M.a.createElement(Y.a,null)),M.a.createElement(p.a,{className:"right"},M.a.createElement(m.a,{disabled:r,onClick:function(){e.setState({showPublish:!0})}},M.a.createElement(Q.a,{className:"my-icon",type:"fly"})," 发布"),M.a.createElement(z.c,{to:"/operation/realtime?tname="+n.name},M.a.createElement(m.a,null,M.a.createElement(Q.a,{className:"my-icon",type:"goin"})," 运维")))),M.a.createElement(gt,f()({},this.props,{ayncTree:this.loadTreeData,editorParamsChange:this.editorParamsChange,editorChange:this.debounceChange})),this.renderPublish())}}]),t}(j.Component);t.default=Object(q.b)(function(e){var t=e.realtimeTask,a=t.resources,n=t.pages,r=t.currentPage,i=t.inputData,o=t.outputData,l=t.dimensionData;return{currentPage:r,pages:n,resources:a,user:e.user,inputData:i,outputData:o,dimensionData:l}})(Tt)},aOJk:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(a("QbLZ")),r=u(a("iCc5")),i=u(a("V7oC")),o=u(a("FYw3")),l=u(a("mRg0")),s=u(a("sbe7")),c=u(a("d1El")),p=u(a("aVg8"));function u(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,l.default)(t,e),(0,i.default)(t,[{key:"getPopupDomNode",value:function(){return this.refs.tooltip.getPopupDomNode()}},{key:"getOverlay",value:function(){var e=this.props,t=e.title,a=e.prefixCls,n=e.content;return(0,p.default)(!("overlay"in this.props),"Popover[overlay] is removed, please use Popover[content] instead, see: https://u.ant.design/popover-content"),s.default.createElement("div",null,t&&s.default.createElement("div",{className:a+"-title"},t),s.default.createElement("div",{className:a+"-inner-content"},n))}},{key:"render",value:function(){var e=(0,n.default)({},this.props);return delete e.title,s.default.createElement(c.default,(0,n.default)({},e,{ref:"tooltip",overlay:this.getOverlay()}))}}]),t}(s.default.Component);t.default=m,m.defaultProps={prefixCls:"ant-popover",placement:"top",transitionName:"zoom-big",trigger:"hover",mouseEnterDelay:.1,mouseLeaveDelay:.1,overlayStyle:{}},e.exports=t.default},eKCK:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CollapsePanel=void 0;var n=d(a("QbLZ")),r=d(a("YEIV")),i=d(a("V7oC")),o=d(a("iCc5")),l=d(a("FYw3")),s=d(a("mRg0")),c=d(a("sbe7")),p=d(a("E1MH")),u=d(a("TSYQ")),m=d(a("MN+a"));function d(e){return e&&e.__esModule?e:{default:e}}t.CollapsePanel=function(e){function t(){return(0,o.default)(this,t),(0,l.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,s.default)(t,e),t}(c.default.Component);var y=function(e){function t(){return(0,o.default)(this,t),(0,l.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.prefixCls,a=e.className,i=void 0===a?"":a,o=e.bordered,l=(0,u.default)((0,r.default)({},t+"-borderless",!o),i);return c.default.createElement(p.default,(0,n.default)({},this.props,{className:l}))}}]),t}(c.default.Component);t.default=y,y.Panel=p.default.Panel,y.defaultProps={prefixCls:"ant-collapse",bordered:!0,openAnimation:(0,n.default)({},m.default,{appear:function(){}})}},n3pV:function(e,t,a){}}]);