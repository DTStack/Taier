(self.webpackJsonp=self.webpackJsonp||[]).push([[20],{"5GXF":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=a("eKCK"),i=(n=r)&&n.__esModule?n:{default:n};t.default=i.default,e.exports=t.default},"7LYo":function(e,t,a){"use strict";a("VEUW"),a("n3pV")},E1MH:function(e,t,a){"use strict";a.r(t);var n=a("sbe7"),r=a.n(n),i=a("17x9"),o=a.n(i),l=a("TSYQ"),s=a.n(l),c=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n["Component"]),c(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.isActive||e.isActive}},{key:"render",value:function(){var e;if(this._isActived=this._isActived||this.props.isActive,!this._isActived)return null;var t=this.props,a=t.prefixCls,n=t.isActive,i=t.children,o=t.destroyInactivePanel,l=s()((p(e={},a+"-content",!0),p(e,a+"-content-active",n),p(e,a+"-content-inactive",!n),e)),c=!n&&o?null:r.a.createElement("div",{className:a+"-content-box"},i);return r.a.createElement("div",{className:l,role:"tabpanel"},c)}}]),t}();u.propTypes={prefixCls:o.a.string,isActive:o.a.bool,children:o.a.any,destroyInactivePanel:o.a.bool};var m=u,d=a("MFj2"),h=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n["Component"]),h(t,[{key:"handleItemClick",value:function(){this.props.onItemClick&&this.props.onItemClick()}},{key:"render",value:function(){var e,t=this.props,a=t.className,n=t.id,i=t.style,o=t.prefixCls,l=t.header,c=t.headerClass,p=t.children,u=t.isActive,h=t.showArrow,f=t.destroyInactivePanel,v=t.disabled,g=s()(o+"-header",y({},c,c)),b=s()((y(e={},o+"-item",!0),y(e,o+"-item-active",u),y(e,o+"-item-disabled",v),e),a);return r.a.createElement("div",{className:b,style:i,id:n,role:"tablist"},r.a.createElement("div",{className:g,onClick:this.handleItemClick.bind(this),role:"tab","aria-expanded":u},h&&r.a.createElement("i",{className:"arrow"}),l),r.a.createElement(d.default,{showProp:"isActive",exclusive:!0,component:"",animation:this.props.openAnimation},r.a.createElement(m,{prefixCls:o,isActive:u,destroyInactivePanel:f},p)))}}]),t}();f.propTypes={className:o.a.oneOfType([o.a.string,o.a.object]),id:o.a.string,children:o.a.any,openAnimation:o.a.object,prefixCls:o.a.string,header:o.a.oneOfType([o.a.string,o.a.number,o.a.node]),headerClass:o.a.string,showArrow:o.a.bool,isActive:o.a.bool,onItemClick:o.a.func,style:o.a.object,destroyInactivePanel:o.a.bool,disabled:o.a.bool},f.defaultProps={showArrow:!0,isActive:!1,destroyInactivePanel:!1,onItemClick:function(){},headerClass:""};var v=f,g=a("J9Du");function b(e,t,a,n){var r=void 0;return Object(g.default)(e,a,{start:function(){t?(r=e.offsetHeight,e.style.height=0):e.style.height=e.offsetHeight+"px"},active:function(){e.style.height=(t?r:0)+"px"},end:function(){e.style.height="",n()}})}var T=function(e){return{enter:function(t,a){return b(t,!0,e+"-anim",a)},leave:function(t,a){return b(t,!1,e+"-anim",a)}}},C=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();function E(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function k(e){var t=e;return Array.isArray(t)||(t=t?[t]:[]),t}var O=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n=a.props,r=n.activeKey,i=n.defaultActiveKey;return"activeKey"in a.props&&(i=r),a.state={openAnimation:a.props.openAnimation||T(a.props.prefixCls),activeKey:k(i)},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n["Component"]),C(t,[{key:"componentWillReceiveProps",value:function(e){"activeKey"in e&&this.setState({activeKey:k(e.activeKey)}),"openAnimation"in e&&this.setState({openAnimation:e.openAnimation})}},{key:"onClickItem",value:function(e){var t=this.state.activeKey;if(this.props.accordion)t=t[0]===e?[]:[e];else{var a=(t=[].concat(function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}(t))).indexOf(e);a>-1?t.splice(a,1):t.push(e)}this.setActiveKey(t)}},{key:"getItems",value:function(){var e=this,t=this.state.activeKey,a=this.props,i=a.prefixCls,o=a.accordion,l=a.destroyInactivePanel,s=[];return n.Children.forEach(this.props.children,function(a,n){if(a){var c=a.key||String(n),p=a.props,u=p.header,m=p.headerClass,d=p.disabled,h=!1;h=o?t[0]===c:t.indexOf(c)>-1;var y={key:c,header:u,headerClass:m,isActive:h,prefixCls:i,destroyInactivePanel:l,openAnimation:e.state.openAnimation,children:a.props.children,onItemClick:d?null:function(){return e.onClickItem(c)}};s.push(r.a.cloneElement(a,y))}}),s}},{key:"setActiveKey",value:function(e){"activeKey"in this.props||this.setState({activeKey:e}),this.props.onChange(this.props.accordion?e[0]:e)}},{key:"render",value:function(){var e,t=this.props,a=t.prefixCls,n=t.className,i=t.style,o=s()((E(e={},a,!0),E(e,n,!!n),e));return r.a.createElement("div",{className:o,style:i},this.getItems())}}]),t}();O.propTypes={children:o.a.any,prefixCls:o.a.string,activeKey:o.a.oneOfType([o.a.string,o.a.arrayOf(o.a.string)]),defaultActiveKey:o.a.oneOfType([o.a.string,o.a.arrayOf(o.a.string)]),openAnimation:o.a.object,onChange:o.a.func,accordion:o.a.bool,className:o.a.string,style:o.a.object,destroyInactivePanel:o.a.bool},O.defaultProps={prefixCls:"rc-collapse",onChange:function(){},accordion:!1,destroyInactivePanel:!1},O.Panel=v;var P=O;a.d(t,"Panel",function(){return S});t.default=P;var S=P.Panel},UCWl:function(e,t,a){"use strict";a.r(t);a("hr7U");var n=a("9xET"),r=a.n(n),i=(a("93XW"),a("d1El")),o=a.n(i),l=(a("FGdI"),a("Pbn2")),s=a.n(l),c=(a("fv9D"),a("ZPTe")),p=a.n(c),u=(a("MaXC"),a("4IMT")),m=a.n(u),d=(a("cUip"),a("iJl9")),h=a.n(d),y=a("QbLZ"),f=a.n(y),v=a("P2sY"),g=a.n(v),b=(a("PAYn"),a("EQeY")),T=a.n(b),C=a("4d7F"),E=a.n(C),k=(a("tL+A"),a("QpBz")),O=a.n(k),P=a("Yz+Y"),S=a.n(P),I=a("iCc5"),x=a.n(I),N=a("V7oC"),L=a.n(N),_=a("FYw3"),D=a.n(_),A=a("mRg0"),w=a.n(A),K=(a("nTym"),a("qu0K")),F=a.n(K),V=(a("fwXI"),a("CC+v")),M=a.n(V),j=a("sbe7"),R=a.n(j),q=a("/MKj"),z=a("dtw8"),W=a("LvDl"),B=a("7Qib"),U=a("bAm3"),Y=a("sVOr"),H=a("/gYX"),G=a("ZU0t"),J=a("dDU9"),Q=a("2KkY"),X=a("W9Sf"),Z=a("fvjX"),$=a("spSB"),ee=a("djHj"),te={currentStep:null,sourceMap:{table:[],sourceId:void 0,collectType:ee.z.ALL,cat:[ee.c.INSERT,ee.c.UPDATE,ee.c.DELETE]},targetMap:{sourceId:void 0,topic:void 0}};function ae(){return $.b.getState().realtimeTask.currentPage}function ne(e,t,a,n){var r=Object(W.cloneDeep)(ae());r[t]=a,"boolean"==typeof n&&(r.notSynced=n),e(Object(Q.x)(r))}var re,ie={navtoStep:function(e){return function(t){ne(t,"currentStep",e)}},getDataSource:function(){return function(e){Y.a.getStreamDataSourceList().then(function(t){var a=[];1===t.code&&(a=t.data),ne(e,"dataSourceList",a)})}},initCollectionTask:function(e){return function(t){var a=ae();void 0===a.currentStep&&(!function(e){var t=Object(W.cloneDeep)(ae());e(Object(Q.x)(f()({},t,te)))}(t),a.taskVersions&&a.taskVersions.length&&ne(t,"isEdit",!0),Y.a.getRealtimeJobData({taskId:e}).then(function(e){e.data?(e.data.sourceMap.journalName?e.data.sourceMap.collectType=ee.z.FILE:e.data.sourceMap.timestamp?e.data.sourceMap.collectType=ee.z.TIME:e.data.sourceMap.collectType=ee.z.ALL,t(ie.updateSourceMap(e.data.sourceMap,!1,!0)),t(ie.updateTargetMap(e.data.targetMap,!1,!0)),ne(t,"currentStep",2)):ne(t,"currentStep",0)}))}},updateSourceMap:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],a=arguments[2];return function(n){var r=ae().sourceMap;t&&(r=te.sourceMap),ne(n,"sourceMap",Object(W.cloneDeep)(f()({},r,e)),!a)}},updateTargetMap:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],a=arguments[2];return function(n){var r=ae().targetMap;t&&(r=te.targetMap),ne(n,"targetMap",Object(W.cloneDeep)(f()({},r,e)),!a)}}},oe=a("5Gkw"),le=a("/x1C"),se=a("dmTY"),ce=(a("G851"),a("ZvzK")),pe=a.n(ce),ue=(a("PFYH"),a("Jv8k")),me=a.n(ue),de=a("FyfS"),he=a.n(de),ye=(a("8YFG"),a("ATwu")),fe=a.n(ye),ve=(a("Z8Mf"),a("j7zX")),ge=a.n(ve),be=a("tHbZ"),Te=a("moyJ"),Ce=a("VoFA"),Ee=(a("7kJ1"),a("qPIi")),ke=a.n(Ee),Oe=a("ogP9"),Pe=F.a.Item,Se=ke.a.Group,Ie=function(e){function t(){return x()(this,t),D()(this,(t.__proto__||S()(t)).apply(this,arguments))}return w()(t,e),L()(t,[{key:"componentWillMount",value:function(){this.props.realtimeGetTaskTypes()}},{key:"render",value:function(){var e=this.props,t=e.form,a=e.currentPage,n=e.taskTypes,r=t.getFieldDecorator;return R.a.createElement("div",{style:{padding:"60px"}},R.a.createElement(F.a,null,R.a.createElement(Pe,f()({},ee.C,{label:"任务名称",hasFeedback:!0}),r("name",{rules:[{required:!0,message:"任务名称不可为空！"},{max:64,message:"任务名称不得超过64个字符！"}],initialValue:a?a.name:""})(R.a.createElement(h.a,null))),R.a.createElement(Pe,f()({},ee.C,{label:"任务类型"}),r("taskType",{rules:[],initialValue:a?a.taskType:0})(R.a.createElement(Se,{disabled:!0},n.map(function(e){return R.a.createElement(ke.a,{key:e.key,value:e.key},e.value)})))),R.a.createElement(Pe,f()({},ee.C,{label:"资源",hasFeedback:!0}),a&&a.resourceList&&a.resourceList.length>0?a.resourceList[0].resourceName:""),R.a.createElement(Pe,f()({},ee.C,{label:"mainClass"}),r("mainClass",{rules:[{}],initialValue:a&&a.mainClass})(R.a.createElement(h.a,{placeholder:"请输入mainClass"}))),R.a.createElement(Pe,f()({},ee.C,{label:"参数"}),r("exeArgs",{rules:[{}],initialValue:a&&a.exeArgs})(R.a.createElement(h.a,{placeholder:"请输入任务参数"}))),R.a.createElement(Pe,f()({},ee.C,{label:"描述",hasFeedback:!0}),r("taskDesc",{rules:[],initialValue:a?a.taskDesc:""})(R.a.createElement(h.a,{type:"textarea",rows:4})))))}}]),t}(j.Component),xe=F.a.create({onValuesChange:function(e,t){var a=e.dispatch,n=e.currentPage,r=!1;""===t.name&&(r=!0),t.invalid=r;var i=g()(n,t);a(Q.x(i)),a(Q.B(i))}})(Ie),Ne=Object(q.b)(function(e){return{taskTypes:e.realtimeTask.comm.taskTypes}},function(e){return Object(Z.b)({realtimeGetTaskTypes:Oe.b},e)})(xe),Le=a("76p7"),_e=a("Ohfy"),De=Object(q.b)(function(e){return{editor:e.editor}},function(e){var t=Object(Z.b)(se,e);return g()(t,{setCurrentPage:function(t){e(Object(Q.x)(t))}})})(re=function(e){function t(){var e,a,n,r;x()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=D()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(o))),n.onContentChange=function(e,t){(0,n.props.editorChange)({merged:!1,sqlText:e,cursorPosition:t.getPosition()})},n.sqlFormat=function(){var e=n.props,t=e.currentPage,a=e.setCurrentPage,r={sql:t.sqlText||""};Y.a.streamSqlFormat(r).then(function(e){if(e.data){var n={merged:!0,sqlText:e.data,id:t.id},r=g()(t,n);a(r)}})},n.debounceSelectionChange=Object(W.debounce)(n.props.setSelectionContent,200,{maxWait:2e3}),r=a,D()(n,r)}return w()(t,e),L()(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.currentPage,n=t.editor,r=a.cursorPosition||void 0,i=a.readWriteLockVO&&!a.readWriteLockVO.getLock,o={value:a.sqlText,language:"dtflink",options:{readOnly:i},cursorPosition:r,theme:n.options.theme||"white",onChange:this.onContentChange,sync:a.merged||void 0,onCursorSelection:this.debounceSelectionChange},l={enable:!0,enableRun:!1,enableFormat:!0,onFileEdit:Object(Le.a)(this._editor),onFormat:this.sqlFormat,onThemeChange:function(t){e.props.updateEditorOptions({theme:t})}};return R.a.createElement(_e.a,{editor:o,toolbar:l,key:"main-editor-"+a.id,editorInstanceRef:function(t){e._editor=t}})}}]),t}(j.Component))||re,Ae=(a("PzEo"),a("+vAN")),we=a.n(Ae),Ke=(a("GBD3"),a("wXtC")),Fe=a.n(Ke),Ve=(a("pJsf"),a("g4D/")),Me=a.n(Ve),je=(a("ek7I"),a("FAat")),Re=a.n(je),qe=a("wd/R"),ze=a.n(qe),We=F.a.Item,Be=Re.a.Option,Ue=ke.a.Group,Ye=Me.a.Group,He=function(e){function t(e){x()(this,t);var a=D()(this,(t.__proto__||S()(t)).call(this,e));return a.state={tableList:[]},a}return w()(t,e),L()(t,[{key:"componentDidMount",value:function(){var e=this.props.collectionData.sourceMap,t=void 0===e?{}:e;t.sourceId&&this.getTableList(t.sourceId)}},{key:"componentWillReceiveProps",value:function(e){var t=e.collectionData,a=t.sourceMap,n=this.props.collectionData,r=n.sourceMap;t.id!=n.id&&this.setState({tableList:[]}),a.sourceId&&r.sourceId!=a.sourceId&&this.getTableList(a.sourceId)}},{key:"getTableList",value:function(e){var t=this;Y.a.getStreamTablelist({sourceId:e,isSys:!1}).then(function(e){1===e.code&&t.setState({tableList:e.data||[]})})}},{key:"next",value:function(){var e=this;this._form.validateFields(null,{},function(t,a){t||e.props.navtoStep(1)})}},{key:"render",value:function(){var e=this,t=this.state.tableList;return R.a.createElement("div",null,R.a.createElement(Je,f()({ref:function(t){e._form=t},tableList:t},this.props)),!this.props.readonly&&R.a.createElement("div",{className:"steps-action"},R.a.createElement(m.a,{type:"primary",onClick:function(){return e.next()}},"下一步")))}}]),t}(R.a.Component),Ge=function(e){function t(){return x()(this,t),D()(this,(t.__proto__||S()(t)).apply(this,arguments))}return w()(t,e),L()(t,[{key:"renderByCatType",value:function(){var e=this.props,t=e.collectionData,a=e.form.getFieldDecorator,n=t.sourceMap,r=t.isEdit;switch(n.collectType){case ee.z.ALL:return null;case ee.z.TIME:return R.a.createElement(We,f()({},ee.C,{label:"起始时间",style:{textAlign:"left"}}),a("timestamp",{rules:[{required:!0,message:"请选择起始时间"}]})(R.a.createElement(Fe.a,{disabled:r,showTime:!0,placeholder:"请选择起始时间",format:"YYYY-MM-DD HH:mm:ss"})));case ee.z.FILE:return R.a.createElement(We,f()({},ee.C,{label:"起始文件"}),a("journalName",{rules:[{required:!0,message:"请填写起始文件"}]})(R.a.createElement(h.a,{disabled:r,placeholder:"请填写起始文件"})))}}},{key:"render",value:function(){var e=this.props,t=e.collectionData,a=e.tableList,n=t.dataSourceList,r=void 0===n?[]:n,i=t.sourceMap,o=t.isEdit,l=this.props.form.getFieldDecorator,s=i.allTable;return R.a.createElement("div",null,R.a.createElement(F.a,null,R.a.createElement(We,f()({},ee.C,{label:"数据源"}),l("sourceId",{rules:[{required:!0,message:"请选择数据源"}]})(R.a.createElement(Re.a,{disabled:o,placeholder:"请选择数据源",style:{width:"100%"}},r.map(function(e){return e.type!=ee.d.MYSQL?null:R.a.createElement(Be,{key:e.id,value:e.id},e.dataName,"(",ee.e[e.type],")")}).filter(Boolean)))),R.a.createElement(We,f()({},ee.C,{label:"表"}),l("table",{rules:[{required:!0,message:"请选择表"}]})(R.a.createElement(Re.a,{mode:"multiple",style:{width:"100%"},placeholder:"请选择表"},a.length?[R.a.createElement(Be,{key:-1,value:-1},"全部")].concat(a.map(function(e){return R.a.createElement(Be,{disabled:s,key:""+e,value:e},e)})):[]))),R.a.createElement(We,f()({},ee.C,{label:"采集起点",style:{textAlign:"left"}}),l("collectType",{rules:[{required:!0,message:"请选择采集起点"}]})(R.a.createElement(Ue,{disabled:o},R.a.createElement(ke.a,{value:ee.z.ALL},"全部"),R.a.createElement(ke.a,{value:ee.z.TIME},"按时间选择"),R.a.createElement(ke.a,{value:ee.z.FILE},"按文件选择")))),this.renderByCatType(),R.a.createElement(We,f()({},ee.C,{label:"数据操作"}),l("cat",{rules:[{required:!0,message:"请选择数据操作"}]})(R.a.createElement(Ye,{options:[{label:"Insert",value:ee.c.INSERT},{label:"Update",value:ee.c.UPDATE},{label:"Delete",value:ee.c.DELETE}]})))))}}]),t}(R.a.Component),Je=F.a.create({onValuesChange:function(e,t){var a=!1;void 0!=t.sourceId&&(a=!0),t.timestamp&&(t.timestamp=t.timestamp.valueOf(),t.journalName=null),t.journalName&&(t.timestamp=null),void 0!=t.collectType&&t.collectType==ee.z.ALL&&(t.journalName=null,t.timestamp=null),t.table&&(t.table.includes(-1)?(t.table=[],t.allTable=!0):t.allTable=!1),e.updateSourceMap(t,a)},mapPropsToFields:function(e){var t=e.collectionData.sourceMap;return{sourceId:{value:t.sourceId},table:{value:t.allTable?-1:t.table},collectType:{value:t.collectType},cat:{value:t.cat},timestamp:{value:t.timestamp?new ze.a(t.timestamp):void 0},journalName:{value:t.journalName}}}})(Ge),Qe=He,Xe=F.a.Item,Ze=Re.a.Option,$e=function(e){function t(e){x()(this,t);var a=D()(this,(t.__proto__||S()(t)).call(this,e));return a.state={topicList:[]},a}return w()(t,e),L()(t,[{key:"componentDidMount",value:function(){var e=this.props.collectionData.targetMap,t=void 0===e?{}:e;t.sourceId&&this.getTopicType(t.sourceId)}},{key:"componentWillReceiveProps",value:function(e){var t=e.collectionData.targetMap,a=this.props.collectionData.targetMap;t.sourceId&&a.sourceId!=t.sourceId&&this.getTopicType(t.sourceId)}},{key:"prev",value:function(){this.props.navtoStep(0)}},{key:"next",value:function(){var e=this;this._form.validateFields(null,{},function(t,a){t||e.props.navtoStep(2)})}},{key:"getTopicType",value:function(e){var t=this;Y.a.getTopicType({sourceId:e}).then(function(e){e.data&&t.setState({topicList:e.data})})}},{key:"render",value:function(){var e=this,t=this.state.topicList;return R.a.createElement("div",null,R.a.createElement(tt,f()({ref:function(t){e._form=t},topicList:t},this.props)),!this.props.readonly&&R.a.createElement("div",{className:"steps-action"},R.a.createElement(m.a,{style:{marginRight:8},onClick:function(){return e.prev()}},"上一步"),R.a.createElement(m.a,{type:"primary",onClick:function(){return e.next()}},"下一步")))}}]),t}(R.a.Component),et=function(e){function t(){return x()(this,t),D()(this,(t.__proto__||S()(t)).apply(this,arguments))}return w()(t,e),L()(t,[{key:"render",value:function(){var e=this.props,t=e.collectionData,a=e.topicList,n=t.dataSourceList,r=void 0===n?[]:n,i=t.isEdit,o=this.props.form.getFieldDecorator;return R.a.createElement("div",null,R.a.createElement(F.a,null,R.a.createElement(Xe,f()({},ee.C,{label:"数据源"}),o("sourceId",{rules:[{required:!0,message:"请选择数据源"}]})(R.a.createElement(Re.a,{disabled:i,placeholder:"请选择数据源",style:{width:"100%"}},r.map(function(e){return e.type!=ee.d.KAFKA?null:R.a.createElement(Ze,{key:e.id,value:e.id},e.dataName,"(",ee.e[e.type],")")}).filter(Boolean)))),R.a.createElement(Xe,f()({},ee.C,{label:"Topic"}),o("topic",{rules:[{required:!0,message:"请选择topic"}]})(R.a.createElement(Re.a,{disabled:i,style:{width:"100%"},placeholder:"请选择topic"},a.map(function(e){return R.a.createElement(Ze,{key:""+e,value:e},e)}))))))}}]),t}(R.a.Component),tt=F.a.create({onValuesChange:function(e,t){var a=!1;void 0!=t.sourceId&&(a=!0),e.updateTargetMap(t,a)},mapPropsToFields:function(e){var t=e.collectionData.targetMap;return{sourceId:{value:t.sourceId},topic:{value:t.topic}}}})(et),at=$e,nt=(a("mN36"),a("N9UN")),rt=a.n(nt);function it(){return R.a.createElement("div",{className:"mask-lock-layer"})}var ot,lt,st,ct,pt,ut=function(e){function t(){return x()(this,t),D()(this,(t.__proto__||S()(t)).apply(this,arguments))}return w()(t,e),L()(t,[{key:"navtoStep",value:function(e){this.props.navtoStep(e)}},{key:"prev",value:function(){this.props.navtoStep(1)}},{key:"save",value:function(){this.props.saveJob()}},{key:"render",value:function(){var e=this,t=this.props,a=t.currentPage,n=t.collectionData;return R.a.createElement("div",{className:"g-step5"},R.a.createElement("div",{className:"m-preview",style:{padding:"0 20"}},R.a.createElement(rt.a,{bordered:!1,style:{marginBottom:10},title:"选择来源",extra:R.a.createElement("a",{href:"javascript:void(0)",onClick:function(){return e.navtoStep(0)}},"修改")},R.a.createElement(Qe,{collectionData:n,readonly:!0}),R.a.createElement(it,null)),R.a.createElement(rt.a,{bordered:!1,style:{marginBottom:10},title:"选择目标",extra:R.a.createElement("a",{href:"javascript:void(0)",onClick:function(){return e.navtoStep(1)}},"修改")},R.a.createElement(at,{collectionData:n,readonly:!0}),R.a.createElement(it,null))),R.a.createElement("div",{className:"steps-action"},R.a.createElement(m.a,{style:{marginRight:8},onClick:function(){return e.prev()}},"上一步"),R.a.createElement(m.a,{type:"primary",disabled:!a.notSynced,onClick:function(){return e.save()}},"保存")))}}]),t}(R.a.Component),mt=we.a.Step,dt=function(e){function t(){return x()(this,t),D()(this,(t.__proto__||S()(t)).apply(this,arguments))}return w()(t,e),L()(t,[{key:"componentWillMount",value:function(){this.props.getDataSource(),this.props.initCollectionTask(this.props.currentPage.id)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;t.id!=a.id&&(this.props.initCollectionTask(t.id),this.props.getDataSource())}},{key:"navtoStep",value:function(e){this.props.navtoStep(e)}},{key:"save",value:function(){this.props.saveTask()}},{key:"render",value:function(){var e=this.props.currentPage,t=e||{},a=t.currentStep,n=e.readWriteLockVO&&!e.readWriteLockVO.getLock,r=[{title:"选择来源",content:R.a.createElement(Qe,{updateSourceMap:this.props.updateSourceMap,navtoStep:this.navtoStep.bind(this),collectionData:t})},{title:"选择目标",content:R.a.createElement(at,{updateTargetMap:this.props.updateTargetMap,navtoStep:this.navtoStep.bind(this),collectionData:t})},{title:"预览保存",content:R.a.createElement(ut,{navtoStep:this.navtoStep.bind(this),collectionData:t,saveJob:this.save.bind(this),currentPage:e})}];return a||0==a?R.a.createElement("div",{className:"m-datasync"},R.a.createElement(we.a,{current:a},r.map(function(e){return R.a.createElement(mt,{key:e.title,title:e.title})})),R.a.createElement("div",{className:"steps-content",style:{position:"relative"}},n?R.a.createElement("div",{className:"steps-mask"}):null,r[a].content)):null}}]),t}(R.a.Component),ht=Object(q.b)(function(e){var t=e.realtimeTask.currentPage;return{pages:e.realtimeTask.pages,currentPage:t,user:e.user,project:e.project}},function(e){return Object(Z.b)(ie,e)})(dt),yt=Object(q.b)(function(e){return{editor:e.editor}},function(e){var t=Object(Z.b)(se,e);return g()(t,{setCurrentPage:function(t){e(Object(Q.x)(t))}})})(ot=function(e){function t(){var e,a,n,r;x()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=D()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(o))),n.onContentChange=function(e,t){(0,n.props.editorChange)({merged:!1,sqlText:e,cursorPosition:t.getPosition()})},n.format=function(){var e=n.props,t=e.currentPage,a=e.setCurrentPage,r=e.onFormat,i={sql:t.sqlText||""};function o(e){var n={merged:!0,sqlText:e,id:t.id},r=g()(t,n);a(r)}r&&"function"==typeof r?r(t.sqlText).then(function(e){o(e)}):Y.a.streamSqlFormat(i).then(function(e){e.data&&o(e.data)})},n.debounceSelectionChange=Object(W.debounce)(n.props.setSelectionContent,200,{maxWait:2e3}),r=a,D()(n,r)}return w()(t,e),L()(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.currentPage,n=t.editor,r=t.mode,i=t.toolBarOptions,o=void 0===i?{}:i,l=a.cursorPosition||void 0,s=a.readWriteLockVO&&!a.readWriteLockVO.getLock,c={value:a.sqlText,language:r,options:{readOnly:s},cursorPosition:l,theme:n.options.theme,onChange:this.onContentChange,sync:a.merged||void 0,onCursorSelection:this.debounceSelectionChange},p=f()({enable:!0,enableRun:!1,enableFormat:!0,onFileEdit:Object(Le.a)(this._editor),onFormat:this.format,onThemeChange:function(t){e.props.updateEditorOptions({theme:t})}},o);return R.a.createElement(_e.a,{editor:c,toolbar:p,key:"main-editor-"+a.id,editorInstanceRef:function(t){e._editor=t}})}}]),t}(j.Component))||ot,ft=a("GQeE"),vt=a.n(ft),gt=a("5012"),bt=a("TH1f"),Tt=(a("vbTb"),F.a.Item),Ct=Re.a.Option,Et=function(e){function t(){var e,a,n,r;x()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=D()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(o))),n.state={sourceType:void 0,targetType:void 0},r=a,D()(n,r)}return w()(t,e),L()(t,[{key:"sourceTypeChange",value:function(e){var t=this.props.form.setFieldsValue;this.setState({sourceType:e},function(){t({sourceId:void 0})})}},{key:"targetTypeChange",value:function(e){var t=this.props.form.setFieldsValue;this.setState({targetType:e},function(){t({targetSourceId:void 0})})}},{key:"getSourceList",value:function(){var e=this.state.sourceType,t=this.props.dataSourceList;return(void 0===t?[]:t).filter(function(t){return t.type==e}).map(function(e){return R.a.createElement(Ct,{key:e.id,name:e.dataName,value:""+e.id},e.dataName,"( ",R.a.createElement(bt.d,{value:e.type}),"  )")})}},{key:"getTargetList",value:function(){var e=this.state.targetType,t=this.props.dataSourceList;return(void 0===t?[]:t).filter(function(t){return t.type==e}).map(function(e){return R.a.createElement(Ct,{key:e.id,name:e.dataName,value:""+e.id},e.dataName,"( ",R.a.createElement(bt.d,{value:e.type})," )")})}},{key:"getTemplateFromNet",value:function(){var e=this,t=this.props.form.validateFields,a=this.props.id;t(function(t,n){if(!t){var r={id:a,sourceMap:{sourceId:n.sourceId,type:n.sourceType},targetMap:{sourceId:n.targetSourceId,type:n.targetType},taskId:a};Y.a.getRealtimeCollectionTemplate(r).then(function(t){1==t.code&&(O.a.success("导入成功"),e.props.onSuccess(t.data))})}})}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.props,a=(t.dataSourceList,t.execConfirmVisible),n=vt()(ee.d).filter(function(e){return ee.d[e]==ee.d.MYSQL}).map(function(e){var t=ee.d[e];return R.a.createElement(Ct,{key:t,value:t.toString()},R.a.createElement(bt.d,{value:t}))}),r=vt()(ee.d).filter(function(e){return ee.d[e]==ee.d.KAFKA}).map(function(e){var t=ee.d[e];return R.a.createElement(Ct,{key:t,value:t.toString()},R.a.createElement(bt.d,{value:t}))});return R.a.createElement("div",{id:"JS_import_modal"},R.a.createElement(M.a,{maskClosable:!0,visible:a,title:"导入模版",onCancel:this.props.onCancel,onOk:this.getTemplateFromNet.bind(this),getContainer:function(){return Object(gt.c)("JS_cata_modal")}},R.a.createElement(F.a,null,R.a.createElement(Tt,f()({},ee.C,{label:"来源类型",hasFeedback:!0}),e("sourceType",{rules:[{required:!0,message:"来源类型不可为空！"}]})(R.a.createElement(Re.a,{placeholder:"请选择来源类型",onChange:this.sourceTypeChange.bind(this)},n))),R.a.createElement(Tt,f()({style:{marginBottom:"35px"}},ee.C,{label:"数据源",hasFeedback:!0}),e("sourceId",{rules:[{required:!0,message:"数据源不可为空！"}]})(R.a.createElement(Re.a,{placeholder:"请选择数据源"},this.getSourceList()))),R.a.createElement(Tt,f()({},ee.C,{label:"目标类型",hasFeedback:!0}),e("targetType",{rules:[{required:!0,message:"目标类型不可为空！"}]})(R.a.createElement(Re.a,{placeholder:"请选择目标类型",onChange:this.targetTypeChange.bind(this)},r))),R.a.createElement(Tt,f()({},ee.C,{label:"数据源",hasFeedback:!0}),e("targetSourceId",{rules:[{required:!0,message:"数据源不可为空！"}]})(R.a.createElement(Re.a,{placeholder:"请选择目标数据源"},this.getTargetList()))))))}}]),t}(j.Component),kt=F.a.create()(Et),Ot=Object(q.b)(function(e){return{dataSourceList:e.realtimeTask.currentPage.dataSourceList}},function(e){return{getDataSource:function(){e(ie.getDataSource())}}})(lt=function(e){function t(){var e,a,n,r;x()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=D()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(o))),n.state={execConfirmVisible:!1},n.onSuccess=function(e){n.props.dispatch;var t={merged:!0};t.sqlText=B.a.jsonFormat(e),n.setState({execConfirmVisible:!1}),n.props.editorChange(t)},r=a,D()(n,r)}return w()(t,e),L()(t,[{key:"componentDidMount",value:function(){(0,this.props.getDataSource)()}},{key:"importTemplate",value:function(){this.setState({execConfirmVisible:!0})}},{key:"render",value:function(){var e=this,t=this.state.execConfirmVisible;return R.a.createElement("span",null,R.a.createElement(m.a,{onClick:this.importTemplate.bind(this),title:"导入模版",icon:"plus-circle-o",style:{marginLeft:"0px"}},"导入模版"),R.a.createElement(kt,f()({execConfirmVisible:t,onCancel:function(){e.setState({execConfirmVisible:!1})},onSuccess:this.onSuccess.bind(this)},this.props)))}}]),t}(j.Component))||lt,Pt=function(e){function t(){return x()(this,t),D()(this,(t.__proto__||S()(t)).apply(this,arguments))}return w()(t,e),L()(t,[{key:"formatJson",value:function(e){return e?new E.a(function(t,a){var n=B.a.jsonFormat(e);t(n||e)}):e}},{key:"getLeftButton",value:function(){return R.a.createElement(Ot,this.props)}},{key:"render",value:function(){return R.a.createElement("div",null,R.a.createElement(yt,f()({mode:"json"},this.props,{onFormat:this.formatJson,toolBarOptions:{leftCustomButton:this.getLeftButton()}})))}}]),t}(R.a.Component),St=function(e){function t(){return x()(this,t),D()(this,(t.__proto__||S()(t)).apply(this,arguments))}return w()(t,e),L()(t,[{key:"render",value:function(){var e=this.props.currentPage,t=void 0;switch(e.taskType){case ee.y.SQL:t=R.a.createElement(De,this.props);break;case ee.y.DATA_COLLECTION:e.createModel==ee.f.GUIDE?t=R.a.createElement(ht,this.props):e.createModel==ee.f.SCRIPT&&(t=R.a.createElement(Pt,this.props));break;case ee.y.MR:default:t=R.a.createElement(Ne,this.props)}return R.a.createElement("div",{className:"editor-container"},t)}}]),t}(j.Component),It=(a("7LYo"),a("5GXF")),xt=a.n(It),Nt=a("I/n2"),Lt=Re.a.Option,_t=xt.a.Panel,Dt=function(e){function t(){var e,a,n,r;x()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=D()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(o))),n.state={visibleAlterRes:!1,resList:[]},n.handleChange=function(e){n.setState({resList:e})},n.alterRes=function(){var e=n,t=n.props.currentPage,a=n.state.resList;0!==(a=Array.isArray(a)?a:[a]).length?t&&t.id&&a.length>0&&Y.a.updateTaskRes({id:t.id,resources:a}).then(function(a){1===a.code&&(O.a.success("资源修改成功！"),e.reloadTask(t.id),e.setState({visibleAlterRes:!1,resList:[]}))}):O.a.info("您没有选择任何资源！")},r=a,D()(n,r)}return w()(t,e),L()(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;if(t.id!==a.id){var n=t.resourceList.length>0?t.resourceList.map(function(e){return e.id}):[];this.setState({resList:n})}}},{key:"reloadTask",value:function(e){var t=this.props.dispatch;Y.a.getTask({taskId:e}).then(function(e){1===e.code&&(t(Q.x(e.data)),t(Q.B(e.data)))})}},{key:"getTaskName",value:function(e){switch(e){case ee.y.SQL:return"FlinkSQL";case ee.y.MR:return"FlinkMR";case ee.y.DATA_COLLECTION:return"实时采集"}}},{key:"render",value:function(){var e=this,t=this.state,a=t.visibleAlterRes,n=t.resList,i=this.props,o=i.resources,l=i.currentPage,s=i.editorChange,c=l.resourceList&&l.resourceList.map(function(e){return R.a.createElement(T.a,{key:e.id,color:"blue"},e.resourceName)}),u=o&&o.map(function(e){return R.a.createElement(Lt,{value:e.id,key:e.id,name:e.resourceName},e.resourceName)}),m=l.taskType!=ee.y.DATA_COLLECTION;return R.a.createElement("div",{className:"m-taksdetail"},R.a.createElement(xt.a,{bordered:!1,defaultActiveKey:["1","2"]},R.a.createElement(_t,{key:"1",header:"任务属性"},R.a.createElement(r.a,{className:"task-info"},R.a.createElement(r.a,null,R.a.createElement(p.a,{span:"10",className:"txt-right"},"任务名称："),R.a.createElement(p.a,{span:"14"},l.name)),R.a.createElement(r.a,null,R.a.createElement(p.a,{span:"10",className:"txt-right"},"任务类型："),R.a.createElement(p.a,{span:"14"},this.getTaskName(l.taskType))),m&&R.a.createElement(r.a,null,R.a.createElement(p.a,{span:"10",className:"txt-right"},"资源："),R.a.createElement(p.a,{span:"14",style:{marginTop:"10px"}},c)),R.a.createElement(r.a,null,R.a.createElement(p.a,{span:"10",className:"txt-right"},"创建人员："),R.a.createElement(p.a,{span:"14"},l.createUserName)),R.a.createElement(r.a,null,R.a.createElement(p.a,{span:"10",className:"txt-right"},"创建时间："),R.a.createElement(p.a,{span:"14"},B.a.formatDateTime(l.gmtCreate))),R.a.createElement(r.a,null,R.a.createElement(p.a,{span:"10",className:"txt-right"},"最近修改时间："),R.a.createElement(p.a,{span:"14"},B.a.formatDateTime(l.gmtModified))),R.a.createElement(r.a,null,R.a.createElement(p.a,{span:"10",className:"txt-right"},"描述："),R.a.createElement(p.a,{span:"14"},l.taskDesc)),R.a.createElement(M.a,{title:"修改任务资源",wrapClassName:"vertical-center-modal",visible:a,onCancel:function(){e.setState({visibleAlterRes:!1})},onOk:this.alterRes},R.a.createElement(Re.a,{mode:0===l.taskType?"multiple":"",style:{width:"100%"},showSearch:!0,value:n,placeholder:"请选择资源",optionFilterProp:"name",onChange:this.handleChange},u)))),R.a.createElement(_t,{key:"2",header:"历史提交版本"},R.a.createElement(Nt.a,{taskInfo:l,changeSql:s,taskType:"realTimeTask"}))))}}]),t}(j.Component),At=(a("/xgg"),a("aOJk")),wt=a.n(At),Kt=a("gDS+"),Ft=a.n(Kt),Vt=a("YEIV"),Mt=a.n(Vt),jt=(a("b+Mx"),a("5Dct")),Rt=a.n(jt),qt=a("DE4S"),zt=Re.a.Option,Wt=xt.a.Panel,Bt=ke.a.Group,Ut=F.a.Item,Yt=function(e){function t(){var e,a,n,r;x()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=D()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(o))),n.checkParams=function(){var e=n.props,t=e.index,a=(e.panelColumn[t].columns,{});return n.props.form.validateFields(function(e,t){a.status=!e}),a},n.originOption=function(e,t){switch(e){case"originType":return t.map(function(e){return R.a.createElement(zt,{key:e,value:""+e.id},e.name)});case"currencyType":return t.map(function(e){return R.a.createElement(zt,{key:e,value:""+e},e)});case"eventTime":return t.map(function(e,t){return R.a.createElement(zt,{key:t,value:""+e.column},e.column)});default:return null}},n.debounceEditorChange=Object(W.debounce)(n.editorParamsChange,300,{maxWait:2e3}),r=a,D()(n,r)}return w()(t,e),L()(t,[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"editorParamsChange",value:function(e,t,a){var n=this.props,r=n.handleInputChange,i=n.index;this._syncEditor=!1,r("columnsText",i,t)}},{key:"render",value:function(){var e=this.props,t=e.handleInputChange,a=e.index,n=e.panelColumn,i=e.sync,l=e.timeColumoption,c=void 0===l?[]:l,u=e.originOptionType,m=void 0===u?[]:u,d=e.topicOptionType,y=void 0===d?[]:d,v=this.originOption("originType",m[a]||[]),g=this.originOption("currencyType",y[a]||[]),b=this.originOption("eventTime",c[a]||[]),T=this.props.form.getFieldDecorator,C={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}};return R.a.createElement(r.a,{className:"title-content"},R.a.createElement(F.a,null,R.a.createElement(Ut,f()({},C,{label:"类型"}),T("type",{rules:[{required:!0,message:"请选择类型"}]})(R.a.createElement(Re.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("type",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},R.a.createElement(zt,{value:"14"},"Kafka")))),R.a.createElement(Ut,f()({},C,{label:"数据源"}),T("sourceId",{rules:[{required:!0,message:"请选择数据源"}]})(R.a.createElement(Re.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("sourceId",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},v))),R.a.createElement(Ut,f()({},C,{label:"Topic"}),T("topic",{rules:[{required:!0,message:"请选择Topic"}]})(R.a.createElement(Re.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("topic",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},g))),R.a.createElement(Ut,f()({},C,{label:R.a.createElement("span",null,"映射表 ",R.a.createElement(o.a,{title:"该表是kafka中的topic映射而成，可以以SQL的方式使用它。"},R.a.createElement(s.a,{type:"question-circle-o"})))}),T("table")(R.a.createElement(h.a,{placeholder:"请输入映射表名",className:"right-input",onChange:function(e){return t("table",a,e.target.value)}}))),R.a.createElement(r.a,null,R.a.createElement("div",{className:"ant-form-item-label ant-col-xs-24 ant-col-sm-6"},R.a.createElement("label",null,"字段")),R.a.createElement(p.a,{span:"18",style:{marginBottom:20,height:202}},R.a.createElement(qt.a,{style:{minHeight:202},className:"bd",key:"params-editor",sync:i,placeholder:"字段 类型, 比如 id int 一行一个字段",value:n[a].columnsText,onChange:this.editorParamsChange.bind(this)}))),R.a.createElement(Ut,f()({},C,{label:"时间特征"}),T("timeType")(R.a.createElement(Bt,{className:"right-select",onChange:function(e){t("timeType",a,e.target.value)}},R.a.createElement(ke.a,{value:1},"ProcTime"),R.a.createElement(ke.a,{value:2},"EventTime")))),2===n[a].timeType?R.a.createElement(Ut,f()({},C,{label:"时间列"}),T("timeColumn",{rules:[{required:!0,message:"请选择时间列"}]})(R.a.createElement(Re.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("timeColumn",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},b))):void 0,2===n[a].timeType?R.a.createElement(Ut,f()({},C,{label:R.a.createElement("span",null,"偏移量(ms)",R.a.createElement(o.a,{title:"watermark值与event time值的偏移量"},R.a.createElement(s.a,{type:"question-circle-o"})))}),T("offset",{rules:[{required:!0,message:"请输入时间偏移量"}]})(R.a.createElement(Rt.a,{className:"number-input",min:0,onChange:function(e){return t("offset",a,e)}}))):void 0,R.a.createElement(Ut,f()({},C,{label:"并行度"}),T("parallelism")(R.a.createElement(Rt.a,{className:"number-input",min:1,onChange:function(e){return t("parallelism",a,e)}})))))}}]),t}(j.Component),Ht=F.a.create({mapPropsToFields:function(e){var t=e.panelColumn[e.index];return{type:{value:t.type},sourceId:{value:t.sourceId},topic:{value:t.topic},table:{value:t.table},columns:{value:t.columns},timeType:{value:t.timeType},timeColumn:{value:t.timeColumn},offset:{value:t.offset},columnsText:{value:t.columnsText},parallelism:{value:t.parallelism}}}})(Yt),Gt=(st={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Mt()(st,"popoverVisible",[]),Mt()(st,"panelColumn",[]),Mt()(st,"checkFormParams",[]),Mt()(st,"timeColumoption",[]),Mt()(st,"topicOptionType",[]),Mt()(st,"originOptionType",[]),st),Jt=function(e){function t(e){var a;x()(this,t);var n=D()(this,(t.__proto__||S()(t)).call(this,e));return n.currentInitData=function(e){var t=n.state,a=t.tabTemplate,r=t.panelColumn;e.map(function(e,t){a.push(Ht),r.push(e),n.getTypeOriginData(t,e.type),n.parseColumnsText(t,e.columnsText),n.getTopicType(t,e.sourceId)}),n.setCurrentSource({tabTemplate:a,panelColumn:r}),n.setState({tabTemplate:a,panelColumn:r})},n.parseColumnsText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=n.state,r=a.timeColumoption,i=a.panelColumn,o=t.split("\n").filter(function(e){return!!e}).map(function(e){var t=void 0;return e.trim().includes(" as ")?{column:e.trim().replace(/\(.*\)/,"").split(" as ")[1]}:{column:(t=e.trim().split(" "))[0],type:t[1]}}),l=o.filter(function(e){return e.column});r[e]=l;var s=l.filter(function(t){return t.column===i[e].timeColumn})[0];i[e].timeColumn=s&&s.column||void 0,n.setCurrentSource({timeColumoption:r}),n.setState({timeColumoption:r})},n.getTypeOriginData=function(e,t){var a=n.state.originOptionType;Y.a.getTypeOriginData({type:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setCurrentSource({originOptionType:a}),n.setState({originOptionType:a})})},n.getTopicType=function(e,t){var a=n.state.topicOptionType;t?Y.a.getTopicType({sourceId:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setCurrentSource({topicOptionType:a}),n.setState({topicOptionType:a})}):("add"===e?a.push([]):a[e]=[],n.setCurrentSource({topicOptionType:a}),n.setState({topicOptionType:a}))},n.getCurrentData=function(e,t){var a=t.dispatch,r=t.inputData,i=t.currentPage.source;if(!r[e]&&i.length>0)n.receiveState(e,i,a);else{var o=JSON.parse(Ft()(Gt)),l=r[e]||o;n.setState(f()({},l))}},n.receiveState=function(e,t,a){var r=[],i=[],o=[],l=[],s=[],c=[],p=[],u=[];t.map(function(e){r.push(Ht),i.push(e)}),a(Q.z({taskId:e,source:{tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,timeColumoption:c,originOptionType:p,topicOptionType:u}})),n.setState({tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,originOptionType:p,topicOptionType:u,timeColumoption:c},function(){t.map(function(e,t){n.getTypeOriginData(t,e.type),n.getTopicType(t,e.sourceId),n.parseColumnsText(t,e.columnsText)})})},n.changeInputTabs=function(e,t){var a={type:"14",sourceId:void 0,topic:void 0,table:void 0,timeType:1,timeColumn:void 0,offset:0,columnsText:void 0,parallelism:1},r=n.state,i=r.tabTemplate,o=r.panelActiveKey,l=r.popoverVisible,s=r.panelColumn,c=r.checkFormParams,p=r.originOptionType,u=r.topicOptionType;if("add"===e){i.push(Ht),s.push(a),n.getTypeOriginData("add",a.type),n.getTopicType("add",a.topic);var m=""+i.length;o.push(m)}else i.splice(t,1),s.splice(t,1),p.splice(t,1),u.splice(t,1),c.pop(),o=n.changeActiveKey(t),l[t]=!1;n.props.tableParamsChange(),n.setCurrentSource({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,originOptionType:p,topicOptionType:u}),n.setState({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,checkFormParams:c,originOptionType:p,topicOptionType:u})},n.setCurrentSource=function(e){var t=n.props,a=t.dispatch,r=t.currentPage,i=f()({},n.state,e);a(Q.z({taskId:r.id,source:i}))},n.changeActiveKey=function(e){var t=n.state.panelActiveKey,a=""+(e+1),r=t.indexOf(a);return r>-1&&t.splice(r,1),t.map(function(t){return Number(t)>Number(e)?""+(Number(t)-1):t})},n.handleActiveKey=function(e){var t=n.state.panelActiveKey;t=e,n.setCurrentSource({panelActiveKey:t}),n.setState({panelActiveKey:t})},n.handleInputChange=function(e,t,a){var r=n.state,i=r.panelColumn,o=r.timeColumoption,l=r.originOptionType,s=r.topicOptionType,c=["type","sourceId","topic","table","columns","timeType","timeColumn","offset","columnsText","parallelism"];"columnsText"===e&&(n._syncEditor=!1,n.parseColumnsText(t,a,"changeText")),i[t][e]=a,"type"===e?(n._syncEditor=!0,o[t]=[],l[t]=[],s[t]=[],c.map(function(e){"type"!=e&&(i[t][e]="columns"==e?[]:"timeType"==e?1:"parallelism"==e?1:void 0)}),n.getTypeOriginData(t,a)):"sourceId"===e?(n._syncEditor=!0,o[t]=[],s[t]=[],c.map(function(e){"type"!=e&&"sourceId"!=e&&(i[t][e]="columns"==e?[]:"timeType"==e?1:"parallelism"==e?1:void 0)}),n.getTopicType(t,a)):"topic"===e&&(n._syncEditor=!0,o[t]=[],c.map(function(e){"type"!=e&&"sourceId"!=e&&"topic"!=e&&(i[t][e]="columns"==e?[]:"timeType"==e?1:"parallelism"==e?1:void 0)})),n.props.tableParamsChange(),n.setCurrentSource({panelColumn:i}),n.setState({panelColumn:i})},n.clearCurrentInfo=function(e,t,a){var r=n.state,i=r.panelColumn,o=r.topicOptionType,l=r.originOptionType,s={type:void 0,sourceId:void 0,topic:void 0,table:void 0,timeType:1,timeColumn:void 0,offset:0,columnsText:void 0,parallelism:1};"type"===e?(s.type=a,i[t]=s,o[t]=[],l[t]=[]):"sourceId"===e&&(s.type=i[t].type,s.sourceId=a,i[t]=s,o[t]=[]),n.setCurrentSource({panelColumn:i,topicOptionType:o,originOptionType:l}),n.setState({panelColumn:i,topicOptionType:o,originOptionType:l})},n.handlePopoverVisibleChange=function(e,t,a){var r=n.state.popoverVisible;r[t]=a,e&&(e.stopPropagation(),a&&(r=r.map(function(e,a){return t==a}))),n.setCurrentSource({popoverVisible:r}),n.setState({popoverVisible:r})},n.panelHeader=function(e){var t=n.state.popoverVisible,a=R.a.createElement("div",{className:"input-panel-title"},R.a.createElement("div",{style:{padding:"8 0 12"}}," ",R.a.createElement(s.a,{type:"exclamation-circle",style:{color:"#faad14"}}),"  你确定要删除此输入源吗？"),R.a.createElement("div",{style:{textAlign:"right",padding:"0 0 8"}},R.a.createElement(m.a,{style:{marginRight:8},size:"small",onClick:function(){n.handlePopoverVisibleChange(null,e,!1)}},"取消"),R.a.createElement(m.a,{type:"primary",size:"small",onClick:function(){n.changeInputTabs("delete",e)}},"确定")));return R.a.createElement("div",{className:"input-panel-title"},R.a.createElement("span",null," 输入源 "+(e+1)+" "),R.a.createElement(wt.a,{trigger:"click",placement:"topLeft",content:a,visible:t[e],onClick:function(a){n.handlePopoverVisibleChange(a,e,!t[e])}},R.a.createElement("span",{className:"title-icon input-panel-title"},R.a.createElement(s.a,{type:"delete"}))))},n.recordForm=function(e){var t=n.state.checkFormParams;t.push(e),n.setCurrentSource({checkFormParams:t}),n.setState({checkFormParams:t})},n.state=(a={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Mt()(a,"popoverVisible",[]),Mt()(a,"panelColumn",[]),Mt()(a,"checkFormParams",[]),Mt()(a,"timeColumoption",[]),Mt()(a,"topicOptionType",[]),Mt()(a,"originOptionType",[]),a),n}return w()(t,e),L()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentPage.source;e&&e.length>0&&this.currentInitData(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;t.id!==a.id&&(this._syncEditor=!0,this.getCurrentData(t.id,e))}},{key:"render",value:function(){var e=this,t=this.state,a=t.tabTemplate,n=t.panelActiveKey,r=t.panelColumn,i=t.timeColumoption,o=t.topicOptionType,l=t.originOptionType;return R.a.createElement("div",{className:"m-taksdetail panel-content"},R.a.createElement(xt.a,{activeKey:n,bordered:!1,onChange:this.handleActiveKey},a.map(function(t,a){return R.a.createElement(Wt,{header:e.panelHeader(a),key:a+1,style:{borderRadius:5},className:"input-panel"},R.a.createElement(Ht,{sync:e._syncEditor,index:a,key:a+1,handleInputChange:e.handleInputChange,panelColumn:r,onRef:e.recordForm,editorParamsChange:e.props.editorParamsChange,timeColumoption:i,topicOptionType:o,originOptionType:l}))})),R.a.createElement(m.a,{className:"stream-btn",onClick:function(){e.changeInputTabs("add")},style:{borderRadius:5}},R.a.createElement(s.a,{type:"plus"}),R.a.createElement("span",null," 添加输入")))}}]),t}(j.Component),Qt=(a("zmYW"),a("DtFj")),Xt=a.n(Qt),Zt=Re.a.Option,$t=xt.a.Panel,ea=(ke.a.Group,Xt.a.Column),ta=(Xt.a.ColumnGroup,F.a.Item),aa=function(e){function t(){var e,a,n,r;x()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=D()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(o))),n.checkParams=function(e){var t=n.props,a=t.index,r=(t.panelColumn[a].columns,{});return n.props.form.validateFields(function(e,t){r.status=!e}),r},n.originOption=function(e,t){switch(e){case"originType":return t.map(function(e){return R.a.createElement(Zt,{key:e,value:""+e.id},e.name)});case"currencyType":return t.map(function(e){return R.a.createElement(Zt,{key:e,value:""+e},e)});case"columnType":return t.map(function(e,t){return R.a.createElement(Zt,{key:t,value:""+e.key},e.key)});case"primaryType":return t.map(function(e,t){return R.a.createElement(Zt,{key:t,value:""+e.column},e.column)});default:return null}},r=a,D()(n,r)}return w()(t,e),L()(t,[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"editorParamsChange",value:function(e,t,a){var n=this.props,r=n.handleInputChange,i=n.index;this._syncEditor=!1,r("columnsText",i,t)}},{key:"render",value:function(){var e=this.props,t=e.handleInputChange,a=e.index,n=e.sync,i=e.originOptionType,l=e.tableOptionType,c=e.panelColumn,u=e.tableColumnOptionType,d=this.props.form.getFieldDecorator,y=this.originOption("originType",i[a]||[]),v=this.originOption("currencyType",l[a]||[]),g=this.originOption("columnType",u[a]||[]),b=this.originOption("primaryType",c[a].columns||[]),T={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}};return R.a.createElement(r.a,{className:"title-content"},R.a.createElement(ta,f()({},T,{label:"存储类型"}),d("type",{rules:[{required:!0,message:"请选择存储类型"}]})(R.a.createElement(Re.a,{className:"right-select",onChange:function(e){t("type",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},R.a.createElement(Zt,{value:"1"},"MySQL"),R.a.createElement(Zt,{value:"8"},"HBase"),R.a.createElement(Zt,{value:"11"},"ElasticSearch")))),R.a.createElement(ta,f()({},T,{label:"数据源"}),d("sourceId",{initialValue:"disabled",rules:[{required:!0,message:"请选择数据源"}]})(R.a.createElement(Re.a,{className:"right-select",onChange:function(e){t("sourceId",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},y))),"1"==c[a].type||"8"==c[a].type?R.a.createElement(ta,f()({},T,{label:"表"}),d("table",{initialValue:"disabled",rules:[{required:!0,message:"请选择表"}]})(R.a.createElement(Re.a,{className:"right-select",onChange:function(e){t("table",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},v))):"","11"==c[a].type?R.a.createElement(ta,f()({},T,{label:"索引"}),d("index",{rules:[{required:!0,message:"请输入索引"}]})(R.a.createElement(h.a,{placeholder:"请输入索引",onChange:function(e){return t("index",a,e.target.value)}}))):"","11"==c[a].type?R.a.createElement(ta,f()({},T,{label:R.a.createElement("span",null,"id ",R.a.createElement(o.a,{title:"id生成规则：填写字段的索引位置（从0开始)"},R.a.createElement(s.a,{type:"question-circle-o"}))," ")}),d("esId")(R.a.createElement(h.a,{placeholder:"请输入id",onChange:function(e){return t("esId",a,e.target.value)}}))):"","11"==c[a].type?R.a.createElement(ta,f()({},T,{label:"索引类型"}),d("esType",{rules:[{required:!0,message:"请输入索引类型"}]})(R.a.createElement(h.a,{placeholder:"请输入索引类型",onChange:function(e){return t("esType",a,e.target.value)}}))):"","8"==c[a].type?R.a.createElement(ta,f()({},T,{label:"rowKey"}),d("rowKey",{rules:[{required:!0,message:"请输入rowKey"}]})(R.a.createElement(h.a,{placeholder:" rowKey 格式：填写字段1 , 填写字段2 ",onChange:function(e){return t("rowKey",a,e.target.value)}}))):"",R.a.createElement(ta,f()({},T,{label:"映射表"}),d("tableName",{rules:"11"===c[a].type?[{required:!0,message:"请输入映射表名"}]:[]})(R.a.createElement(h.a,{placeholder:"请输入映射表名",onChange:function(e){return t("tableName",a,e.target.value)}}))),R.a.createElement(r.a,null,R.a.createElement("div",{className:"ant-form-item-label ant-col-xs-24 ant-col-sm-6"},R.a.createElement("label",null,"字段")),"1"==c[a].type?R.a.createElement(p.a,{span:"18",className:"bd",style:{marginBottom:20}},R.a.createElement(Xt.a,{dataSource:c[a].columns,className:"table-small",pagination:!1,size:"small"},R.a.createElement(ea,{title:"字段",dataIndex:"column",key:"字段",width:"50%",render:function(e,n,r){return R.a.createElement(Re.a,{className:"sub-right-select",value:e,onChange:function(e){t("subColumn",a,r,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},g)}}),R.a.createElement(ea,{title:"类型",dataIndex:"type",key:"类型",width:"40%",render:function(e,t,a){return R.a.createElement(h.a,{value:e,disabled:!0})}}),R.a.createElement(ea,{key:"delete",render:function(e,n,r){return R.a.createElement(s.a,{type:"close",style:{fontSize:16,color:"#888"},onClick:function(){t("deleteColumn",a,r)}})}})),R.a.createElement("div",{style:{padding:"0 20 20"}},R.a.createElement(m.a,{className:"stream-btn",type:"dashed",style:{borderRadius:5},onClick:function(){t("columns",a,{})}},R.a.createElement(s.a,{type:"plus"}),R.a.createElement("span",null," 添加输入")))):R.a.createElement(p.a,{span:"18",style:{marginBottom:20,height:200}},R.a.createElement(qt.a,{style:{minHeight:202,border:"1px solid #ddd"},key:"params-editor",sync:n,placeholder:"字段 类型, 比如 id int 一行一个字段",value:c[a].columnsText,onChange:this.editorParamsChange.bind(this)}))),"1"==c[a].type?R.a.createElement(ta,f()({},T,{label:"主键"}),d("primaryKey")(R.a.createElement(Re.a,{className:"right-select",onChange:function(e){t("primaryKey",a,e)},mode:"multiple",showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},b))):"",R.a.createElement(ta,f()({},T,{label:"并行度"}),d("parallelism")(R.a.createElement(Rt.a,{className:"number-input",min:1,onChange:function(e){return t("parallelism",a,e)}}))))}}]),t}(j.Component),na=F.a.create({mapPropsToFields:function(e){var t=e.panelColumn[e.index];return{type:{value:t.type},sourceId:{value:t.sourceId},table:{value:t.table},columns:{value:t.columns},columnsText:{value:t.columnsText},id:{value:t.id},index:{value:t.index},writePolicy:{value:t.writePolicy},esId:{value:t.esId},esType:{value:t.esType},parallelism:{value:t.parallelism},tableName:{value:t.tableName},primaryKey:{value:t.primaryKey},rowKey:{value:t.rowKey}}}})(aa),ra=(ct={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Mt()(ct,"popoverVisible",[]),Mt()(ct,"panelColumn",[]),Mt()(ct,"checkFormParams",[]),Mt()(ct,"originOptionType",[]),Mt()(ct,"tableOptionType",[]),Mt()(ct,"tableColumnOptionType",[]),ct),ia=function(e){function t(e){var a;x()(this,t);var n=D()(this,(t.__proto__||S()(t)).call(this,e));return n.currentInitData=function(e){var t=n.state,a=t.tabTemplate,r=t.panelColumn;e.map(function(e,t){a.push(na),r.push(e),n.getTypeOriginData(t,e.type),"1"!=e.type&&"8"!=e.type||(n.getTableType(t,e.sourceId),"1"==e.type&&n.getTableColumns(t,e.sourceId,e.table))}),n.setOutputData({tabTemplate:a,panelColumn:r}),n.setState({tabTemplate:a,panelColumn:r})},n.getCurrentData=function(e,t){var a=t.currentPage,r=t.outputData,i=t.dispatch,o=a.sink;if(!r[e]&&o.length>0)n.receiveState(e,o,i);else{var l=JSON.parse(Ft()(ra)),s=r[e]||l;n.setState(f()({},s))}},n.receiveState=function(e,t,a){var r=[],i=[],o=[],l=[],s=[],c=[],p=[],u=[];t.map(function(e){r.push(na),i.push(e)}),a(Q.A({taskId:e,sink:{tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u}})),n.setState({tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u},function(){t.map(function(e,t){n.getTypeOriginData(t,e.type),"1"!=e.type&&"8"!=e.type||(n.getTableType(t,e.sourceId),"1"==e.type&&n.getTableColumns(t,e.sourceId,e.table))})})},n.getTypeOriginData=function(e,t){var a=n.state.originOptionType;Y.a.getTypeOriginData({type:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setOutputData({originOptionType:a}),n.setState({originOptionType:a})})},n.getTableType=function(e,t){var a=n.state.tableOptionType;t?Y.a.getStremTableType({sourceId:t,isSys:!1}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setOutputData({tableOptionType:a}),n.setState({tableOptionType:a})}):("add"===e?a.push([]):a[e]=[],n.setOutputData({tableOptionType:a}),n.setState({tableOptionType:a}))},n.getTableColumns=function(e,t,a){var r=n.state.tableColumnOptionType;Y.a.getStreamTableColumn({sourceId:t,tableName:a}).then(function(t){1===t.code?r[e]=t.data:r[e]=[],n.setOutputData({tableColumnOptionType:r}),n.setState({tableColumnOptionType:r})})},n.changeInputTabs=function(e,t){var a={type:"1",columns:[],sourceId:void 0,table:void 0,columnsText:void 0,esId:void 0,esType:void 0,writePolicy:void 0,index:void 0,id:void 0,parallelism:1,tableName:void 0,primaryKey:void 0,rowKey:void 0},r=n.state,i=r.tabTemplate,o=r.panelActiveKey,l=r.popoverVisible,s=r.panelColumn,c=r.checkFormParams,p=r.originOptionType,u=r.tableOptionType,m=r.tableColumnOptionType;if("add"===e){i.push(na),s.push(a),n.getTypeOriginData("add",a.type),n.getTableType("add",a.table),m.push([]);var d=""+i.length;o.push(d)}else i.splice(t,1),s.splice(t,1),p.splice(t,1),u.splice(t,1),m.splice(t,1),c.pop(),o=n.changeActiveKey(t),l[t]=!1;n.props.tableParamsChange(),n.setOutputData({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,tableColumnOptionType:m}),n.setState({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,checkFormParams:c,originOptionType:p,tableOptionType:u,tableColumnOptionType:m})},n.setOutputData=function(e){var t=n.props,a=t.dispatch,r=t.currentPage,i=f()({},n.state,e);a(Q.A({taskId:r.id,sink:i}))},n.changeActiveKey=function(e){var t=n.state.panelActiveKey,a=""+(e+1),r=t.indexOf(a);return r>-1&&t.splice(r,1),t.map(function(t){return Number(t)>Number(e)?""+(Number(t)-1):t})},n.handleActiveKey=function(e){var t=n.state.panelActiveKey;t=e,n.setOutputData({panelActiveKey:t}),n.setState({panelActiveKey:t})},n.tableColumnType=function(e,t){return n.state.tableColumnOptionType[e].filter(function(e){return e.key===t})[0].type},n.filterPrimaryKey=function(e,t){return t.filter(function(t){var a=!1;return e.map(function(e){e.column===t&&(a=!0)}),a})},n.handleInputChange=function(e,t,a,r){n._syncEditor=!0;var i=n.state,o=i.panelColumn,l=i.originOptionType,s=i.tableOptionType,c=i.tableColumnOptionType;if("columns"===e)o[t][e].push(a);else if("deleteColumn"===e){o[t].columns.splice(a,1);var p=n.filterPrimaryKey(o[t].columns,o[t].primaryKey||[]);o[t].primaryKey=p}else if("subColumn"===e){o[t].columns[a].column=r;var u=n.tableColumnType(t,r);o[t].columns[a].type=u}else o[t][e]=a;"columnsText"===e&&(n._syncEditor=!1);var m=["type","sourceId","table","columns","columnsText","id","index","writePolicy","esId","esType","parallelism","tableName","primaryKey","rowKey"];if("type"===e)n._syncEditor=!0,l[t]=[],s[t]=[],c[t]=[],m.map(function(e){o[t][e]="type"===e?a:"parallelism"==e?1:"columns"==e?[]:void 0}),n.getTypeOriginData(t,a);else if("sourceId"===e)s[t]=[],c[t]=[],m.map(function(e){n._syncEditor=!0,"type"!==e&&"sourceId"!=e&&(o[t][e]="columns"==e?[]:"parallelism"==e?1:void 0)}),"1"!=o[t].type&&"8"!=o[t].type||n.getTableType(t,a);else if("table"===e){n._syncEditor=!0,c[t]=[];var d=o[t].sourceId;o[t].columns=[],m.map(function(e){"type"!=e&&"sourceId"!=e&&"table"!=e&&(o[t][e]="columns"==e?[]:"parallelism"==e?1:void 0)}),"1"==o[t].type&&n.getTableColumns(t,d,a)}n.props.tableParamsChange(),n.setOutputData({panelColumn:o}),n.setState({panelColumn:o})},n.clearCurrentInfo=function(e,t,a){var r=n.state,i=r.panelColumn,o=r.tableOptionType,l=r.originOptionType,s={type:void 0,columns:[],sourceId:void 0,table:void 0,columnsText:void 0,esId:void 0,esType:void 0,writePolicy:void 0,index:void 0,id:void 0,parallelism:1,tableName:void 0,rowKey:void 0,primaryKey:void 0};"type"===e?(s.type=a,l[t]=[],o[t]=[],i[t]=s):"sourceId"===e&&(s.type=i[t].type,s.sourceId=a,o[t]=[],i[t]=s),n.setOutputData({panelColumn:i,tableOptionType:o,originOptionType:l}),n.setState({panelColumn:i,tableOptionType:o,originOptionType:l})},n.handlePopoverVisibleChange=function(e,t,a){var r=n.state.popoverVisible;r[t]=a,e&&(e.stopPropagation(),a&&(r=r.map(function(e,a){return t==a}))),n.setOutputData({popoverVisible:r}),n.setState({popoverVisible:r})},n.panelHeader=function(e){var t=n.state.popoverVisible,a=R.a.createElement("div",{className:"input-panel-title"},R.a.createElement("div",{style:{padding:"8 0 12"}}," ",R.a.createElement(s.a,{type:"exclamation-circle",style:{color:"#faad14"}}),"  你确定要删除此输出源吗？"),R.a.createElement("div",{style:{textAlign:"right",padding:"0 0 8"}},R.a.createElement(m.a,{style:{marginRight:8},size:"small",onClick:function(){n.handlePopoverVisibleChange(null,e,!1)}},"取消"),R.a.createElement(m.a,{type:"primary",size:"small",onClick:function(){n.changeInputTabs("delete",e)}},"确定")));return R.a.createElement("div",{className:"input-panel-title"},R.a.createElement("span",null," 输出源 "+(e+1)+" "),R.a.createElement(wt.a,{trigger:"click",placement:"topLeft",content:a,visible:t[e],onClick:function(a){n.handlePopoverVisibleChange(a,e,!t[e])}},R.a.createElement("span",{className:"title-icon input-panel-title"},R.a.createElement(s.a,{type:"delete"}))))},n.recordForm=function(e){var t=n.state.checkFormParams;t.push(e),n.setOutputData({checkFormParams:t}),n.setState({checkFormParams:t})},n.state=(a={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Mt()(a,"popoverVisible",[]),Mt()(a,"panelColumn",[]),Mt()(a,"checkFormParams",[]),Mt()(a,"originOptionType",[]),Mt()(a,"tableOptionType",[]),Mt()(a,"tableColumnOptionType",[]),a),n}return w()(t,e),L()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentPage.sink;e&&e.length>0&&this.currentInitData(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;t.id!==a.id&&(this._syncEditor=!0,this.getCurrentData(t.id,e))}},{key:"render",value:function(){var e=this,t=this.state,a=t.tabTemplate,n=t.panelActiveKey,r=t.panelColumn,i=t.originOptionType,o=t.tableOptionType,l=t.tableColumnOptionType;return R.a.createElement("div",{className:"m-taksdetail panel-content"},R.a.createElement(xt.a,{activeKey:n,bordered:!1,onChange:this.handleActiveKey},a.map(function(t,a){return R.a.createElement($t,{header:e.panelHeader(a),key:a+1,style:{borderRadius:5},className:"input-panel"},R.a.createElement(na,{sync:e._syncEditor,index:a,handleInputChange:e.handleInputChange,panelColumn:r,originOptionType:i,tableOptionType:o,tableColumnOptionType:l,onRef:e.recordForm,editorParamsChange:e.props.editorParamsChange}))})),R.a.createElement(m.a,{className:"stream-btn",onClick:function(){e.changeInputTabs("add")},style:{borderRadius:5}},R.a.createElement(s.a,{type:"plus"}),R.a.createElement("span",null," 添加输入")))}}]),t}(j.Component),oa=(a("LGkk"),a("rVaU")),la=a.n(oa),sa=a("przh"),ca=Re.a.Option,pa=xt.a.Panel,ua=(ke.a.Group,Xt.a.Column),ma=(Xt.a.ColumnGroup,F.a.Item),da=function(e){function t(){var e,a,n,r;x()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=D()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(o))),n.checkParams=function(e){var t=n.props,a=t.index,r=(t.panelColumn[a].columns,{});return n.props.form.validateFields(function(e,t){r.status=!e}),r},n.originOption=function(e,t){switch(e){case"originType":return t.map(function(e){return R.a.createElement(ca,{key:e,value:""+e.id},e.name)});case"currencyType":return t.map(function(e){return R.a.createElement(ca,{key:e,value:""+e},e)});case"columnType":return t.map(function(e,t){return R.a.createElement(ca,{key:t,value:""+e.key},e.key)});case"primaryType":return t.map(function(e,t){return R.a.createElement(ca,{key:t,value:""+e.column},e.column)});default:return null}},r=a,D()(n,r)}return w()(t,e),L()(t,[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"editorParamsChange",value:function(e,t,a){var n=this.props,r=n.handleInputChange,i=n.index;this._syncEditor=!1,r("columnsText",i,t)}},{key:"render",value:function(){var e=this.props,t=e.handleInputChange,a=e.index,n=e.sync,i=e.originOptionType,l=e.tableOptionType,c=e.panelColumn,u=e.tableColumnOptionType,d=this.props.form.getFieldDecorator,y=this.originOption("originType",i[a]||[]),v=this.originOption("currencyType",l[a]||[]),g=this.originOption("columnType",u[a]||[]),b=this.originOption("primaryType",c[a].columns||[]),T={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}};return R.a.createElement(r.a,{className:"title-content"},R.a.createElement(ma,f()({},T,{label:"存储类型"}),d("type",{rules:[{required:!0,message:"请选择存储类型"}]})(R.a.createElement(Re.a,{className:"right-select",onChange:function(e){t("type",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},R.a.createElement(ca,{value:"1"},"MySQL"),R.a.createElement(ca,{value:"8"},"HBase")))),R.a.createElement(ma,f()({},T,{label:"数据源"}),d("sourceId",{initialValue:"disabled",rules:[{required:!0,message:"请选择数据源"}]})(R.a.createElement(Re.a,{className:"right-select",onChange:function(e){t("sourceId",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},y))),R.a.createElement(ma,f()({},T,{label:"表"}),d("table",{rules:[{required:!0,message:"请选择表"}]})(R.a.createElement(Re.a,{className:"right-select",onChange:function(e){t("table",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},v))),R.a.createElement(ma,f()({},T,{label:"映射表"}),d("tableName")(R.a.createElement(h.a,{placeholder:"请输入映射表名",onChange:function(e){return t("tableName",a,e.target.value)}}))),R.a.createElement(r.a,null,R.a.createElement("div",{className:"ant-form-item-label ant-col-xs-24 ant-col-sm-6"},R.a.createElement("label",null,"字段")),"1"==c[a].type?R.a.createElement(p.a,{span:"18",className:"bd",style:{marginBottom:20}},R.a.createElement(Xt.a,{dataSource:c[a].columns,className:"table-small",pagination:!1,size:"small"},R.a.createElement(ua,{title:"字段",dataIndex:"column",key:"字段",width:"50%",render:function(e,n,r){return R.a.createElement(Re.a,{className:"sub-right-select",value:e,onChange:function(e){t("subColumn",a,r,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},g)}}),R.a.createElement(ua,{title:"类型",dataIndex:"type",key:"类型",width:"40%",render:function(e,t,a){return R.a.createElement(h.a,{value:e,disabled:!0})}}),R.a.createElement(ua,{key:"delete",render:function(e,n,r){return R.a.createElement(s.a,{type:"close",style:{fontSize:16,color:"#888"},onClick:function(){t("deleteColumn",a,r)}})}})),R.a.createElement("div",{style:{padding:"0 20 20"}},R.a.createElement(m.a,{className:"stream-btn",type:"dashed",style:{borderRadius:5},onClick:function(){t("columns",a,{})}},R.a.createElement(s.a,{type:"plus"}),R.a.createElement("span",null," 添加输入")))):R.a.createElement(p.a,{span:"18",style:{marginBottom:20,height:200}},R.a.createElement(qt.a,{style:{minHeight:202,border:"1px solid #ddd"},key:"params-editor",sync:n,placeholder:"字段 类型, 比如 id int 一行一个字段",value:c[a].columnsText,onChange:this.editorParamsChange.bind(this)}))),"1"==c[a].type?R.a.createElement(ma,f()({},T,{label:"主键"}),d("primaryKey",{rules:[{required:!0,message:"请选择主键"}]})(R.a.createElement(Re.a,{className:"right-select",onChange:function(e){t("primaryKey",a,e)},mode:"multiple",showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},b))):R.a.createElement(ma,f()({},T,{label:"主键"}),d("hbasePrimaryKey",{rules:[{required:!0,message:"请输入主键"}]})(R.a.createElement(h.a,{placeholder:"请输入主键",onChange:function(e){return t("hbasePrimaryKey",a,e.target.value)}}))),R.a.createElement(ma,f()({},T,{label:"并行度"}),d("parallelism")(R.a.createElement(Rt.a,{className:"number-input",min:1,onChange:function(e){return t("parallelism",a,e)}}))),R.a.createElement(ma,f()({},T,{label:"缓存策略"}),d("cache",{rules:[{required:!0,message:"请选择缓存策略"}]})(R.a.createElement(Re.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("cache",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},R.a.createElement(ca,{key:"None",value:"None"},"None"),R.a.createElement(ca,{key:"LRU",value:"LRU"},"LRU"),R.a.createElement(ca,{key:"ALL",value:"ALL"},"ALL")))),"LRU"===c[a].cache?[R.a.createElement(ma,f()({},T,{label:"缓存大小(行)"}),d("cacheSize",{rules:[{required:!0,message:"请输入缓存大小"}]})(R.a.createElement(Rt.a,{className:"number-input",min:0,onChange:function(e){return t("cacheSize",a,e)}}))),R.a.createElement(ma,f()({},T,{label:"缓存超时时间(ms)"}),d("cacheTTLMs",{rules:[{required:!0,message:"请输入缓存超时时间"}]})(R.a.createElement(Rt.a,{className:"number-input",min:0,onChange:function(e){return t("cacheTTLMs",a,e)}}))),R.a.createElement(ma,f()({},T,{label:R.a.createElement("span",null,"开启分区 ",R.a.createElement(o.a,{title:sa.switchPartition},R.a.createElement(s.a,{type:"question-circle-o"})))}),d("partitionedJoin",{rules:[{required:!0}]})(R.a.createElement(la.a,{defaultChecked:!1,onChange:function(e){return t("partitionedJoin",a,e)}})))]:void 0,"ALL"===c[a].cache?R.a.createElement(ma,f()({},T,{label:"缓存超时时间(ms)"}),d("cacheTTLMs",{rules:[{required:!0,message:"请输入缓存超时时间"}]})(R.a.createElement(Rt.a,{className:"number-input",min:0,onChange:function(e){return t("cacheTTLMs",a,e)}}))):void 0)}}]),t}(j.Component),ha=F.a.create({mapPropsToFields:function(e){var t=e.panelColumn[e.index],a=t.type,n=t.sourceId,r=t.table,i=t.columns,o=t.parallelism,l=t.columnsText,s=t.cache,c=t.cacheSize,p=t.hbasePrimaryKey,u=t.cacheTTLMs;return{type:{value:a},sourceId:{value:n},table:{value:r},tableName:{value:t.tableName},columns:{value:i},parallelism:{value:o},columnsText:{value:l},cache:{value:s},cacheSize:{value:c},cacheTTLMs:{value:u},primaryKey:{value:t.primaryKey},hbasePrimaryKey:{value:p}}}})(da),ya=(pt={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Mt()(pt,"popoverVisible",[]),Mt()(pt,"panelColumn",[]),Mt()(pt,"checkFormParams",[]),Mt()(pt,"originOptionType",[]),Mt()(pt,"tableOptionType",[]),Mt()(pt,"tableColumnOptionType",[]),pt),fa=function(e){function t(e){var a;x()(this,t);var n=D()(this,(t.__proto__||S()(t)).call(this,e));return n.currentInitData=function(e){var t=n.state,a=t.tabTemplate,r=t.panelColumn;e.map(function(e,t){a.push(ha),r.push(e),n.getTypeOriginData(t,e.type),n.getTableType(t,e.sourceId),"1"==e.type&&n.getTableColumns(t,e.sourceId,e.table)}),n.setOutputData({tabTemplate:a,panelColumn:r}),n.setState({tabTemplate:a,panelColumn:r})},n.getCurrentData=function(e,t){var a=t.currentPage,r=t.dimensionData,i=t.dispatch,o=a.side;if(!r[e]&&o.length>0)n.receiveState(e,o,i);else{var l=JSON.parse(Ft()(ya)),s=r[e]||l;n.setState(f()({},s))}},n.receiveState=function(e,t,a){var r=[],i=[],o=[],l=[],s=[],c=[],p=[],u=[];t.map(function(e){r.push(ha),i.push(e)}),a(Q.y({taskId:e,side:{tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u}})),n.setState({tabTemplate:r,panelColumn:i,panelActiveKey:o,popoverVisible:l,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u},function(){t.map(function(e,t){n.getTypeOriginData(t,e.type),n.getTableType(t,e.sourceId),"1"==e.type&&n.getTableColumns(t,e.sourceId,e.table)})})},n.getTypeOriginData=function(e,t){var a=n.state.originOptionType;Y.a.getTypeOriginData({type:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setOutputData({originOptionType:a}),n.setState({originOptionType:a})})},n.getTableType=function(e,t,a){var r=n.state.tableOptionType;t?Y.a.getStremTableType({sourceId:t,isSys:!1}).then(function(t){"add"===e?1===t.code?r.push(t.data):r.push([]):1===t.code?r[e]=t.data:r[e]=[],n.setOutputData({tableOptionType:r}),n.setState({tableOptionType:r})}):((e="add")?r.push([]):r[e]=[],n.setOutputData({tableOptionType:r}),n.setState({tableOptionType:r}))},n.getTableColumns=function(e,t,a){var r=n.state.tableColumnOptionType;Y.a.getStreamTableColumn({sourceId:t,tableName:a}).then(function(t){1===t.code?r[e]=t.data:r[e]=[],n.setOutputData({tableColumnOptionType:r}),n.setState({tableColumnOptionType:r})})},n.changeInputTabs=function(e,t){var a={type:"1",columns:[],sourceId:void 0,table:void 0,columnsText:void 0,tableName:void 0,primaryKey:void 0,hbasePrimaryKey:void 0,parallelism:1,cache:"LRU",cacheSize:1e4,cacheTTLMs:6e4},r=n.state,i=r.tabTemplate,o=r.panelActiveKey,l=r.popoverVisible,s=r.panelColumn,c=r.checkFormParams,p=r.originOptionType,u=r.tableOptionType,m=r.tableColumnOptionType;if("add"===e){i.push(ha),s.push(a),n.getTypeOriginData("add",a.type),n.getTableType("add",a.table),m.push([]);var d=""+i.length;o.push(d)}else i.splice(t,1),s.splice(t,1),p.splice(t,1),u.splice(t,1),m.splice(t,1),c.pop(),o=n.changeActiveKey(t),l[t]=!1;n.props.tableParamsChange(),n.setOutputData({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,checkFormParams:c,originOptionType:p,tableOptionType:u,tableColumnOptionType:m}),n.setState({tabTemplate:i,panelActiveKey:o,popoverVisible:l,panelColumn:s,checkFormParams:c,originOptionType:p,tableOptionType:u,tableColumnOptionType:m})},n.setOutputData=function(e){var t=n.props,a=t.dispatch,r=t.currentPage,i=f()({},n.state,e);a(Q.y({taskId:r.id,side:i}))},n.changeActiveKey=function(e){var t=n.state.panelActiveKey,a=""+(e+1),r=t.indexOf(a);return r>-1&&t.splice(r,1),t.map(function(t){return Number(t)>Number(e)?""+(Number(t)-1):t})},n.handleActiveKey=function(e){var t=n.state.panelActiveKey;t=e,n.setOutputData({panelActiveKey:t}),n.setState({panelActiveKey:t})},n.tableColumnType=function(e,t){var a=n.state.tableColumnOptionType;return a[e].filter(function(e){return e.key===t})[0].type},n.filterPrimaryKey=function(e,t){return t.filter(function(t){var a=!1;return e.map(function(e){e.column===t&&(a=!0)}),a})},n.handleInputChange=function(e,t,a,r){var i=n.state,o=i.panelColumn,l=i.originOptionType,s=i.tableOptionType,c=i.tableColumnOptionType;if("columns"===e)o[t][e].push(a);else if("deleteColumn"===e){o[t].columns.splice(a,1);var p=n.filterPrimaryKey(o[t].columns,o[t].primaryKey||[]);o[t].primaryKey=p}else if("subColumn"===e){o[t].columns[a].column=r;var u=n.tableColumnType(t,r);o[t].columns[a].type=u}else o[t][e]=a;"columnsText"===e&&(n._syncEditor=!1);var m=["type","sourceId","table","columns","columnsText","parallelism","cache","cacheSize","hbasePrimaryKey","cacheTTLMs","tableName","primaryKey"];if("type"===e)l[t]=[],s[t]=[],c[t]=[],m.map(function(e){"type"!=e&&(o[t][e]="parallelism"==e?1:"columns"==e?[]:"cache"==e?"LRU":"cacheSize"==e?1e4:"cacheTTLMs"==e?6e4:void 0)}),n.getTypeOriginData(t,a);else if("sourceId"===e)s[t]=[],c[t]=[],o[t].columns=[],m.map(function(e){"type"!=e&&"sourceId"!=e&&(o[t][e]="parallelism"==e?1:"columns"==e?[]:"cache"==e?"LRU":"cacheSize"==e?1e4:"cacheTTLMs"==e?6e4:void 0)}),n.getTableType(t,a,e);else if("table"===e){c[t]=[],m.map(function(e){"type"!=e&&"sourceId"!=e&&"table"!=e&&(o[t][e]="parallelism"==e?1:"columns"==e?[]:"cache"==e?"LRU":"cacheSize"==e?1e4:"cacheTTLMs"==e?6e4:void 0)});var d=o[t].sourceId;"1"==o[t].type&&n.getTableColumns(t,d,a)}n.props.tableParamsChange(),n.setOutputData({panelColumn:o}),n.setState({panelColumn:o})},n.clearCurrentInfo=function(e,t,a){var r=n.state,i=r.panelColumn,o=r.originOptionType,l=r.tableOptionType,s={type:void 0,columns:[],sourceId:void 0,table:void 0,tableName:void 0,parallelism:1,cache:"LRU",cacheSize:1e4,cacheTTLMs:6e4};"type"===e?(s.type=a,i[t]=s,o[t]=[],l[t]=[]):"sourceId"===e&&(s.type=i[t].type,s.sourceId=a,i[t]=s,l[t]=[]),n.setOutputData({panelColumn:i,originOptionType:o,tableOptionType:l}),n.setState({panelColumn:i,originOptionType:o,tableOptionType:l})},n.handlePopoverVisibleChange=function(e,t,a){var r=n.state.popoverVisible;r[t]=a,e&&(e.stopPropagation(),a&&(r=r.map(function(e,a){return t==a}))),n.setOutputData({popoverVisible:r}),n.setState({popoverVisible:r})},n.panelHeader=function(e){var t=n.state.popoverVisible,a=R.a.createElement("div",{className:"input-panel-title"},R.a.createElement("div",{style:{padding:"8 0 12"}}," ",R.a.createElement(s.a,{type:"exclamation-circle",style:{color:"#faad14"}})," ","你确定要删除此输出源吗？"),R.a.createElement("div",{style:{textAlign:"right",padding:"0 0 8"}},R.a.createElement(m.a,{style:{marginRight:8},size:"small",onClick:function(){n.handlePopoverVisibleChange(null,e,!1)}},"取消"),R.a.createElement(m.a,{type:"primary",size:"small",onClick:function(){n.changeInputTabs("delete",e)}},"确定")));return R.a.createElement("div",{className:"input-panel-title"},R.a.createElement("span",null," 维表 "+(e+1)),R.a.createElement(wt.a,{trigger:"click",placement:"topLeft",content:a,visible:t[e],onClick:function(a){n.handlePopoverVisibleChange(a,e,!t[e])}},R.a.createElement("span",{className:"title-icon input-panel-title"},R.a.createElement(s.a,{type:"delete"}))))},n.recordForm=function(e){var t=n.state.checkFormParams;t.push(e),n.setOutputData({checkFormParams:t}),n.setState({checkFormParams:t})},n.state=(a={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Mt()(a,"popoverVisible",[]),Mt()(a,"panelColumn",[]),Mt()(a,"checkFormParams",[]),Mt()(a,"originOptionType",[]),Mt()(a,"tableOptionType",[]),Mt()(a,"tableColumnOptionType",[]),a),n}return w()(t,e),L()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentPage.side;e&&e.length>0&&this.currentInitData(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;t.id!==a.id&&this.getCurrentData(t.id,e)}},{key:"render",value:function(){var e=this,t=this.state,a=t.tabTemplate,n=t.panelActiveKey,r=t.panelColumn,i=t.originOptionType,o=t.tableOptionType,l=t.tableColumnOptionType;return R.a.createElement("div",{className:"m-taksdetail panel-content"},R.a.createElement(xt.a,{activeKey:n,bordered:!1,onChange:this.handleActiveKey},a.map(function(t,a){return R.a.createElement(pa,{header:e.panelHeader(a),key:a+1,style:{borderRadius:5},className:"input-panel"},R.a.createElement(ha,{index:a,sync:e._syncEditor,handleInputChange:e.handleInputChange,panelColumn:r,originOptionType:i,tableOptionType:o,tableColumnOptionType:l,onRef:e.recordForm,editorParamsChange:e.props.editorParamsChange}))})),R.a.createElement(m.a,{className:"stream-btn",onClick:function(){e.changeInputTabs("add")},style:{borderRadius:5}},R.a.createElement(s.a,{type:"plus"}),R.a.createElement("span",null," 添加输入")))}}]),t}(j.Component),va=ge.a.TabPane,ga=M.a.confirm,ba=function(e){function t(){var e,a,n,r;x()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=D()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(o))),n.state={selected:"",expanded:!1},n.onChange=function(e){var t=n.props,a=t.dispatch,r=t.pages,i=parseInt(e,10),o=r&&r.find(function(e){return e.id===i});o&&(a(Q.x(o)),a(Q.p()),a(Q.q()),a(Q.o()))},n.onEdit=function(e,t){var a=n.props,r=a.pages,i=a.dispatch,o=r.filter(function(t){return t.id==e})[0]||{};switch(t){case"remove":o.notSynced?ga({title:"部分任务修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃这些修改数据",onOk:function(){i(Q.l(parseInt(e,10),r,o)),i(Q.f(o.id)),i(Q.g(o.id)),i(Q.e(o.id))},onCancel:function(){}}):(i(Q.l(parseInt(e,10),r,o)),i(Q.f(o.id)),i(Q.g(o.id)),i(Q.e(o.id)))}},n.mapPanels=function(e){return e&&e.length>0?e.map(function(e){var t=R.a.createElement("span",null,R.a.createElement(Ce.a,{tabData:e}),R.a.createElement(be.a,{notSynced:e.notSynced}),R.a.createElement("span",{className:"tab-ellipsis"},e.name));return R.a.createElement(va,{style:{height:"0px"},tab:t,key:e.id})}):[]},n.tabClick=function(e){var t=n.state,a=t.selected,r=t.expanded;e===a&&r?(n.setState({selected:"",expanded:!1}),n.SideBench.style.width="30px"):e!==a&&(n.SideBench.style.width="500px",n.setState({selected:e,expanded:!0}))},n.unLock=function(){var e=n.props,t=e.currentPage,a=e.dispatch,r=t.readWriteLockVO;ga({title:"解锁提醒",content:"文件正在被"+r.lastKeepLockUserName+"编辑中，开始编辑时间\n                "+B.a.formatDateTime(r.gmtModified)+"。\n                强制编辑可能导致"+r.lastKeepLockUserName+"对该文件的修改无法保存！\n            ",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){var e={fileId:t.id,type:ee.k.STREAM_TASK,lockVersion:r.version};Y.a.unlockFile(e).then(function(e){if(1===e.code){var n=e.data;n.getLock?O.a.success("文件解锁成功！"):M.a.error({title:"解锁失败",content:"文件正在被"+n.lastKeepLockUserName+"编辑中!开始编辑时间\n                                "+B.a.formatDateTime(n.gmtModified)+"."});var r={id:t.id};Y.a.getTask(r).then(function(e){if(1===e.code){var n=e.data;n.merged=!0;var r={id:t.id,readWriteLockVO:n.readWriteLockVO};a(Q.x(n)),a(Object(X.f)(r))}})}})},onCancel:function(){}})},n.handleCustomParamsChange=function(e){var t=n.props,a=t.currentPage,r=t.dispatch,i=g()(a,e);r(Q.x(i))},n.editorChange=function(e){var t=n.props,a=t.currentPage,r=t.dispatch;(a=Object(W.cloneDeep)(a)).taskParams=e,a.notSynced=!0,r(Q.x(a))},n.debounceChange=Object(W.debounce)(n.editorChange,300,{maxWait:2e3}),n.editorParamsChange=function(e){var t=n.props,a=t.currentPage,r=t.dispatch;a.taskParams=e,r(Q.x(a))},n.tableParamsChange=function(){n.props.editorChange()},r=a,D()(n,r)}return w()(t,e),L()(t,[{key:"componentWillReceiveProps",value:function(e){e.currentPage!=this.props.currentPage&&(this._syncEditor=!0)}},{key:"renderLock",value:function(e){return e.readWriteLockVO&&!e.readWriteLockVO.getLock?R.a.createElement("div",{className:"lock-layer"},R.a.createElement(fe.a,{style:{position:"absolute",top:"-2px",left:"35%",zIndex:"999",height:"35px"},showIcon:!0,message:R.a.createElement("span",null,"当前文件为只读状态！",R.a.createElement("a",{onClick:this.unLock},"解锁")),type:"warning"})):null}},{key:"closeAllorOthers",value:function(e){var t=this.props,a=t.pages,n=t.currentPage,r=t.dispatch;if("ALL"===e){var i=!0,o=!0,l=!1,s=void 0;try{for(var c,p=he()(a);!(o=(c=p.next()).done);o=!0){if(c.value.notSynced){i=!1;break}}}catch(e){l=!0,s=e}finally{try{!o&&p.return&&p.return()}finally{if(l)throw s}}i?(r(Q.a()),r(Q.c()),r(Q.d()),r(Q.b())):ga({title:"部分任务修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃所有修改数据",onOk:function(){r(Q.a()),r(Q.c()),r(Q.d()),r(Q.b())},onCancel:function(){}})}else{var u=!0,m=!0,d=!1,h=void 0;try{for(var y,f=he()(a);!(m=(y=f.next()).done);m=!0){var v=y.value;if(v.notSynced&&v.id!==n.id){u=!1;break}}}catch(e){d=!0,h=e}finally{try{!m&&f.return&&f.return()}finally{if(d)throw h}}u?(r(Q.k(n)),r(Q.i(n.id)),r(Q.j(n.id)),r(Q.h(n.id))):ga({title:"部分任务修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃这些修改数据",onOk:function(){r(Q.k(n)),r(Q.i(n.id)),r(Q.j(n.id)),r(Q.h(n.id))},onCancel:function(){}})}}},{key:"editorParamsChange",value:function(e){this._syncEditor?(this._syncEditor=!1,this.editorParamsChange(e)):this.debounceChange(e)}},{key:"render",value:function(){var e=this,t=this.props,a=t.currentPage,n=t.pages,i=t.router,o=t.editor;0===n.length&&i.push("/realtime");var l=this.mapPanels(n);return R.a.createElement(r.a,{className:"task-browser"},R.a.createElement("div",{className:"browser-content"},R.a.createElement(ge.a,{hideAdd:!0,onTabClick:this.onChange,activeKey:""+a.id,type:"editable-card",className:"browser-tabs",onEdit:this.onEdit,tabBarExtraContent:R.a.createElement(pe.a,{overlay:R.a.createElement(me.a,{style:{marginRight:2}},R.a.createElement(me.a.Item,{key:"OHTERS"},R.a.createElement("a",{onClick:this.closeAllorOthers.bind(this,"OHTERS")},"关闭其他")),R.a.createElement(me.a.Item,{key:"ALL"},R.a.createElement("a",{onClick:this.closeAllorOthers.bind(this,"ALL")},"关闭所有")),R.a.createElement(me.a.Divider,null),n.map(function(t){return R.a.createElement(me.a.Item,{key:t.id},R.a.createElement("a",{onClick:function(){a.id!=t.id&&e.onChange(t.id)},style:t.id==a.id?{color:"#2491F7"}:{}},t.name))}))},R.a.createElement(s.a,{type:"bars",style:{margin:"7 0 0 0",fontSize:18}}))},l),this.renderLock(a),R.a.createElement(St,this.props),R.a.createElement("div",{className:"m-siderbench padding-r0",ref:function(t){e.SideBench=t}},R.a.createElement(ge.a,{activeKey:this.state.selected,type:"card",className:"task-params",tabPosition:"right",onTabClick:this.tabClick},R.a.createElement(va,{tab:R.a.createElement("span",{className:"title-vertical"},"任务详情"),key:"params1"},R.a.createElement(Dt,this.props)),0===a.taskType?R.a.createElement(va,{tab:R.a.createElement("span",{className:"title-vertical tabpanel-content",style:{marginTop:10,paddingBottom:10}},"源表"),key:"params3"},R.a.createElement(Jt,f()({},this.props,{tableParamsChange:this.tableParamsChange}))):"",0===a.taskType?R.a.createElement(va,{tab:R.a.createElement("span",{className:"title-vertical tabpanel-content",style:{marginTop:5,paddingBottom:3}},"结果表"),key:"params4"},R.a.createElement(ia,f()({},this.props,{tableParamsChange:this.tableParamsChange}))):"",0===a.taskType?R.a.createElement(va,{tab:R.a.createElement("span",{className:"title-vertical tabpanel-content",style:{marginTop:10,paddingBottom:10}},"维表"),key:"params5"},R.a.createElement(fa,f()({},this.props,{tableParamsChange:this.tableParamsChange}))):"",R.a.createElement(va,{tab:R.a.createElement("span",{className:"title-vertical"},"环境参数"),key:"params2"},R.a.createElement(Te.a,{key:"params-editor",sync:this._syncEditor,value:a.taskParams,onChange:this.editorParamsChange.bind(this),language:"ini",options:{theme:o.options.theme}}))))))}}]),t}(j.Component),Ta=Object(q.b)(function(e){var t=e.realtimeTask,a=t.resources,n=t.pages;return{currentPage:t.currentPage,pages:n,resources:a,editor:e.editor}})(ba),Ca=M.a.confirm,Ea=F.a.Item,ka=function(e){function t(){var e,a,n,r;x()(this,t);for(var i=arguments.length,o=Array(i),l=0;l<i;l++)o[l]=arguments[l];return a=n=D()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(o))),n.state={publishDesc:"",showPublish:!1},n.saveTask=function(){for(var e=n.props,t=e.currentPage,a=e.dispatch,r=e.inputData,i=e.outputData,o=e.dimensionData,l=r[t.id]||{},s=l.checkFormParams,c=void 0===s?[]:s,p=l.panelColumn,u=void 0===p?[]:p,m=i[t.id]||{},d=m.checkFormParams,h=void 0===d?[]:d,y=m.panelColumn,f=void 0===y?[]:y,v=o[t.id]||{},g=v.checkFormParams,b=void 0===g?[]:g,C=v.panelColumn,k=void 0===C?[]:C,P=0,S=c.length;P<S;P++){var I=c[P].checkParams();if(!I.status)return O.a.error("源表--输入源"+(c[P].props.index+1)+": "+(I.message||"您还有未填选项"))}if(h.length>0)for(var x=0,N=h.length;x<N;x++){var L=h[x].checkParams();if(!L.status)return O.a.error("结果表--输出源"+(h[x].props.index+1)+": "+(L.message||"您还有未填选项"))}if(b.length>0)for(var _=0,D=b.length;_<D;_++){var A=b[_].checkParams();if(!A.status)return O.a.error("维表--维表"+(b[_].props.index+1)+": "+(A.message||"您还有未填选项"))}var w=t.resourceList;return t.preSave=!0,w&&w.length>0&&(t.resourceIdList=w.map(function(e){return e.id})),u.length>0&&(t.source=u),f.length>0&&(t.sink=f),k.length>0&&(t.side=k),t.lockVersion=t.readWriteLockVO.version,new E.a(function(e,n){Y.a.saveTask(t).then(function(n){var r=function(n){O.a.success("任务保存成功"),n.notSynced=!1,a(Q.x(n)),t.taskType===ee.y.MR&&a(X.a({id:n.nodePid,catalogueType:ee.l.TASK_DEV})),t.taskType==ee.y.DATA_COLLECTION&&t.createModel==ee.f.GUIDE&&(a(ie.initCollectionTask(t.id)),a(ie.getDataSource())),e(!0)};if(1===n.code){var i=n.data.readWriteLockVO,o=i.result;0===o?r(n.data):1===o?Ca({title:"锁定提醒",content:R.a.createElement("span",null,"文件正在被",i.lastKeepLockUserName,"编辑中，开始编辑时间为",B.a.formatDateTime(i.gmtModified),"。 强制保存可能导致",i.lastKeepLockUserName,"对文件的修改无法正常保存！"),okText:"确定保存",okType:"danger",cancelText:"取消",onOk:function(){Y.a.forceUpdateTask(t).then(function(e){1===e.code&&r(e.data)})}}):2===o&&Ca({title:"保存警告",content:R.a.createElement("span",null,"文件已经被",i.lastKeepLockUserName,"编辑过，编辑时间为",B.a.formatDateTime(i.gmtModified),"。 点击确认按钮会",R.a.createElement(T.a,{color:"orange"},"覆盖"),"您本地的代码，请您提前做好备份！"),okText:"确定覆盖",okType:"danger",cancelText:"取消",onOk:function(){var e={id:t.id,lockVersion:i.version};Y.a.getTask(e).then(function(e){if(1===e.code){var t=e.data;t.merged=!0,r(t)}})}})}})})},n.editorChange=function(e){var t=n.props,a=t.currentPage,r=t.dispatch;a=Object(W.cloneDeep)(a),(a=g()(a,e)).notSynced=!0,r(Q.x(a))},n.debounceChange=Object(W.debounce)(n.editorChange,300,{maxWait:2e3}),n.editorParamsChange=function(e,t){var a=n.props,r=a.currentPage,i=a.dispatch;e!==t&&(r.taskParams=t,i(Q.x(r)))},n.startTask=function(){var e=n.props,t=e.currentPage,a=e.dispatch;Y.a.startTask({id:t.id,isRestoration:0}).then(function(e){1===e.code&&(t.status=10,a(Q.x(g()({},t))),O.a.success("任务已经成功提交！"))})},n.loadTreeData=function(e){var t=n.props.dispatch,a=e.props.data;return new E.a(function(e){t(X.a(a)),e()})},n.closePublish=function(){n.setState({publishDesc:"",showPublish:!1})},n.searchTask=function(){n.props.dispatch(Object(le.a)(!0))},n.publishChange=function(e){n.setState({publishDesc:e.target.value})},n.renderPublish=function(){var e=n.props.user,t=n.state.publishDesc;return R.a.createElement(M.a,{wrapClassName:"vertical-center-modal",title:"提交任务",style:{height:"600px",width:"600px"},visible:n.state.showPublish,onCancel:n.closePublish,onOk:n.submitTab.bind(n),cancelText:"关闭"},R.a.createElement(F.a,null,R.a.createElement(Ea,f()({},ee.C,{label:"提交人",hasFeedback:!0}),R.a.createElement("span",null,e.userName)),R.a.createElement(Ea,f()({},ee.C,{label:R.a.createElement("span",{className:"ant-form-item-required"},"备注"),hasFeedback:!0}),R.a.createElement(h.a,{type:"textarea",value:t,name:"publishDesc",rows:4,onChange:n.publishChange}))))},r=a,D()(n,r)}return w()(t,e),L()(t,[{key:"componentDidMount",value:function(){this.props.dispatch;var e=B.a.getParameterByName("taskId");e&&this.props.dispatch(Q.t({id:e}))}},{key:"autoSaveTask",value:function(){var e=this;this.timerID=setInterval(function(){if("edit"===e.state.editorState){var t=e.props.currentPage;Y.a.saveTask(t).then(function(e){1===e.code&&O.a.success("任务已自动保存")})}},3e4)}},{key:"submitTab",value:function(){var e=this,t=this.props,a=t.currentPage,n=t.dispatch,r=this.state.publishDesc,i=Object(W.cloneDeep)(a);return r?r.length>200?(O.a.error("备注信息不可超过200个字符！"),!1):(i.publishDesc=r,i.preSave=!0,i.submitStatus=1,void Q.w(i).then(function(t){e.closePublish(),t&&(O.a.success("提交成功！"),Y.a.getTask({id:a.id}).then(function(e){if(1===e.code){var t=e.data;t.merged=!0,t.notSynced=!1,n(Q.x(t)),t.taskType==ee.y.DATA_COLLECTION&&t.createModel==ee.f.GUIDE&&(n(ie.initCollectionTask(t.id)),n(ie.getDataSource()))}}))})):(O.a.error("提交备注不可为空！"),!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.dispatch,n=t.currentPage,i=t.editor,l=n.notSynced,c="vs"!==i.options.theme||void 0;return R.a.createElement(r.a,{className:"task-editor"},R.a.createElement("header",{className:"toolbar clear"},R.a.createElement(p.a,{className:"left"},R.a.createElement("span",null,R.a.createElement(m.a,{onClick:function(){a(J.a(oe.c.ADD_TASK_VISIBLE))},title:"创建任务"},R.a.createElement(H.a,{className:"my-icon",type:"focus",themeDark:c})," 新建任务"),R.a.createElement(m.a,{disabled:n.invalid,onClick:this.saveTask,title:"保存任务"},R.a.createElement(H.a,{className:"my-icon",type:"save",themeDark:c}),"保存"),R.a.createElement(m.a,{onClick:this.searchTask,title:"打开任务"},R.a.createElement(H.a,{className:"my-icon",type:"search",themeDark:c}),"搜索")),R.a.createElement(U.a,{themeDark:c}),R.a.createElement(G.a,{editorTheme:i.options.theme,onThemeChange:function(e){a(Object(se.updateEditorOptions)({theme:e}))}})),R.a.createElement(p.a,{className:"right"},R.a.createElement("span",null,R.a.createElement(o.a,{placement:"bottom",title:"提交到调度系统",mouseLeaveDelay:0},R.a.createElement(m.a,{disabled:l,onClick:function(){e.setState({showPublish:!0})}},R.a.createElement(s.a,{type:"upload"})," 提交"))),R.a.createElement(z.c,{to:"/operation/realtime?tname="+n.name},R.a.createElement(m.a,null,R.a.createElement(H.a,{className:"my-icon",type:"goin",themeDark:c})," 运维")))),R.a.createElement(Ta,f()({},this.props,{ayncTree:this.loadTreeData,editorParamsChange:this.editorParamsChange,editorChange:this.debounceChange,saveTask:this.saveTask.bind(this)})),this.renderPublish())}}]),t}(j.Component);t.default=Object(q.b)(function(e){var t=e.realtimeTask,a=t.resources,n=t.pages,r=t.currentPage,i=t.inputData,o=t.outputData,l=t.dimensionData;return{currentPage:r,pages:n,resources:a,user:e.user,inputData:i,outputData:o,dimensionData:l,project:e.project,editor:e.editor}})(ka)},aOJk:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(a("QbLZ")),r=u(a("iCc5")),i=u(a("V7oC")),o=u(a("FYw3")),l=u(a("mRg0")),s=u(a("sbe7")),c=u(a("d1El")),p=u(a("aVg8"));function u(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){return(0,r.default)(this,t),(0,o.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,l.default)(t,e),(0,i.default)(t,[{key:"getPopupDomNode",value:function(){return this.refs.tooltip.getPopupDomNode()}},{key:"getOverlay",value:function(){var e=this.props,t=e.title,a=e.prefixCls,n=e.content;return(0,p.default)(!("overlay"in this.props),"Popover[overlay] is removed, please use Popover[content] instead, see: https://u.ant.design/popover-content"),s.default.createElement("div",null,t&&s.default.createElement("div",{className:a+"-title"},t),s.default.createElement("div",{className:a+"-inner-content"},n))}},{key:"render",value:function(){var e=(0,n.default)({},this.props);return delete e.title,s.default.createElement(c.default,(0,n.default)({},e,{ref:"tooltip",overlay:this.getOverlay()}))}}]),t}(s.default.Component);t.default=m,m.defaultProps={prefixCls:"ant-popover",placement:"top",transitionName:"zoom-big",trigger:"hover",mouseEnterDelay:.1,mouseLeaveDelay:.1,overlayStyle:{}},e.exports=t.default},eKCK:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CollapsePanel=void 0;var n=d(a("QbLZ")),r=d(a("YEIV")),i=d(a("V7oC")),o=d(a("iCc5")),l=d(a("FYw3")),s=d(a("mRg0")),c=d(a("sbe7")),p=d(a("E1MH")),u=d(a("TSYQ")),m=d(a("MN+a"));function d(e){return e&&e.__esModule?e:{default:e}}t.CollapsePanel=function(e){function t(){return(0,o.default)(this,t),(0,l.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,s.default)(t,e),t}(c.default.Component);var h=function(e){function t(){return(0,o.default)(this,t),(0,l.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,s.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){var e=this.props,t=e.prefixCls,a=e.className,i=void 0===a?"":a,o=e.bordered,l=(0,u.default)((0,r.default)({},t+"-borderless",!o),i);return c.default.createElement(p.default,(0,n.default)({},this.props,{className:l}))}}]),t}(c.default.Component);t.default=h,h.Panel=p.default.Panel,h.defaultProps={prefixCls:"ant-collapse",bordered:!0,openAnimation:(0,n.default)({},m.default,{appear:function(){}})}},n3pV:function(e,t,a){}}]);