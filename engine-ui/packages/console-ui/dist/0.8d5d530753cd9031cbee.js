(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1466:function(e,t,a){"use strict";a(58);var n=a(30),r=a.n(n),s=(a(121),a(83)),i=a.n(s),l=(a(47),a(20)),o=a.n(l),c=a(8),u=a.n(c),_=a(5),p=a.n(_),d=a(7),m=a.n(d),E=a(1),h=a.n(E),f=a(6),y=a.n(f),T=a(0),g=a.n(T),k=a(21),b=a(12),v=a(22),O=a(75),C=a(24),A=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.state={loading:!0,data:void 0},a}return y()(t,e),m()(t,[{key:"componentWillReceiveProps",value:function(e){e.resId!==this.props.resId&&this.getResDetail(e.resId)}},{key:"getResDetail",value:function(e){var t=this;e&&v.a.getOfflineRes({resourceId:e}).then(function(e){1===e.code&&t.setState({loading:!1,data:e.data})})}},{key:"render",value:function(){var e=this.props,t=e.visible,a=e.resId,n=e.closeModal,s=this.state,l=s.data,c=s.loading;return g.a.createElement(r.a,{title:"资源详情",visible:t,onCancel:n,key:a,footer:[g.a.createElement(o.a,{size:"large",onClick:n,key:"cancel"},"取消")]},c?g.a.createElement(i.a,null):null===l?"系统异常":g.a.createElement("table",{className:"ant-table ant-table-bordered bd-top bd-left",style:{width:"100%"}},g.a.createElement("tbody",{className:"ant-table-tbody"},g.a.createElement("tr",null,g.a.createElement("td",{width:"15%"},"资源名称"),g.a.createElement("td",null,l.resourceName)),g.a.createElement("tr",null,g.a.createElement("td",null,"资源描述"),g.a.createElement("td",null,l.resourceDesc)),g.a.createElement("tr",null,g.a.createElement("td",null,"资源类型"),g.a.createElement("td",null," ",g.a.createElement(O.f,{value:l.resourceType}))),g.a.createElement("tr",null,g.a.createElement("td",null,"创建"),g.a.createElement("td",null,l.createUser.userName," 于 ",b.a.formatDateTime(l.gmtCreate))),g.a.createElement("tr",null,g.a.createElement("td",null,"修改时间"),g.a.createElement("td",null,b.a.formatDateTime(l.gmtModified))))))}}]),t}(g.a.Component),R=Object(k.b)(function(e){var t=e.offlineTask.modalShow;return{visible:t.resViewModal,resId:t.resId}},function(e){return{closeModal:function(){e({type:C.f.HIDE_RESVIEW_MODAL})}}})(A);t.a=R;"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(A,"ResViewModal","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/resViewModal.js"),__REACT_HOT_LOADER__.register(R,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/resViewModal.js"))},870:function(e,t,a){"use strict";a.r(t);a(66);var n=a(25),r=a.n(n),s=(a(61),a(23)),i=a.n(s),l=(a(74),a(19)),o=a.n(l),c=a(8),u=a.n(c),_=a(5),p=a.n(_),d=a(7),m=a.n(d),E=a(1),h=a.n(E),f=a(6),y=a.n(f),T=a(0),g=a.n(T),k=a(21),b=a(11),v=a(24),O=a(97),C=(a(380),a(146)),A=a.n(C),R=a(129),S=a.n(R),D=(a(43),a(15)),w=a.n(D),L=a(4),x=a.n(L),H=(a(201),a(98)),N=a.n(H),F=(a(47),a(20)),I=a.n(F),M=(a(36),a(13)),j=a.n(M),V=(a(176),a(52)),U=a.n(V),P=(a(53),a(17)),q=a.n(P),B=(a(58),a(30)),K=a.n(B),W=(a(81),a(34)),G=a.n(W),z=a(14),Y=a(226),Q=a.n(Y),$=a(12),J=a(22),X=a(9),Z=a(425),ee=(a(405),a(205)),te=a.n(ee),ae=(a(381),a(130)),ne=a.n(ae),re=a(31),se=a.n(re),ie=(a(48),a(26)),le=a.n(ie),oe=(a(91),a(51)),ce=a.n(oe),ue=(a(49),a(16)),_e=a.n(ue),pe=a(50),de=a.n(pe),me=a(596),Ee=a(151),he=q.a.Item,fe=_e.a.Option,ye=ce.a.Group,Te=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.getTableList=function(){return a.__getTableList__REACT_HOT_LOADER__.apply(a,arguments)},a.validatePath=function(){return a.__validatePath__REACT_HOT_LOADER__.apply(a,arguments)},a.debounceTableSearch=Object(b.debounce)(a.changeTable,300,{maxWait:2e3}),a.state={tableList:[],showPreview:!1,dataSource:[],columns:[]},a}return y()(t,e),m()(t,[{key:"componentDidMount",value:function(){var e=this.props.sourceMap.sourceId;e&&this.getTableList(e)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timerID)}},{key:"__getTableList__REACT_HOT_LOADER__",value:function(e){var t=this,a=this.props.sourceMap;(!a.type||a.type.type!==X.c.HDFS&&a.type.type!==X.c.FTP)&&this.setState({tableList:[],showPreview:!1},function(){J.a.getOfflineTableList({sourceId:e,isSys:!1}).then(function(e){1===e.code&&t.setState({tableList:e.data||[]})})})}},{key:"getTableColumn",value:function(e){var t=this.props,a=t.form,n=t.handleTableColumnChange,r=this.props.sourceMap;if(!r.type||r.type.type!==X.c.HBASE){var s=a.getFieldValue("sourceId");J.a.getOfflineTableColumn({sourceId:s,tableName:e}).then(function(e){1===e.code?n(e.data):n([])})}}},{key:"getDataObjById",value:function(e){return this.props.dataSourceList.filter(function(t){return t.id==e})[0]}},{key:"changeSource",value:function(e){var t=this,a=this.props.handleSourceChange;setTimeout(function(){t.getTableList(e)},0),a(this.getDataObjById(e)),this.resetTable()}},{key:"resetTable",value:function(){var e=this,t=this.props.form;this.changeTable(""),this.setState({selectHack:!0},function(){t.resetFields(["table"]),e.setState({selectHack:!1})})}},{key:"changeTable",value:function(e){e&&this.getTableColumn(e),this.submitForm(),this.setState({showPreview:!1})}},{key:"__validatePath__REACT_HOT_LOADER__",value:function(e,t,a){var n=this.props,r=n.handleTableColumnChange,s=n.form.getFieldValue,i=s("sourceId");"orc"===s("fileType")?J.a.getOfflineTableColumn({sourceId:i,tableName:t}).then(function(e){1===e.code&&(r(e.data),a()),a("该路径无效！")}):a()}},{key:"submitForm",value:function(){var e=this,t=this.props,a=t.updateTaskFields,n=t.form,r=t.handleSourceMapChange,s=t.currentTab,i=(t.sourceMap,t.taskCustomParams);this.timerID=setTimeout(function(){var t=n.getFieldsValue();for(var l in t)""===t[l]&&delete t[l];if(t.where){var o=Object(Ee.e)(i,t.where);o.length>0&&a({id:s,taskVariables:o})}if(t.partition){var c=Object(Ee.e)(i,t.partition);c.length>0&&a({id:s,taskVariables:c})}var u=de()(t,{src:e.getDataObjById(t.sourceId)});r(u)},0)}},{key:"next",value:function(e){var t=this.props,a=t.form,n=(t.handleSourceMapChange,t.sourceMap),r=null;n.type&&n.type.type===X.c.HDFS&&(r=["sourceId","path","fileType"],"text"===n.type.fileType&&r.push("encoding")),a.validateFieldsAndScroll(r,{force:!0},function(t,a){t||e.call(null,1)})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.props,n=a.sourceMap,r=a.dataSourceList,s=a.navtoStep,l=a.isCurrentTabNew,o=Object(b.isEmpty)(n)||n.type.type===X.c.HDFS||n.type.type===X.c.HBASE||n.type.type===X.c.FTP;return g.a.createElement("div",{className:"g-step1"},g.a.createElement(q.a,null,g.a.createElement(he,x()({},X.t,{label:"数据源"}),t("sourceId",{rules:[{required:!0}],initialValue:Object(b.isEmpty)(n)?"":""+n.sourceId})(g.a.createElement(_e.a,{showSearch:!0,onChange:this.changeSource.bind(this),optionFilterProp:"name",disabled:!l},r.map(function(e){var t=e.dataName+"（"+X.d[e.type]+"）",a=e.type===X.c.ES||e.type===X.c.REDIS||e.type===X.c.MONGODB;return g.a.createElement(fe,{key:e.id,name:e.dataName,value:""+e.id,disabled:a},t)})))),this.renderDynamicForm()),g.a.createElement("div",{className:"m-datapreview",style:{width:"90%",margin:"0 auto",overflow:"auto"}},g.a.createElement("p",{style:{cursor:"pointer",marginBottom:10}},g.a.createElement("a",{disabled:o,href:"javascript:void(0)",onClick:this.loadPreview.bind(this)},"数据预览",this.state.showPreview?g.a.createElement(i.a,{type:"up"}):g.a.createElement(i.a,{type:"down"}))),this.state.showPreview?g.a.createElement(le.a,{dataSource:this.state.dataSource,columns:this.state.columns,scroll:{x:200*this.state.columns.length},pagination:!1,bordered:!1}):null),!this.props.readonly&&g.a.createElement("div",{className:"steps-action"},g.a.createElement(I.a,{type:"primary",onClick:function(){return e.next(s)}},"下一步")))}},{key:"loadPreview",value:function(){var e=this,t=this.state.showPreview,a=this.props.form,n=a.getFieldValue("sourceId"),r=a.getFieldValue("table");n&&r?t?this.setState({showPreview:!1}):J.a.getDataPreview({sourceId:n,tableName:r}).then(function(t){if(1===t.code){var a=t.data,n=a.columnList,r=a.dataList,s=n.map(function(e){return{title:e,dataIndex:e,key:e}}),i=r.map(function(e,t){for(var a={},r=0;r<e.length;r++)a.key=t,a[n[r]]=e[r];return a});e.setState({columns:s,dataSource:i,showPreview:!0})}}):j.a.error("数据源或表名缺失")}},{key:"renderDynamicForm",value:function(){var e=this.props.form.getFieldDecorator,t=this.state.selectHack,a=this.props,n=a.sourceMap,r=a.isCurrentTabNew,s=n.type&&n.type.fileType||"text",i=void 0;if(Object(b.isEmpty)(n))return null;switch(n.type.type){case X.c.MYSQL:case X.c.ORACLE:case X.c.SQLSERVER:case X.c.POSTGRESQL:i=[!t&&g.a.createElement(he,x()({},X.t,{label:"表名",key:"table"}),e("table",{rules:[{required:!0,message:"数据源表为必选项！"}],initialValue:Object(b.isEmpty)(n)?"":n.type.table})(g.a.createElement(_e.a,{mode:"combobox",showSearch:!0,showArrow:!0,onChange:this.debounceTableSearch.bind(this),disabled:!r,optionFilterProp:"value"},this.state.tableList.map(function(e){return g.a.createElement(fe,{key:"rdb-"+e,value:e},e)})))),g.a.createElement(he,x()({},X.t,{label:"数据过滤",key:"where"}),e("where",{rules:[{max:1e3,message:"过滤语句不可超过1000个字符!"}],initialValue:Object(b.isEmpty)(n)?"":n.type.where})(g.a.createElement(w.a,{type:"textarea",placeholder:"请参考相关SQL语法填写where过滤语句（不要填写where关键字）。该过滤语句通常用作增量同步",onChange:this.submitForm.bind(this)})),g.a.createElement(me.a,{doc:"dataFilterDoc"})),g.a.createElement(he,x()({},X.t,{label:"切分键",key:"splitPK"}),e("splitPK",{rules:[],initialValue:Object(b.isEmpty)(n)?"":n.splitPK})(g.a.createElement(w.a,{type:"text",placeholder:"根据配置的字段进行数据分片，实现并发读取",onChange:this.submitForm.bind(this)})),g.a.createElement(me.a,{doc:"switchKey"}))];break;case X.c.MAXCOMPUTE:case X.c.HIVE:var l;i=[!t&&g.a.createElement(he,x()({},X.t,{label:"表名",key:"table"}),e("table",{rules:[{required:!0}],initialValue:Object(b.isEmpty)(n)?"":n.type.table})(g.a.createElement(_e.a,{showSearch:!0,mode:"combobox",onChange:this.debounceTableSearch.bind(this),disabled:!r,optionFilterProp:"value"},this.state.tableList.map(function(e){return g.a.createElement(fe,{key:"rdb-"+e,value:e},e)})))),g.a.createElement(he,x()({},X.t,{label:"分区",key:"partition"}),e("partition",{rules:[],initialValue:Object(b.isEmpty)(n)?"":n.type.partition})(g.a.createElement(w.a,(l={placeholder:"请填写分区"},se()(l,"placeholder","pt=${bdp.system.bizdate};"),se()(l,"onChange",this.submitForm.bind(this)),l))),g.a.createElement(me.a,{doc:"partitionDesc"}))];break;case X.c.HDFS:i=[g.a.createElement(he,x()({},X.t,{label:"路径",key:"path"}),e("path",{rules:[{required:!0,message:"路径不得为空！"},{max:200,message:"路径不得超过200个字符！"},{validator:this.validatePath}],validateTrigger:"onSubmit",initialValue:Object(b.isEmpty)(n)?"":n.type.path})(g.a.createElement(w.a,{placeholder:"例如: /rdos/batch",onChange:this.submitForm.bind(this)})),g.a.createElement(me.a,{doc:"hdfsPath"})),g.a.createElement(he,x()({},X.t,{label:"文件类型",key:"fileType"}),e("fileType",{rules:[{required:!0}],initialValue:n.type&&n.type.fileType?n.type.fileType:"text"})(g.a.createElement(_e.a,{onChange:this.submitForm.bind(this)},g.a.createElement(fe,{value:"orc"},"orc"),g.a.createElement(fe,{value:"text"},"text")))),g.a.createElement(he,x()({},X.t,{label:"编码",key:"encoding",style:{display:"text"===s?"block":"none"}}),e("encoding",{rules:[{required:!0}],initialValue:n.type&&n.type.encoding?n.type.encoding:"utf-8"})(g.a.createElement(_e.a,{onChange:this.submitForm.bind(this)},g.a.createElement(fe,{value:"utf-8"},"utf-8"),g.a.createElement(fe,{value:"gbk"},"gbk")))),g.a.createElement(he,x()({},X.t,{style:{display:"text"===s?"block":"none"},label:"分隔符",key:"fieldDelimiter"}),e("fieldDelimiter",{rules:[],initialValue:Object(b.isEmpty)(n)?",":n.type.fieldDelimiter})(g.a.createElement(w.a,{placeholder:"若不填写，则默认为\\001",onChange:this.submitForm.bind(this)})))];break;case X.c.HBASE:i=[!t&&g.a.createElement(he,x()({},X.t,{label:"表名",key:"table"}),e("table",{rules:[{required:!0}],initialValue:Object(b.isEmpty)(n)?"":n.type.table})(g.a.createElement(_e.a,{showSearch:!0,mode:"combobox",onChange:this.debounceTableSearch.bind(this),disabled:!r,optionFilterProp:"value"},this.state.tableList.map(function(e){return g.a.createElement(fe,{key:"hbase-"+e,value:e},e)})))),g.a.createElement(he,x()({},X.t,{label:"编码",key:"encoding"}),e("encoding",{rules:[{required:!0}],initialValue:n.type&&n.type.encoding?n.type.encoding:"utf-8"})(g.a.createElement(_e.a,{onChange:this.submitForm.bind(this)},g.a.createElement(fe,{value:"utf-8"},"utf-8"),g.a.createElement(fe,{value:"gbk"},"gbk")))),g.a.createElement(he,x()({},X.t,{label:"开始行健",key:"startRowkey"}),e("startRowkey",{rules:[],initialValue:n.type&&n.type.startRowkey?n.type.startRowkey:""})(g.a.createElement(w.a,{placeholder:"startRowkey",onChange:this.submitForm.bind(this)}))),g.a.createElement(he,x()({},X.t,{label:"结束行健",key:"endRowkey"}),e("endRowkey",{rules:[],initialValue:n.type&&n.type.endRowkey?n.type.endRowkey:""})(g.a.createElement(w.a,{placeholder:"endRowkey",onChange:this.submitForm.bind(this)}))),g.a.createElement(he,x()({},X.t,{className:"txt-left",label:"行健二进制转换",key:"isBinaryRowkey"}),e("isBinaryRowkey",{rules:[],initialValue:n.type&&n.type.isBinaryRowkey?n.type.isBinaryRowkey:"0"})(g.a.createElement(ye,{onChange:this.submitForm.bind(this)},g.a.createElement(ce.a,{value:"0",style:{float:"left"}},"FALSE"),g.a.createElement(ce.a,{value:"1",style:{float:"left"}},"TRUE")))),g.a.createElement(he,x()({},X.t,{label:"每次RPC请求获取行数",key:"scanCacheSize"}),e("scanCacheSize",{rules:[],initialValue:n.type&&n.type.scanCacheSize?n.type.scanCacheSize:""})(g.a.createElement(w.a,{onChange:this.submitForm.bind(this),placeholder:"请输入大小, 默认为256",type:"number",min:0,suffix:"行"}))),g.a.createElement(he,x()({},X.t,{label:"每次RPC请求获取列数",key:"scanBatchSize"}),e("scanBatchSize",{rules:[],initialValue:n.type&&n.type.scanBatchSize?n.type.scanBatchSize:""})(g.a.createElement(w.a,{onChange:this.submitForm.bind(this),placeholder:"请输入大小, 默认为100",type:"number",min:0,suffix:"列"})))];break;case X.c.FTP:i=[g.a.createElement(he,x()({},X.t,{label:"路径",key:"path"}),e("path",{rules:[{required:!0,message:"路径不得为空！"},{max:200,message:"路径不得超过200个字符！"},{validator:this.validatePath}],validateTrigger:"onSubmit",initialValue:Object(b.isEmpty)(n)?"":n.type.path})(g.a.createElement(w.a,{placeholder:"例如: /rdos/batch",onChange:this.submitForm.bind(this)}))),g.a.createElement(he,x()({},X.t,{style:{display:"text"===s?"block":"none"},label:"列分隔符",key:"fieldDelimiter"}),e("fieldDelimiter",{rules:[{required:!0,message:"分隔符不可为空！"}],initialValue:Object(b.isEmpty)(n)?",":n.type.fieldDelimiter})(g.a.createElement(w.a,{placeholder:"默认值为,",onChange:this.submitForm.bind(this)}))),g.a.createElement(he,x()({},X.t,{label:"编码",key:"encoding",style:{display:"text"===s?"block":"none"}}),e("encoding",{rules:[{required:!0,message:"必须选择一种编码！"}],initialValue:n.type&&n.type.encoding?n.type.encoding:"utf-8"})(g.a.createElement(_e.a,{onChange:this.submitForm.bind(this)},g.a.createElement(fe,{value:"utf-8"},"utf-8"),g.a.createElement(fe,{value:"gbk"},"gbk"))))]}return i}}]),t}(g.a.Component),ge=q.a.create()(Te),ke=function(e){function t(e){return p()(this,t),h()(this,(t.__proto__||u()(t)).call(this,e))}return y()(t,e),m()(t,[{key:"render",value:function(){return g.a.createElement("div",null,g.a.createElement(ge,this.props))}}]),t}(g.a.Component),be=function(e){var t=e.offlineTask,a=t.dataSync,n=t.workbench;return{isCurrentTabNew:n.isCurrentTabNew,currentTab:n.currentTab,sourceMap:a.sourceMap,dataSourceList:a.dataSourceList,taskCustomParams:n.taskCustomParams}},ve=function(e){return{handleSourceChange:function(t){e({type:v.b.RESET_SOURCE_MAP}),e({type:v.b.RESET_KEYMAP}),e({type:v.j.DATA_SOURCE_CHANGE,payload:t}),e({type:v.o.MAKE_TAB_DIRTY})},handleSourceMapChange:function(t){e({type:v.j.DATA_SOURCEMAP_CHANGE,payload:t}),e({type:v.o.MAKE_TAB_DIRTY})},handleTableColumnChange:function(t){e({type:v.j.SOURCE_TABLE_COLUMN_CHANGE,payload:t}),e({type:v.o.MAKE_TAB_DIRTY})},updateTaskFields:function(t){e({type:v.o.SET_TASK_FIELDS_VALUE,payload:t})}}},Oe=Object(k.b)(be,ve)(ke),Ce=Oe,Ae=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(he,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/source.js"),__REACT_HOT_LOADER__.register(fe,"Option","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/source.js"),__REACT_HOT_LOADER__.register(ye,"RadioGroup","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/source.js"),__REACT_HOT_LOADER__.register(Te,"SourceForm","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/source.js"),__REACT_HOT_LOADER__.register(ge,"SourceFormWrap","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/source.js"),__REACT_HOT_LOADER__.register(ke,"Source","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/source.js"),__REACT_HOT_LOADER__.register(be,"mapState","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/source.js"),__REACT_HOT_LOADER__.register(ve,"mapDispatch","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/source.js"),__REACT_HOT_LOADER__.register(Oe,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/source.js")),q.a.Item),Re=_e.a.Option,Se=ce.a.Group,De=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.getTableList=function(){return a.__getTableList__REACT_HOT_LOADER__.apply(a,arguments)},a.getTableColumn=function(){return a.__getTableColumn__REACT_HOT_LOADER__.apply(a,arguments)},a.debounceTableSearch=Object(b.debounce)(a.changeTable,600,{maxWait:2e3}),a.state={tableList:[]},a}return y()(t,e),m()(t,[{key:"componentDidMount",value:function(){var e=this.props.targetMap.sourceId;e&&this.getTableList(e)}},{key:"__getTableList__REACT_HOT_LOADER__",value:function(e){var t=this,a=this.props.targetMap;if(a.type&&(a.type.type===X.c.HDFS||a.type.type===X.c.FTP))return!0;t.setState({tableList:[]},function(){J.a.getOfflineTableList({sourceId:e,isSys:!1}).then(function(e){1===e.code&&t.setState({tableList:e.data})})})}},{key:"__getTableColumn__REACT_HOT_LOADER__",value:function(e){var t=this.props,a=t.form,n=t.handleTableColumnChange,r=t.targetMap,s=a.getFieldValue("sourceId");if(r.type&&r.type.type===X.c.HBASE)return!0;J.a.getOfflineTableColumn({sourceId:s,tableName:e}).then(function(e){1===e.code?n(e.data):n([])})}},{key:"getDataObjById",value:function(e){return this.props.dataSourceList.filter(function(t){return t.id==e})[0]}},{key:"changeSource",value:function(e){var t=this,a=this.props,n=a.handleSourceChange;a.form;setTimeout(function(){t.getTableList(e)},0),n(this.getDataObjById(e)),this.resetTable()}},{key:"resetTable",value:function(){var e=this,t=this.props.form;this.changeTable(""),this.setState({selectHack:!0},function(){t.resetFields(["table"]),e.setState({selectHack:!1})})}},{key:"changeTable",value:function(e){e&&this.getTableColumn(e),this.submitForm()}},{key:"submitForm",value:function(){var e=this,t=this.props,a=t.taskCustomParams,n=t.updateTaskFields,r=t.form,s=t.handleTargetMapChange,i=t.currentTab;setTimeout(function(){var t=r.getFieldsValue(),l=t.preSql+" "+t.postSql;if(l){var o=Object(Ee.e)(a,l);o.length>0&&n({id:i,taskVariables:o})}if(t.partition){var c=Object(Ee.e)(a,t.partition);c.length>0&&n({id:i,taskVariables:c})}var u=de()(t,{src:e.getDataObjById(t.sourceId)});s(u)},0)}},{key:"prev",value:function(e){e.call(null,0)}},{key:"next",value:function(e){var t=this.props,a=t.form;t.handleTargetMapChange,t.targetMap;a.validateFields(function(t,a){t||e.call(null,2)})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.props,n=a.targetMap,r=(a.sourceMap,a.dataSourceList),s=a.navtoStep,i=a.isCurrentTabNew;return g.a.createElement("div",{className:"g-step2"},g.a.createElement(q.a,null,g.a.createElement(Ae,x()({},X.t,{label:"数据同步目标"}),t("sourceId",{rules:[{required:!0}],initialValue:Object(b.isEmpty)(n)?"":""+n.sourceId})(g.a.createElement(_e.a,{showSearch:!0,onChange:this.changeSource.bind(this),optionFilterProp:"name",disabled:!i},r.map(function(e){var t=e.dataName+"（"+X.d[e.type]+"）",a=e.type===X.c.ES||e.type===X.c.REDIS||e.type===X.c.MONGODB;return g.a.createElement(Re,{key:e.id,name:e.dataName,value:""+e.id,disabled:a},t)})))),this.renderDynamicForm()),!this.props.readonly&&g.a.createElement("div",{className:"steps-action"},g.a.createElement(I.a,{style:{marginRight:8},onClick:function(){return e.prev(s)}},"上一步"),g.a.createElement(I.a,{type:"primary",onClick:function(){return e.next(s)}},"下一步")))}},{key:"renderDynamicForm",value:function(){var e=this.props.form.getFieldDecorator,t=this.state.selectHack,a=this.props,n=a.targetMap,r=(a.dataSourceList,a.isCurrentTabNew),s=void 0;if(Object(b.isEmpty)(n))return null;switch(n.type.type){case X.c.MYSQL:case X.c.ORACLE:case X.c.SQLSERVER:case X.c.POSTGRESQL:s=[!t&&g.a.createElement(Ae,x()({},X.t,{label:"表名",key:"table"}),e("table",{rules:[{required:!0}],initialValue:Object(b.isEmpty)(n)?"":n.type.table})(g.a.createElement(_e.a,{showSearch:!0,mode:"combobox",disabled:!r,optionFilterProp:"value",onChange:this.debounceTableSearch.bind(this)},this.state.tableList.map(function(e){return g.a.createElement(Re,{key:"rdb-target-"+e,value:e},e)})))),g.a.createElement(Ae,x()({},X.t,{label:"导入前准备语句",key:"preSql"}),e("preSql",{rules:[],initialValue:Object(b.isEmpty)(n)?"":n.type.preSql})(g.a.createElement(w.a,{onChange:this.submitForm.bind(this),placeholder:"请输入导入数据前执行的SQL脚本",type:"textarea"}))),g.a.createElement(Ae,x()({},X.t,{label:"导入后准备语句",key:"postSql"}),e("postSql",{rules:[],initialValue:Object(b.isEmpty)(n)?"":n.type.postSql})(g.a.createElement(w.a,{onChange:this.submitForm.bind(this),placeholder:"请输入导入数据后执行的SQL脚本",type:"textarea"}))),g.a.createElement(Ae,x()({},X.t,{label:"主键冲突",key:"writeMode",className:"txt-left"}),e("writeMode",{rules:[{required:!0}],initialValue:n.type&&n.type.writeMode?n.type.writeMode:"insert"})(g.a.createElement(Se,{onChange:this.submitForm.bind(this)},g.a.createElement(ce.a,{value:"insert",style:{float:"left"}},"视为脏数据，保留原有数据（Insert Into）"),g.a.createElement(ce.a,{value:"replace",style:{float:"left"}},"替换原有数据（Replace Into）"))))];break;case X.c.HIVE:case X.c.MAXCOMPUTE:s=[!t&&g.a.createElement(Ae,x()({},X.t,{label:"表名",key:"table"}),e("table",{rules:[{required:!0}],initialValue:Object(b.isEmpty)(n)?"":n.type.table})(g.a.createElement(_e.a,{showSearch:!0,mode:"combobox",onChange:this.debounceTableSearch.bind(this),disabled:!r,optionFilterProp:"value"},this.state.tableList.map(function(e){return g.a.createElement(Re,{key:"rdb-target-"+e,value:e},e)})))),g.a.createElement(Ae,x()({},X.t,{label:"分区",key:"partition"}),e("partition",{rules:[],initialValue:Object(b.isEmpty)(n)?"":n.type.partition})(g.a.createElement(w.a,{onChange:this.submitForm.bind(this),placeholder:"pt=${bdp.system.bizdate};"})),g.a.createElement(me.a,{doc:"partitionDesc"})),g.a.createElement(Ae,x()({},X.t,{label:"写入模式",key:"writeMode",className:"txt-left"}),e("writeMode",{rules:[{required:!0}],initialValue:n.type&&n.type.writeMode?n.type.writeMode:"replace"})(g.a.createElement(Se,{onChange:this.submitForm.bind(this)},g.a.createElement(ce.a,{value:"replace",style:{float:"left"}},"覆盖（Insert Overwrite）"),g.a.createElement(ce.a,{value:"insert",style:{float:"left"}},"追加（Insert Into）"))))];break;case X.c.HDFS:s=[g.a.createElement(Ae,x()({},X.t,{label:"路径",key:"path"}),e("path",{rules:[{required:!0}],initialValue:Object(b.isEmpty)(n)?"":n.type.path})(g.a.createElement(w.a,{placeholder:"例如: /rdos/batch",onChange:this.submitForm.bind(this)}))),g.a.createElement(Ae,x()({},X.t,{label:"分隔符",key:"fieldDelimiter"}),e("fieldDelimiter",{rules:[],initialValue:Object(b.isEmpty)(n)?",":n.type.fieldDelimiter})(g.a.createElement(w.a,{placeholder:"例如: 目标为hive则 分隔符为\\001",onChange:this.submitForm.bind(this)}))),g.a.createElement(Ae,x()({},X.t,{label:"编码",key:"encoding"}),e("encoding",{rules:[{required:!0}],initialValue:Object(b.isEmpty)(n)||!n.type.encoding?"utf-8":n.type.encoding})(g.a.createElement(_e.a,{onChange:this.submitForm.bind(this)},g.a.createElement(Re,{value:"utf-8"},"utf-8"),g.a.createElement(Re,{value:"gbk"},"gbk")))),g.a.createElement(Ae,x()({},X.t,{label:"文件名",key:"fileName"}),e("fileName",{rules:[{required:!0}],initialValue:Object(b.isEmpty)(n)?"":n.type.fileName})(g.a.createElement(w.a,{onChange:this.submitForm.bind(this)}))),g.a.createElement(Ae,x()({},X.t,{label:"文件类型",key:"fileType"}),e("fileType",{rules:[{required:!0}],initialValue:n.type&&n.type.fileType?n.type.fileType:"orc"})(g.a.createElement(_e.a,{onChange:this.submitForm.bind(this)},g.a.createElement(Re,{value:"orc"},"orc"),g.a.createElement(Re,{value:"text"},"text")))),g.a.createElement(Ae,x()({},X.t,{label:"写入模式",className:"txt-left",key:"writeMode"}),e("writeMode",{rules:[{required:!0}],initialValue:n.type&&n.type.writeMode?n.type.writeMode:"APPEND"})(g.a.createElement(Se,{onChange:this.submitForm.bind(this)},g.a.createElement(ce.a,{value:"APPEND",style:{float:"left"}},"追加新数据"),g.a.createElement(ce.a,{value:"NONCONFLICT",style:{float:"left"}},"覆盖老数据"))))];break;case X.c.HBASE:s=[!t&&g.a.createElement(Ae,x()({},X.t,{label:"表名",key:"table"}),e("table",{rules:[{required:!0}],initialValue:n.type&&n.type.table?n.type.table:""})(g.a.createElement(_e.a,{showSearch:!0,mode:"combobox",onChange:this.debounceTableSearch.bind(this),disabled:!r,optionFilterProp:"value"},this.state.tableList.map(function(e){return g.a.createElement(Re,{key:"hbase-target-"+e,value:e},e)})))),g.a.createElement(Ae,x()({},X.t,{label:"编码",key:"encoding"}),e("encoding",{rules:[{required:!0}],initialValue:n.type&&n.type.encoding?n.type.encoding:"utf-8"})(g.a.createElement(_e.a,{onChange:this.submitForm.bind(this)},g.a.createElement(Re,{value:"utf-8"},"utf-8"),g.a.createElement(Re,{value:"gbk"},"gbk")))),g.a.createElement(Ae,x()({},X.t,{label:"读取为空时的处理方式",key:"nullMode",className:"txt-left"}),e("nullMode",{rules:[{required:!0,message:"请选择为空时的处理方式!"}],initialValue:n.type&&n.type.nullMode?n.type.nullMode:"skip"})(g.a.createElement(Se,{onChange:this.submitForm.bind(this)},g.a.createElement(ce.a,{value:"skip",style:{float:"left"}},"SKIP"),g.a.createElement(ce.a,{value:"empty",style:{float:"left"}},"EMPTY")))),g.a.createElement(Ae,x()({},X.t,{label:"写入缓存大小",key:"writeBufferSize"}),e("writeBufferSize",{rules:[],initialValue:Object(b.isEmpty)(n)?"":n.type.writeBufferSize})(g.a.createElement(w.a,{onChange:this.submitForm.bind(this),placeholder:"请输入缓存大小",type:"number",min:0,suffix:"KB"})))];break;case X.c.FTP:s=[g.a.createElement(Ae,x()({},X.t,{label:"路径",key:"path"}),e("path",{rules:[{required:!0,message:"路径不得为空！"},{max:200,message:"路径不得超过200个字符！"},{validator:this.validatePath}],validateTrigger:"onSubmit",initialValue:Object(b.isEmpty)(n)?"":n.type.path})(g.a.createElement(w.a,{placeholder:"例如: /rdos/batch",onChange:this.submitForm.bind(this)}))),g.a.createElement(Ae,x()({},X.t,{label:"编码",key:"encoding"}),e("encoding",{rules:[{required:!0}],initialValue:n.type&&n.type.encoding?n.type.encoding:"utf-8"})(g.a.createElement(_e.a,{onChange:this.submitForm.bind(this)},g.a.createElement(Re,{value:"utf-8"},"utf-8"),g.a.createElement(Re,{value:"gbk"},"gbk")))),g.a.createElement(Ae,x()({},X.t,{label:"分隔符",key:"fieldDelimiter"}),e("fieldDelimiter",{rules:[],initialValue:n.type&&n.type.fieldDelimiter?n.type.fieldDelimiter:","})(g.a.createElement(w.a,{placeholder:"若不填写，则默认,",onChange:this.submitForm.bind(this)}))),g.a.createElement(Ae,x()({},X.t,{label:"写入模式",className:"txt-left",key:"writeMode"}),e("writeMode",{rules:[{required:!0}],initialValue:n.type&&n.type.writeMode?n.type.writeMode:"APPEND"})(g.a.createElement(Se,{onChange:this.submitForm.bind(this)},g.a.createElement(ce.a,{value:"APPEND",style:{float:"left"}},"追加新数据"),g.a.createElement(ce.a,{value:"NONCONFLICT",style:{float:"left"}},"覆盖老数据"))))]}return s}}]),t}(g.a.Component),we=q.a.create()(De),Le=function(e){function t(e){return p()(this,t),h()(this,(t.__proto__||u()(t)).call(this,e))}return y()(t,e),m()(t,[{key:"render",value:function(){return g.a.createElement("div",null,g.a.createElement(we,this.props))}}]),t}(g.a.Component),xe=function(e){var t=e.offlineTask,a=t.dataSync,n=t.workbench,r=n.isCurrentTabNew;return{currentTab:n.currentTab,isCurrentTabNew:r,targetMap:a.targetMap,sourceMap:a.sourceMap,dataSourceList:a.dataSourceList,taskCustomParams:n.taskCustomParams}},He=function(e){return{handleSourceChange:function(t){e({type:v.b.RESET_TARGET_MAP}),e({type:v.b.RESET_KEYMAP}),e({type:v.m.DATA_SOURCE_TARGET_CHANGE,payload:t}),e({type:v.o.MAKE_TAB_DIRTY})},handleTargetMapChange:function(t){e({type:v.m.DATA_TARGETMAP_CHANGE,payload:t}),e({type:v.o.MAKE_TAB_DIRTY})},handleTableColumnChange:function(t){e({type:v.m.TARGET_TABLE_COLUMN_CHANGE,payload:t}),e({type:v.o.MAKE_TAB_DIRTY})},updateTaskFields:function(t){e({type:v.o.SET_TASK_FIELDS_VALUE,payload:t})}}},Ne=Object(k.b)(xe,He)(Le),Fe=Ne,Ie=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Ae,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/target.js"),__REACT_HOT_LOADER__.register(Re,"Option","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/target.js"),__REACT_HOT_LOADER__.register(Se,"RadioGroup","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/target.js"),__REACT_HOT_LOADER__.register(De,"TargetForm","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/target.js"),__REACT_HOT_LOADER__.register(we,"TargetFormWrap","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/target.js"),__REACT_HOT_LOADER__.register(Le,"Target","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/target.js"),__REACT_HOT_LOADER__.register(xe,"mapState","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/target.js"),__REACT_HOT_LOADER__.register(He,"mapDispatch","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/target.js"),__REACT_HOT_LOADER__.register(Ne,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/target.js")),a(89)),Me=a.n(Ie),je=(a(77),a(32)),Ve=a.n(je),Ue=a(132),Pe=a.n(Ue),qe=a(199),Be=a(851),Ke=a(115),We=(a(177),a(93)),Ge=a.n(We),ze=q.a.Item,Ye=_e.a.Option,Qe=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.columnFamily=function(){var e;return(e=n).__columnFamily__REACT_HOT_LOADER__.apply(e,arguments)},n.renderFormItems=function(){var e;return(e=n).__renderFormItems__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"shouldComponentUpdate",value:function(e){return this.props!==e}},{key:"__columnFamily__REACT_HOT_LOADER__",value:function(e){return e&&e.map(function(e){return g.a.createElement(Ye,{value:e},e)})}},{key:"__renderFormItems__REACT_HOT_LOADER__",value:function(){var e=this.props,t=e.keyModal,a=e.dataType,n=e.sourceColumnFamily,r=e.targetColumnFamily,s=t.isReader,i=(t.fileType,t.editField),l=this.props.form.getFieldDecorator;if(s)switch(a){case X.c.FTP:case X.c.HDFS:return[g.a.createElement(ze,x()({},X.t,{label:"索引值",key:"index"}),l("index",{rules:[{required:!0,type:"integer",message:"请按要求填写索引值！"}],initialValue:i&&i.index||""})(g.a.createElement(Ge.a,{style:{width:"100%"},min:0}))),g.a.createElement(ze,x()({},X.t,{label:"选择类型",key:"type"}),l("type",{rules:[{required:!0}],initialValue:i&&i.type||"STRING"})(g.a.createElement(_e.a,null,g.a.createElement(Ye,{value:"STRING"},"STRING"),g.a.createElement(Ye,{value:"LONG"},"LONG"),g.a.createElement(Ye,{value:"BOOLEAN"},"BOOLEAN"),g.a.createElement(Ye,{value:"DOUBLE"},"DOUBLE"),g.a.createElement(Ye,{value:"DATE"},"DATE"))))];case X.c.HBASE:var o=i&&"rowkey"===i.key;return[g.a.createElement(ze,x()({},X.t,{label:"列名",key:"key"}),l("key",{rules:[{required:!0,type:"string"}],initialValue:i&&i.key||""})(g.a.createElement(w.a,{style:{width:"100%"},disabled:o}))),g.a.createElement(ze,x()({},X.t,{label:"列族",key:"cf"}),l("cf",{rules:[{required:!0}],initialValue:i&&i.cf||""})(g.a.createElement(_e.a,{placeHolder:"请选择列族",disabled:o},this.columnFamily(n)))),g.a.createElement(ze,x()({},X.t,{label:"选择类型",key:"type"}),l("type",{rules:[{required:!0}],initialValue:i&&i.type||"STRING"})(g.a.createElement(_e.a,null,g.a.createElement(Ye,{value:"STRING"},"STRING"),g.a.createElement(Ye,{value:"BOOLEAN"},"BOOLEAN"),g.a.createElement(Ye,{value:"SHORT"},"SHORT"),g.a.createElement(Ye,{value:"INT"},"INT"),g.a.createElement(Ye,{value:"LONG"},"LONG"),g.a.createElement(Ye,{value:"FLOAT"},"FLOAT"),g.a.createElement(Ye,{value:"DOUBLE"},"DOUBLE"))))]}else switch(a){case X.c.FTP:case X.c.HDFS:return[g.a.createElement(ze,x()({},X.t,{label:"选择类型",key:"type"}),l("type",{rules:[{required:!0}],initialValue:i&&i.type||"STRING"})(g.a.createElement(_e.a,null,g.a.createElement(Ye,{value:"STRING"},"STRING"),g.a.createElement(Ye,{value:"BIGINT"},"BIGINT"),g.a.createElement(Ye,{value:"TIMESTAMP"},"TIMESTAMP"),g.a.createElement(Ye,{value:"VARCHAR"},"VARCHAR"),g.a.createElement(Ye,{value:"CHAR"},"CHAR"),g.a.createElement(Ye,{value:"TINYINT"},"TINYINT"),g.a.createElement(Ye,{value:"SMALLINT"},"SMALLINT"),g.a.createElement(Ye,{value:"DECIMAL"},"DECIMAL"),g.a.createElement(Ye,{value:"INT"},"INT"),g.a.createElement(Ye,{value:"FLOAT"},"FLOAT"),g.a.createElement(Ye,{value:"DOUBLE"},"DOUBLE"),g.a.createElement(Ye,{value:"DATE"},"DATE")))),g.a.createElement(ze,x()({},X.t,{label:"字段名",key:"keyName"}),l("key",{rules:[{required:!0}],initialValue:i&&i.key||""})(g.a.createElement(w.a,null)))];case X.c.HBASE:return[g.a.createElement(ze,x()({},X.t,{label:"列名",key:"key"}),l("key",{rules:[{required:!0,type:"string"}],initialValue:i&&i.key||""})(g.a.createElement(w.a,{style:{width:"100%"}}))),g.a.createElement(ze,x()({},X.t,{label:"列族",key:"cf"}),l("cf",{rules:[{required:!0}],initialValue:i&&i.cf||""})(g.a.createElement(_e.a,{placeHolder:"请选择列族"},this.columnFamily(r)))),g.a.createElement(ze,x()({},X.t,{label:"选择类型",key:"type"}),l("type",{rules:[{required:!0}],initialValue:i&&i.type||"STRING"})(g.a.createElement(_e.a,null,g.a.createElement(Ye,{value:"STRING"},"STRING"),g.a.createElement(Ye,{value:"BOOLEAN"},"BOOLEAN"),g.a.createElement(Ye,{value:"SHORT"},"SHORT"),g.a.createElement(Ye,{value:"INT"},"INT"),g.a.createElement(Ye,{value:"LONG"},"LONG"),g.a.createElement(Ye,{value:"FLOAT"},"FLOAT"),g.a.createElement(Ye,{value:"DOUBLE"},"DOUBLE"))))]}return[]}},{key:"render",value:function(){return g.a.createElement(q.a,null,this.renderFormItems())}}]),t}(g.a.Component),$e=q.a.create()(Qe),Je=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.submit=function(){var e;return(e=n).__submit__REACT_HOT_LOADER__.apply(e,arguments)},n.cancel=function(){var e;return(e=n).__cancel__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"__submit__REACT_HOT_LOADER__",value:function(){var e=this,t=this.props.onOk;this.Form.validateFields(function(a,n){a?t(null,a):(setTimeout(function(){e.Form.resetFields()},200),t(n))})}},{key:"__cancel__REACT_HOT_LOADER__",value:function(){(0,this.props.onCancel)(),this.Form.resetFields()}},{key:"render",value:function(){var e=this,t=this.props,a=t.title,n=t.visible,r=t.keyModal,s=t.dataType,i=t.sourceColumnFamily,l=t.targetColumnFamily;return g.a.createElement(K.a,{title:a,visible:n,onOk:this.submit,onCancel:this.cancel},g.a.createElement($e,{sourceColumnFamily:i,targetColumnFamily:l,dataType:s,keyModal:r,ref:function(t){return e.Form=t}}))}}]),t}(g.a.Component),Xe=Je,Ze=Xe,et=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(ze,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/keymapModal.js"),__REACT_HOT_LOADER__.register(Ye,"Option","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/keymapModal.js"),__REACT_HOT_LOADER__.register(Qe,"KeyForm","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/keymapModal.js"),__REACT_HOT_LOADER__.register($e,"KeyFormWrapper","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/keymapModal.js"),__REACT_HOT_LOADER__.register(Je,"KeyMapModal","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/keymapModal.js"),__REACT_HOT_LOADER__.register(Xe,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/keymapModal.js")),function(){return g.a.createElement("span",null,g.a.createElement("b",null,"STRING"),",",g.a.createElement("b",null,"VARCHAR"),",",g.a.createElement("b",null,"CHAR"),",",g.a.createElement("b",null,"TINYINT"),",",g.a.createElement("b",null,"SMALLINT"),",",g.a.createElement("b",null,"DECIMAL"),",",g.a.createElement("br",null),g.a.createElement("b",null,"INT"),",",g.a.createElement("b",null,"BIGINT"),",",g.a.createElement("b",null,"FLOAT"),",",g.a.createElement("b",null,"DOUBLE"),",",g.a.createElement("b",null,"TIMESTAMP"),",",g.a.createElement("b",null,"DATE"))});function tt(e){var t=e.title,a=e.desc,n=e.visible,r=e.onOk,s=e.placeholder,i=e.value,l=e.onCancel,o=e.onChange,c=e.columnFamily;return g.a.createElement(K.a,{title:t,onOk:r,onCancel:l,visible:n},g.a.createElement("p",null,"批量导入的语法格式：",g.a.createElement("b",{style:{color:"rgb(255, 102, 0)"}},a)),g.a.createElement("p",null,"常用数据类型：",g.a.createElement("span",{style:{color:"rgb(255, 102, 0)"}},et())),c?g.a.createElement("p",null,"已有列族：",g.a.createElement("span",{style:{color:"rgb(255, 102, 0)"}},c.map(function(e){return e+","}))):"",g.a.createElement("br",null),g.a.createElement(w.a,{type:"textarea",rows:6,value:i,onChange:o,placeholder:s}))}"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(et,"renderHDFSTypes","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/batchModal.js"),__REACT_HOT_LOADER__.register(tt,"BatchModal","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/batchModal.js"));var at=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.state={constValue:""},n.onChange=function(){var e;return(e=n).__onChange__REACT_HOT_LOADER__.apply(e,arguments)},n.submit=function(){var e;return(e=n).__submit__REACT_HOT_LOADER__.apply(e,arguments)},n.close=function(){var e;return(e=n).__close__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"__onChange__REACT_HOT_LOADER__",value:function(e){this.setState({constValue:e.target.value})}},{key:"__submit__REACT_HOT_LOADER__",value:function(){var e=this.props,t=e.onOk,a=e.onCancel,n=$.a.trim(this.state.constValue);""!==n?t&&(t({type:"string",key:n,value:n}),a()):j.a.error("常量字段不可为空！")}},{key:"__close__REACT_HOT_LOADER__",value:function(){var e=this.props.onCancel;this.setState({constValue:""},function(){e&&e()})}},{key:"render",value:function(){var e=this.state.constValue,t=this.props,a=t.visible;t.onCancel;return g.a.createElement(K.a,{title:"添加常量",onOk:this.submit,onCancel:this.close,visible:a},g.a.createElement(w.a,{value:e,onChange:this.onChange,placeholder:"请输入常量值"}))}}]),t}(g.a.Component),nt=("undefined"!=typeof __REACT_HOT_LOADER__&&__REACT_HOT_LOADER__.register(at,"ConstModal","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/constModal.js"),q.a.Item),rt=_e.a.Option,st={cf:"-",key:"rowkey",type:"STRING"};function it(e){return X.c.HDFS===parseInt(e,10)}function lt(e){return X.f.indexOf(parseInt(e,10))>-1}function ot(e,t){return Object(b.isObject)(e)&&Object(b.isObject)(t)?Object(b.isEqual)(e,t):Object(b.isObject)(e)&&!Object(b.isObject)(t)?(e.key||e.index)===t:!Object(b.isObject)(e)&&Object(b.isObject)(t)?e===(t.key||t.index):e===t}var ct=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.resize=function(){return a.__resize__REACT_HOT_LOADER__.apply(a,arguments)},a.initData=function(){return a.__initData__REACT_HOT_LOADER__.apply(a,arguments)},a.loadColumnFamily=function(){return a.__loadColumnFamily__REACT_HOT_LOADER__.apply(a,arguments)},a.hbaseRowKeyChange=function(){return a.__hbaseRowKeyChange__REACT_HOT_LOADER__.apply(a,arguments)},a.renderKeyModal=function(){return a.__renderKeyModal__REACT_HOT_LOADER__.apply(a,arguments)},a.renderBatchModal=function(){return a.__renderBatchModal__REACT_HOT_LOADER__.apply(a,arguments)},a.checkHBaseRowKey=function(){return a.__checkHBaseRowKey__REACT_HOT_LOADER__.apply(a,arguments)},a.copySourceCols=function(){return a.__copySourceCols__REACT_HOT_LOADER__.apply(a,arguments)},a.batchTextChange=function(){return a.__batchTextChange__REACT_HOT_LOADER__.apply(a,arguments)},a.batchSourceTextChange=function(){return a.__batchSourceTextChange__REACT_HOT_LOADER__.apply(a,arguments)},a.doBatchImport=function(){return a.__doBatchImport__REACT_HOT_LOADER__.apply(a,arguments)},a.hideBatchImportModal=function(){return a.__hideBatchImportModal__REACT_HOT_LOADER__.apply(a,arguments)},a.hideBatchSourceModal=function(){return a.__hideBatchSourceModal__REACT_HOT_LOADER__.apply(a,arguments)},a.importFields=function(){return a.__importFields__REACT_HOT_LOADER__.apply(a,arguments)},a.importSourceFields=function(){return a.__importSourceFields__REACT_HOT_LOADER__.apply(a,arguments)},a.doBatchAddSourceFields=function(){return a.__doBatchAddSourceFields__REACT_HOT_LOADER__.apply(a,arguments)},a.initEditKeyRow=function(){return a.__initEditKeyRow__REACT_HOT_LOADER__.apply(a,arguments)},a.doAddkeyRow=function(){return a.__doAddkeyRow__REACT_HOT_LOADER__.apply(a,arguments)},a.doEditKeyRow=function(){return a.__doEditKeyRow__REACT_HOT_LOADER__.apply(a,arguments)},a.hideKeyModal=function(){return a.__hideKeyModal__REACT_HOT_LOADER__.apply(a,arguments)},a.state={h:40,w:230,W:450,padding:10,rowMap:!1,nameMap:!1,keyModalVisible:!1,visibleConst:!1,keyModal:{operation:"add",isReader:!0,editField:"",position:-1,source:"",fileType:"orc"},batchModal:{visible:!1,batchText:""},batchSourceModal:{visible:!1,batchText:""},sourceColumnFamily:"",targetColumnFamily:""},a}return y()(t,e),m()(t,[{key:"getCanvasW",value:function(){var e=450,t=document.querySelector(".steps-content");if(t){var a=t.getBoundingClientRect().width/6*5;a>e&&(e=a)}return e}},{key:"componentDidMount",value:function(){this.$canvas=Object(qe.b)(this.canvas),this.$activeLine=Object(qe.b)("#activeLine"),this.setState({W:this.getCanvasW()}),this.drawSvg(),this.listenResize(),this.loadColumnFamily(),this.initData()}},{key:"__resize__REACT_HOT_LOADER__",value:function(){this.setState({W:this.getCanvasW()})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize,!1)}},{key:"listenResize",value:function(){window.addEventListener&&window.addEventListener("resize",this.resize,!1)}},{key:"componentDidUpdate",value:function(){this.$canvas.selectAll(".dl, .dr, .lines").remove(),this.drawSvg()}},{key:"drawSvg",value:function(){this.renderDags(),this.renderLines(),this.bindEvents()}},{key:"renderDags",value:function(){var e=this.state,t=e.w,a=e.h,n=e.W,r=e.padding,s=this.props,i=s.targetCol,l=s.sourceCol;s.keymap;this.$canvas.append("g").attr("class","dl").selectAll("g").data(l).enter().append("g").attr("class","col-dag-l").append("circle").attr("class","dag-circle").attr("cx",function(e,t){return r}).attr("cy",function(e,t){return a*(t+1.5)}).attr("r",5).attr("stroke-width",2).attr("stroke","#fff").attr("fill","#2491F7"),this.$canvas.append("g").attr("class","dr").selectAll("g").data(i).enter().append("g").attr("class","col-dag-r").append("circle").attr("class","dag-circle").attr("cx",function(e,a){return n-2*t-r}).attr("cy",function(e,t){return a*(t+1.5)}).attr("r",5).attr("stroke-width",2).attr("stroke","#fff").attr("fill","#2491F7")}},{key:"renderLines",value:function(){var e=this.state,t=e.w,a=e.h,n=e.W,r=e.padding,s=this.props,i=s.keymap,l=s.sourceSrcType,o=s.targetSrcType,c=i.source,u=i.target,_=Object(qe.c)(".col-dag-l"),p=Object(qe.c)(".col-dag-r"),d=[];c.forEach(function(e,s){_.each(function(i,c){var _,m,E=void 0,h=void 0,f=void 0,y=void 0;_=i,m=e,(lt(l)?_.key===m:ot(_,m))&&(E=r,h=(c+1.5)*a,p.each(function(i,l){var c,_;c=i,_=u[s],(lt(o)?c.key===_:ot(c,_))&&(f=n-2*t-r,y=(l+1.5)*a,d.push({s:{x:E,y:h},e:{x:f,y:y},dl:e,dr:u[s]}))}))})}),this.$canvas.append("g").attr("class","lines").selectAll("g").data(d).enter().append("g").attr("class","mapline").append("line").attr("x1",function(e){return e.s.x}).attr("y1",function(e){return e.s.y}).attr("x2",function(e){return e.e.x}).attr("y2",function(e){return e.e.y}).attr("stroke","#2491F7").attr("stroke-width",2).attr("marker-end","url(#arrow)")}},{key:"bindEvents",value:function(){var e=this,t=this.state,a=t.w,n=t.h,r=t.W,s=t.padding,i=this.props,l=i.addLinkedKeys,o=i.delLinkedKeys,c=i.sourceSrcType,u=i.sourceFileType,_=i.targetSrcType,p=i.targetFileType,d=this.$activeLine,m=!1,E=void 0,h=void 0;Object(qe.c)(".col-dag-l").on("mousedown",function(e,t,a){var r=s,i=(t+1.5)*n;d.attr("x1",r).attr("y1",i).attr("x2",r).attr("y2",i),E=e,m=!0}),this.$canvas.on("mousemove",function(){if(m){var t=Object(qe.a)(e.$canvas.node());d.attr("x2",t[0]).attr("y2",t[1])}}).on("mouseup",function(){if(m){var t=Object(qe.a)(e.$canvas.node()),i=Pe()(t,2),o=i[0],u=i[1];if(o<r-2*a-s)e.resetActiveLine();else{var p=Math.floor(u/n)-1;Object(qe.c)(".col-dag-r").each(function(e,t){t===p&&(h=e)})}}E&&h&&(l({source:lt(c)?E.key:E,target:lt(_)?h.key:h}),e.resetActiveLine()),m=!1}),this.$canvas.selectAll(".mapline").on("mouseover",function(e,t,a){Object(qe.b)(a[t]).select("line").attr("stroke-width",3).attr("stroke","#2491F7")}).on("mouseout",function(e,t,a){Object(qe.b)(a[t]).select("line").attr("stroke-width",2).attr("stroke","#2491F7")}).on("click",function(e,t,a){o({source:e.dl,target:e.dr,sourceSrcType:c,sourceFileType:u,targetSrcType:_,targetFileType:p})})}},{key:"resetActiveLine",value:function(){this.$activeLine.attr("x1",-10).attr("y1",-10).attr("x2",-10).attr("y2",-10)}},{key:"__initData__REACT_HOT_LOADER__",value:function(){var e=this.props,t=e.sourceMap,a=e.sourceSrcType,n=e.addSourceKeyRow;a===X.c.HBASE&&(t.column&&0!==t.column.length||n(st))}},{key:"__loadColumnFamily__REACT_HOT_LOADER__",value:function(){var e=this.props,t=e.sourceMap,a=e.targetMap,n=e.sourceSrcType,r=e.targetSrcType,s=this,i=function(e,t){J.a.getHBaseColumnFamily(e).then(function(e){1===e.code&&t(e.data)})};n===X.c.HBASE&&i({sourceId:t.sourceId,tableName:t.type.table},function(e){s.setState({sourceColumnFamily:e})}),r===X.c.HBASE&&i({sourceId:a.sourceId,tableName:a.type.table},function(e){s.setState({targetColumnFamily:e})})}},{key:"__hbaseRowKeyChange__REACT_HOT_LOADER__",value:function(e){var t=$.a.trim(e.target.value),a=this.props,n=a.handleTargetMapChange,r=a.targetMap;t&&(r.rowkey=t,n(r))}},{key:"renderSource",value:function(){var e=this,t=this.state,a=t.w,n=t.h,r=(t.W,t.H,t.padding),s=this.props,l=s.sourceCol,o=(s.keymap,s.sourceSrcType),c=s.sourceFileType,u=s.removeSourceKeyRow,_=s.readonly,p={left:r,top:r,width:a,height:n},d=function(t,a,n){var r=g.a.createElement("div",{className:"remove-cell",onClick:function(){return u(a,n)}},g.a.createElement(Ve.a,{title:"删除当前列"},g.a.createElement(i.a,{type:"minus"})));switch(t){case X.c.HDFS:var s=a?Object(Be.a)(void 0!==a.index?a.index:"'"+a.key+"'"):"索引位";return g.a.createElement("div",null,g.a.createElement("div",{className:"cell",title:s},s),g.a.createElement("div",{className:"cell"},a?a.value?"常量":a.type.toUpperCase():"类型"),"orc"!==c?g.a.createElement("div",{className:"cell"},a?r:"操作"):"");case X.c.HBASE:var l=a?Object(Be.a)(a.key):"列名/行健",o=a?a.cf:"列族";return g.a.createElement("div",{className:"four-cells"},g.a.createElement("div",{className:"cell",title:o},o),g.a.createElement("div",{className:"cell",title:l},l),g.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"),g.a.createElement("div",{className:"cell"},a?g.a.createElement("div",null,"rowkey"===a.key?"":r,g.a.createElement("div",{className:"edit-cell",onClick:function(){e.initEditKeyRow(!0,t,null,a,n)}},g.a.createElement(Ve.a,{title:"编辑当前列"},g.a.createElement(i.a,{type:"edit"})))):"操作"));case X.c.MAXCOMPUTE:case X.c.HIVE:var _=a?Object(Be.a)(a.value?"'"+a.key+"'":a.key):"字段名称";return g.a.createElement("div",null,g.a.createElement("div",{className:"cell"},_),g.a.createElement("div",{className:"cell"},a?a.value?"常量":a.type.toUpperCase():"类型"),g.a.createElement("div",{className:"cell"},a?a.value?r:"":"操作"));case X.c.FTP:var p=a?Object(Be.a)(void 0!==a.index?a.index:"'"+a.key+"'"):"字段序号";return g.a.createElement("div",null,g.a.createElement("div",{className:"cell",title:p},p),g.a.createElement("div",{className:"cell"},a?a.value?"常量":a.type.toUpperCase():"类型"),g.a.createElement("div",{className:"cell"},a?r:"操作"));default:return g.a.createElement("div",null,g.a.createElement("div",{className:"cell",title:name},a?Object(Be.a)(a.key):"字段名称"),g.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"))}};return g.a.createElement("div",{className:"sourceLeft"},g.a.createElement("div",{className:"m-col title pa",style:p},d(o)),l.map(function(e,t){return g.a.createElement("div",{style:{width:a,height:n,left:r,top:r+n*(t+1)},className:"m-col pa",key:"sourceLeft-"+t},d(o,e,t))}),function(t){if(!_){var s="",i=g.a.createElement("span",{onClick:function(){e.setState({visibleConst:!0})}},"+添加常量");switch(t){case X.c.MAXCOMPUTE:case X.c.HIVE:s=g.a.createElement("div",null,i);break;case X.c.HBASE:s=g.a.createElement("div",null,g.a.createElement("span",{onClick:e.initAddKeyRow.bind(e,!0,c)},"+添加字段")," ",g.a.createElement("span",{onClick:e.importSourceFields},"批量添加"));break;case X.c.HDFS:s="orc"!==c?g.a.createElement("div",null,g.a.createElement("span",{onClick:e.initAddKeyRow.bind(e,!0,c)},"+添加字段")," ",i," ",g.a.createElement("span",{onClick:e.importSourceFields},"批量添加")):null;break;case X.c.FTP:s=g.a.createElement("div",null,g.a.createElement("span",{onClick:e.initAddKeyRow.bind(e,!0,c)},"+添加字段")," ",i," ",g.a.createElement("span",{onClick:e.importSourceFields},"批量添加"));break;default:s=null}return g.a.createElement("div",{className:"m-col footer pa",style:{left:r,top:r+n*(l.length+1),width:a,height:n,zIndex:100}},s)}return""}(o))}},{key:"renderTarget",value:function(){var e=this,t=this.state,a=t.w,n=t.h,r=t.W,s=(t.H,t.padding),l=this.props,o=l.targetCol,c=l.sourceCol,u=(l.keymap,l.readonly),_=l.targetMap,p=l.targetFileType,d=l.removeTargetKeyRow,m=l.sourceSrcType,E=l.targetSrcType,h={left:r-(s+a),top:s,width:a,height:n},f=function(t,a,n){var r=g.a.createElement("div",null,g.a.createElement("div",{className:"remove-cell",onClick:function(){return d(a,n)}},g.a.createElement(Ve.a,{title:"删除当前列"},g.a.createElement(i.a,{type:"minus"}))),g.a.createElement("div",{className:"edit-cell",onClick:function(){e.initEditKeyRow(!1,p,c[n],a,n)}},g.a.createElement(Ve.a,{title:"编辑当前列"},g.a.createElement(i.a,{type:"edit"}))));switch(t){case X.c.HDFS:return g.a.createElement("div",null,g.a.createElement("div",{className:"cell"},a?Object(Be.a)(a.key):"字段名称"),g.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"),g.a.createElement("div",{className:"cell"},a?r:"操作"));case X.c.HBASE:return g.a.createElement("div",{className:"four-cells"},g.a.createElement("div",{className:"cell"},a?a.cf:"列族"),g.a.createElement("div",{className:"cell"},a?Object(Be.a)(a.key):"列名"),g.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"),g.a.createElement("div",{className:"cell"},a?r:"操作"));case X.c.FTP:return g.a.createElement("div",null,g.a.createElement("div",{className:"cell"},a?Object(Be.a)(a.key):"字段名称"),g.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"),g.a.createElement("div",{className:"cell"},a?r:"操作"));default:return g.a.createElement("div",null,g.a.createElement("div",{className:"cell"},a?Object(Be.a)(a.key):"字段名称"),g.a.createElement("div",{className:"cell"},a?a.type.toUpperCase():"类型"))}};return g.a.createElement("div",{className:"targetRight"},g.a.createElement("div",{className:"m-col title  pa",style:h},f(E)),o.map(function(e,t){return g.a.createElement("div",{key:"targetRight-"+t,className:"m-col pa",style:{width:a,height:n,top:s+n*(t+1),left:r-(s+a)}},f(E,e,t))}),function(t){if(!u){var i="";switch(t){case X.c.HBASE:i=g.a.createElement("div",null,g.a.createElement("span",{onClick:e.initAddKeyRow.bind(e,!1,p)},"+添加字段")," ",g.a.createElement("span",{onClick:e.importFields},"批量添加"),g.a.createElement("div",{className:"m-col"},"rowkey: ",g.a.createElement(w.a,{style:{width:"160px"},defaultValue:_.type&&_.type.rowkey||"",placeholder:m===X.c.HBASE?"$(colFamily1:colName1)":"$(colName)",onChange:e.hbaseRowKeyChange})));break;case X.c.HDFS:case X.c.FTP:i=g.a.createElement("div",null,g.a.createElement("span",{onClick:e.initAddKeyRow.bind(e,!1,p)},"+添加字段")," ",g.a.createElement("span",{onClick:e.importFields},"批量添加"));break;default:i=null}return i?g.a.createElement("div",{className:"m-col footer pa",style:{top:s+n*(o.length+1),left:r-(s+a),width:a,height:n,zIndex:100}},i):""}return""}(E))}},{key:"__renderKeyModal__REACT_HOT_LOADER__",value:function(){var e=this.state,t=e.keyModal,a=e.keyModalVisible,n=e.sourceColumnFamily,r=e.targetColumnFamily,s=t.operation,i=t.isReader,l=this.props,o=l.sourceSrcType,c=l.targetSrcType,u=t.isReader?o:c,_=this.doAddkeyRow,p="添加HDFS字段";return"add"===s?u===X.c.HBASE?p="添加HBase字段":u===X.c.FTP&&(p="添加FTP字段"):"edit"===s&&(_=this.doEditKeyRow,p="修改HDFS字段",u===X.c.HBASE?p="修改HBase字段":u===X.c.FTP&&(p="添加FTP字段")),g.a.createElement(Ze,{title:p,visible:a,keyModal:t,dataType:u,sourceColumnFamily:n,targetColumnFamily:r,onOk:_,onCancel:this.hideKeyModal,key:i?"source-"+u+"-"+o:"target-"+u+"-"+c})}},{key:"__renderBatchModal__REACT_HOT_LOADER__",value:function(){var e=this.state,t=e.batchModal,a=e.batchSourceModal,n=e.sourceColumnFamily,r=e.targetColumnFamily,s=this.props,i=s.sourceSrcType,l=s.targetSrcType,o=void 0,c=void 0,u=void 0,_=void 0;switch(i){case X.c.FTP:case X.c.HDFS:o="0: STRING, 1: INTEGER,...",c="index: type, index: type";break;case X.c.HBASE:o="cf1: field1: STRING, cf1: field2: INTEGER,...",c="columnFamily: fieldName: type,"}switch(l){case X.c.FTP:case X.c.HDFS:u="field1: STRING, field2: INTEGER,...",_="fieldName: type, fieldName: type";break;case X.c.HBASE:u=o,_=c}return[g.a.createElement(tt,{key:"sourceBatchAdd",title:"批量添加源表字段",desc:c,columnFamily:n,placeholder:o,visible:a.visible,value:a.batchText,onOk:this.doBatchAddSourceFields,onCancel:this.hideBatchSourceModal,onChange:this.batchSourceTextChange}),g.a.createElement(tt,{key:"targetBatchAdd",title:"批量添加目标字段",desc:_,columnFamily:r,placeholder:u,visible:t.visible,value:t.batchText,onOk:this.doBatchImport,onCancel:this.hideBatchImportModal,onChange:this.batchTextChange})]}},{key:"render",value:function(){var e=this,t=this.state,a=t.w,n=t.h,s=t.W,i=t.padding,l=t.visibleConst,c=this.props,u=c.targetCol,_=c.sourceCol,p=(c.keymap,c.sourceSrcType),d=c.navtoStep,m=c.targetSrcType,E=c.addSourceKeyRow,h=n*(Math.max(u.length,_.length)+1);return g.a.createElement("div",null,g.a.createElement("p",{style:{fontSize:12,color:"#ccc",marginTop:-20}},"您要配置来源表与目标表的字段映射关系，通过连线将待同步的字段左右相连，也可以通过同行映射、同名映射批量完成映射"),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"20"},g.a.createElement("div",{className:"m-keymapbox",ref:function(t){return e.container=t},style:{width:s,minHeight:h+20}},this.renderSource(),this.renderTarget(),g.a.createElement("svg",{ref:function(t){return e.canvas=t},width:s>2*a?s-2*a:0,height:h,className:"pa m-keymapcanvas",style:{left:a,top:i}},g.a.createElement("defs",null,g.a.createElement("marker",{id:"arrow",markerUnits:"strokeWidth",markerWidth:"12",markerHeight:"12",viewBox:"0 0 12 12",refX:"6",refY:"6",orient:"auto"},g.a.createElement("path",{d:"M2,3 L9,6 L2,9 L2,6 L2,3",style:{fill:"#2491F7"}}))),g.a.createElement("g",null,g.a.createElement("line",{id:"activeLine",x1:"-10",y1:"-10",x2:"-10",y2:"-10",stroke:"#2491F7",strokeWidth:"2",markerEnd:"url(#arrow)"}))))),g.a.createElement(o.a,{span:"4"},this.props.readonly?null:g.a.createElement("div",{className:"m-buttons"},g.a.createElement(I.a,{type:this.state.rowMap?"primary":"default",onClick:this.setRowMap.bind(this)},this.state.rowMap?"取消同行映射":"同行映射"),g.a.createElement("br",null),g.a.createElement(I.a,{disabled:it(p),type:this.state.nameMap?"primary":"default",onClick:this.setNameMap.bind(this)},this.state.nameMap?"取消同名映射":"同名映射"),g.a.createElement("br",null),it(m)?g.a.createElement(I.a,{onClick:function(){e.copySourceCols(_)}},"拷贝源字段"):""))),this.renderKeyModal(),this.renderBatchModal(),g.a.createElement(at,{visible:l,onOk:E,onCancel:function(){e.setState({visibleConst:!1})}}),!this.props.readonly&&g.a.createElement("div",{className:"steps-action",style:{marginTop:80}},g.a.createElement(I.a,{style:{marginRight:8},onClick:function(){return e.prev(d)}},"上一步"),g.a.createElement(I.a,{type:"primary",onClick:function(){return e.next(d)}},"下一步")))}},{key:"prev",value:function(e){e.call(null,1)}},{key:"next",value:function(e){var t=this.props,a=t.keymap,n=t.targetSrcType,r=a.source,s=a.target;0!==r.length||0!==s.length?(n!==X.c.HBASE||this.checkHBaseRowKey())&&e.call(null,3):j.a.error("尚未配置数据同步的字段映射！")}},{key:"__checkHBaseRowKey__REACT_HOT_LOADER__",value:function(e){var t=this.props,a=t.keymap,n=t.targetMap,r=t.sourceSrcType,s=n.type,i=a.source;if(s&&s.rowkey){var l=function(){var e=[];if(r===X.c.HBASE)for(var t=s.rowkey.match(/([\w]+:[\w]+)/g),a=function(e){var a=t[e].split(":");if(a&&2===a.length&&!i.find(function(e){return e.cf===a[0]&&e.key===a[1]}))return j.a.error("目标表rowkey在源表中并不存在！"),{v:{v:!1}}},n=0;n<t.length;n++){var l=a(n);if("object"===(void 0===l?"undefined":Me()(l)))return l.v}else{for(var o=/\$\(([\w]+)\)/g,c=void 0;null!==(c=o.exec(s.rowkey));)e.push(c[1]);var u=function(t){if(!(Object(b.isObject)(i[0])?i.find(function(a){return""+(void 0!==a.key?a.key:a.index)==""+e[t]?a:void 0}):i.find(function(a){return a===e[t]})))return j.a.error("rowkey在已映射的字段中并未找到"+e[t]+"！"),{v:{v:!1}}};for(n=0;n<e.length;n++){var _=u(n);if("object"===(void 0===_?"undefined":Me()(_)))return _.v}}return{v:!0}}();if("object"===(void 0===l?"undefined":Me()(l)))return l.v}else if(!s.rowkey)return j.a.error("目标表rowkey不能为空！"),!1}},{key:"__copySourceCols__REACT_HOT_LOADER__",value:function(e){(0,this.props.addBatchTargetKeyRow)(e&&e.map(function(e){return{key:e.key||e.index,type:e.type}}))}},{key:"__batchTextChange__REACT_HOT_LOADER__",value:function(e){this.state.batchModal;this.setState({batchModal:{visible:!0,batchText:e.target.value}})}},{key:"__batchSourceTextChange__REACT_HOT_LOADER__",value:function(e){this.state.batchSourceModal;this.setState({batchSourceModal:{visible:!0,batchText:e.target.value}})}},{key:"__doBatchImport__REACT_HOT_LOADER__",value:function(){var e=this.state.batchModal.batchText,t=this.props,a=t.addBatchTargetKeyRow,n=t.targetSrcType,r=$.a.trim(e).split(","),s=[];switch(n){case X.c.FTP:case X.c.HDFS:for(var i=0;i<r.length;i++){var l=r[i];if(l){var o=l.split(":"),c=o[0],u=o[1];if(!X.u.includes(u))return void j.a.error("字段"+c+"的数据类型错误！");s.push({key:c,type:u})}}break;case X.c.HBASE:for(var _=0;_<r.length;_++){var p=r[_];if(p){var d=p.split(":"),m=$.a.trim(d[0]),E=$.a.trim(d[1]),h=$.a.trim(d[2]);if(!X.u.includes(h))return void j.a.error("字段"+E+"的数据类型错误！");s.push({cf:m,key:E,type:h})}}}a(s),this.hideBatchImportModal()}},{key:"__hideBatchImportModal__REACT_HOT_LOADER__",value:function(){this.setState({batchModal:{visible:!1,batchText:""}})}},{key:"__hideBatchSourceModal__REACT_HOT_LOADER__",value:function(){this.setState({batchSourceModal:{visible:!1,batchText:""}})}},{key:"__importFields__REACT_HOT_LOADER__",value:function(){this.setState({batchModal:{visible:!0}})}},{key:"__importSourceFields__REACT_HOT_LOADER__",value:function(){this.setState({batchSourceModal:{visible:!0}})}},{key:"__doBatchAddSourceFields__REACT_HOT_LOADER__",value:function(){var e=this.state.batchSourceModal.batchText,t=this.props,a=t.addBatchSourceKeyRow,n=t.sourceSrcType,r=(t.sourceCol,$.a.trim(e),e.split(",")),s=[];switch(n){case X.c.FTP:case X.c.HDFS:for(var i=function(e){var t=r[e];if(!t)return"continue";var a=t.split(":"),n=parseInt($.a.trim(a[0]),10),i=$.a.trim(a[1]);return Object(b.isNaN)(n)||!Object(b.isNumber)(n)?(j.a.error("索引名称应该为整数数字！"),{v:void 0}):X.u.includes(i)?void(s.find(function(e){return e.index===n})||s.push({index:n,type:i})):(j.a.error("字段"+n+"的数据类型错误！"),{v:void 0})},l=0;l<r.length;l++){var o=i(l);switch(o){case"continue":continue;default:if("object"===(void 0===o?"undefined":Me()(o)))return o.v}}break;case X.c.HBASE:s.push(st);for(l=0;l<r.length;l++){var c=r[l];if(c){var u=c.split(":"),_=$.a.trim(u[0]),p=$.a.trim(u[1]),d=$.a.trim(u[2]);if(!X.u.includes(d))return void j.a.error("字段"+p+"的数据类型错误！");s.push({cf:_,key:p,type:d})}}}a(s),this.hideBatchSourceModal()}},{key:"setRowMap",value:function(){var e,t=this.state,a=t.rowMap,n=t.nameMap,r=this.props,s=r.targetCol,i=r.sourceCol,l=r.sourceSrcType,o=r.targetSrcType;a?this.props.resetLinkedKeys():this.props.setRowMap({sourceCol:(e=i,lt(l)&&(e=e.map(function(e){return e.key})),e),targetCol:function(e){return lt(o)&&(e=e.map(function(e){return e.key})),e}(s)}),this.setState({rowMap:!a,nameMap:n?!n:n})}},{key:"setNameMap",value:function(){var e=this.state,t=e.nameMap,a=e.rowMap,n=this.props,r=n.targetCol,s=n.sourceCol,i=n.targetSrcType;t?this.props.resetLinkedKeys():this.props.setNameMap({sourceCol:s,targetCol:r,targetSrcType:i}),this.setState({nameMap:!t,rowMap:a?!a:a})}},{key:"initAddKeyRow",value:function(e,t){this.setState({keyModalVisible:!0,keyModal:{operation:"add",isReader:e,fileType:t}})}},{key:"__initEditKeyRow__REACT_HOT_LOADER__",value:function(e,t,a,n,r){this.setState({keyModalVisible:!0,keyModal:{operation:"edit",isReader:e,fileType:t,editField:n,position:r,source:a}})}},{key:"__doAddkeyRow__REACT_HOT_LOADER__",value:function(e){var t=this.state.keyModal.isReader,a=this.props,n=a.addSourceKeyRow,r=a.addTargetKeyRow;e&&(t?n(e):r(e),this.hideKeyModal())}},{key:"__doEditKeyRow__REACT_HOT_LOADER__",value:function(e){var t=this.props,a=t.editSourceKeyRow,n=t.editTargetKeyRow,r=t.editKeyMapTarget,s=this.state.keyModal,i=s.isReader,l=s.position,o=(s.source,s.editField);e&&(i?a(e):(n({index:l,value:e}),r({old:o,replace:e})),this.hideKeyModal())}},{key:"__hideKeyModal__REACT_HOT_LOADER__",value:function(){this.setState({keyModalVisible:!1,keyModal:{operation:"add",editField:"",source:""}})}}]),t}(g.a.Component),ut=function(e){var t=e.offlineTask.dataSync;return{sourceMap:t.sourceMap,targetMap:t.targetMap,targetCol:t.targetMap.column||[],targetSrcType:t.targetMap.type&&t.targetMap.type.type,targetFileType:t.sourceMap.type&&t.targetMap.type.fileType,sourceCol:t.sourceMap.column||[],sourceSrcType:t.sourceMap.type&&t.sourceMap.type.type,sourceFileType:t.sourceMap.type&&t.sourceMap.type.fileType,keymap:t.keymap}},_t=Object(k.b)(ut,Ke.a)(ct),pt=_t,dt=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(nt,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/index.js"),__REACT_HOT_LOADER__.register(rt,"Option","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/index.js"),__REACT_HOT_LOADER__.register(st,"DefaultRowKey","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/index.js"),__REACT_HOT_LOADER__.register(it,"isHdfsType","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/index.js"),__REACT_HOT_LOADER__.register(lt,"isRDB","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/index.js"),__REACT_HOT_LOADER__.register(ot,"isFieldMatch","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/index.js"),__REACT_HOT_LOADER__.register(ct,"Keymap","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/index.js"),__REACT_HOT_LOADER__.register(ut,"mapState","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/index.js"),__REACT_HOT_LOADER__.register(_t,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/keymap/index.js")),a(80),a(46)),mt=a.n(dt),Et=(a(1473),a(1470)),ht=a.n(Et),ft=a(144),yt=q.a.Item,Tt=_e.a.Option,gt=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.state={isRecord:!1},a.onLifeDayChange=function(){return a.__onLifeDayChange__REACT_HOT_LOADER__.apply(a,arguments)},a}return y()(t,e),m()(t,[{key:"__onLifeDayChange__REACT_HOT_LOADER__",value:function(e){this.props.changeChannelSetting({lifeDay:e})}},{key:"render",value:function(){for(var e=this,t=this.props.form.getFieldDecorator,a=this.props,n=a.setting,r=(a.changeChannelSetting,a.navtoStep),s=(a.form,{labelCol:{sm:{span:6}},wrapperCol:{sm:{span:14}}}),i=[],l=[],o=1;o<=20;o++)i.push(g.a.createElement(Tt,{value:""+o,key:o},o,"MB/s"));for(var c=1;c<=5;c++)l.push(g.a.createElement(Tt,{value:""+c,key:c},c));return g.a.createElement("div",{className:"g-step4"},g.a.createElement(q.a,null,g.a.createElement(yt,x()({},s,{label:"作业速率上限",style:{height:"32px"}}),t("speed",{rules:[{required:!0}],initialValue:""+n.speed})(g.a.createElement(ht.a,{dataSource:i,optionLabelProp:"value"},g.a.createElement(w.a,{suffix:"MB/s"}))),g.a.createElement(me.a,{doc:"jobSpeedLimit"})),g.a.createElement(yt,x()({},s,{label:"作业并发数",style:{height:"32px"}}),t("channel",{rules:[{required:!0}],initialValue:""+n.channel})(g.a.createElement(ht.a,{dataSource:l,optionLabelProp:"value"})),g.a.createElement(me.a,{doc:"jobConcurrence"})),g.a.createElement(yt,x()({},s,{label:"错误记录管理",className:"txt-left"}),t("isSaveDirty",{rules:[],initialValue:n.isSaveDirty})(g.a.createElement(mt.a,{checked:n.isSaveDirty}," 记录保存 ")),g.a.createElement(me.a,{doc:"recordDirtyData"})),n.isSaveDirty?g.a.createElement("div",null,g.a.createElement(yt,x()({},s,{label:"脏数据写入hive表"}),t("tableName",{rules:[],initialValue:n.tableName||null})(g.a.createElement(w.a,{placeholder:"默认系统分配"})),g.a.createElement(me.a,{doc:"recordDirtyData"})),g.a.createElement(yt,x()({},s,{label:"脏数据存储生命周期",className:"txt-left"}),t("lifeDay",{rules:[{required:!0,message:"生命周期不可为空！"}],initialValue:n.lifeDay||90})(g.a.createElement(w.a,{type:"hidden"})),g.a.createElement(ft.a,{value:n.lifeDay,width:120,onChange:this.onLifeDayChange}),g.a.createElement(me.a,{doc:"recordDirtyData"}))):"",g.a.createElement(yt,x()({},s,{label:"错误记录数超过"}),t("record",{rules:[],initialValue:n.record})(g.a.createElement(Ge.a,{style:{float:"left"}})),g.a.createElement("span",{style:{float:"left"}},"条, 任务自动结束",g.a.createElement(me.a,{doc:"errorCount",style:{position:"initial",marginLeft:"6px"}}))),g.a.createElement(yt,x()({},s,{label:"错误记录比例配置"}),g.a.createElement("span",{style:{float:"left"}},"任务执行结束后，统计错误记录占比，大于"),t("percentage",{rules:[],initialValue:n.percentage})(g.a.createElement(Ge.a,{style:{float:"left"}})),g.a.createElement("span",{style:{float:"left"}},"%时，任务置为失败"),g.a.createElement(me.a,{doc:"errorPercentConfig",style:{position:"initial",marginLeft:"6px"}}))),!this.props.readonly&&g.a.createElement("div",{className:"steps-action"},g.a.createElement(I.a,{style:{marginRight:8},onClick:function(){return e.prev(r)}},"上一步"),g.a.createElement(I.a,{type:"primary",onClick:function(){return e.next(r)}},"下一步")))}},{key:"prev",value:function(e){e.call(null,2)}},{key:"next",value:function(e){var t=this.props,a=t.changeChannelSetting;t.form.validateFields(function(t,n){t||(e.call(null,4),a(n))})}}]),t}(g.a.Component),kt=q.a.create({onValuesChange:function(e,t){var a=e.changeChannelSetting,n=e.setting;n.isSaveDirty&&!n.lifeDay&&(t.lifeDay=90),n.isSaveDirty||(t.tableName=null),a(t)}})(gt),bt=function(e){function t(){return p()(this,t),h()(this,(t.__proto__||u()(t)).apply(this,arguments))}return y()(t,e),m()(t,[{key:"render",value:function(){return g.a.createElement("div",null,g.a.createElement(kt,this.props))}}]),t}(g.a.Component),vt=function(e){var t=e.offlineTask.dataSync;return{setting:t.setting,targetMap:t.targetMap}},Ot=function(e){return{changeChannelSetting:function(t){e({type:v.i.CHANGE_CHANNEL_FIELDS,payload:t}),e({type:v.o.MAKE_TAB_DIRTY})}}},Ct=Object(k.b)(vt,Ot)(bt),At=Ct,Rt=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(yt,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/channel.js"),__REACT_HOT_LOADER__.register(Tt,"Option","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/channel.js"),__REACT_HOT_LOADER__.register(gt,"ChannelForm","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/channel.js"),__REACT_HOT_LOADER__.register(kt,"ChannelFormWrap","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/channel.js"),__REACT_HOT_LOADER__.register(bt,"Channel","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/channel.js"),__REACT_HOT_LOADER__.register(vt,"mapState","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/channel.js"),__REACT_HOT_LOADER__.register(Ot,"mapDispatch","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/channel.js"),__REACT_HOT_LOADER__.register(Ct,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/channel.js")),a(56),a(29)),St=a.n(Rt);function Dt(){return g.a.createElement("div",{style:{position:"absolute",top:48,left:0,bottom:0,right:0,zIndex:3,background:"rgba(255, 255, 255, 0.4)",cursor:"not-allowed"}})}var wt,Lt,xt=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.navtoStep=a.props.navtoStep,a}return y()(t,e),m()(t,[{key:"render",value:function(){var e=this,t=this.navtoStep,a=this.props.notSynced;return g.a.createElement("div",{className:"g-step5"},g.a.createElement("div",{className:"m-preview",style:{padding:"0 20"}},g.a.createElement(St.a,{bordered:!1,style:{marginBottom:10},title:"选择来源",extra:g.a.createElement("a",{href:"javascript:void(0)",onClick:function(){return e.navtoStep(0)}},"修改")},g.a.createElement(Ce,{readonly:!0}),g.a.createElement(Dt,null)),g.a.createElement(St.a,{bordered:!1,style:{marginBottom:10},title:"选择目标",extra:g.a.createElement("a",{href:"javascript:void(0)",onClick:function(){return e.navtoStep(1)}},"修改")},g.a.createElement(Fe,{readonly:!0}),g.a.createElement(Dt,null)),g.a.createElement(St.a,{bordered:!1,style:{marginBottom:10},title:"字段映射",extra:g.a.createElement("a",{href:"javascript:void(0)",onClick:function(){return e.navtoStep(2)}},"修改")},g.a.createElement(pt,{readonly:!0}),g.a.createElement(Dt,null)),g.a.createElement(St.a,{bordered:!1,style:{marginBottom:10},title:"通道控制",extra:g.a.createElement("a",{href:"javascript:void(0)",onClick:function(){return e.navtoStep(3)}},"修改")},g.a.createElement(At,{readonly:!0}),g.a.createElement(Dt,null))),g.a.createElement("div",{className:"steps-action"},g.a.createElement(I.a,{style:{marginRight:8},onClick:function(){return e.prev(t)}},"上一步"),g.a.createElement(I.a,{type:"primary",disabled:!a,onClick:function(){return e.save(t)}},"保存")))}},{key:"prev",value:function(e){e.call(null,3)}},{key:"save",value:function(e){this.props.saveJob(e)}}]),t}(g.a.Component),Ht=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Dt,"Mask","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/save.js"),__REACT_HOT_LOADER__.register(xt,"Save","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/save.js")),ne.a.Step),Nt=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.state={currentStep:0,loading:!0},a.getJobData=function(){return a.__getJobData__REACT_HOT_LOADER__.apply(a,arguments)},a}return y()(t,e),m()(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.id;e.dataSyncSaved;this.getJobData({taskId:t}),this.props.setTabId(t),this.props.getDataSource()}},{key:"__getJobData__REACT_HOT_LOADER__",value:function(e){var t=this,a=this.props,n=(a.id,a.dataSyncSaved);J.a.getOfflineJobData(e).then(function(e){n?(t.props.getDataSyncSaved(n),t.setState({currentStep:n.currentStep.step})):t.props.initJobData(e.data),e.data?(t.props.setTabSaved(),t.setState({currentStep:4})):t.props.setTabNew(),t.setState({loading:!1})})}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.id,a=e.dataSync;this.props.saveDataSyncToTab({id:t,data:a})}},{key:"next",value:function(){this.setState({currentStep:this.state.currentStep+1})}},{key:"prev",value:function(){this.setState({currentStep:this.state.currentStep-1})}},{key:"navtoStep",value:function(e){this.setState({currentStep:e}),this.props.setCurrentStep(e)}},{key:"save",value:function(){var e=this.props,t=e.saveJobData,a=e.dataSync;t(this.generateRqtBody(a))}},{key:"generateRqtBody",value:function(e){var t=Object(b.cloneDeep)(e),a=this.props,n=a.tabs,r=a.currentTab,s=t.keymap,i=t.sourceMap,l=t.targetMap,o=s.source,c=s.target,u=this.props,_=u.name,p=u.id;t.sourceMap.column=o,t.targetMap.column=c,t.settingMap=t.setting,t.name=_,t.taskId=p;var d=l.type,m=i.type;for(var E in m)m.hasOwnProperty(E)&&(i[E]=m[E]);for(var h in d)d.hasOwnProperty(h)&&(l[h]=d[h]);delete t.keymap,delete t.setting,delete t.dataSourceList,delete t.currentStep;var f=Object(b.cloneDeep)(n.filter(function(e){return e.id===r})[0]);for(var y in t)t.hasOwnProperty(y)&&(f[y]=t[y]);return f.preSave=!0,f.taskVOS&&(f.dependencyTasks=f.taskVOS.map(function(e){return e}),f.taskVOS=null),f}},{key:"render",value:function(){var e=this.state,t=e.currentStep,a=e.loading,n=this.props,r=n.readWriteLockVO,s=n.notSynced,i=r&&!r.getLock,l=[{title:"数据来源",content:g.a.createElement(Ce,{currentStep:t,navtoStep:this.navtoStep.bind(this)})},{title:"选择目标",content:g.a.createElement(Fe,{currentStep:t,navtoStep:this.navtoStep.bind(this)})},{title:"字段映射",content:g.a.createElement(pt,{currentStep:t,navtoStep:this.navtoStep.bind(this)})},{title:"通道控制",content:g.a.createElement(At,{currentStep:t,navtoStep:this.navtoStep.bind(this)})},{title:"预览保存",content:g.a.createElement(xt,{currentStep:t,notSynced:s,navtoStep:this.navtoStep.bind(this),saveJob:this.save.bind(this)})}];return a?null:g.a.createElement("div",{className:"m-datasync"},g.a.createElement(ne.a,{current:t},l.map(function(e){return g.a.createElement(Ht,{key:e.title,title:e.title})})),g.a.createElement("div",{className:"steps-content",style:{position:"relative"}},i?g.a.createElement("div",{className:"steps-mask"}):null,l[t].content))}}]),t}(g.a.Component),Ft=function(e){var t=e.offlineTask.workbench.currentTab;return{dataSync:e.offlineTask.dataSync,tabs:e.offlineTask.workbench.tabs,currentTab:t}},It=function(e){return{getDataSource:function(){J.a.getOfflineDataSource().then(function(t){var a=[];1===t.code&&(a=t.data),e({type:v.a.LOAD_DATASOURCE,payload:a})})},initJobData:function(t){e({type:v.b.INIT_JOBDATA,payload:t})},setTabNew:function(){e({type:v.o.SET_CURRENT_TAB_NEW})},setTabSaved:function(){e({type:v.o.SET_CURRENT_TAB_SAVED})},saveDataSyncToTab:function(t){e({type:v.o.SAVE_DATASYNC_TO_TAB,payload:{id:t.id,data:t.data}})},getDataSyncSaved:function(t){e({type:v.b.GET_DATASYNC_SAVED,payload:t})},setTabId:function(t){e({type:v.b.SET_TABID,payload:t})},setCurrentStep:function(t){e({type:v.b.SET_CURRENT_STEP,payload:t})},saveJobData:function(t){J.a.saveOfflineJobData(t).then(function(t){1===t.code&&(j.a.success("保存成功！"),e({type:v.o.SET_CURRENT_TAB_SAVED}),e({type:v.o.MAKE_TAB_CLEAN}))})}}},Mt=Object(k.b)(Ft,It)(Nt),jt=Mt,Vt=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Ht,"Step","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/index.js"),__REACT_HOT_LOADER__.register(Nt,"DataSync","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/index.js"),__REACT_HOT_LOADER__.register(Ft,"mapState","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/index.js"),__REACT_HOT_LOADER__.register(It,"mapDispatch","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/index.js"),__REACT_HOT_LOADER__.register(Mt,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/index.js")),a(114)),Ut=a(142),Pt=a.n(Ut),qt=a(18),Bt=a.n(qt),Kt=a(75),Wt=q.a.Item,Gt=_e.a.Option,zt=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.state={sourceType:void 0,targetType:void 0},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"newSource",value:function(){z.g.push("/database")}},{key:"sourceTypeChange",value:function(e){var t=this.props.form.setFieldsValue;this.setState({sourceType:e},function(){t({sourceId:void 0})})}},{key:"targetTypeChange",value:function(e){var t=this.props.form.setFieldsValue;this.setState({targetType:e},function(){t({targetSourceId:void 0})})}},{key:"getSourceList",value:function(){var e=this.state.sourceType;return this.props.dataSourceList.filter(function(t){return t.type==e}).map(function(e){return g.a.createElement(Gt,{key:e.id,name:e.dataName,value:""+e.id},e.dataName,"( ",g.a.createElement(Kt.d,{value:e.type}),"  )")})}},{key:"getTargetList",value:function(){var e=this.state.targetType;return this.props.dataSourceList.filter(function(t){return t.type==e}).map(function(e){return g.a.createElement(Gt,{key:e.id,name:e.dataName,value:""+e.id},e.dataName,"( ",g.a.createElement(Kt.d,{value:e.type})," )")})}},{key:"getTemplateFromNet",value:function(){var e=this,t=this.props.form.validateFields,a=this.props.id;t(function(t,n){if(!t){var r={id:a,sourceMap:{sourceId:n.sourceId,type:n.sourceType},targetMap:{sourceId:n.targetSourceId,type:n.targetType},taskId:a};J.a.getSyncTemplate(r).then(function(t){1==t.code&&(j.a.success("导入成功"),e.props.onSuccess(t.data))})}})}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.props,a=(t.dataSourceList,t.execConfirmVisible),n=Pt()(X.c).map(function(e){var t=X.c[e];return g.a.createElement(Gt,{key:t,value:t.toString()},g.a.createElement(Kt.d,{value:t}))});return g.a.createElement(K.a,{maskClosable:!0,visible:a,title:"导入模版",onCancel:this.props.onCancel,onOk:this.getTemplateFromNet.bind(this)},g.a.createElement(q.a,null,g.a.createElement(Wt,x()({},X.t,{label:"来源类型",hasFeedback:!0}),e("sourceType",{rules:[{required:!0,message:"来源类型不可为空！"}]})(g.a.createElement(_e.a,{placeholder:"请选择来源类型",onChange:this.sourceTypeChange.bind(this)},n))),g.a.createElement(Wt,x()({style:{marginBottom:"35px"}},X.t,{label:"数据源",hasFeedback:!0}),e("sourceId",{rules:[{required:!0,message:"数据源不可为空！"}]})(g.a.createElement(_e.a,{placeholder:"请选择数据源"},this.getSourceList()))),g.a.createElement(Wt,x()({},X.t,{label:"目标类型",hasFeedback:!0}),e("targetType",{rules:[{required:!0,message:"目标类型不可为空！"}]})(g.a.createElement(_e.a,{placeholder:"请选择目标类型",onChange:this.targetTypeChange.bind(this)},n))),g.a.createElement(Wt,x()({},X.t,{label:"数据源",hasFeedback:!0}),e("targetSourceId",{rules:[{required:!0,message:"数据源不可为空！"}]})(g.a.createElement(_e.a,{placeholder:"请选择目标数据源"},this.getTargetList())))))}}]),t}(T.Component),Yt=q.a.create()(zt),Qt=Object(k.b)(function(e){return{dataSourceList:e.offlineTask.dataSync.dataSourceList}},function(e){return{getDataSource:function(){J.a.getOfflineDataSource().then(function(t){var a=[];1===t.code&&(a=t.data),e({type:v.a.LOAD_DATASOURCE,payload:a})})}}})(wt=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.state={execConfirmVisible:!1},n.sqlFormat=function(){var e;return(e=n).__sqlFormat__REACT_HOT_LOADER__.apply(e,arguments)},n.onSuccess=function(){var e;return(e=n).__onSuccess__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"componentDidMount",value:function(){(0,this.props.getDataSource)()}},{key:"importTemplate",value:function(){this.setState({execConfirmVisible:!0})}},{key:"__sqlFormat__REACT_HOT_LOADER__",value:function(){var e=this.props,t=e.sqlText,a=e.dispatch,n={merged:!0};n.sqlText=$.a.jsonFormat(t),n.sqlText?a({type:v.o.SET_TASK_SQL_FIELD_VALUE,payload:n}):j.a.error("您的JSON格式有误")}},{key:"__onSuccess__REACT_HOT_LOADER__",value:function(e){var t=this.props.dispatch,a={merged:!0};a.sqlText=$.a.jsonFormat(e),this.setState({execConfirmVisible:!1}),t({type:v.o.SET_TASK_SQL_FIELD_VALUE,payload:a})}},{key:"render",value:function(){var e=this,t=this.state.execConfirmVisible;this.props.currentTabData;return g.a.createElement("div",{className:"ide-toolbar toolbar",style:{position:"relative"}},g.a.createElement(I.a,{onClick:this.importTemplate.bind(this),title:"导入模版",icon:"plus-circle-o",style:{marginLeft:"0px"}},"导入模版"),g.a.createElement(I.a,{icon:"appstore-o",title:"格式化",onClick:this.sqlFormat},"格式化"),g.a.createElement("span",{style:{float:"right",position:"relative",marginRight:"18px",lineHeight:"28px",zIndex:"901"}},g.a.createElement(i.a,{style:{color:"#2491F7",marginRight:"2px"},type:"question-circle-o"}),g.a.createElement("a",{href:X.h.DATA_SYNC,target:"blank"},"帮助文档")),g.a.createElement(Yt,x()({execConfirmVisible:t,onCancel:function(){e.setState({execConfirmVisible:!1})},onSuccess:this.onSuccess.bind(this)},this.props)))}}]),t}(T.Component))||wt,$t=Qt,Jt=$t,Xt=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Wt,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/dataSyncScript/toolbar.js"),__REACT_HOT_LOADER__.register(Gt,"Option","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/dataSyncScript/toolbar.js"),__REACT_HOT_LOADER__.register(zt,"ImportTemplateForm","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/dataSyncScript/toolbar.js"),__REACT_HOT_LOADER__.register(Yt,"WrapTemplateForm","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/dataSyncScript/toolbar.js"),__REACT_HOT_LOADER__.register(Qt,"SyncToolbar","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/dataSyncScript/toolbar.js"),__REACT_HOT_LOADER__.register($t,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/dataSyncScript/toolbar.js")),a(118)),Zt=Object(k.b)(function(e){return{project:e.project,user:e.user}},function(e){return{dispatch:e,updateTaskFields:function(t){e({type:v.o.SET_TASK_FIELDS_VALUE,payload:t})},setSelection:function(t){e(Object(Xt.i)(t))},getTab:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(t){e(getTab(t))})}})(Lt=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.handleEditorTxtChange=function(){var e;return(e=n).__handleEditorTxtChange__REACT_HOT_LOADER__.apply(e,arguments)},n.onEditorSelection=function(){var e;return(e=n).__onEditorSelection__REACT_HOT_LOADER__.apply(e,arguments)},n.debounceChange=Object(b.debounce)(n.handleEditorTxtChange,300,{maxWait:2e3}),r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"__handleEditorTxtChange__REACT_HOT_LOADER__",value:function(e,t,a){var n=this.props,r=n.taskType,s=n.taskCustomParams,i={merged:!1,cursor:a.getCursor()};$.a.checkExist(r)&&(i.sqlText=t,i.taskVariables=Object(Ee.e)(s,t)),this.props.updateTaskFields(i)}},{key:"__onEditorSelection__REACT_HOT_LOADER__",value:function(e,t){var a=t.getSelection();t.somethingSelected()?this.props.setSelection(a):""!==this.props.sqlEditor.selection&&this.props.setSelection("")}},{key:"render",value:function(){var e=this.props,t=e.merged,a=e.sqlText,n=e.cursor,r=$.a.jsonFormat(a);return g.a.createElement("div",{className:"ide-sql"},g.a.createElement("div",{className:"ide-header bd-bottom"},g.a.createElement(Jt,this.props)),g.a.createElement("div",{className:"ide-content"},g.a.createElement("div",{className:"ide-editor bd-bottom"},g.a.createElement(Vt.a,{key:"jsonEditor",sync:t||void 0,options:X.v,cursor:n,onChange:this.debounceChange,value:r}))))}}]),t}(T.Component))||Lt,ea=Zt,ta=ea,aa=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Zt,"DataSyncScript","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/dataSyncScript/index.js"),__REACT_HOT_LOADER__.register(ea,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataSync/dataSyncScript/index.js")),a(379)),na=q.a.Item,ra=_e.a.Option,sa=ce.a.Group,ia=function(e){function t(){return p()(this,t),h()(this,(t.__proto__||u()(t)).apply(this,arguments))}return y()(t,e),m()(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=this.props,a=t.taskType,n=a===X.q.MR,r=a===X.q.PYTHON,s=n?X.l.JAR:r?X.l.PY:"";return g.a.createElement(q.a,null,g.a.createElement(na,x()({},X.t,{label:"任务名称"}),e("name",{rules:[{max:64,message:"任务名称不得超过20个字符！"}],initialValue:t.name})(g.a.createElement(w.a,{disabled:!0}))),g.a.createElement(na,x()({},X.t,{label:"任务类型"}),e("taskType",{rules:[{}],initialValue:a})(g.a.createElement(sa,{disabled:!0,onChange:this.handleRadioChange},g.a.createElement(ce.a,{value:X.q.SQL},"SQL"),g.a.createElement(ce.a,{value:X.q.MR},"MR"),g.a.createElement(ce.a,{value:X.q.SYNC},"数据同步"),g.a.createElement(ce.a,{value:X.q.PYTHON},"Python"),g.a.createElement(ce.a,{value:X.q.VIRTUAL_NODE},"虚节点")))),a!==X.q.VIRTUAL_NODE&&g.a.createElement(na,x()({},X.t,{label:"资源"}),e("resourceIdList",{rules:[{required:!0,message:"请选择关联资源"}],initialValue:t.resourceList.length?t.resourceList[0].id:""})(g.a.createElement(w.a,{type:"hidden"})),g.a.createElement(aa.a,{ispicker:!0,isFilepicker:!0,acceptRes:s,type:X.j.RESOURCE,treeData:this.props.resTreeData,onChange:this.handleResChange.bind(this),defaultNode:t.resourceList.length?t.resourceList[0].resourceName:""})),a!==X.q.PYTHON&&a!==X.q.VIRTUAL_NODE&&g.a.createElement(na,x()({},X.t,{label:"mainClass",hasFeedback:!0}),e("mainClass",{rules:[{required:!0,message:"mainClass 不可为空！"}],initialValue:t.mainClass})(g.a.createElement(w.a,{placeholder:"请输入 mainClass"}))),a!==X.q.VIRTUAL_NODE&&g.a.createElement("span",null,g.a.createElement(na,x()({},X.t,{label:"参数"}),e("exeArgs",{initialValue:t.exeArgs})(g.a.createElement(w.a,{placeholder:"请输入任务参数"}))),g.a.createElement(na,x()({},X.t,{label:"存储位置"}),e("nodePid",{rules:[{required:!0,message:"存储位置必选！"}],initialValue:t.nodePid})(g.a.createElement(w.a,{type:"hidden"})),g.a.createElement(aa.a,{type:X.j.TASK,ispicker:!0,isFilepicker:!1,treeData:this.props.pathTreeData,onChange:this.handlePathChange.bind(this),defaultNode:t.nodePName}))),g.a.createElement(na,x()({},X.t,{label:"描述",hasFeedback:!0}),e("taskDesc",{rules:[{max:200,message:"描述请控制在200个字符以内！"}],initialValue:t.taskDesc})(g.a.createElement(w.a,{type:"textarea",rows:4,placeholder:"请输入任务描述"}))),g.a.createElement(na,{style:{display:"none"}},e("computeType",{initialValue:1})(g.a.createElement(w.a,{type:"hidden"}))))}},{key:"handleResChange",value:function(e){this.props.form.setFieldsValue({resourceIdList:[e]})}},{key:"handlePathChange",value:function(e){this.props.form.setFieldsValue({nodePid:e})}}]),t}(g.a.Component),la=q.a.create({onValuesChange:function(e,t){var a=e.setFieldsValue,n=e.taskCustomParams,r=!1;""===t.mainClass&&(r=!0),t.invalid=r,""!==t.exeArgs&&(t.taskVariables=Object(Ee.e)(n,t.exeArgs)),a(t)}})(ia),oa=function(e){function t(e){return p()(this,t),h()(this,(t.__proto__||u()(t)).call(this,e))}return y()(t,e),m()(t,[{key:"render",value:function(){return g.a.createElement("div",{className:"m-taskedit",style:{padding:60}},g.a.createElement(la,this.props))}}]),t}(g.a.Component),ca=function(e,t){var a=e.offlineTask;return{resTreeData:a.resourceTree,pathTreeData:a.taskTree,taskCustomParams:a.workbench.taskCustomParams}},ua=function(e){return{setFieldsValue:function(t){e({type:v.o.SET_TASK_FIELDS_VALUE,payload:t})}}},_a=Object(k.b)(ca,ua)(oa),pa=_a,da=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(na,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/normalTask.js"),__REACT_HOT_LOADER__.register(ra,"Option","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/normalTask.js"),__REACT_HOT_LOADER__.register(sa,"RadioGroup","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/normalTask.js"),__REACT_HOT_LOADER__.register(ia,"NormalTaskForm","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/normalTask.js"),__REACT_HOT_LOADER__.register(la,"NormalTaskFormWrapper","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/normalTask.js"),__REACT_HOT_LOADER__.register(oa,"NormalTaskEditor","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/normalTask.js"),__REACT_HOT_LOADER__.register(ca,"mapState","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/normalTask.js"),__REACT_HOT_LOADER__.register(ua,"mapDispatch","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/normalTask.js"),__REACT_HOT_LOADER__.register(_a,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/normalTask.js")),a(73)),ma=a(195),Ea=a(705),ha=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.state={confirmCode:"",execConfirmVisible:!1},n.onNeverWarning=function(){var e;return(e=n).__onNeverWarning__REACT_HOT_LOADER__.apply(e,arguments)},n.filterSql=function(){var e;return(e=n).__filterSql__REACT_HOT_LOADER__.apply(e,arguments)},n.execSQL=function(){var e;return(e=n).__execSQL__REACT_HOT_LOADER__.apply(e,arguments)},n.reqExecSQL=function(){var e;return(e=n).__reqExecSQL__REACT_HOT_LOADER__.apply(e,arguments)},n.stopSQL=function(){var e;return(e=n).__stopSQL__REACT_HOT_LOADER__.apply(e,arguments)},n.execConfirm=function(){var e;return(e=n).__execConfirm__REACT_HOT_LOADER__.apply(e,arguments)},n.sqlFormat=function(){var e;return(e=n).__sqlFormat__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"__onNeverWarning__REACT_HOT_LOADER__",value:function(e){var t=e.target.checked?1:0;this.props.dispatch(Object(ma.e)({isCheckDDL:t}))}},{key:"__filterSql__REACT_HOT_LOADER__",value:function(e){var t=[],a=Object(da.b)(e);if(a&&(a=Object(da.h)(a)),a&&a.length>0)for(var n=0;n<a.length;n++){var r=a[n];""!==$.a.trim(r)&&t.push($.a.trimlr(r))}return t}},{key:"__execSQL__REACT_HOT_LOADER__",value:function(){var e=this.props,t=e.currentTab,a=e.sqlEditor,n=e.user,r=e.currentTabData,s=e.project,i=e.dispatch,l={projectId:s.id,isCheckDDL:n.isCheckDDL,taskVariables:r.taskVariables};this.setState({execConfirmVisible:!1});var o=a.selection||r.sqlText||r.scriptText,c=this.filterSql(o);if(c&&c.length>0){i(Object(Xt.h)(t,"正在提交...")),i(Object(Xt.a)(t)),this.reqExecSQL(r,l,c,0)}}},{key:"__reqExecSQL__REACT_HOT_LOADER__",value:function(e,t,a,n){var r=this.props,s=r.dispatch,i=r.currentTab;s(Object(Ea.a)(i,e,t,a))}},{key:"__stopSQL__REACT_HOT_LOADER__",value:function(){var e=this.props,t=e.currentTabData,a=e.dispatch,n=e.currentTab;a(Object(Ea.b)(n,t))}},{key:"__execConfirm__REACT_HOT_LOADER__",value:function(){var e=this.props,t=e.currentTabData,a=e.user,n=e.sqlEditor;if(this.props.changeTab(1),1!==a.isCheckDDL){var r=n.selection||t.sqlText||t.scriptText,s=(r=Object(da.b)(r)).replace(/show\s+create/gi,"show");/(create|alter|drop|truncate)+\s+(external|temporary)?\s?(table)+\s+([\s\S]*?)/gi.test(s)?this.setState({execConfirmVisible:!0,confirmCode:r}):(this.execSQL(),this.setState({execConfirmVisible:!1}))}else this.execSQL()}},{key:"__sqlFormat__REACT_HOT_LOADER__",value:function(){var e=this.props,t=e.currentTabData,a=e.dispatch,n={sql:t.sqlText||t.scriptText||""};J.a.sqlFormat(n).then(function(e){if(e.data){var n={merged:!0};t.scriptText?n.scriptText=e.data:n.sqlText=e.data,a({type:v.o.SET_TASK_SQL_FIELD_VALUE,payload:n})}})}},{key:"getUniqueKey",value:function(e){return e+"_"+Bt()().valueOf()}},{key:"render",value:function(){var e=this,t=this.state,a=t.execConfirmVisible,n=t.confirmCode,r=this.props,s=r.currentTab,i=r.sqlEditor.running.indexOf(s)>-1;return g.a.createElement("div",{className:"ide-toolbar toolbar clear-offset"},g.a.createElement(I.a,{onClick:this.execConfirm,loading:i,disabled:i,title:"立即运行",icon:"play-circle-o",style:{marginLeft:"0px"}}," ","运行"),g.a.createElement(I.a,{onClick:this.stopSQL,icon:"pause-circle-o",title:"立即停止",disabled:!i},"停止"),g.a.createElement(I.a,{icon:"appstore-o",title:"格式化",onClick:this.sqlFormat},"格式化"),g.a.createElement(K.a,{maskClosable:!0,visible:a,title:"执行的语句中包含DDL语句，是否确认执行？",wrapClassName:"vertical-center-modal modal-body-nopadding",onCancel:function(){e.setState({execConfirmVisible:!1})},footer:g.a.createElement("div",null,g.a.createElement(mt.a,{onChange:this.onNeverWarning},"不再提示"),g.a.createElement(I.a,{onClick:function(){e.setState({execConfirmVisible:!1})}},"取消"),g.a.createElement(I.a,{type:"primary",onClick:this.execSQL},"执行"))},g.a.createElement("div",{style:{height:"400px"}},g.a.createElement(Vt.a,{value:n,sync:!0}))))}}]),t}(T.Component),fa=("undefined"!=typeof __REACT_HOT_LOADER__&&__REACT_HOT_LOADER__.register(ha,"Toolbar","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/sqlEditor/toolbar.js"),a(28)),ya=G.a.TabPane,Ta={mode:"text/x-sql",lineNumbers:!1,readOnly:!0,autofocus:!1,indentWithTabs:!0,smartIndent:!0},ga={position:"absolute",bottom:"0px",height:"30px"},ka=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.state={currentPage:1},n.onChange=function(){var e;return(e=n).__onChange__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"__onChange__REACT_HOT_LOADER__",value:function(e){this.setState({currentPage:e.current})}},{key:"generateCols",value:function(e){var t=this.state.currentPage;if(e&&e.length>0){var a=[{title:"序号",key:"t-id",render:function(e,a,n){return 10*(t-1)+(n+1)}}];return e.forEach(function(e,t){a.push({title:e,key:t+e,render:function(e,a){return g.a.createElement("textarea",{title:a[t],value:a[t]})}})}),a}return[]}},{key:"render",value:function(){var e=this.props.data,t=e.slice(1,e.length),a=this.generateCols(e[0]);return g.a.createElement(le.a,{rowKey:"id",scroll:{x:!0},className:"console-table",bordered:!0,dataSource:t,onChange:this.onChange,columns:a})}}]),t}(T.Component),ba=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.state={activeKey:"console-log"},n.onEdit=function(){var e;return(e=n).__onEdit__REACT_HOT_LOADER__.apply(e,arguments)},n.onChange=function(){var e;return(e=n).__onChange__REACT_HOT_LOADER__.apply(e,arguments)},n.focusEditor=function(){var e;return(e=n).__focusEditor__REACT_HOT_LOADER__.apply(e,arguments)},n.remove=function(){var e;return(e=n).__remove__REACT_HOT_LOADER__.apply(e,arguments)},n.closeConsole=function(){var e;return(e=n).__closeConsole__REACT_HOT_LOADER__.apply(e,arguments)},n.appendLog=function(){var e;return(e=n).__appendLog__REACT_HOT_LOADER__.apply(e,arguments)},n.exportCsv=function(){var e;return(e=n).__exportCsv__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.data,a=this.props.data;t.showRes&&t.results.length>0&&!Object(b.isEqual)(t.results,a.results)?(this.setState({activeKey:""+(t.results.length-1)}),this.props.changeTab(0)):0===t.results.length&&this.setState({activeKey:"console-log"},this.focusEditor)}},{key:"__onEdit__REACT_HOT_LOADER__",value:function(e,t){this[t](e)}},{key:"__onChange__REACT_HOT_LOADER__",value:function(e){var t=this;this.setState({activeKey:e},function(){"console-log"===e?(t.focusEditor(),t.props.changeTab(1)):t.props.changeTab(0)})}},{key:"__focusEditor__REACT_HOT_LOADER__",value:function(){var e=this.editor.self;e.doc.setCursor(e.lineCount(),null)}},{key:"__remove__REACT_HOT_LOADER__",value:function(e){var t=this.props,a=t.currentTab;(0,t.dispatch)(Object(Xt.f)(a,parseInt(e,10)))}},{key:"__closeConsole__REACT_HOT_LOADER__",value:function(){var e=this.props,t=e.currentTab;(0,e.dispatch)(Object(Xt.g)(t))}},{key:"__appendLog__REACT_HOT_LOADER__",value:function(e){if(e){var t=this.editor.self.doc;t.setValue(e),t.setCursor(t.lineCount(),null)}}},{key:"__exportCsv__REACT_HOT_LOADER__",value:function(){var e=this.props.data.results,t=parseInt(this.state.activeKey,10),a=e[t],n="",r="结果"+(parseInt(t)+1)+".csv";a.forEach(function(e,t){var r=e.join(",");n+=t<a.length?r+"\n":r});var s=new Blob([n]);if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(s,r);else{var i=window.document.createElement("a");i.href=window.URL.createObjectURL(s,{type:"text/plain"}),i.download=r,document.body.appendChild(i),i.click(),document.body.removeChild(i)}}},{key:"renderTabs",value:function(e){return e&&e.length>0?e.map(function(e,t){var a=g.a.createElement("span",null,"结果",t+1);return g.a.createElement(ya,{style:{minHeight:"100%",position:"relative"},tab:a,key:""+t},g.a.createElement(ka,{data:e.data}),e.jobId?g.a.createElement("a",{href:fa.a.DOWNLOAD_SQL_RESULT+"?jobId="+e.jobId,download:!0},g.a.createElement(I.a,{style:ga},"下载")):null)}):[]}},{key:"render",value:function(){var e=this,t=this.props,a=t.data,n=(t.dispatch,t.setMax),r=t.setMin,s=t.changeTabStatus?"console-log":this.state.activeKey;return g.a.createElement("div",{className:"ide-console"},g.a.createElement(G.a,{hideAdd:!0,type:"editable-card",activeKey:s,onChange:this.onChange,onEdit:this.onEdit},g.a.createElement(ya,{tab:"日志",key:"console-log"},g.a.createElement("div",{style:{position:"relative"}},g.a.createElement(Vt.a,{cursorAlwaysInEnd:!0,style:{minHeight:"auto"},ref:function(t){e.editor=t},options:Ta,key:"output-log",sync:!0,value:a.log}))),this.renderTabs(a.results)),g.a.createElement(i.a,{onClick:n,className:"console-icon up",type:"up-square-o"}),g.a.createElement(i.a,{onClick:r,className:"console-icon down",type:"down-square-o"}),g.a.createElement(Ve.a,{placement:"top",title:"关闭控制台"},g.a.createElement(i.a,{className:"close-console",type:"close",onClick:this.closeConsole})))}}]),t}(T.Component),va=ba,Oa=va,Ca=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(ya,"TabPane","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/sqlEditor/console.js"),__REACT_HOT_LOADER__.register(Ta,"editorOptions","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/sqlEditor/console.js"),__REACT_HOT_LOADER__.register(ga,"exportStyle","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/sqlEditor/console.js"),__REACT_HOT_LOADER__.register(ka,"Result","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/sqlEditor/console.js"),__REACT_HOT_LOADER__.register(ba,"Console","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/sqlEditor/console.js"),__REACT_HOT_LOADER__.register(va,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/sqlEditor/console.js")),function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.state={customHeight:null,changeTab:!0},n.changeTab=function(){var e;return(e=n).__changeTab__REACT_HOT_LOADER__.apply(e,arguments)},n.handleEditorTxtChange=function(){var e;return(e=n).__handleEditorTxtChange__REACT_HOT_LOADER__.apply(e,arguments)},n.onEditorSelection=function(){var e;return(e=n).__onEditorSelection__REACT_HOT_LOADER__.apply(e,arguments)},n.debounceChange=Object(b.debounce)(n.handleEditorTxtChange,300,{maxWait:2e3}),n.debounceSelectionChange=Object(b.debounce)(n.onEditorSelection,200,{maxWait:2e3}),r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentTabData;e&&this.props.getTab(e.id)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentTabData,a=this.props.currentTabData;t&&t.id!==a.id&&this.props.getTab(t.id)}},{key:"__changeTab__REACT_HOT_LOADER__",value:function(e){var t=this.state.changeTab;t=!!e,this.setState({changeTab:t})}},{key:"__handleEditorTxtChange__REACT_HOT_LOADER__",value:function(e,t,a){var n=this.props.currentTabData,r=this.props.taskCustomParams,s={merged:!1,cursor:a.getCursor()};if($.a.checkExist(n.taskType)){s.sqlText=t;var i=Object(da.b)(t);s.taskVariables=Object(Ee.e)(r,i)}else $.a.checkExist(n.type)&&(s.scriptText=t);this.props.updateTaskFields(s)}},{key:"__onEditorSelection__REACT_HOT_LOADER__",value:function(e,t){var a=t.getSelection();t.somethingSelected()?this.props.setSelection(a):""!==this.props.sqlEditor.selection&&this.props.setSelection("")}},{key:"render",value:function(){var e=this,t=this.props,a=t.sqlEditor,n=t.currentTabData,r=t.options,s=t.value,i=n.id,l=a.console,o=l&&l[i]?l[i]:{results:[]},c=this.state.size,u=n.cursor||void 0,_=n.readWriteLockVO&&!n.readWriteLockVO.getLock;return g.a.createElement("div",{className:"ide-sql"},g.a.createElement("div",{className:"ide-header bd-bottom"},g.a.createElement(ha,x()({},this.props,{changeTab:this.changeTab}))),g.a.createElement("div",{className:"ide-content"},o.log?g.a.createElement(Q.a,{split:"horizontal",minSize:100,maxSize:-77,style:{paddingBottom:"40px"},defaultSize:"60%",primary:"first",size:c,onDragStarted:function(){e.setState({size:void 0})}},g.a.createElement("div",{className:"ide-editor bd-bottom"},g.a.createElement(Vt.a,{key:"sqlEditor",sync:n.merged||void 0,options:x()({},r,{readOnly:_}),value:s,cursor:u,cursorActivity:this.debounceSelectionChange,onChange:this.debounceChange})),g.a.createElement(Oa,{changeTab:this.changeTab,changeTabStatus:this.state.changeTab,data:o,ref:"getSwordButton",currentTab:i,dispatch:this.props.dispatch,setMax:function(){e.setState({size:"100px"})},setMin:function(){e.setState({size:"calc(100% - 40px)"})}})):g.a.createElement("div",{className:"ide-editor bd-bottom"},g.a.createElement(Vt.a,{key:"sqlEditor",sync:n.merged||void 0,options:x()({},r,{readOnly:_}),cursor:u,cursorActivity:this.debounceSelectionChange,onChange:this.debounceChange,value:s}))))}}]),t}(T.Component)),Aa=Object(k.b)(function(e){return{sqlEditor:e.sqlEditor,project:e.project,user:e.user}},function(e){return{dispatch:e,updateTaskFields:function(t){e({type:v.o.SET_TASK_FIELDS_VALUE,payload:t})},setSelection:function(t){e(Object(Xt.i)(t))},getTab:function(t){e(Object(Xt.b)(t))}}})(Ca),Ra=Aa,Sa=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Ca,"SQLEditor","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/sqlEditor/index.js"),__REACT_HOT_LOADER__.register(Aa,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/sqlEditor/index.js")),K.a.confirm),Da=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.unLock=function(){return a.__unLock__REACT_HOT_LOADER__.apply(a,arguments)},a}return y()(t,e),m()(t,[{key:"__unLock__REACT_HOT_LOADER__",value:function(){var e=this.props,t=e.tabData,a=e.updateTaskFields,n=e.updateCatalogue,r=t.readWriteLockVO;Sa({title:"解锁提醒",content:"文件正在被"+r.lastKeepLockUserName+"编辑中，开始编辑时间\n                "+$.a.formatDateTime(r.gmtModified)+"。\n                强制编辑可能导致"+r.lastKeepLockUserName+"对该文件的修改无法保存！\n            ",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){var e={fileId:t.id,lockVersion:r.version};$.a.checkExist(t.taskType)?e.type=X.i.OFFLINE_TASK:$.a.checkExist(t.type)&&(e.type=X.i.OFFLINE_SCRIPT),J.a.unlockFile(e).then(function(r){if(1===r.code){var s=r.data;s.getLock?j.a.success("文件解锁成功！"):K.a.error({title:"解锁失败",content:"文件正在被"+s.lastKeepLockUserName+"编辑中!开始编辑时间\n                                "+$.a.formatDateTime(s.gmtModified)+"."});var i={id:t.id};e.type===X.i.OFFLINE_TASK?J.a.getOfflineTaskDetail(i).then(function(e){if(1===e.code){var r=e.data;r.merged=!0;var s={id:t.id,readWriteLockVO:r.readWriteLockVO};n(s),a(r)}}):e.type===X.i.OFFLINE_SCRIPT&&J.a.getScriptById(i).then(function(e){if(1===e.code){var r=e.data;r.merged=!0;var s={id:t.id,readWriteLockVO:r.readWriteLockVO};n(s),a(r)}})}})},onCancel:function(){}})}},{key:"render",value:function(){var e=this.props.tabData;return g.a.createElement("div",{className:"m-mainbench editor-container"},e&&this.renderBench(e),e&&this.renderLock(e))}},{key:"renderLock",value:function(e){var t=e.readWriteLockVO&&!e.readWriteLockVO.getLock,a=e.createModel&&e.createModel==X.e.SCRIPT,n=e.taskType==X.q.SQL||a||$.a.checkExist(e&&e.type),r="0px";e.taskType&&e.taskType!==X.q.SQL&&!a&&(r="10px");var s="lock-layer";return n?s="lock-layer-editor":e.taskType==X.q.SYNC&&(s="lock-layer-sync"),t?g.a.createElement("div",{className:s},g.a.createElement(te.a,{style:{position:"absolute",top:r,left:"35%",zIndex:"999"},showIcon:!0,message:g.a.createElement("span",null,"当前文件为只读状态！",g.a.createElement("a",{onClick:this.unLock},"解锁")),type:"warning"})):""}},{key:"renderBench",value:function(e){var t=this.props.taskCustomParams;if(X.s.autofocus=!0,X.s.indentUnit=4,X.s.indentWithTabs=!1,$.a.checkExist(e&&e.taskType))switch(e.taskType){case X.q.MR:case X.q.PYTHON:case X.q.VIRTUAL_NODE:return g.a.createElement(pa,x()({key:e.id},e));case X.q.SYNC:return e.createModel&&e.createModel==X.e.SCRIPT?g.a.createElement(ta,x()({key:e.id},e,{taskCustomParams:t})):g.a.createElement(jt,x()({key:e.id},e));case X.q.SQL:return g.a.createElement(Ra,{options:X.s,taskCustomParams:t,key:e.id,value:e.sqlText,currentTab:e.id,currentTabData:e});default:return g.a.createElement("p",{className:"txt-center",style:{lineHeight:"60px"}},"未知任务类型")}else if($.a.checkExist(e&&e.type))return g.a.createElement(Ra,{options:X.s,key:e.id,value:e.scriptText,currentTab:e.id,currentTabData:e})}}]),t}(g.a.Component),wa=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Sa,"confirm","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/mainBench.js"),__REACT_HOT_LOADER__.register(Da,"MainBench","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/mainBench.js")),a(704),a(387)),La=a.n(wa),xa=a(423),Ha=_e.a.Option,Na=function(e){function t(){return p()(this,t),h()(this,(t.__proto__||u()(t)).apply(this,arguments))}return y()(t,e),m()(t,[{key:"render",value:function(){var e=this.props,t=e.onOk,a=e.visible,n=e.onCancel,r=e.projectUsers,s=e.onSelect,i=e.defaultValue,l=r&&r.map(function(e){return g.a.createElement(Ha,{key:""+e.userId,value:""+e.userId,name:e.user.userName},e.user.userName)});return g.a.createElement(K.a,{title:"选择责任人",visible:a,onOk:t,onCancel:n},g.a.createElement(_e.a,{style:{width:"100%"},showSearch:!0,defaultValue:i,onSelect:s,optionFilterProp:"name"},l))}}]),t}(g.a.Component),Fa=Na,Ia=Fa,Ma=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Ha,"Option","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/updateTaskOwnerModal.js"),__REACT_HOT_LOADER__.register(Na,"UpdateTaskOwnerModal","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/updateTaskOwnerModal.js"),__REACT_HOT_LOADER__.register(Fa,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/updateTaskOwnerModal.js")),La.a.Panel);function ja(e){var t=e.taskInfo;return g.a.createElement(r.a,{className:"task-info"},g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"任务名称："),g.a.createElement(o.a,{span:"14"},t.name)),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"任务类型："),g.a.createElement(o.a,{span:"14"},g.a.createElement(Kt.j,{value:t.taskType}))),t.resourceList.length&&g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"资源："),g.a.createElement(o.a,{span:"14t"},t.resourceList.map(function(e){return g.a.createElement(A.a,{key:e.id,color:"blue",style:{marginTop:10}},e.resourceName)}))),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"责任人："),g.a.createElement(o.a,{span:"14"},t.ownerUser&&t.ownerUser.userName," ",g.a.createElement("a",{onClick:e.modifyTaskOwner},"修改"))),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"创建时间："),g.a.createElement(o.a,{span:"14"},$.a.formatDateTime(t.gmtCreate))),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"最近修改人员："),g.a.createElement(o.a,{span:"14"},t.readWriteLockVO.lastKeepLockUserName)),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"最近修改时间："),g.a.createElement(o.a,{span:"14"},$.a.formatDateTime(t.gmtModified))),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"描述："),g.a.createElement(o.a,{span:"14",style:{lineHeight:"20px",padding:"10 0"}},t.taskDesc)))}var Va=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.state={visible:!1,selectedUser:""},a.onSelectUser=function(){return a.__onSelectUser__REACT_HOT_LOADER__.apply(a,arguments)},a.modifyTaskOwner=function(){return a.__modifyTaskOwner__REACT_HOT_LOADER__.apply(a,arguments)},a.setSqlText=function(){return a.__setSqlText__REACT_HOT_LOADER__.apply(a,arguments)},a}return y()(t,e),m()(t,[{key:"componentDidMount",value:function(){this.props.dispatch(Object(ma.a)())}},{key:"__onSelectUser__REACT_HOT_LOADER__",value:function(e){this.setState({selectedUser:e})}},{key:"__modifyTaskOwner__REACT_HOT_LOADER__",value:function(){var e=this,t=this.state.selectedUser,a=this.props.tabData.id;t?J.a.updateTaskOwner({ownerUserId:t,taskId:a}).then(function(t){1===t.code&&(j.a.success("修改成功！"),e.props.reloadTabTask(a),e.setState({visible:!1,selectedUser:""}))}):j.a.error("请选择所属用户！")}},{key:"__setSqlText__REACT_HOT_LOADER__",value:function(e){this.props.updateTaskField({sqlText:e,merged:!0})}},{key:"render",value:function(){var e=this,t=this.state.visible,a=this.props,n=a.tabData,r=a.projectUsers;return g.a.createElement("div",{className:"m-taksdetail"},g.a.createElement(La.a,{bordered:!1,defaultActiveKey:["1","2"]},g.a.createElement(Ma,{key:"1",header:"任务属性"},g.a.createElement(ja,{taskInfo:n,modifyTaskOwner:function(){e.setState({visible:!0})}}),g.a.createElement(Ia,{visible:t,projectUsers:r,onSelect:this.onSelectUser,onOk:this.modifyTaskOwner,defaultValue:""+(n.ownerUserId||""),onCancel:function(){e.setState({visible:!1})}})),g.a.createElement(Ma,{key:"2",header:"历史发布版本"},g.a.createElement(xa.a,{taskInfo:n,changeSql:this.setSqlText}))))}}]),t}(g.a.Component),Ua=Object(k.b)(function(e,t){return{projectUsers:e.projectUsers}},Ke.b)(Va),Pa=Ua,qa=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Ma,"Panel","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskDetail.js"),__REACT_HOT_LOADER__.register(ja,"TaskInfo","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskDetail.js"),__REACT_HOT_LOADER__.register(Va,"TaskDetail","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskDetail.js"),__REACT_HOT_LOADER__.register(Ua,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskDetail.js")),La.a.Panel),Ba=function(e){function t(e){return p()(this,t),h()(this,(t.__proto__||u()(t)).call(this,e))}return y()(t,e),m()(t,[{key:"render",value:function(){var e=this.props.tabData;return g.a.createElement("div",{className:"m-taksdetail"},g.a.createElement(La.a,{bordered:!1,defaultActiveKey:["1","2"]},g.a.createElement(qa,{key:"1",header:"脚本属性"},g.a.createElement(r.a,{className:"task-info"},g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"脚本名称："),g.a.createElement(o.a,{span:"14"},e.name)),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"创建人员："),g.a.createElement(o.a,{span:"14"},e.createUser.userName)),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"创建时间："),g.a.createElement(o.a,{span:"14"},$.a.formatDateTime(e.gmtCreate))),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"最近修改人员："),g.a.createElement(o.a,{span:"14"},e.modifyUser.userName)),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"最近修改时间："),g.a.createElement(o.a,{span:"14"},$.a.formatDateTime(e.gmtModified))),g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"10",className:"txt-right"},"描述："),g.a.createElement(o.a,{span:"14",style:{lineHeight:"20px",padding:"10 0"}},e.scriptDesc))))))}}]),t}(g.a.Component),Ka=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(qa,"Panel","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/scriptDetail.js"),__REACT_HOT_LOADER__.register(Ba,"ScriptDetail","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/scriptDetail.js")),a(39)),Wa=a.n(Ka),Ga=(a(104),a(71)),za=a.n(Ga),Ya=La.a.Panel,Qa=_e.a.Option,$a=q.a.Item,Ja=ce.a.Group,Xa={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:18}}},Za=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.changeScheduleStatus=a.props.handleScheduleStatus,a.changeScheduleConf=a.props.handleScheduleConf,a.changeScheduleType=a.props.handleScheduleType,a}return y()(t,e),m()(t,[{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.props,n=a.status,r=a.scheduleConf,s=r.periodType,i=function(){for(var t=[],a=0;a<=23;a++)t.push(g.a.createElement(Qa,{key:a,value:""+a},a<10?"0"+a:a));return g.a.createElement(_e.a,{onChange:e.changeScheduleConf.bind(e)},t)},l=function(){for(var t=[],a=0;a<=59;a++)t.push(g.a.createElement(Qa,{key:a,value:""+a},a<10?"0"+a:a));return g.a.createElement(_e.a,{onChange:e.changeScheduleConf.bind(e)},t)};return g.a.createElement(q.a,{key:s},g.a.createElement($a,x()({},Xa,{label:"调度状态"}),t("scheduleStatus",{valuePropName:"checked",initialValue:0===n||2===n})(g.a.createElement(mt.a,{onChange:this.changeScheduleStatus.bind(this)},"冻结"))),g.a.createElement($a,x()({},Xa,{label:"生效日期"}),t("beginDate",{initialValue:Bt()(r.beginDate,"YYYY-MM-DD")})(g.a.createElement(za.a,{onChange:this.changeScheduleConf.bind(this)})),g.a.createElement("span",{className:"split-text",style:{float:"none"}},"-"),t("endDate",{initialValue:Bt()(r.endDate,"YYYY-MM-DD")})(g.a.createElement(za.a,{onChange:this.changeScheduleConf.bind(this)}))),g.a.createElement($a,x()({},Xa,{label:"调度周期"}),g.a.createElement(o.a,{span:"6"},t("periodType",{initialValue:""+r.periodType,rules:[{required:!0}]})(g.a.createElement(_e.a,{onChange:this.changeScheduleType.bind(this)},g.a.createElement(Qa,{key:0,value:"0"},"分钟"),g.a.createElement(Qa,{key:1,value:"1"},"小时"),g.a.createElement(Qa,{key:2,value:"2"},"天"),g.a.createElement(Qa,{key:3,value:"3"},"周"),g.a.createElement(Qa,{key:4,value:"4"},"月"))))),g.a.createElement($a,{style:{display:"none"}},t("selfReliance",{initialValue:r.selfReliance})(g.a.createElement(w.a,{type:"hidden"}))),function(a,n){var s=void 0;switch(a){case 0:s=g.a.createElement("span",{key:a},g.a.createElement($a,x()({},Xa,{label:"开始时间"}),g.a.createElement(o.a,{span:"6"},t("beginHour",{rules:[{required:!0},{validator:n.checkTimeS.bind(n)}],initialValue:""+r.beginHour})(i())),g.a.createElement("span",{className:"split-text"},"时"),g.a.createElement(o.a,{span:"6"},t("beginMin",{rules:[{required:!0}],initialValue:"0"})(g.a.createElement(_e.a,{disabled:!0},g.a.createElement(Qa,{value:"0"},"0")))),g.a.createElement("span",{className:"split-text"},"分")),g.a.createElement($a,x()({},Xa,{label:"间隔时间"}),g.a.createElement(o.a,{span:"6"},t("gapMin",{rules:[{required:!0}],initialValue:""+r.gapMin})(g.a.createElement(_e.a,{onChange:n.changeScheduleConf.bind(n)},function(){for(var e=[],t=5;t<=55;t+=5)e.push(g.a.createElement(Qa,{key:t,value:""+t},t,"分钟"));return e}())))),g.a.createElement($a,x()({},Xa,{label:"结束时间"}),g.a.createElement(o.a,{span:"6"},t("endHour",{rules:[{required:!0},{validator:n.checkTimeE.bind(n)}],initialValue:""+r.endHour})(i())),g.a.createElement("span",{className:"split-text"},"时"),g.a.createElement(o.a,{span:"6"},t("endMin",{initialValue:"59"})(g.a.createElement(_e.a,{disabled:!0},g.a.createElement(Qa,{value:"59"},"59")))),g.a.createElement("span",{className:"split-text"},"分")));break;case 1:s=g.a.createElement("span",{key:a},g.a.createElement($a,x()({},Xa,{label:"开始时间"}),g.a.createElement(o.a,{span:"6"},t("beginHour",{rules:[{required:!0},{validator:n.checkTimeS1.bind(n)}],initialValue:""+r.beginHour})(i())),g.a.createElement("span",{className:"split-text"},"时"),g.a.createElement(o.a,{span:"6"},t("beginMin",{rules:[{required:!0},{validator:n.checkTimeS1.bind(n)}],initialValue:""+r.beginMin})(l())),g.a.createElement("span",{className:"split-text"},"分")),g.a.createElement($a,x()({},Xa,{label:"间隔时间"}),g.a.createElement(o.a,{span:"6"},t("gapHour",{rules:[{required:!0}],initialValue:""+r.gapHour})(g.a.createElement(_e.a,{onChange:n.changeScheduleConf.bind(n)},function(){for(var e=[],t=1;t<=23;t++)e.push(g.a.createElement(Qa,{key:t,value:""+t},t,"小时"));return e}())))),g.a.createElement($a,x()({},Xa,{label:"结束时间"}),g.a.createElement(o.a,{span:"6"},t("endHour",{rules:[{required:!0},{validator:n.checkTimeE1.bind(n)}],initialValue:""+r.endHour})(i())),g.a.createElement("span",{className:"split-text"},"时"),g.a.createElement(o.a,{span:"6"},t("endMin",{rules:[{required:!0}],initialValue:"59"})(g.a.createElement(_e.a,{disabled:!0},g.a.createElement(Qa,{value:"59"},"59")))),g.a.createElement("span",{className:"split-text"},"分")));break;case 2:s=g.a.createElement("span",{key:a},g.a.createElement($a,x()({},Xa,{label:"具体时间"}),g.a.createElement(o.a,{span:"6"},t("hour",{rules:[{required:!0}],initialValue:""+r.hour})(i())),g.a.createElement("span",{className:"split-text"},"时"),g.a.createElement(o.a,{span:"6"},t("min",{rules:[{required:!0}],initialValue:""+r.min})(l())),g.a.createElement("span",{className:"split-text"},"分")));break;case 3:s=g.a.createElement("span",{key:a},g.a.createElement($a,x()({},Xa,{label:"选择时间"}),g.a.createElement(o.a,{span:"13"},t("weekDay",{rules:[{required:!0}],initialValue:(""+r.weekDay).split(",")})(g.a.createElement(_e.a,{mode:"multiple",style:{width:"100%"},onChange:e.changeScheduleConf.bind(e)},g.a.createElement(Qa,{key:1,value:"1"},"星期一"),g.a.createElement(Qa,{key:2,value:"2"},"星期二"),g.a.createElement(Qa,{key:3,value:"3"},"星期三"),g.a.createElement(Qa,{key:4,value:"4"},"星期四"),g.a.createElement(Qa,{key:5,value:"5"},"星期五"),g.a.createElement(Qa,{key:6,value:"6"},"星期六"),g.a.createElement(Qa,{key:7,value:"7"},"星期天"))))),g.a.createElement($a,x()({},Xa,{label:"具体时间"}),g.a.createElement(o.a,{span:"6"},t("hour",{rules:[{required:!0}],initialValue:""+r.hour})(i())),g.a.createElement("span",{className:"split-text"},"时"),g.a.createElement(o.a,{span:"6"},t("min",{rules:[{required:!0}],initialValue:""+r.min})(l())),g.a.createElement("span",{className:"split-text"},"分")));break;case 4:s=g.a.createElement("span",{key:a},g.a.createElement($a,x()({},Xa,{label:"选择时间"}),g.a.createElement(o.a,{span:"13"},t("day",{rules:[{required:!0}],initialValue:(""+r.day).split(",")})(function(){for(var t=[],a=1;a<=31;a++)t.push(g.a.createElement(Qa,{key:a,value:""+a},"每月"+a+"号"));return g.a.createElement(_e.a,{mode:"multiple",style:{width:"100%"},onChange:e.changeScheduleConf.bind(e)},t)}()))),g.a.createElement($a,x()({},Xa,{label:"具体时间"}),g.a.createElement(o.a,{span:"6"},t("hour",{rules:[{required:!0}],initialValue:""+r.hour})(i())),g.a.createElement("span",{className:"split-text"},"时"),g.a.createElement(o.a,{span:"6"},t("min",{rules:[{required:!0}],initialValue:""+r.min})(l())),g.a.createElement("span",{className:"split-text"},"分")));break;default:s=g.a.createElement("span",null,"something wrong")}return s}(+s,this))}},{key:"checkTimeS",value:function(e,t,a){+t>+this.props.form.getFieldValue("endHour")&&a("开始时间不能晚于结束时间"),a()}},{key:"checkTimeE",value:function(e,t,a){+t<+this.props.form.getFieldValue("beginHour")&&a("结束时间不能早于开始时间"),a()}},{key:"checkTimeS1",value:function(e,t,a){var n=this.props.form;60*+n.getFieldValue("beginHour")+ +n.getFieldValue("beginMin")>60*+n.getFieldValue("endHour")+59&&a("开始时间不能晚于结束时间"),a()}},{key:"checkTimeE1",value:function(e,t,a){var n=this.props.form;60*+n.getFieldValue("beginHour")+ +n.getFieldValue("beginMin")>60*+n.getFieldValue("endHour")+59&&a("结束时间不能早于开始时间"),a()}}]),t}(g.a.Component),en=q.a.create()(Za),tn=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e)),n=a.props.tabData.scheduleConf,r=""===n?Wa()(a.getDefaultScheduleConf(0),{beginDate:"2001-01-01",endDate:"2021-01-01"}):JSON.parse(n);return"undefined"!==r.selfReliance?!1===r.selfReliance?a._selfReliance=0:!0===r.selfReliance?a._selfReliance=1:a._selfReliance=r.selfReliance:a._selfReliance=0,a}return y()(t,e),m()(t,[{key:"handleScheduleStatus",value:function(e){var t=e.target.checked;this.props.changeScheduleStatus(t?2:1)}},{key:"handleScheduleStatus",value:function(e){var t=this,a=e.target.checked,n=a?2:1,r=this.props.tabData,s=a?"冻结成功":"解冻成功",i=a?"冻结失败":"解冻失败";J.a.forzenTask({taskIdList:[r.id],scheduleStatus:n}).then(function(e){1===e.code?(t.props.changeScheduleStatus(n),j.a.info(s)):j.a.err(i)})}},{key:"handleScheduleConf",value:function(){var e=this;setTimeout(function(){e.form.validateFields(function(t,a){if(!t){var n=e.form.getFieldsValue();n.selfReliance=e._selfReliance,delete n.scheduleStatus,e.props.changeScheduleConf(n)}})},0)}},{key:"handleScheduleType",value:function(e){var t=this.getDefaultScheduleConf(e),a=de()({},t,{scheduleStatus:this.form.getFieldValue("scheduleStatus"),beginDate:this.form.getFieldValue("beginDate"),endDate:this.form.getFieldValue("endDate"),periodType:e,selfReliance:this.form.getFieldValue("selfReliance")});this.props.changeScheduleConf(a)}},{key:"getDefaultScheduleConf",value:function(e){return{0:{beginHour:0,gapMin:5,endHour:23,periodType:0},1:{beginHour:0,beginMin:0,endHour:23,gapHour:5,periodType:1},2:{min:0,hour:0,periodType:2},3:{weekDay:3,min:0,hour:23,periodType:3},4:{day:5,hour:0,min:23,periodType:4}}[e]}},{key:"handleDelVOS",value:function(e){this.props.delVOS(e.id)}},{key:"handleAddVOS",value:function(e){this.props.addVOS(e)}},{key:"goEdit",value:function(e){this.props.getTaskDetail(e.id)}},{key:"setSelfReliance",value:function(e){var t=e.target.value;this._selfReliance=t,this.handleScheduleConf()}},{key:"render",value:function(){var e=this,t=this.props.tabData,a=t.readWriteLockVO&&!t.readWriteLockVO.getLock,n=t.scheduleConf,s=""===n?Wa()(this.getDefaultScheduleConf(0),{beginDate:"2001-01-01",endDate:"2021-01-01"}):JSON.parse(n),i=[{title:"任务名称",dataIndex:"name",key:"name",render:function(t,a){return g.a.createElement("a",{href:"javascript:void(0)",onClick:e.goEdit.bind(e,a)},t)}},{title:"责任人",dataIndex:"createUser.userName",key:"createUser.userName"},{title:"操作",key:"action",render:function(t,a){return g.a.createElement("span",null,g.a.createElement("a",{href:"javascript:void(0)",onClick:e.handleDelVOS.bind(e,a)},"删除"))}}],l={display:"block",height:"30px",lineHeight:"30px"};return g.a.createElement("div",{className:"m-scheduling",style:{position:"relative"}},a?g.a.createElement("div",{className:"cover-mask"}):null,g.a.createElement(La.a,{bordered:!1,defaultActiveKey:["1","2","3"]},g.a.createElement(Ya,{key:"1",header:"调度属性"},g.a.createElement(en,{scheduleConf:s,status:t.scheduleStatus,handleScheduleStatus:this.handleScheduleStatus.bind(this),handleScheduleConf:this.handleScheduleConf.bind(this),handleScheduleType:this.handleScheduleType.bind(this),ref:function(t){return e.form=t},key:t.id+" - "+s.periodType})),t.taskType!==X.q.VIRTUAL_NODE&&g.a.createElement(Ya,{key:"2",header:"任务间依赖"},g.a.createElement(q.a,null,g.a.createElement($a,x()({},Xa,{label:"上游任务"}),g.a.createElement(an,{onSelect:this.handleAddVOS.bind(this),taskId:t.id}))),g.a.createElement(r.a,null,g.a.createElement(o.a,null,g.a.createElement(le.a,{className:"m-table",columns:i,bordered:!1,dataSource:t.taskVOS,rowKey:function(e){return e.id.lable}})))),g.a.createElement(Ya,{key:"3",header:"跨周期依赖"},g.a.createElement(r.a,null,g.a.createElement(o.a,{span:"1"}),g.a.createElement(o.a,null,g.a.createElement(Ja,{onChange:this.setSelfReliance.bind(this),value:this._selfReliance},g.a.createElement(ce.a,{style:l,value:0},"不依赖上一调度周期"),g.a.createElement(ce.a,{style:l,value:1},"自依赖，等待上一调度周期成功，才能继续运行"),g.a.createElement(ce.a,{style:l,value:3},"自依赖，等待上一调度周期结束，才能继续运行 ",g.a.createElement(me.a,{style:{position:"inherit"},doc:"taskDependentTypeDesc"})),g.a.createElement(ce.a,{style:l,value:2},"等待下游任务的上一周期成功，才能继续运行"),g.a.createElement(ce.a,{style:l,value:4},"等待下游任务的上一周期结束，才能继续运行 ",g.a.createElement(me.a,{style:{position:"inherit"},doc:"taskDependentTypeDesc"}))))))))}}]),t}(g.a.Component),an=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.searchVOS=a.fetchVOS.bind(a),a.handleClick=a.handleClick.bind(a),a.selectVOS=a.props.onSelect,a.taskId=a.props.taskId,a.state={list:[]},a}return y()(t,e),m()(t,[{key:"fetchVOS",value:function(e){var t=this,a=e.target.value;""!==a.trim()?J.a.getOfflineTaskByName({name:a,taskId:this.taskId}).then(function(e){1===e.code&&(0===e.data.length&&j.a.error("没有符合条件的任务"),t.setState({list:e.data,fetching:!1}))}):this.setState({list:[]})}},{key:"handleClick",value:function(e){var t=this;J.a.checkIsLoop({taskId:this.taskId,dependencyTaskId:e.id}).then(function(a){1===a.code&&(a.data?j.a.error("添加失败，该任务循环依赖任务"+(a.data.name||"")+"!"):(t.selectVOS(e),t.$input.value="",t.setState({list:[]})))})}},{key:"render",value:function(){var e=this,t=this.state.list;return g.a.createElement("div",{className:"m-taskselector"},g.a.createElement("input",{onInput:Object(Ee.a)(this.searchVOS,500,{maxWait:2e3}),ref:function(t){return e.$input=t},className:"ant-input"}),t.length>0&&g.a.createElement("ul",{className:"tasklist"},t.map(function(t){return g.a.createElement("li",{className:"taskitem",onClick:function(){e.handleClick(t)},key:t.id},t.name)})))}}]),t}(g.a.Component),nn=function(e,t){return x()({},t)},rn=function(e){return{changeScheduleConf:function(t){e({type:v.o.CHANGE_SCHEDULE_CONF,payload:t})},changeScheduleStatus:function(t){e({type:v.o.CHANGE_SCHEDULE_STATUS,payload:t})},addVOS:function(t){e({type:v.o.ADD_VOS,payload:t})},delVOS:function(t){e({type:v.o.DEL_VOS,payload:t})},getTaskDetail:function(t){J.a.getOfflineTaskDetail({id:t}).then(function(a){1===a.code&&(e({type:v.o.LOAD_TASK_DETAIL,payload:a.data}),e({type:v.o.OPEN_TASK_TAB,payload:t}))})}}},sn=Object(k.b)(nn,rn)(tn),ln=sn,on=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Ya,"Panel","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js"),__REACT_HOT_LOADER__.register(Qa,"Option","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js"),__REACT_HOT_LOADER__.register($a,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js"),__REACT_HOT_LOADER__.register(Ja,"RadioGroup","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js"),__REACT_HOT_LOADER__.register(Xa,"formItemLayout","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js"),__REACT_HOT_LOADER__.register(Za,"ScheduleForm","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js"),__REACT_HOT_LOADER__.register(en,"FormWrap","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js"),__REACT_HOT_LOADER__.register(tn,"SchedulingConfig","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js"),__REACT_HOT_LOADER__.register(an,"TaskSelector","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js"),__REACT_HOT_LOADER__.register(nn,"mapState","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js"),__REACT_HOT_LOADER__.register(rn,"mapDispatch","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js"),__REACT_HOT_LOADER__.register(sn,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/schedulingConfig.js")),a(121),a(83)),cn=a.n(on),un=a(63),_n=a.n(un),pn=a(182),dn=a(432)({mxImageBasePath:"public/rdos/mxgraph/images",mxBasePath:"public/rdos/mxgraph"}),mn=dn.mxGraph,En=dn.mxShape,hn=dn.mxConnectionConstraint,fn=dn.mxPoint,yn=dn.mxPolyline,Tn=dn.mxEvent,gn=dn.mxRubberband,kn=dn.mxConstants,bn=dn.mxEdgeStyle,vn=dn.mxPerimeter,On=dn.mxCompactTreeLayout,Cn=dn.mxHierarchicalLayout,An=dn.mxUtils,Rn={width:150,height:36},Sn=function(e){return e},Dn=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.state={selectedTask:"",data:{},loading:"success",lastVertex:"",visible:!1},n.loadTaskChidren=function(){var e;return(e=n).__loadTaskChidren__REACT_HOT_LOADER__.apply(e,arguments)},n.insertVertex=function(){var e;return(e=n).__insertVertex__REACT_HOT_LOADER__.apply(e,arguments)},n.loopTree=function(){var e;return(e=n).__loopTree__REACT_HOT_LOADER__.apply(e,arguments)},n.doInsertVertex=function(){var e;return(e=n).__doInsertVertex__REACT_HOT_LOADER__.apply(e,arguments)},n.loadEditor=function(){var e;return(e=n).__loadEditor__REACT_HOT_LOADER__.apply(e,arguments)},n.getStyles=function(){var e;return(e=n).__getStyles__REACT_HOT_LOADER__.apply(e,arguments)},n.formatTooltip=function(){var e;return(e=n).__formatTooltip__REACT_HOT_LOADER__.apply(e,arguments)},n.corvertValueToString=function(){var e;return(e=n).__corvertValueToString__REACT_HOT_LOADER__.apply(e,arguments)},n.refresh=function(){var e;return(e=n).__refresh__REACT_HOT_LOADER__.apply(e,arguments)},n.zoomIn=function(){var e;return(e=n).__zoomIn__REACT_HOT_LOADER__.apply(e,arguments)},n.zoomOut=function(){var e;return(e=n).__zoomOut__REACT_HOT_LOADER__.apply(e,arguments)},n.hideMenu=function(){var e;return(e=n).__hideMenu__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"componentDidMount",value:function(){this.Container.innerHTML="",this.graph="";var e=this.Container,t=this.props.tabData;this.initEditor(),this.loadEditor(e),this.hideMenu(),this.loadTaskChidren({taskId:t.id,level:6})}},{key:"__loadTaskChidren__REACT_HOT_LOADER__",value:function(e){var t=this;this.setState({loading:"loading"}),J.a.getTaskChildren(e).then(function(e){if(1===e.code){var a=e.data;t.setState({selectedTask:a,data:a}),t.doInsertVertex(a)}t.setState({loading:"success"})})}},{key:"__insertVertex__REACT_HOT_LOADER__",value:function(e,t){var a=this.graph,n=a.getDefaultParent(),r=this._vertexCells.find(function(e){var a=e.getAttribute("data");return a?JSON.parse(a).id===t.id:null});if(r)return 0===a.getEdgesBetween(e,r).length&&a.insertEdge(n,null,"",e,r),r;var s=this.getStyles(t),i=An.createXmlDocument().createElement("Task");i.setAttribute("id",t.id),i.setAttribute("data",_n()(t));var l=a.insertVertex(n,null,i,1,1,Rn.width,Rn.height,s);return a.insertEdge(n,null,"",e,l),a.view.refresh(l),this._vertexCells.push(l),l}},{key:"__loopTree__REACT_HOT_LOADER__",value:function(e,t){if(t){var a=e.getDefaultParent(),n=t.taskVOS,r=t.subTaskVOS,s=Sn(t),i=this.insertVertex(a,s);if(n&&n.length>0)for(var l=0;l<n.length;l++){var o=Sn(n[l]),c=this.insertVertex(a,o);this.insertVertex(c,s);n[l].taskVOS&&this.loopTree(e,n[l])}if(r&&r.length>0)for(var u=0;u<r.length;u++){var _=Sn(r[u]);this.insertVertex(a,_),this.insertVertex(i,_);r[u].subTaskVOS&&this.loopTree(e,r[u])}}}},{key:"__doInsertVertex__REACT_HOT_LOADER__",value:function(e){var t=this,a=this.graph,n=(a.container.clientWidth-Rn.width)/2;this._vertexCells=[];var r=a.getModel(),s=a.getDefaultParent();this.executeLayout=function(e,t){r.beginUpdate();try{var n=new Cn(a,!1);n.orientation="north",n.disableEdgeStyle=!1,n.interRankCellSpacing=40,n.intraCellSpacing=10,null!=e&&e(),n.execute(s)}catch(e){throw e}finally{a.getModel().endUpdate(),null!=t&&t()}},this.executeLayout(function(){t.loopTree(a,e)},function(){a.view.setTranslate(n,200)})}},{key:"__loadEditor__REACT_HOT_LOADER__",value:function(e){Tn.disableContextMenu(e);var t=new mn(e);this.graph=t,t.setPanning(!0),t.panningHandler.useLeftButtonForPanning=!0,t.setConnectable(!0),t.setTooltips(!0),t.view.setScale(1),t.setHtmlLabels(!0),t.setAllowDanglingEdges(!1),t.setConnectable(!1),t.isCellsMovable=function(e){return!((e=t.getSelectionCell())&&e.edge)},t.isCellEditable=function(){return!1};var a=this.getDefaultVertexStyle();t.getStylesheet().putDefaultVertexStyle(a),t.convertValueToString=this.corvertValueToString,t.getTooltipForCell=this.formatTooltip;var n=this.getDefaultEdgeStyle();t.getStylesheet().putDefaultEdgeStyle(n),kn.HANDLE_FILLCOLOR="#ffffff",kn.HANDLE_STROKECOLOR="#2491F7",kn.VERTEX_SELECTION_COLOR="#2491F7",new gn(t)}},{key:"__getStyles__REACT_HOT_LOADER__",value:function(e){return"whiteSpace=wrap;fillColor=#E6F7FF;strokeColor=#90D5FF;"}},{key:"__formatTooltip__REACT_HOT_LOADER__",value:function(e){var t=e.getAttribute("data"),a=t?JSON.parse(t):"";return a?a.name:""}},{key:"__corvertValueToString__REACT_HOT_LOADER__",value:function(e){if(An.isNode(e.value)&&"task"==e.value.nodeName.toLowerCase()){var t=e.getAttribute("data"),a=t?JSON.parse(t):"",n=Object(pn.c)(a.taskType);if(a)return'<div class="vertex"><span class="vertex-title">'+(a.name||"")+'</span>\n                    <span style="font-size:10px; color: #666666;">'+n+"</span>\n                    </div>"}return""}},{key:"listenDoubleClick",value:function(){this.graph.addListener(Tn.DOUBLE_CLICK,function(e,t){t.getProperty("cell")})}},{key:"listenOnClick",value:function(){var e=this;this.graph.addListener(Tn.onClick,function(t,a){var n=a.getProperty("cell");if(n){var r=n.getAttribute("data");r=r?JSON.parse(r):"",e.setState({selectedTask:r})}})}},{key:"__refresh__REACT_HOT_LOADER__",value:function(){this.componentDidMount()}},{key:"graphEnable",value:function(){var e=this.graph.isEnabled();this.graph.setEnabled(!e)}},{key:"__zoomIn__REACT_HOT_LOADER__",value:function(){this.graph.zoomIn()}},{key:"__zoomOut__REACT_HOT_LOADER__",value:function(){this.graph.zoomOut()}},{key:"__hideMenu__REACT_HOT_LOADER__",value:function(){var e=this;document.addEventListener("click",function(t){var a=e.graph;a.popupMenuHandler;a.popupMenuHandler.isMenuShowing()&&a.popupMenuHandler.hideMenu()})}},{key:"render",value:function(){var e=this;this.state.selectedTask,this.props.project;return g.a.createElement("div",{className:"graph-editor",style:{position:"relative"}},g.a.createElement("div",{className:"editor pointer",ref:function(t){e.Container=t}}),g.a.createElement(cn.a,{tip:"Loading...",size:"large",spinning:"loading"===this.state.loading},g.a.createElement("div",{className:"absolute-middle",style:{width:"100%",height:"100%"}})),g.a.createElement("div",{className:"graph-toolbar"},g.a.createElement(Ve.a,{placement:"bottom",title:"刷新"},g.a.createElement(i.a,{type:"reload",onClick:this.refresh})),g.a.createElement(Ve.a,{placement:"bottom",title:"放大"},g.a.createElement(O.a,{onClick:this.zoomIn,type:"zoom-in"})),g.a.createElement(Ve.a,{placement:"bottom",title:"缩小"},g.a.createElement(O.a,{onClick:this.zoomOut,type:"zoom-out"}))))}},{key:"getDefaultVertexStyle",value:function(){var e=[];return e[kn.STYLE_SHAPE]=kn.SHAPE_RECTANGLE,e[kn.STYLE_PERIMETER]=vn.RectanglePerimeter,e[kn.STYLE_STROKECOLOR]="#90D5FF",e[kn.STYLE_FILLCOLOR]="#E6F7FF;",e[kn.STYLE_FONTCOLOR]="#333333;",e[kn.STYLE_ALIGN]=kn.ALIGN_CENTER,e[kn.STYLE_VERTICAL_ALIGN]=kn.ALIGN_MIDDLE,e[kn.STYLE_FONTSIZE]="12",e[kn.STYLE_FONTSTYLE]=1,e}},{key:"getDefaultEdgeStyle",value:function(){var e=[];return e[kn.STYLE_SHAPE]=kn.SHAPE_CONNECTOR,e[kn.STYLE_STROKECOLOR]="#9EABB2",e[kn.STYLE_STROKEWIDTH]=1,e[kn.STYLE_ALIGN]=kn.ALIGN_CENTER,e[kn.STYLE_VERTICAL_ALIGN]=kn.ALIGN_MIDDLE,e[kn.STYLE_EDGE]=bn.TopToBottom,e[kn.STYLE_ENDARROW]=kn.ARROW_CLASSIC,e[kn.STYLE_FONTSIZE]="10",e[kn.STYLE_ROUNDED]=!0,e}},{key:"initEditor",value:function(){mn.prototype.getAllConnectionConstraints=function(e,t){if(null!=e&&null!=e.shape)if(null!=e.shape.stencil){if(null!=e.shape.stencil)return e.shape.stencil.constraints}else if(null!=e.shape.constraints)return e.shape.constraints;return null},En.prototype.constraints=[new hn(new fn(.25,0),!0),new hn(new fn(.5,0),!0),new hn(new fn(.75,0),!0),new hn(new fn(0,.25),!0),new hn(new fn(0,.5),!0),new hn(new fn(0,.75),!0),new hn(new fn(1,.25),!0),new hn(new fn(1,.5),!0),new hn(new fn(1,.75),!0),new hn(new fn(.25,1),!0),new hn(new fn(.5,1),!0),new hn(new fn(.75,1),!0)],yn.prototype.constraints=null}}]),t}(T.Component),wn=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(dn,"Mx","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(mn,"mxGraph","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(En,"mxShape","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(hn,"mxConnectionConstraint","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(fn,"mxPoint","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(yn,"mxPolyline","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(Tn,"mxEvent","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(gn,"mxRubberband","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(kn,"mxConstants","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(bn,"mxEdgeStyle","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(vn,"mxPerimeter","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(On,"mxCompactTreeLayout","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(Cn,"mxHierarchicalLayout","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(An,"mxUtils","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(Rn,"VertexSize","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(Sn,"getVertexNode","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js"),__REACT_HOT_LOADER__.register(Dn,"TaskView","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskView/index.js")),a(33)),Ln=a.n(wn),xn=q.a.Item,Hn=La.a.Panel,Nn={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:16}}},Fn=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.onChange=function(){var e;return(e=n).__onChange__REACT_HOT_LOADER__.apply(e,arguments)},n.getFormItems=function(){var e;return(e=n).__getFormItems__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"__onChange__REACT_HOT_LOADER__",value:function(e,t){var a=this.props,n=a.tabData,r=a.onChange;if(/(^\$\[(\S+\(\S*\)|[a-z0-9\+\-\/\\\*]{2,})\]$)|(^(?!\$)\S+$)/i.test(t)){var s=[].concat(Ln()(n.taskVariables));s[e].paramCommand=t,r({taskVariables:s})}}},{key:"__getFormItems__REACT_HOT_LOADER__",value:function(){var e=this,t=this.props.form.getFieldDecorator,a=this.props.tabData.taskVariables,n=[],r=[],s=function(a,n){return g.a.createElement(xn,x()({key:n.paramName},Nn,{label:n.paramName}),t(n.paramName,{rules:[{pattern:/(^\$\[(\S+\(\S*\)|[a-z0-9\+\-\/\\\*]{2,})\]$)|(^(?!\$)\S+$)/i,message:"参数格式不正确"}],initialValue:n.paramCommand})(g.a.createElement(w.a,{disabled:0===n.type,onChange:function(t){e.onChange(a,t.target.value)}})))};if(a)for(var i=0;i<a.length;i++){var l=a[i],o=s(i,l);0===l.type?n.push(o):1===l.type&&r.push(o)}return{sysItems:n,customItems:r}}},{key:"render",value:function(){var e=this.props.tabData,t=e.readWriteLockVO&&!e.readWriteLockVO.getLock,a=this.getFormItems();return g.a.createElement(q.a,{style:{position:"relative"}},t?g.a.createElement("div",{className:"cover-mask"}):null,g.a.createElement(La.a,{bordered:!1,defaultActiveKey:["1","2"]},g.a.createElement(Hn,{key:"1",header:g.a.createElement("span",null,"系统参数配置 ",g.a.createElement(me.a,{style:{position:"inherit"},doc:"customSystemParams"}))},a.sysItems),g.a.createElement(Hn,{key:"2",header:g.a.createElement("span",null,"自定义参数配置 ",g.a.createElement(me.a,{style:{position:"inherit"},doc:"customParams"}))},a.customItems)))}}]),t}(g.a.Component),In=q.a.create()(Fn),Mn=In,jn=Mn,Vn=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(xn,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskParams.js"),__REACT_HOT_LOADER__.register(Hn,"Panel","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskParams.js"),__REACT_HOT_LOADER__.register(Nn,"formItemLayout","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskParams.js"),__REACT_HOT_LOADER__.register(Fn,"TaskParams","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskParams.js"),__REACT_HOT_LOADER__.register(In,"FormWrapper","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskParams.js"),__REACT_HOT_LOADER__.register(Mn,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/taskParams.js")),G.a.TabPane),Un=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.state={selected:"",expanded:!1},a.handleCustomParamsChange=function(){return a.__handleCustomParamsChange__REACT_HOT_LOADER__.apply(a,arguments)},a.tabClick=function(){return a.__tabClick__REACT_HOT_LOADER__.apply(a,arguments)},a.getTabPanes=function(){return a.__getTabPanes__REACT_HOT_LOADER__.apply(a,arguments)},a}return y()(t,e),m()(t,[{key:"handleTaskParamChange",value:function(e,t){e!==t&&this.props.setTaskParams({taskParams:t})}},{key:"__handleCustomParamsChange__REACT_HOT_LOADER__",value:function(e){this.props.setTaskParams(e)}},{key:"__tabClick__REACT_HOT_LOADER__",value:function(e){var t=this.state,a=t.selected,n=t.expanded;e===a&&n?(this.setState({selected:"",expanded:!1}),this.SideBench.style.width="30px"):e!==a&&(this.SideBench.style.width="500px",this.setState({selected:e,expanded:!0}))}},{key:"__getTabPanes__REACT_HOT_LOADER__",value:function(){var e=this.props.tabData;if(!e)return null;var t=e.readWriteLockVO&&!e.readWriteLockVO.getLock,a=[g.a.createElement(Vn,{tab:g.a.createElement("span",{className:"title-vertical"},"任务属性"),key:"params1"},g.a.createElement(Pa,{tabData:e})),g.a.createElement(Vn,{tab:g.a.createElement("span",{className:"title-vertical"},"调度依赖"),key:"params2"},g.a.createElement(ln,{tabData:e})),g.a.createElement(Vn,{tab:g.a.createElement("span",{className:"title-vertical"},"依赖视图"),key:"params4"},g.a.createElement(Dn,{tabData:e}))];if(e&&$.a.checkExist(e.taskType)&&e.taskType!==X.q.VIRTUAL_NODE)a.push([g.a.createElement(Vn,{tab:g.a.createElement("span",{className:"title-vertical"},"任务参数"),key:"params5"},g.a.createElement(jn,{tabData:e,onChange:this.handleCustomParamsChange})),g.a.createElement(Vn,{tab:g.a.createElement("span",{className:"title-vertical"},"环境参数"),key:"params3"},g.a.createElement(Vt.a,{options:x()({},X.C,{readOnly:t}),key:"params"+e.id,value:e.taskParams,onFocus:function(){},focusOut:function(){},onChange:this.handleTaskParamChange.bind(this)}))]);else if($.a.checkExist(e.type))return g.a.createElement(Vn,{tab:g.a.createElement("span",{className:"title-vertical"},"脚本属性"),key:"params1"},g.a.createElement(Ba,{tabData:e}));return a}},{key:"render",value:function(){var e=this;return g.a.createElement("div",{className:"m-siderbench bd-left padding-r0",ref:function(t){e.SideBench=t}},g.a.createElement(G.a,{activeKey:this.state.selected,type:"card",className:"task-params",tabPosition:"right",onTabClick:this.tabClick},this.getTabPanes()))}}]),t}(g.a.Component),Pn=Object(k.b)(function(e){return{}},function(e){return{setTaskParams:function(t){e({type:v.o.SET_TASK_FIELDS_VALUE_SILENT,payload:t})}}})(Un),qn=Pn,Bn=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Vn,"TabPane","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/siderBench.js"),__REACT_HOT_LOADER__.register(Un,"SiderBench","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/siderBench.js"),__REACT_HOT_LOADER__.register(Pn,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/siderBench.js")),a(152)),Kn=q.a.Item,Wn=_e.a.Option,Gn=ce.a.Group,zn=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.state={radio:1},n.splitChange=function(){var e;return(e=n).__splitChange__REACT_HOT_LOADER__.apply(e,arguments)},n.charsetChange=function(){var e;return(e=n).__charsetChange__REACT_HOT_LOADER__.apply(e,arguments)},n.asTitle=function(){var e;return(e=n).__asTitle__REACT_HOT_LOADER__.apply(e,arguments)},n.changeStartLine=function(){var e;return(e=n).__changeStartLine__REACT_HOT_LOADER__.apply(e,arguments)},n.radioChange=function(){var e;return(e=n).__radioChange__REACT_HOT_LOADER__.apply(e,arguments)},n.generateCols=function(){var e;return(e=n).__generateCols__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"__splitChange__REACT_HOT_LOADER__",value:function(e){this.props.changeStatus({splitSymbol:e})}},{key:"__charsetChange__REACT_HOT_LOADER__",value:function(e){this.props.changeStatus({charset:e})}},{key:"__asTitle__REACT_HOT_LOADER__",value:function(e){var t=e.target.checked;this.props.changeStatus({asTitle:t,matchType:t?1:0})}},{key:"__changeStartLine__REACT_HOT_LOADER__",value:function(e){var t=this.props.formState,a=e.target.value;a=a>t.originLineCount?t.originLineCount:a,this.props.changeStatus({startLine:a})}},{key:"__radioChange__REACT_HOT_LOADER__",value:function(e){this.setState({radio:e.target.value})}},{key:"__generateCols__REACT_HOT_LOADER__",value:function(e,t){if(t&&t.length>0){var a=[];return e?(t.forEach(function(e,t){a.push({title:e,width:100,key:t+e,render:function(e,a){return g.a.createElement(Bn.a,{style:{minWidth:100},value:a[t]})}})}),a):(t.forEach(function(e,t){var n="col-"+(t+1);a.push({key:n,width:100,title:n,render:function(e,a){return g.a.createElement(Bn.a,{style:{minWidth:100},value:a[t]})}})}),a)}return[]}},{key:"getRowKey",value:function(e,t){return(e.length>0?e[0]:"")+"-"+t}},{key:"render",value:function(){var e=this,t=this.props,a=t.data,n=t.file,s=t.display,i=t.formState,l=this.generateCols(i.asTitle,a[0]),o=i.asTitle?a.slice(1):a,c=this.state.radio;return g.a.createElement("div",{style:{display:"source"===s?"block":"none"}},g.a.createElement(r.a,null,g.a.createElement(q.a,null,g.a.createElement(Kn,x()({},X.t,{label:"已选文件"}),g.a.createElement("span",{style:{fontSize:"14px"}},n.name||""),"  ",g.a.createElement("span",{style:{color:"#f60"}},"只支持.txt、.csv和.log文件类型")),g.a.createElement(Kn,x()({},X.t,{label:"分隔符"}),g.a.createElement(Gn,{onChange:this.radioChange,defaultValue:1},g.a.createElement(ce.a,{value:1}),g.a.createElement(_e.a,{disabled:2===c,style:{width:"80px"},value:i.splitSymbol,onChange:this.splitChange},g.a.createElement(Wn,{value:","},"逗号"),g.a.createElement(Wn,{value:"tab"},"Tab"),g.a.createElement(Wn,{value:";"},"分号"),g.a.createElement(Wn,{value:"blank"},"空格"),g.a.createElement(Wn,{value:"|"},"|"),g.a.createElement(Wn,{value:"#"},"#"),g.a.createElement(Wn,{value:"&"},"&")),"  ",g.a.createElement(ce.a,{value:2},"自定义"),g.a.createElement(w.a,{disabled:1===c,onChange:function(t){e.splitChange(t.target.value)},style:{width:"80px"}}))),g.a.createElement(Kn,x()({},X.t,{label:"原始字符集"}),g.a.createElement(_e.a,{value:i.charset,onChange:this.charsetChange},g.a.createElement(Wn,{value:"UTF-8"},"UTF-8"),g.a.createElement(Wn,{value:"GBK"},"GBK"),g.a.createElement(Wn,{value:"CP936"},"CP936"),g.a.createElement(Wn,{value:"ISO-8859"},"ISO-8859"))),g.a.createElement(Kn,x()({},X.t,{label:"导入起始行"}),g.a.createElement(w.a,{onChange:this.changeStartLine,type:"number",min:1,max:a.length,value:i.startLine})),g.a.createElement(Kn,x()({},X.t,{label:"首行为标题"}),g.a.createElement(mt.a,{checked:i.asTitle,onChange:this.asTitle},"是")))),g.a.createElement(r.a,{className:"no-table-padding"},g.a.createElement(le.a,{rowKey:this.getRowKey,scroll:{y:240,x:800},bordered:!0,dataSource:o,columns:l})))}}]),t}(T.Component),Yn=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Kn,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataImport/source.js"),__REACT_HOT_LOADER__.register(Wn,"Option","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataImport/source.js"),__REACT_HOT_LOADER__.register(Gn,"RadioGroup","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataImport/source.js"),__REACT_HOT_LOADER__.register(zn,"ImportSource","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataImport/source.js")),a(55)),Qn=a(350),$n=a(699),Jn=ce.a.Group,Xn=q.a.Item,Zn=_e.a.Option,er=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.state={visible:!1,pagination:{current:1,pageSize:10}},n.tableInput=function(){var e;return(e=n).__tableInput__REACT_HOT_LOADER__.apply(e,arguments)},n.tbNameOnChange=function(){var e;return(e=n).__tbNameOnChange__REACT_HOT_LOADER__.apply(e,arguments)},n.debounceSearch=Object(b.debounce)(n.tableInput,500,{maxWait:2e3}),n.tableChange=function(){var e;return(e=n).__tableChange__REACT_HOT_LOADER__.apply(e,arguments)},n.checkPartition=function(){var e;return(e=n).__checkPartition__REACT_HOT_LOADER__.apply(e,arguments)},n.createTable=function(){var e;return(e=n).__createTable__REACT_HOT_LOADER__.apply(e,arguments)},n.handleCancel=function(){var e;return(e=n).__handleCancel__REACT_HOT_LOADER__.apply(e,arguments)},n.mapChange=function(){var e;return(e=n).__mapChange__REACT_HOT_LOADER__.apply(e,arguments)},n.changeMatchWay=function(){var e;return(e=n).__changeMatchWay__REACT_HOT_LOADER__.apply(e,arguments)},n.changeImportMode=function(){var e;return(e=n).__changeImportMode__REACT_HOT_LOADER__.apply(e,arguments)},n.tablePartitionChange=function(){var e;return(e=n).__tablePartitionChange__REACT_HOT_LOADER__.apply(e,arguments)},n.ddlChange=function(){var e;return(e=n).__ddlChange__REACT_HOT_LOADER__.apply(e,arguments)},n.generateCols=function(){var e;return(e=n).__generateCols__REACT_HOT_LOADER__.apply(e,arguments)},n.generatePartitions=function(){var e;return(e=n).__generatePartitions__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props.visible,a=e.visible;t==a||a||this.setState({pagination:{current:1,pageSize:10}})}},{key:"__tableInput__REACT_HOT_LOADER__",value:function(e){var t=this.props.changeStatus;e.length>0&&Yn.a.getTablesByName({tableName:e}).then(function(e){1===e.code&&t({tableList:e.data||[]})})}},{key:"__tbNameOnChange__REACT_HOT_LOADER__",value:function(e){var t={queryTable:e};""===e&&(t.tableData={}),this.props.changeStatus(t)}},{key:"__tableChange__REACT_HOT_LOADER__",value:function(e,t){var a=t.props.data,n=this.props,r=n.changeStatus,s=n.data[0]||[];Yn.a.getTable({tableId:a.id}).then(function(e){if(1===e.code){var t=e.data,n=t.column&&t.column.map(function(e){var t=e.columnName;return s.indexOf(t)>-1?t:""}),i=t.partition&&t.partition.map(function(e){return se()({},e.columnName,"")});r({targetTable:a,queryTable:a.tableName,tableData:t,hasPartition:t.partition&&t.partition.length>0,columnMap:n,originPartitions:t.partition,partitions:i,targetExchangeWarning:!1})}})}},{key:"__checkPartition__REACT_HOT_LOADER__",value:function(){for(var e=this.props.formState,t=e.targetTable,a=e.partitions,n=e.originPartitions,r=0;r<a.length;r++){var s=a[r],i=n[r].columnName;if(""===$.a.trim(s[i]))return void j.a.error("分区值不可为空！")}Yn.a.checkTablePartition({tableId:t.id,partitionInfo:a}).then(function(e){e.data?j.a.success("分区存在！"):j.a.error("分区不存在！")})}},{key:"__createTable__REACT_HOT_LOADER__",value:function(){var e=this,t=this.props.formState.sqlText;Yn.a.createDdlTable({sql:t}).then(function(t){1===t.code&&(e.setState({visible:!1,tableList:[t.data]}),e.tbNameOnChange(t.data.id),e.tableChange(t.data.id,{props:{data:t.data}}),j.a.success("表创建成功!"))})}},{key:"__handleCancel__REACT_HOT_LOADER__",value:function(){this.setState({visible:!1})}},{key:"__mapChange__REACT_HOT_LOADER__",value:function(e,t){var a=this.props,n=a.formState,r=a.changeStatus,s=[].concat(Ln()(n.columnMap));s[t]=e,r({columnMap:s,targetExchangeWarning:!1})}},{key:"onTableChange",value:function(e){this.setState({pagination:e})}},{key:"__changeMatchWay__REACT_HOT_LOADER__",value:function(e){this.props.formState.asTitle&&this.props.changeStatus({matchType:e.target.value,targetExchangeWarning:!1})}},{key:"__changeImportMode__REACT_HOT_LOADER__",value:function(e){this.props.changeStatus({overwriteFlag:e.target.value})}},{key:"__tablePartitionChange__REACT_HOT_LOADER__",value:function(e,t,a){var n=this.props.formState.partitions,r=[].concat(Ln()(n));r[a]=se()({},t.columnName,e.target.value),this.props.changeStatus({partitions:r})}},{key:"__ddlChange__REACT_HOT_LOADER__",value:function(e,t){(0,this.props.changeStatus)({sqlText:t})}},{key:"__generateCols__REACT_HOT_LOADER__",value:function(e){var t=this,a=this.props,n=a.formState,r=a.warning,s=this.state.pagination,i=n.columnMap,l=e?e[0].map(function(e,t){return g.a.createElement(Zn,{key:"col-"+t,value:e},e)}):[];return[{title:"目标字段",key:"target_part",render:function(e,t){return g.a.createElement("span",null,t.columnName)}},{title:g.a.createElement("span",null,"源字段 ",r&&g.a.createElement("span",{style:{color:"#ce3b3b",float:"right"}},"请至少选择一个源字段")),key:"source_part",render:function(e,a,r){var o=r+(s.current-1)*s.pageSize;return g.a.createElement("span",null,g.a.createElement(_e.a,{value:0===n.matchType?"":i[o],disabled:0===n.matchType,onSelect:function(e){t.mapChange(e,o)},style:{width:"200px"}},g.a.createElement(Zn,{key:"col-null",value:""},"空字段"),l))}}]}},{key:"__generatePartitions__REACT_HOT_LOADER__",value:function(e){var t=this;return e.map(function(a,n){return g.a.createElement(r.a,{key:"partition-"+n},g.a.createElement("div",{className:"ellipsis",title:a.columnName,style:{width:"60px",display:"inline-block"}},a.columnName),g.a.createElement(w.a,{style:{width:"140px"},onChange:function(e){t.tablePartitionChange(e,a,n)},placeholder:"请输入分区名称"}),"  ",0===n?g.a.createElement(I.a,{type:"primary",onClick:t.checkPartition},"检测"):"",n===e.length-1?g.a.createElement("span",{style:{color:"#f60"}},g.a.createElement("br",null),'点击"检测"按钮，测试分区是否存在'):"")})}},{key:"render",value:function(){var e=this,t=this.props,a=t.data,n=(t.file,t.display),s=t.formState,i=s.tableList,l=s.tableData,o=s.queryTable,c=s.asTitle,u=this.state.pagination,_=this.generateCols(a,l),p=this.generatePartitions(l.partition||[]),d=l&&l.column,m=i.map(function(e,t){return g.a.createElement(Zn,{key:"table-"+t,data:e,value:e.tableName},e.tableName)});return g.a.createElement("div",{style:{display:"target"===n?"block":"none"}},g.a.createElement(r.a,null,g.a.createElement(q.a,null,g.a.createElement(Xn,x()({},X.t,{label:"导入至表"}),g.a.createElement("div",null,g.a.createElement(_e.a,{mode:"combobox",style:{width:"200px"},onChange:this.tbNameOnChange,onSearch:this.debounceSearch,onSelect:this.tableChange,notFoundContent:"没有发现相关表",value:o,placeholder:"请输入表名",showArrow:!1,filterOption:!1,defaultActiveFirstOption:!1},m),"  ",g.a.createElement(I.a,{type:"primary",onClick:function(){e.setState({visible:!0})}},"新建表"))),g.a.createElement(Xn,x()({},X.t,{style:{display:l.partition&&l.partition.length>0?"block":"none"},label:"分区"}),p),g.a.createElement(Xn,x()({},X.t,{label:"字段匹配"}),g.a.createElement(Jn,{value:s.matchType,onChange:this.changeMatchWay},g.a.createElement(ce.a,{value:0},"按位置匹配"),g.a.createElement(ce.a,{disabled:!c,value:1},"按名称匹配"))),g.a.createElement(Xn,x()({},X.t,{label:"导入模式"}),g.a.createElement(Jn,{value:s.overwriteFlag,onChange:this.changeImportMode},g.a.createElement(ce.a,{value:0},"写入"),g.a.createElement(ce.a,{value:1},"覆盖"))))),g.a.createElement(r.a,null,g.a.createElement(le.a,{className:"m-table",bordered:!0,columns:_,dataSource:d,onChange:this.onTableChange.bind(this),pagination:u})),g.a.createElement(K.a,{className:"m-codemodal",title:g.a.createElement("span",null,"建表语句",g.a.createElement(Qn.a,{style:{marginLeft:"8px"},copyText:$n.a})),maskClosable:!1,style:{height:424},visible:this.state.visible,onCancel:this.handleCancel,onOk:this.createTable},g.a.createElement(Vt.a,{placeholder:$n.a,onChange:this.ddlChange})))}}]),t}(T.Component),tr=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(Jn,"RadioGroup","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataImport/target.js"),__REACT_HOT_LOADER__.register(Xn,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataImport/target.js"),__REACT_HOT_LOADER__.register(Zn,"Option","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataImport/target.js"),__REACT_HOT_LOADER__.register(er,"ImportTarget","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataImport/target.js")),{file:"",startLine:1,asTitle:!0,visible:!1,sourceFile:"",data:[],splitSymbol:",",charset:"UTF-8",step:"source",tableData:{},targetTable:"",tableList:[],partitions:[],hasPartition:!1,originPartitions:[],columnMap:[],matchType:1,sqlText:"",queryTable:"",overwriteFlag:0,originLineCount:0,targetExchangeWarning:!1}),ar=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,i=Array(s),l=0;l<s;l++)i[l]=arguments[l];return a=n=h()(this,(e=t.__proto__||u()(t)).call.apply(e,[this].concat(i))),n.state=Wa()({},tr),n.importData=function(){var e;return(e=n).__importData__REACT_HOT_LOADER__.apply(e,arguments)},n.checkParams=function(){var e;return(e=n).__checkParams__REACT_HOT_LOADER__.apply(e,arguments)},n.getParams=function(){var e;return(e=n).__getParams__REACT_HOT_LOADER__.apply(e,arguments)},n.fileChange=function(){var e;return(e=n).__fileChange__REACT_HOT_LOADER__.apply(e,arguments)},n.fileClick=function(){var e;return(e=n).__fileClick__REACT_HOT_LOADER__.apply(e,arguments)},n.readFile=function(){var e;return(e=n).__readFile__REACT_HOT_LOADER__.apply(e,arguments)},n.changeStatus=function(){var e;return(e=n).__changeStatus__REACT_HOT_LOADER__.apply(e,arguments)},n.next=function(){var e;return(e=n).__next__REACT_HOT_LOADER__.apply(e,arguments)},n.prev=function(){var e;return(e=n).__prev__REACT_HOT_LOADER__.apply(e,arguments)},r=a,h()(n,r)}return y()(t,e),m()(t,[{key:"__importData__REACT_HOT_LOADER__",value:function(){var e=this,t=this.getParams();this.checkParams(t)&&(t.partitions=_n()(t.partitions),t.keyRef=_n()(t.keyRef),Yn.a.importLocalData(t).then(function(t){if(1===t.code){var a="您已经成功导入"+t.data+"条数据！";j.a.success(a),e.setState({visible:!1})}}))}},{key:"__checkParams__REACT_HOT_LOADER__",value:function(e){var t=!0,a=this.state,n=a.originPartitions,r=a.columnMap,s=a.matchType,i=e.partitions;if(!e.tableId)return j.a.error("请选择要导入的目标表！"),!1;if(1==s){for(var l=!0,o=0;o<r.length;o++){if(r[o]){l=!1;break}}if(l)return this.setState({targetExchangeWarning:!0}),!1}if(n&&n.length>0){for(var c=!0,u=0;u<i.length;u++){""===i[u][n[u].columnName]&&(t=!1,c=!1)}c||j.a.error("分区每项值必填！")}return t}},{key:"__getParams__REACT_HOT_LOADER__",value:function(){var e=this.state,t=e.file,a=e.targetTable,n=e.splitSymbol,r=e.charset,s=e.startLine,i=e.asTitle,l=e.matchType,o=e.columnMap,c=e.partitions,u=e.overwriteFlag;return{tableId:a.id,separator:n,oriCharset:r,topLineIsTitle:i,keyRef:o,file:t,matchType:l,startLine:s,partitions:c,overwriteFlag:u}}},{key:"__fileChange__REACT_HOT_LOADER__",value:function(e){var t=this,a=e.target.files[0];a.size>52428800?j.a.error("本地上传文件不可超过50MB!"):this.setState({file:a},function(){t.readFile(a)})}},{key:"__fileClick__REACT_HOT_LOADER__",value:function(e){e.target.value=null,this.setState(Wa()({},tr))}},{key:"__readFile__REACT_HOT_LOADER__",value:function(e){var t=this,a=this.state.charset;if(e){var n=new FileReader;e.type.split("/")[1];n.onload=function(e){t.setState({sourceFile:e.target.result}),t.parseFile(e.target.result)},n.readAsText(e,a)}}},{key:"parseFile",value:function(e){var t=this.state,a=t.splitSymbol,n=t.startLine,r=[],s=this.parseSplitSymbol(a);if((e=e.split("\n"))&&e[0].length>5e3)j.a.error("文件内容不正确！");else{for(var i=0;i<e.length;i++){var l=e[i].replace(/\r/,"");r.push(l.split(s))}var o=r.slice(n-1);this.setState({data:o,step:"source",visible:!0,originLineCount:e.length})}}},{key:"parseSplitSymbol",value:function(e){switch(e){case"blank":e=" ";break;case"tab":e="\t"}return e}},{key:"__changeStatus__REACT_HOT_LOADER__",value:function(e){var t=this,a=this.state.file;this.setState(e,function(){t.readFile(a)})}},{key:"__next__REACT_HOT_LOADER__",value:function(){this.setState({step:"target"})}},{key:"__prev__REACT_HOT_LOADER__",value:function(){this.setState({step:"source"})}},{key:"footer",value:function(){var e=this,t=this.state.step;return g.a.createElement("div",null,g.a.createElement(I.a,{onClick:function(){e.setState({visible:!1})}},"取消"),g.a.createElement(I.a,{style:{display:"source"===t?"inline-block":"none"},type:"primary",onClick:this.next},"下一步"),g.a.createElement(I.a,{style:{display:"target"===t?"inline-block":"none"},type:"primary",onClick:this.prev},"上一步"),g.a.createElement(I.a,{style:{display:"target"===t?"inline-block":"none"},onClick:this.importData,type:"primary"},"导入"))}},{key:"render",value:function(){var e=this,t=this.state,a=t.data,n=t.file,r=t.visible,s=t.step,i=t.targetExchangeWarning;return g.a.createElement("div",null,g.a.createElement("input",{name:"file",type:"file",accept:".txt, .log, .csv",id:"importFile",onClick:this.fileClick,onChange:this.fileChange,style:{display:"none"}}),g.a.createElement(K.a,{maskClosable:!1,title:"本地数据导入",visible:r,onCancel:function(){e.setState({visible:!1})},footer:this.footer()},g.a.createElement(zn,{data:a,file:n,display:s,formState:this.state,changeStatus:this.changeStatus}),g.a.createElement(er,{visible:r,warning:i,data:a,file:n,formState:this.state,changeStatus:function(t){e.setState(t)},display:s})))}}]),t}(T.Component),nr=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(tr,"defaultState","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataImport/index.js"),__REACT_HOT_LOADER__.register(ar,"ImportLocalData","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/dataImport/index.js")),a(1466),G.a.TabPane),rr=K.a.confirm,sr=q.a.Item,ir=function(e){function t(e){p()(this,t);var a=h()(this,(t.__proto__||u()(t)).call(this,e));return a.state={visible:!1,showPublish:!1,theReqIsEnd:!0},a.handleMenuClick=function(){return a.__handleMenuClick__REACT_HOT_LOADER__.apply(a,arguments)},a.handleCreateClick=function(){return a.__handleCreateClick__REACT_HOT_LOADER__.apply(a,arguments)},a.createMenu=function(){return a.__createMenu__REACT_HOT_LOADER__.apply(a,arguments)},a.importMenu=function(){return a.__importMenu__REACT_HOT_LOADER__.apply(a,arguments)},a.renderPublish=function(){return a.__renderPublish__REACT_HOT_LOADER__.apply(a,arguments)},a.publishChange=function(){return a.__publishChange__REACT_HOT_LOADER__.apply(a,arguments)},a.closePublish=function(){return a.__closePublish__REACT_HOT_LOADER__.apply(a,arguments)},a}return y()(t,e),m()(t,[{key:"__handleMenuClick__REACT_HOT_LOADER__",value:function(e){if("1"===e.key){var t=document.getElementById("importFile");t&&t.click()}}},{key:"__handleCreateClick__REACT_HOT_LOADER__",value:function(e){"task"===e.key?this.props.toggleCreateTask():"script"===e.key&&this.props.toggleCreateScript()}},{key:"__createMenu__REACT_HOT_LOADER__",value:function(){var e=this.props.scriptTreeData;return g.a.createElement(U.a,{onClick:this.handleCreateClick},g.a.createElement(U.a.Item,{key:"task"},"创建任务"),e&&g.a.createElement(U.a.Item,{key:"script"},"创建脚本"))}},{key:"__importMenu__REACT_HOT_LOADER__",value:function(){return g.a.createElement(U.a,{onClick:this.handleMenuClick},g.a.createElement(U.a.Item,{key:"1"},"导入本地数据"))}},{key:"showPublish",value:function(){var e=this.props.currentTabData,t=e.taskType,a=(e.createModel,!0);switch(t){case X.q.SYNC:e.createModel==X.e.SCRIPT&&(a=this.checkSyncScript(e))}a&&this.setState({showPublish:!0})}},{key:"checkSyncScript",value:function(e){var t=e.sqlText;return!!$.a.jsonFormat(t)||(j.a.error("请确认JSON格式是否正确"),!1)}},{key:"render",value:function(){var e=this.props,t=e.tabs,a=e.currentTab,n=e.currentTabData,s=e.dataSync,l=e.taskCustomParams,c=s.sourceMap,u=s.targetMap,_=this.state.theReqIsEnd,p=!1;Object(b.isEmpty)(c)||Object(b.isEmpty)(u)||(p=!0),n&&(n.taskType!==X.q.SYNC||n.createModel==X.e.SCRIPT&&n.taskType==X.q.SYNC)&&(p=!0),n&&n.readWriteLockVO&&!n.readWriteLockVO.getLock&&(p=!1),p=n&&!n.invalid||!_;var d=n&&$.a.checkExist(n.taskType),m=!d||n.notSynced,E=d;return g.a.createElement(r.a,{className:"m-workbench task-editor"},g.a.createElement("header",{className:"toolbar bd-bottom clear"},g.a.createElement(o.a,{className:"left"},g.a.createElement(N.a,{overlay:this.createMenu(),trigger:["click"]},g.a.createElement(I.a,{title:"创建"},g.a.createElement(O.a,{className:"my-icon",type:"focus"}),"新建",g.a.createElement(i.a,{type:"down"}))),g.a.createElement(I.a,{onClick:this.saveTab.bind(this,!0),title:"保存任务",disabled:!p},g.a.createElement(O.a,{className:"my-icon",type:"save"}),"保存"),g.a.createElement(N.a,{overlay:this.importMenu(),trigger:["click"]},g.a.createElement(I.a,null,g.a.createElement(O.a,{className:"my-icon",type:"import"}),"导入",g.a.createElement(i.a,{type:"down"})))),E?g.a.createElement(o.a,{className:"right"},g.a.createElement(I.a,{disabled:m,onClick:this.showPublish.bind(this),title:"发布任务"},g.a.createElement(O.a,{className:"my-icon",type:"fly"}),"发布"),g.a.createElement(z.c,{to:"/operation/offline-management?tname="+(n&&n.name)},g.a.createElement(I.a,{disabled:!d},g.a.createElement(O.a,{className:"my-icon",type:"goin"})," 运维"))):null),g.a.createElement(r.a,{className:"task-browser"},g.a.createElement("div",{className:"browser-content"},g.a.createElement(G.a,{hideAdd:!0,onTabClick:this.switchTab.bind(this,a),activeKey:""+a,type:"editable-card",className:"browser-tabs",onEdit:this.closeTab.bind(this),tabBarExtraContent:g.a.createElement(N.a,{overlay:g.a.createElement(U.a,{style:{marginRight:2},onClick:this.closeAllorOthers.bind(this)},g.a.createElement(U.a.Item,{key:"OHTERS"},"关闭其他"),g.a.createElement(U.a.Item,{key:"ALL"},"关闭所有"))},g.a.createElement(i.a,{type:"bars",style:{margin:"10 0 0 0"}}))},this.renderTabs(t)),g.a.createElement(Da,{tabData:n,taskCustomParams:l,updateTaskFields:this.props.updateTaskFields,updateCatalogue:this.props.updateCatalogue}),g.a.createElement(qn,{tabData:n,key:n&&n.id}))),g.a.createElement(ar,{visible:this.state.visible}),this.renderPublish())}},{key:"__renderPublish__REACT_HOT_LOADER__",value:function(){var e=this.props.user,t=this.state.publishDesc;return g.a.createElement(K.a,{wrapClassName:"vertical-center-modal",title:"发布任务",style:{height:"600px",width:"600px"},visible:this.state.showPublish,onCancel:this.closePublish,onOk:this.submitTab.bind(this),cancelText:"关闭"},g.a.createElement(q.a,null,g.a.createElement(sr,x()({},X.t,{label:"发布人",hasFeedback:!0}),g.a.createElement("span",null,e.userName)),g.a.createElement(sr,x()({},X.t,{label:g.a.createElement("span",{className:"ant-form-item-required"},"备注"),hasFeedback:!0}),g.a.createElement(w.a,{type:"textarea",value:t,name:"publishDesc",rows:4,onChange:this.publishChange}))))}},{key:"__publishChange__REACT_HOT_LOADER__",value:function(e){this.setState({publishDesc:e.target.value})}},{key:"__closePublish__REACT_HOT_LOADER__",value:function(){this.setState({publishDesc:"",showPublish:!1})}},{key:"closeAllorOthers",value:function(e){var t=e.key,a=this.props,n=a.tabs,r=a.closeAll,s=a.currentTab,i=a.closeOthers;if("ALL"===t){var l=!0,o=!0,c=!1,u=void 0;try{for(var _,p=S()(n);!(o=(_=p.next()).done);o=!0){_.value.notSynced&&(l=!1);break}}catch(e){c=!0,u=e}finally{try{!o&&p.return&&p.return()}finally{if(c)throw u}}l?this.props.closeAll(n):rr({title:"部分任务修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃所有修改数据",onOk:function(){r(n)},onCancel:function(){}})}else{var d=!0,m=!0,E=!1,h=void 0;try{for(var f,y=S()(n);!(m=(f=y.next()).done);m=!0){var T=f.value;T.notSynced&&T.id!==s&&(d=!1);break}}catch(e){E=!0,h=e}finally{try{!m&&y.return&&y.return()}finally{if(E)throw h}}d?i(s,n):rr({title:"部分任务修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃这些修改数据",onOk:function(){i(s,n)},onCancel:function(){}})}}},{key:"renderTabs",value:function(e){return e&&e.length>0?e.map(function(e){var t=g.a.createElement("span",null,g.a.createElement(Z.a,{notSynced:e.notSynced}),e.name);return g.a.createElement(nr,{style:{height:"0px"},tab:t,key:e.id})}):[]}},{key:"saveTab",value:function(e){var t=this;this.setState({theReqIsEnd:!1});var a=this.props,n=a.saveTab,r=a.dataSync,s=a.currentTabData,i=(a.currentTab,this.generateRqtBody(r)),l="task";$.a.checkExist(s.taskType)||(i=s,l="script"),i.preSave=!0,i.submitStatus=0,n(i,e,l),setTimeout(function(){t.setState({theReqIsEnd:!0})},500)}},{key:"submitTab",value:function(){var e=this,t=this.props,a=t.publishTask,n=t.dataSync,r=t.currentTab,s=t.reloadTabTask,i=this.state.publishDesc,l=this.generateRqtBody(n);return i?i.length>200?(j.a.error("备注信息不可超过200个字符！"),!1):(l.preSave=!0,l.submitStatus=1,l.publishDesc=i,void J.a.publishOfflineTask(l).then(function(t){1===t.code?(j.a.success("发布成功！"),a(t),s(r),e.closePublish()):(j.a.error("发布失败！"),e.closePublish())})):(j.a.error("发布备注不可为空！"),!1)}},{key:"switchTab",value:function(e,t){var a=this.props.openTab;+t!==e&&a(+t)}},{key:"closeTab",value:function(e){var t=this.props,a=t.closeTab;t.tabs.filter(function(t){return t.id==e})[0].notSynced?rr({title:"修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃当前修改数据",onOk:function(){a(+e)},onCancel:function(){}}):a(+e)}},{key:"generateRqtBody",value:function(e){var t=Object(b.cloneDeep)(e),a=this.props,n=a.tabs,r=a.currentTab,s=a.currentTabData,i=t.keymap,l=t.sourceMap,o=t.targetMap,c=i.source,u=i.target,_=this.props;_.name,_.id;t.sourceMap.column=c,t.targetMap.column=u,t.settingMap=t.setting,t.name=s.name,t.taskId=s.id;var p=o.type,d=l.type;for(var m in d)d.hasOwnProperty(m)&&(l[m]=d[m]);for(var E in p)p.hasOwnProperty(E)&&(o[E]=p[E]);delete t.keymap,delete t.setting,delete t.dataSourceList;var h=Object(b.cloneDeep)(n.filter(function(e){return e.id===r})[0]);for(var f in t)t.hasOwnProperty(f)&&(h[f]=t[f]);return h.preSave=!0,h.taskVOS&&(h.dependencyTasks=h.taskVOS.map(function(e){return e}),h.taskVOS=null),delete h.taskVersions,h}}]),t}(g.a.Component),lr=function(e){var t=e.offlineTask,a=t.workbench,n=t.dataSync,r=t.scriptTree,s=a.currentTab,i=a.tabs,l=a.taskCustomParams,o=i.filter(function(e){return e.id===s})[0];return{currentTab:s,currentTabData:o,tabs:i,dataSync:n,taskCustomParams:l,user:e.user,scriptTreeData:r}},or=function(e){var t=Object(Ke.b)(e);return{openTab:function(t){e({type:v.o.OPEN_TASK_TAB,payload:t}),e({type:v.c.SET_SELECTION_CONTENT,data:""})},updateTaskFields:function(t){return e({type:v.o.SET_TASK_FIELDS_VALUE,payload:t})},updateCatalogue:function(t){e({type:v.n.EDIT_FOLDER_CHILD_FIELDS,payload:t})},closeTab:function(t){e(Object(Ea.b)(t,null,!0)),e({type:v.o.CLOSE_TASK_TAB,payload:t})},closeAll:function(t){for(var a in t)e(Object(Ea.b)(t[a].id,null,!0));e({type:v.o.CLOSE_ALL_TABS})},closeOthers:function(t,a){for(var n in a)a[n].id!=t&&e(Object(Ea.b)(a[n].id,null,!0));e({type:v.o.CLOSE_OTHER_TABS,payload:t})},saveTab:function(t,a,n){var r=function(t){e({type:v.o.SET_TASK_FIELDS_VALUE,payload:t}),e({type:v.o.MAKE_TAB_CLEAN})},s=function(e){if(1===e.code){var s=e.data,i=s.readWriteLockVO,l=i.result;0===l?(j.a.success(a?"保存成功！":"发布成功！"),r({version:s.version,readWriteLockVO:s.readWriteLockVO})):1===l?rr({title:"锁定提醒",content:g.a.createElement("span",null,"文件正在被",i.lastKeepLockUserName,"编辑中，开始编辑时间为",$.a.formatDateTime(i.gmtModified),"。 强制保存可能导致",i.lastKeepLockUserName,"对文件的修改无法正常保存！"),okText:"确定保存",okType:"danger",cancelText:"取消",onOk:function(){var e=function(e){1===e.code&&(j.a.success("保存成功！"),r({version:e.data.version,readWriteLockVO:e.data.readWriteLockVO}))};"task"===n?J.a.forceUpdateOfflineTask(t).then(e):"script"===n&&J.a.forceUpdateOfflineScript(t).then(e)}}):2===l&&rr({title:"保存警告",content:g.a.createElement("span",null,"文件已经被",i.lastKeepLockUserName,"编辑过，编辑时间为",$.a.formatDateTime(i.gmtModified),"。 点击确认按钮会",g.a.createElement(A.a,{color:"orange"},"覆盖"),"您本地的代码，请您提前做好备份！"),okText:"确定覆盖",okType:"danger",cancelText:"取消",onOk:function(){var e={id:t.id,lockVersion:i.version};"task"===n?J.a.getOfflineTaskDetail(e).then(function(e){if(1===e.code){var t=e.data;t.merged=!0,r(t)}}):"script"===n&&J.a.getScriptById(e).then(function(e){if(1===e.code){var t=e.data;t.merged=!0,r(t)}})}})}};t.lockVersion=t.readWriteLockVO.version,"task"===n?J.a.saveOfflineJobData(t).then(s):"script"===n&&J.a.saveScript(t).then(s)},goToTaskDev:function(e){t.openTaskInDev(e)},reloadTabTask:function(e){t.reloadTabTask(e)},publishTask:function(t){e({type:v.o.CHANGE_TASK_SUBMITSTATUS,payload:t.data&&t.data.submitStatus||1}),e({type:v.o.MAKE_TAB_CLEAN})},toggleCreateTask:function(){e({type:v.f.TOGGLE_CREATE_TASK})},toggleCreateFolder:function(t){e({type:v.f.TOGGLE_CREATE_FOLDER,payload:t})},toggleCreateScript:function(){e({type:v.f.TOGGLE_CREATE_SCRIPT})}}},cr=Object(k.b)(lr,or)(ir),ur=cr,_r=("undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(nr,"TabPane","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/workbench.js"),__REACT_HOT_LOADER__.register(rr,"confirm","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/workbench.js"),__REACT_HOT_LOADER__.register(sr,"FormItem","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/workbench.js"),__REACT_HOT_LOADER__.register(ir,"Workbench","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/workbench.js"),__REACT_HOT_LOADER__.register(lr,"mapState","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/workbench.js"),__REACT_HOT_LOADER__.register(or,"mapDispatch","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/workbench.js"),__REACT_HOT_LOADER__.register(cr,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/workbench.js")),function(e){function t(){return p()(this,t),h()(this,(t.__proto__||u()(t)).apply(this,arguments))}return y()(t,e),m()(t,[{key:"render",value:function(){var e=this.props,t=(e.createTask,e.upload,e.workbench),a=e.scriptTree,n=e.toggleCreateTask,s=e.toggleUpload,l=e.toggleCreateScript,c={width:"60px",height:"60px",marginTop:"25px"};return t.tabs.length?g.a.createElement(ur,null):g.a.createElement(r.a,{className:"box-card txt-left",style:{paddingTop:"30px"}},g.a.createElement(o.a,{className:"operation-card"},g.a.createElement("div",{onClick:n,className:"operation-content"},g.a.createElement(O.a,{style:c,type:"add-file"})),g.a.createElement("p",{className:"txt-center"},"创建离线任务")),g.a.createElement(o.a,{className:"operation-card"},g.a.createElement("div",{onClick:s,className:"operation-content"},g.a.createElement(O.a,{style:c,type:"upload"})),g.a.createElement("p",{className:"txt-center"},"上传离线计算资源")),!Object(b.isEmpty)(a)&&g.a.createElement(o.a,{className:"operation-card"},g.a.createElement("div",{onClick:l,className:"operation-content"},g.a.createElement(i.a,{style:c,type:"code-o"})),g.a.createElement("p",{className:"txt-center"},"创建脚本")))}}]),t}(T.Component)),pr=Object(k.b)(function(e){var t=e.offlineTask.modalShow,a=t.createTask,n=t.upload,r=e.offlineTask;return{createTask:a,upload:n,workbench:r.workbench,scriptTree:r.scriptTree}},function(e){return{toggleCreateTask:function(){e({type:v.f.TOGGLE_CREATE_TASK})},toggleUpload:function(){e({type:v.f.TOGGLE_UPLOAD})},toggleCreateScript:function(){e({type:v.f.TOGGLE_CREATE_SCRIPT})}}})(_r);t.default=pr,"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(_r,"Default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/default.js"),__REACT_HOT_LOADER__.register(pr,"default","/Users/xuexiaokang/Documents/数据中台/git/data-stack-web/src/webapps/rdos/views/task/offline/default.js"))}}]);