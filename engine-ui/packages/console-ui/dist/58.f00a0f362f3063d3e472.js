(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{UCWl:function(e,t,a){"use strict";a.r(t);a("hr7U");var n,r,i,l,o=a("9xET"),s=a.n(o),c=(a("fv9D"),a("ZPTe")),p=a.n(c),u=(a("MaXC"),a("4IMT")),m=a.n(u),d=(a("cUip"),a("iJl9")),y=a.n(d),h=a("QbLZ"),v=a.n(h),g=a("4d7F"),f=a.n(g),b=a("P2sY"),T=a.n(b),C=(a("PAYn"),a("EQeY")),E=a.n(C),O=(a("tL+A"),a("QpBz")),k=a.n(O),P=a("Yz+Y"),S=a.n(P),x=a("iCc5"),I=a.n(x),N=a("V7oC"),D=a.n(N),L=a("FYw3"),w=a.n(L),K=a("mRg0"),A=a.n(K),_=(a("nTym"),a("qu0K")),V=a.n(_),F=(a("fwXI"),a("CC+v")),R=a.n(F),q=a("sbe7"),M=a.n(q),z=a("/MKj"),U=a("dtw8"),j=a("LvDl"),W=a("7Qib"),Y=a("bAm3"),B=a("sVOr"),G=a("/gYX"),H=a("dDU9"),Q=a("2KkY"),J=a("W9Sf"),X=a("5Gkw"),Z=a("djHj"),$=(a("G851"),a("ZvzK")),ee=a.n($),te=(a("FGdI"),a("Pbn2")),ae=a.n(te),ne=(a("PFYH"),a("Jv8k")),re=a.n(ne),ie=a("FyfS"),le=a.n(ie),oe=(a("8YFG"),a("ATwu")),se=a.n(oe),ce=(a("Z8Mf"),a("j7zX")),pe=a.n(ce),ue=a("tHbZ"),me=a("DE4S"),de=(a("7kJ1"),a("qPIi")),ye=a.n(de),he=V.a.Item,ve=ye.a.Group,ge=function(e){function t(){return I()(this,t),w()(this,(t.__proto__||S()(t)).apply(this,arguments))}return A()(t,e),D()(t,[{key:"render",value:function(){var e=this.props,t=e.form,a=e.currentPage,n=t.getFieldDecorator;return M.a.createElement("div",{style:{padding:"60px"}},M.a.createElement(V.a,null,M.a.createElement(he,v()({},Z.y,{label:"任务名称",hasFeedback:!0}),n("name",{rules:[{required:!0,message:"任务名称不可为空！"},{max:64,message:"任务名称不得超过64个字符！"}],initialValue:a?a.name:""})(M.a.createElement(y.a,null))),M.a.createElement(he,v()({},Z.y,{label:"任务类型"}),n("taskType",{rules:[],initialValue:a?a.taskType:0})(M.a.createElement(ve,{disabled:!0},M.a.createElement(ye.a,{value:0},"SQL任务"),M.a.createElement(ye.a,{value:1},"MR任务")))),M.a.createElement(he,v()({},Z.y,{label:"资源",hasFeedback:!0}),a&&a.resourceList&&a.resourceList.length>0?a.resourceList[0].resourceName:""),M.a.createElement(he,v()({},Z.y,{label:"mainClass"}),n("mainClass",{rules:[{}],initialValue:a&&a.mainClass})(M.a.createElement(y.a,{placeholder:"请输入mainClass"}))),M.a.createElement(he,v()({},Z.y,{label:"参数"}),n("exeArgs",{rules:[{}],initialValue:a&&a.exeArgs})(M.a.createElement(y.a,{placeholder:"请输入任务参数"}))),M.a.createElement(he,v()({},Z.y,{label:"描述",hasFeedback:!0}),n("taskDesc",{rules:[],initialValue:a?a.taskDesc:""})(M.a.createElement(y.a,{type:"textarea",rows:4})))))}}]),t}(q.Component),fe=V.a.create({onValuesChange:function(e,t){var a=e.dispatch,n=e.currentPage,r=!1;""===t.name&&(r=!0),t.invalid=r;var i=T()(n,t);a(Q.x(i)),a(Q.B(i))}})(ge),be=a("fvjX"),Te=a("76p7"),Ce=a("Ohfy"),Ee=a("dmTY"),Oe=Object(z.b)(function(e){return{editor:e.editor}},function(e){var t=Object(be.b)(Ee,e);return T()(t,{setCurrentPage:function(t){e(Object(Q.x)(t))}})})(n=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,l=Array(i),o=0;o<i;o++)l[o]=arguments[o];return a=n=w()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(l))),n.onContentChange=function(e,t){(0,n.props.editorChange)({merged:!1,sqlText:e,cursorPosition:t.getPosition()})},n.sqlFormat=function(){var e=n.props,t=e.currentPage,a=e.setCurrentPage,r={sql:t.sqlText||""};B.a.streamSqlFormat(r).then(function(e){if(e.data){var n={merged:!0,sqlText:e.data,id:t.id},r=T()(t,n);a(r)}})},n.debounceSelectionChange=Object(j.debounce)(n.props.setSelectionContent,200,{maxWait:2e3}),r=a,w()(n,r)}return A()(t,e),D()(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.currentPage,n=t.editor,r=a.cursorPosition||void 0,i=a.readWriteLockVO&&!a.readWriteLockVO.getLock,l={value:a.sqlText,language:"dtsql",options:{readOnly:i},cursorPosition:r,theme:n.options.theme,onChange:this.onContentChange,sync:a.merged||void 0,onCursorSelection:this.debounceSelectionChange},o={enable:!0,enableRun:!1,enableFormat:!0,onFileEdit:Object(Te.a)(this._editor),onFormat:this.sqlFormat,onThemeChange:function(t){e.props.updateEditorOptions({theme:t})}};return M.a.createElement(Ce.a,{editor:l,toolbar:o,key:"main-editor-"+a.id,editorInstanceRef:function(t){e._editor=t}})}}]),t}(q.Component))||n,ke=function(e){function t(){return I()(this,t),w()(this,(t.__proto__||S()(t)).apply(this,arguments))}return A()(t,e),D()(t,[{key:"render",value:function(){var e=this.props.currentPage.taskType===Z.v.SQL?M.a.createElement(Oe,this.props):M.a.createElement(fe,this.props);return M.a.createElement("div",{className:"editor-container"},e)}}]),t}(q.Component),Pe=(a("7LYo"),a("5GXF")),Se=a.n(Pe),xe=(a("ek7I"),a("FAat")),Ie=a.n(xe),Ne=a("I/n2"),De=Ie.a.Option,Le=Se.a.Panel,we=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,l=Array(i),o=0;o<i;o++)l[o]=arguments[o];return a=n=w()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(l))),n.state={visibleAlterRes:!1,resList:[]},n.handleChange=function(e){n.setState({resList:e})},n.alterRes=function(){var e=n,t=n.props.currentPage,a=n.state.resList;0!==(a=Array.isArray(a)?a:[a]).length?t&&t.id&&a.length>0&&B.a.updateTaskRes({id:t.id,resources:a}).then(function(a){1===a.code&&(k.a.success("资源修改成功！"),e.reloadTask(t.id),e.setState({visibleAlterRes:!1,resList:[]}))}):k.a.info("您没有选择任何资源！")},r=a,w()(n,r)}return A()(t,e),D()(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;if(t.id!==a.id){var n=t.resourceList.length>0?t.resourceList.map(function(e){return e.id}):[];this.setState({resList:n})}}},{key:"reloadTask",value:function(e){var t=this.props.dispatch;B.a.getTask({taskId:e}).then(function(e){1===e.code&&(t(Q.x(e.data)),t(Q.B(e.data)))})}},{key:"render",value:function(){var e=this,t=this.state,a=t.visibleAlterRes,n=t.resList,r=this.props,i=r.resources,l=r.currentPage,o=r.editorChange,c=l.resourceList&&l.resourceList.map(function(e){return M.a.createElement(E.a,{key:e.id,color:"blue"},e.resourceName)}),u=i&&i.map(function(e){return M.a.createElement(De,{value:e.id,key:e.id,name:e.resourceName},e.resourceName)});return M.a.createElement("div",{className:"m-taksdetail"},M.a.createElement(Se.a,{bordered:!1,defaultActiveKey:["1","2"]},M.a.createElement(Le,{key:"1",header:"任务属性"},M.a.createElement(s.a,{className:"task-info"},M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"任务名称："),M.a.createElement(p.a,{span:"14"},l.name)),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"任务类型："),M.a.createElement(p.a,{span:"14"},0===l.taskType?"SQL任务":"MR任务")),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"资源："),M.a.createElement(p.a,{span:"14",style:{marginTop:"10px"}},c)),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"创建人员："),M.a.createElement(p.a,{span:"14"},l.createUserName)),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"创建时间："),M.a.createElement(p.a,{span:"14"},W.a.formatDateTime(l.gmtCreate))),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"最近修改时间："),M.a.createElement(p.a,{span:"14"},W.a.formatDateTime(l.gmtModified))),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"10",className:"txt-right"},"描述："),M.a.createElement(p.a,{span:"14"},l.taskDesc)),M.a.createElement(R.a,{title:"修改任务资源",wrapClassName:"vertical-center-modal",visible:a,onCancel:function(){e.setState({visibleAlterRes:!1})},onOk:this.alterRes},M.a.createElement(Ie.a,{mode:0===l.taskType?"multiple":"",style:{width:"100%"},showSearch:!0,value:n,placeholder:"请选择资源",optionFilterProp:"name",onChange:this.handleChange},u)))),M.a.createElement(Le,{key:"2",header:"历史发布版本"},M.a.createElement(Ne.a,{taskInfo:l,changeSql:o,taskType:"realTimeTask"}))))}}]),t}(q.Component),Ke=(a("/xgg"),a("aOJk")),Ae=a.n(Ke),_e=a("gDS+"),Ve=a.n(_e),Fe=a("YEIV"),Re=a.n(Fe),qe=(a("b+Mx"),a("5Dct")),Me=a.n(qe),ze=(a("93XW"),a("d1El")),Ue=a.n(ze),je=(a("zmYW"),a("DtFj")),We=a.n(je),Ye=Ie.a.Option,Be=Se.a.Panel,Ge=ye.a.Group,He=(We.a.Column,We.a.ColumnGroup,V.a.Item),Qe=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,l=Array(i),o=0;o<i;o++)l[o]=arguments[o];return a=n=w()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(l))),n.checkParams=function(){var e=n.props,t=e.index,a=(e.panelColumn[t].columns,{});return n.props.form.validateFields(function(e,t){a.status=!e}),a},n.originOption=function(e,t){switch(e){case"originType":return t.map(function(e){return M.a.createElement(Ye,{key:e,value:""+e.id},e.name)});case"currencyType":return t.map(function(e){return M.a.createElement(Ye,{key:e,value:""+e},e)});case"eventTime":return t.map(function(e,t){return M.a.createElement(Ye,{key:t,value:""+e.column},e.column)});default:return null}},r=a,w()(n,r)}return A()(t,e),D()(t,[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"editorParamsChange",value:function(e,t,a){var n=this.props,r=n.handleInputChange,i=n.index;this._syncEditor=!1,r("columnsText",i,t)}},{key:"render",value:function(){var e=this.props,t=e.handleInputChange,a=e.index,n=e.panelColumn,r=e.sync,i=e.timeColumoption,l=void 0===i?[]:i,o=e.originOptionType,c=void 0===o?[]:o,u=e.topicOptionType,m=void 0===u?[]:u,d=this.originOption("originType",c[a]||[]),h=this.originOption("currencyType",m[a]||[]),g=this.originOption("eventTime",l[a]||[]),f=this.props.form.getFieldDecorator,b={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}};return M.a.createElement(s.a,{className:"title-content"},M.a.createElement(V.a,null,M.a.createElement(He,v()({},b,{label:"类型"}),f("type",{rules:[{required:!0,message:"请选择类型"}]})(M.a.createElement(Ie.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("type",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},M.a.createElement(Ye,{value:"14"},"Kafka")))),M.a.createElement(He,v()({},b,{label:"数据源"}),f("sourceId",{rules:[{required:!0,message:"请选择数据源"}]})(M.a.createElement(Ie.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("sourceId",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},d))),M.a.createElement(He,v()({},b,{label:"Topic"}),f("topic",{rules:[{required:!0,message:"请选择Topic"}]})(M.a.createElement(Ie.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("topic",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},h))),M.a.createElement(He,v()({},b,{label:M.a.createElement("span",null,"映射表 ",M.a.createElement(Ue.a,{title:"该表是kafka中的topic映射而成，可以以SQL的方式使用它。"},M.a.createElement(ae.a,{type:"question-circle-o"})))}),f("table")(M.a.createElement(y.a,{placeholder:"请输入映射表名",className:"right-input",onChange:function(e){return t("table",a,e.target.value)}}))),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"6"},M.a.createElement("span",{style:{color:"rgba(0, 0, 0, 0.85)",paddingRight:10,float:"right"}},"字段 :")),M.a.createElement(p.a,{span:"18",style:{marginBottom:20,height:202}},M.a.createElement(me.a,{style:{minHeight:202,border:"1px solid #ddd"},key:"params-editor",sync:r,placeholder:"字段 类型, 比如 id int 一行一个字段",value:n[a].columnsText,onChange:this.editorParamsChange.bind(this)}))),M.a.createElement(He,v()({},b,{label:"时间特征"}),f("timeType")(M.a.createElement(Ge,{className:"right-select",onChange:function(e){t("timeType",a,e.target.value)}},M.a.createElement(ye.a,{value:1},"ProcTime"),M.a.createElement(ye.a,{value:2},"EventTime")))),2===n[a].timeType?M.a.createElement(He,v()({},b,{label:"时间列"}),f("timeColumn",{rules:[{required:!0,message:"请选择时间列"}]})(M.a.createElement(Ie.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("timeColumn",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},g))):void 0,2===n[a].timeType?M.a.createElement(He,v()({},b,{label:M.a.createElement("span",null,"偏移量(ms) ",M.a.createElement(Ue.a,{title:"watermark值与event time值的偏移量"},M.a.createElement(ae.a,{type:"question-circle-o"})))}),f("offset",{rules:[{required:!0,message:"请输入时间偏移量"}]})(M.a.createElement(Me.a,{className:"number-input",min:0,onChange:function(e){return t("offset",a,e)}}))):void 0,M.a.createElement(He,v()({},b,{label:"并行度"}),f("parallelism")(M.a.createElement(Me.a,{className:"number-input",min:1,onChange:function(e){return t("parallelism",a,e)}})))))}}]),t}(q.Component),Je=V.a.create({mapPropsToFields:function(e){var t=e.panelColumn[e.index];return{type:{value:t.type},sourceId:{value:t.sourceId},topic:{value:t.topic},table:{value:t.table},columns:{value:t.columns},timeType:{value:t.timeType},timeColumn:{value:t.timeColumn},offset:{value:t.offset},columnsText:{value:t.columnsText},parallelism:{value:t.parallelism}}}})(Qe),Xe=(r={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(r,"popoverVisible",[]),Re()(r,"panelColumn",[]),Re()(r,"checkFormParams",[]),Re()(r,"timeColumoption",[]),Re()(r,"topicOptionType",[]),Re()(r,"originOptionType",[]),r),Ze=function(e){function t(e){var a;I()(this,t);var n=w()(this,(t.__proto__||S()(t)).call(this,e));return n.currentInitData=function(e){var t=n.state,a=t.tabTemplate,r=t.panelColumn;e.map(function(e,t){a.push(Je),r.push(e),n.getTypeOriginData(t,e.type),n.parseColumnsText(t,e.columnsText),n.getTopicType(t,e.sourceId)}),n.setCurrentSource({tabTemplate:a,panelColumn:r}),n.setState({tabTemplate:a,panelColumn:r})},n.parseColumnsText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=n.state,r=a.timeColumoption,i=a.panelColumn,l=t.split("\n").filter(function(e){return!!e}).map(function(e){var t=void 0;return{column:(t=e.trim().includes(" as ")?e.trim().split(" as "):e.trim().split(" "))[0],type:t[1]}}),o=l.filter(function(e){return e.column&&e.type});r[e]=o;var s=o.filter(function(t){return t.column===i[e].timeColumn})[0];i[e].timeColumn=s&&s.column||void 0,n.setCurrentSource({timeColumoption:r}),n.setState({timeColumoption:r})},n.getTypeOriginData=function(e,t){var a=n.state.originOptionType;B.a.getTypeOriginData({type:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setCurrentSource({originOptionType:a}),n.setState({originOptionType:a})})},n.getTopicType=function(e,t){var a=n.state.topicOptionType;t?B.a.getTopicType({sourceId:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setCurrentSource({topicOptionType:a}),n.setState({topicOptionType:a})}):("add"===e?a.push([]):a[e]=[],n.setCurrentSource({topicOptionType:a}),n.setState({topicOptionType:a}))},n.getCurrentData=function(e,t){var a=t.dispatch,r=t.inputData,i=t.currentPage.source;if(!r[e]&&i.length>0)n.receiveState(e,i,a);else{var l=JSON.parse(Ve()(Xe)),o=r[e]||l;n.setState(v()({},o))}},n.receiveState=function(e,t,a){var r=[],i=[],l=[],o=[],s=[],c=[],p=[],u=[];t.map(function(e){r.push(Je),i.push(e)}),a(Q.z({taskId:e,source:{tabTemplate:r,panelColumn:i,panelActiveKey:l,popoverVisible:o,checkFormParams:s,timeColumoption:c,originOptionType:p,topicOptionType:u}})),n.setState({tabTemplate:r,panelColumn:i,panelActiveKey:l,popoverVisible:o,checkFormParams:s,originOptionType:p,topicOptionType:u,timeColumoption:c},function(){t.map(function(e,t){n.getTypeOriginData(t,e.type),n.getTopicType(t,e.sourceId),n.parseColumnsText(t,e.columnsText)})})},n.changeInputTabs=function(e,t){var a={type:"14",sourceId:void 0,topic:void 0,table:void 0,timeType:1,timeColumn:void 0,offset:0,columnsText:void 0,parallelism:1},r=n.state,i=r.tabTemplate,l=r.panelActiveKey,o=r.popoverVisible,s=r.panelColumn,c=r.checkFormParams,p=r.originOptionType,u=r.topicOptionType;if("add"===e){i.push(Je),s.push(a),n.getTypeOriginData("add",a.type),n.getTopicType("add",a.topic);var m=""+i.length;l.push(m)}else i.splice(t,1),s.splice(t,1),p.splice(t,1),u.splice(t,1),c.pop(),l=n.changeActiveKey(t),o[t]=!1;n.props.tableParamsChange(),n.setCurrentSource({tabTemplate:i,panelActiveKey:l,popoverVisible:o,panelColumn:s,originOptionType:p,topicOptionType:u}),n.setState({tabTemplate:i,panelActiveKey:l,popoverVisible:o,panelColumn:s,checkFormParams:c,originOptionType:p,topicOptionType:u})},n.setCurrentSource=function(e){var t=n.props,a=t.dispatch,r=t.currentPage,i=v()({},n.state,e);a(Q.z({taskId:r.id,source:i}))},n.changeActiveKey=function(e){var t=n.state.panelActiveKey,a=""+(e+1),r=t.indexOf(a);return r>-1&&t.splice(r,1),t.map(function(t){return Number(t)>Number(e)?""+(Number(t)-1):t})},n.handleActiveKey=function(e){var t=n.state.panelActiveKey;t=e,n.setCurrentSource({panelActiveKey:t}),n.setState({panelActiveKey:t})},n.handleInputChange=function(e,t,a){var r=n.state,i=r.panelColumn,l=r.timeColumoption,o=r.originOptionType,s=r.topicOptionType,c=["type","sourceId","topic","table","columns","timeType","timeColumn","offset","columnsText","parallelism"];"columnsText"===e&&(n._syncEditor=!1,n.parseColumnsText(t,a,"changeText")),i[t][e]=a,"type"===e?(n._syncEditor=!0,l[t]=[],o[t]=[],s[t]=[],c.map(function(e){"type"!=e&&(i[t][e]="columns"==e?[]:"timeType"==e?1:"parallelism"==e?1:void 0)}),n.getTypeOriginData(t,a)):"sourceId"===e?(n._syncEditor=!0,l[t]=[],s[t]=[],c.map(function(e){"type"!=e&&"sourceId"!=e&&(i[t][e]="columns"==e?[]:"timeType"==e?1:"parallelism"==e?1:void 0)}),n.getTopicType(t,a)):"topic"===e&&(n._syncEditor=!0,l[t]=[],c.map(function(e){"type"!=e&&"sourceId"!=e&&"topic"!=e&&(i[t][e]="columns"==e?[]:"timeType"==e?1:"parallelism"==e?1:void 0)})),n.props.tableParamsChange(),n.setCurrentSource({panelColumn:i}),n.setState({panelColumn:i})},n.clearCurrentInfo=function(e,t,a){var r=n.state,i=r.panelColumn,l=r.topicOptionType,o=r.originOptionType,s={type:void 0,sourceId:void 0,topic:void 0,table:void 0,timeType:1,timeColumn:void 0,offset:0,columnsText:void 0,parallelism:1};"type"===e?(s.type=a,i[t]=s,l[t]=[],o[t]=[]):"sourceId"===e&&(s.type=i[t].type,s.sourceId=a,i[t]=s,l[t]=[]),n.setCurrentSource({panelColumn:i,topicOptionType:l,originOptionType:o}),n.setState({panelColumn:i,topicOptionType:l,originOptionType:o})},n.handlePopoverVisibleChange=function(e,t,a){var r=n.state.popoverVisible;r[t]=a,e&&(e.stopPropagation(),a&&(r=r.map(function(e,a){return t==a}))),n.setCurrentSource({popoverVisible:r}),n.setState({popoverVisible:r})},n.panelHeader=function(e){var t=n.state.popoverVisible,a=M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("div",{style:{padding:"8 0 12"}}," ",M.a.createElement(ae.a,{type:"exclamation-circle",style:{color:"#faad14"}}),"  你确定要删除此输入源吗？"),M.a.createElement("div",{style:{textAlign:"right",padding:"0 0 8"}},M.a.createElement(m.a,{style:{marginRight:8},size:"small",onClick:function(){n.handlePopoverVisibleChange(null,e,!1)}},"取消"),M.a.createElement(m.a,{type:"primary",size:"small",onClick:function(){n.changeInputTabs("delete",e)}},"确定")));return M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("span",null," 输入源 "+(e+1)+" "),M.a.createElement(Ae.a,{trigger:"click",placement:"topLeft",content:a,visible:t[e],onClick:function(a){n.handlePopoverVisibleChange(a,e,!t[e])}},M.a.createElement("span",{className:"title-icon input-panel-title"},M.a.createElement(ae.a,{type:"delete"}))))},n.recordForm=function(e){var t=n.state.checkFormParams;t.push(e),n.setCurrentSource({checkFormParams:t}),n.setState({checkFormParams:t})},n.state=(a={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(a,"popoverVisible",[]),Re()(a,"panelColumn",[]),Re()(a,"checkFormParams",[]),Re()(a,"timeColumoption",[]),Re()(a,"topicOptionType",[]),Re()(a,"originOptionType",[]),a),n}return A()(t,e),D()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentPage.source;e&&e.length>0&&this.currentInitData(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;t.id!==a.id&&(this._syncEditor=!0,this.getCurrentData(t.id,e))}},{key:"render",value:function(){var e=this,t=this.state,a=t.tabTemplate,n=t.panelActiveKey,r=t.panelColumn,i=t.timeColumoption,l=t.topicOptionType,o=t.originOptionType;return M.a.createElement("div",{className:"m-taksdetail panel-content"},M.a.createElement(Se.a,{activeKey:n,bordered:!1,onChange:this.handleActiveKey},a.map(function(t,a){return M.a.createElement(Be,{header:e.panelHeader(a),key:a+1,style:{borderRadius:5},className:"input-panel"},M.a.createElement(Je,{sync:e._syncEditor,index:a,key:a+1,handleInputChange:e.handleInputChange,panelColumn:r,onRef:e.recordForm,editorParamsChange:e.props.editorParamsChange,timeColumoption:i,topicOptionType:l,originOptionType:o}))})),M.a.createElement(m.a,{className:"stream-btn",onClick:function(){e.changeInputTabs("add")},style:{borderRadius:5}},M.a.createElement(ae.a,{type:"plus"}),M.a.createElement("span",null," 添加输入")))}}]),t}(q.Component),$e=Ie.a.Option,et=Se.a.Panel,tt=(ye.a.Group,We.a.Column),at=(We.a.ColumnGroup,V.a.Item),nt=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,l=Array(i),o=0;o<i;o++)l[o]=arguments[o];return a=n=w()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(l))),n.checkParams=function(e){var t=n.props,a=t.index,r=(t.panelColumn[a].columns,{});return n.props.form.validateFields(function(e,t){r.status=!e}),r},n.originOption=function(e,t){switch(e){case"originType":return t.map(function(e){return M.a.createElement($e,{key:e,value:""+e.id},e.name)});case"currencyType":return t.map(function(e){return M.a.createElement($e,{key:e,value:""+e},e)});case"columnType":return t.map(function(e,t){return M.a.createElement($e,{key:t,value:""+e.key},e.key)});case"primaryType":return t.map(function(e,t){return M.a.createElement($e,{key:t,value:""+e.column},e.column)});default:return null}},r=a,w()(n,r)}return A()(t,e),D()(t,[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"editorParamsChange",value:function(e,t,a){var n=this.props,r=n.handleInputChange,i=n.index;this._syncEditor=!1,r("columnsText",i,t)}},{key:"render",value:function(){var e=this.props,t=e.handleInputChange,a=e.index,n=e.sync,r=e.originOptionType,i=e.tableOptionType,l=e.panelColumn,o=e.tableColumnOptionType,c=this.props.form.getFieldDecorator,u=this.originOption("originType",r[a]||[]),d=this.originOption("currencyType",i[a]||[]),h=this.originOption("columnType",o[a]||[]),g=this.originOption("primaryType",l[a].columns||[]),f={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}};return M.a.createElement(s.a,{className:"title-content"},M.a.createElement(at,v()({},f,{label:"存储类型"}),c("type",{rules:[{required:!0,message:"请选择存储类型"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("type",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},M.a.createElement($e,{value:"1"},"MySQL"),M.a.createElement($e,{value:"8"},"HBase"),M.a.createElement($e,{value:"11"},"ElasticSearch")))),M.a.createElement(at,v()({},f,{label:"数据源"}),c("sourceId",{initialValue:"disabled",rules:[{required:!0,message:"请选择数据源"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("sourceId",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},u))),"1"==l[a].type||"8"==l[a].type?M.a.createElement(at,v()({},f,{label:"表"}),c("table",{initialValue:"disabled",rules:[{required:!0,message:"请选择表"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("table",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},d))):"","11"==l[a].type?M.a.createElement(at,v()({},f,{label:"索引"}),c("index",{rules:[{required:!0,message:"请输入索引"}]})(M.a.createElement(y.a,{placeholder:"请输入索引",onChange:function(e){return t("index",a,e.target.value)}}))):"","11"==l[a].type?M.a.createElement(at,v()({},f,{label:M.a.createElement("span",null,"id ",M.a.createElement(Ue.a,{title:"id生成规则：填写字段的索引位置（从0开始)"},M.a.createElement(ae.a,{type:"question-circle-o"}))," ")}),c("esId")(M.a.createElement(y.a,{placeholder:"请输入id",onChange:function(e){return t("esId",a,e.target.value)}}))):"","11"==l[a].type?M.a.createElement(at,v()({},f,{label:"索引类型"}),c("esType",{rules:[{required:!0,message:"请输入索引类型"}]})(M.a.createElement(y.a,{placeholder:"请输入索引类型",onChange:function(e){return t("esType",a,e.target.value)}}))):"","8"==l[a].type?M.a.createElement(at,v()({},f,{label:"rowKey"}),c("rowKey",{rules:[{required:!0,message:"请输入rowKey"}]})(M.a.createElement(y.a,{placeholder:" rowKey 格式：填写字段1 , 填写字段2 ",onChange:function(e){return t("rowKey",a,e.target.value)}}))):"",M.a.createElement(at,v()({},f,{label:"映射表"}),c("tableName",{rules:"11"===l[a].type?[{required:!0,message:"请输入映射表名"}]:[]})(M.a.createElement(y.a,{placeholder:"请输入映射表名",onChange:function(e){return t("tableName",a,e.target.value)}}))),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"6"},M.a.createElement("span",{style:{color:"rgba(0, 0, 0, 0.85)",paddingRight:10,float:"right"}},"字段 :")),"1"==l[a].type?M.a.createElement(p.a,{span:"18",style:{marginBottom:20,border:"1px solid #ddd"}},M.a.createElement(We.a,{dataSource:l[a].columns,className:"table-small",pagination:!1,size:"small"},M.a.createElement(tt,{title:"字段",dataIndex:"column",key:"字段",width:"50%",render:function(e,n,r){return M.a.createElement(Ie.a,{className:"sub-right-select",value:e,onChange:function(e){t("subColumn",a,r,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},h)}}),M.a.createElement(tt,{title:"类型",dataIndex:"type",key:"类型",width:"40%",render:function(e,t,a){return M.a.createElement(y.a,{value:e,disabled:!0})}}),M.a.createElement(tt,{key:"delete",render:function(e,n,r){return M.a.createElement(ae.a,{type:"close",style:{fontSize:16,color:"#888"},onClick:function(){t("deleteColumn",a,r)}})}})),M.a.createElement("div",{style:{padding:"0 20 20"}},M.a.createElement(m.a,{className:"stream-btn",type:"dashed",style:{borderRadius:5},onClick:function(){t("columns",a,{})}},M.a.createElement(ae.a,{type:"plus"}),M.a.createElement("span",null," 添加输入")))):M.a.createElement(p.a,{span:"18",style:{marginBottom:20,height:200}},M.a.createElement(me.a,{style:{minHeight:202,border:"1px solid #ddd"},key:"params-editor",sync:n,placeholder:"字段 类型, 比如 id int 一行一个字段",value:l[a].columnsText,onChange:this.editorParamsChange.bind(this)}))),"1"==l[a].type?M.a.createElement(at,v()({},f,{label:"主键"}),c("primaryKey")(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("primaryKey",a,e)},mode:"multiple",showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},g))):"",M.a.createElement(at,v()({},f,{label:"并行度"}),c("parallelism")(M.a.createElement(Me.a,{className:"number-input",min:1,onChange:function(e){return t("parallelism",a,e)}}))))}}]),t}(q.Component),rt=V.a.create({mapPropsToFields:function(e){var t=e.panelColumn[e.index];return{type:{value:t.type},sourceId:{value:t.sourceId},table:{value:t.table},columns:{value:t.columns},columnsText:{value:t.columnsText},id:{value:t.id},index:{value:t.index},writePolicy:{value:t.writePolicy},esId:{value:t.esId},esType:{value:t.esType},parallelism:{value:t.parallelism},tableName:{value:t.tableName},primaryKey:{value:t.primaryKey},rowKey:{value:t.rowKey}}}})(nt),it=(i={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(i,"popoverVisible",[]),Re()(i,"panelColumn",[]),Re()(i,"checkFormParams",[]),Re()(i,"originOptionType",[]),Re()(i,"tableOptionType",[]),Re()(i,"tableColumnOptionType",[]),i),lt=function(e){function t(e){var a;I()(this,t);var n=w()(this,(t.__proto__||S()(t)).call(this,e));return n.currentInitData=function(e){var t=n.state,a=t.tabTemplate,r=t.panelColumn;e.map(function(e,t){a.push(rt),r.push(e),n.getTypeOriginData(t,e.type),"1"!=e.type&&"8"!=e.type||(n.getTableType(t,e.sourceId),"1"==e.type&&n.getTableColumns(t,e.sourceId,e.table))}),n.setOutputData({tabTemplate:a,panelColumn:r}),n.setState({tabTemplate:a,panelColumn:r})},n.getCurrentData=function(e,t){var a=t.currentPage,r=t.outputData,i=t.dispatch,l=a.sink;if(!r[e]&&l.length>0)n.receiveState(e,l,i);else{var o=JSON.parse(Ve()(it)),s=r[e]||o;n.setState(v()({},s))}},n.receiveState=function(e,t,a){var r=[],i=[],l=[],o=[],s=[],c=[],p=[],u=[];t.map(function(e){r.push(rt),i.push(e)}),a(Q.A({taskId:e,sink:{tabTemplate:r,panelColumn:i,panelActiveKey:l,popoverVisible:o,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u}})),n.setState({tabTemplate:r,panelColumn:i,panelActiveKey:l,popoverVisible:o,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u},function(){t.map(function(e,t){n.getTypeOriginData(t,e.type),"1"!=e.type&&"8"!=e.type||(n.getTableType(t,e.sourceId),"1"==e.type&&n.getTableColumns(t,e.sourceId,e.table))})})},n.getTypeOriginData=function(e,t){var a=n.state.originOptionType;B.a.getTypeOriginData({type:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setOutputData({originOptionType:a}),n.setState({originOptionType:a})})},n.getTableType=function(e,t){var a=n.state.tableOptionType;t?B.a.getStremTableType({sourceId:t,isSys:!1}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setOutputData({tableOptionType:a}),n.setState({tableOptionType:a})}):("add"===e?a.push([]):a[e]=[],n.setOutputData({tableOptionType:a}),n.setState({tableOptionType:a}))},n.getTableColumns=function(e,t,a){var r=n.state.tableColumnOptionType;B.a.getStreamTableColumn({sourceId:t,tableName:a}).then(function(t){1===t.code?r[e]=t.data:r[e]=[],n.setOutputData({tableColumnOptionType:r}),n.setState({tableColumnOptionType:r})})},n.changeInputTabs=function(e,t){var a={type:"1",columns:[],sourceId:void 0,table:void 0,columnsText:void 0,esId:void 0,esType:void 0,writePolicy:void 0,index:void 0,id:void 0,parallelism:1,tableName:void 0,primaryKey:void 0,rowKey:void 0},r=n.state,i=r.tabTemplate,l=r.panelActiveKey,o=r.popoverVisible,s=r.panelColumn,c=r.checkFormParams,p=r.originOptionType,u=r.tableOptionType,m=r.tableColumnOptionType;if("add"===e){i.push(rt),s.push(a),n.getTypeOriginData("add",a.type),n.getTableType("add",a.table),m.push([]);var d=""+i.length;l.push(d)}else i.splice(t,1),s.splice(t,1),p.splice(t,1),u.splice(t,1),m.splice(t,1),c.pop(),l=n.changeActiveKey(t),o[t]=!1;n.props.tableParamsChange(),n.setOutputData({tabTemplate:i,panelActiveKey:l,popoverVisible:o,panelColumn:s,tableColumnOptionType:m}),n.setState({tabTemplate:i,panelActiveKey:l,popoverVisible:o,panelColumn:s,checkFormParams:c,originOptionType:p,tableOptionType:u,tableColumnOptionType:m})},n.setOutputData=function(e){var t=n.props,a=t.dispatch,r=t.currentPage,i=v()({},n.state,e);a(Q.A({taskId:r.id,sink:i}))},n.changeActiveKey=function(e){var t=n.state.panelActiveKey,a=""+(e+1),r=t.indexOf(a);return r>-1&&t.splice(r,1),t.map(function(t){return Number(t)>Number(e)?""+(Number(t)-1):t})},n.handleActiveKey=function(e){var t=n.state.panelActiveKey;t=e,n.setOutputData({panelActiveKey:t}),n.setState({panelActiveKey:t})},n.tableColumnType=function(e,t){return n.state.tableColumnOptionType[e].filter(function(e){return e.key===t})[0].type},n.filterPrimaryKey=function(e,t){return t.filter(function(t){var a=!1;return e.map(function(e){e.column===t&&(a=!0)}),a})},n.handleInputChange=function(e,t,a,r){n._syncEditor=!0;var i=n.state,l=i.panelColumn,o=i.originOptionType,s=i.tableOptionType,c=i.tableColumnOptionType;if("columns"===e)l[t][e].push(a);else if("deleteColumn"===e){l[t].columns.splice(a,1);var p=n.filterPrimaryKey(l[t].columns,l[t].primaryKey||[]);l[t].primaryKey=p}else if("subColumn"===e){l[t].columns[a].column=r;var u=n.tableColumnType(t,r);l[t].columns[a].type=u}else l[t][e]=a;"columnsText"===e&&(n._syncEditor=!1);var m=["type","sourceId","table","columns","columnsText","id","index","writePolicy","esId","esType","parallelism","tableName","primaryKey","rowKey"];if("type"===e)n._syncEditor=!0,o[t]=[],s[t]=[],c[t]=[],m.map(function(e){l[t][e]="type"===e?a:"parallelism"==e?1:"columns"==e?[]:void 0}),n.getTypeOriginData(t,a);else if("sourceId"===e)s[t]=[],c[t]=[],m.map(function(e){n._syncEditor=!0,"type"!==e&&"sourceId"!=e&&(l[t][e]="columns"==e?[]:"parallelism"==e?1:void 0)}),"1"!=l[t].type&&"8"!=l[t].type||n.getTableType(t,a);else if("table"===e){n._syncEditor=!0,c[t]=[];var d=l[t].sourceId;l[t].columns=[],m.map(function(e){"type"!=e&&"sourceId"!=e&&"table"!=e&&(l[t][e]="columns"==e?[]:"parallelism"==e?1:void 0)}),"1"==l[t].type&&n.getTableColumns(t,d,a)}n.props.tableParamsChange(),n.setOutputData({panelColumn:l}),n.setState({panelColumn:l})},n.clearCurrentInfo=function(e,t,a){var r=n.state,i=r.panelColumn,l=r.tableOptionType,o=r.originOptionType,s={type:void 0,columns:[],sourceId:void 0,table:void 0,columnsText:void 0,esId:void 0,esType:void 0,writePolicy:void 0,index:void 0,id:void 0,parallelism:1,tableName:void 0,rowKey:void 0,primaryKey:void 0};"type"===e?(s.type=a,o[t]=[],l[t]=[],i[t]=s):"sourceId"===e&&(s.type=i[t].type,s.sourceId=a,l[t]=[],i[t]=s),n.setOutputData({panelColumn:i,tableOptionType:l,originOptionType:o}),n.setState({panelColumn:i,tableOptionType:l,originOptionType:o})},n.handlePopoverVisibleChange=function(e,t,a){var r=n.state.popoverVisible;r[t]=a,e&&(e.stopPropagation(),a&&(r=r.map(function(e,a){return t==a}))),n.setOutputData({popoverVisible:r}),n.setState({popoverVisible:r})},n.panelHeader=function(e){var t=n.state.popoverVisible,a=M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("div",{style:{padding:"8 0 12"}}," ",M.a.createElement(ae.a,{type:"exclamation-circle",style:{color:"#faad14"}}),"  你确定要删除此输出源吗？"),M.a.createElement("div",{style:{textAlign:"right",padding:"0 0 8"}},M.a.createElement(m.a,{style:{marginRight:8},size:"small",onClick:function(){n.handlePopoverVisibleChange(null,e,!1)}},"取消"),M.a.createElement(m.a,{type:"primary",size:"small",onClick:function(){n.changeInputTabs("delete",e)}},"确定")));return M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("span",null," 输出源 "+(e+1)+" "),M.a.createElement(Ae.a,{trigger:"click",placement:"topLeft",content:a,visible:t[e],onClick:function(a){n.handlePopoverVisibleChange(a,e,!t[e])}},M.a.createElement("span",{className:"title-icon input-panel-title"},M.a.createElement(ae.a,{type:"delete"}))))},n.recordForm=function(e){var t=n.state.checkFormParams;t.push(e),n.setOutputData({checkFormParams:t}),n.setState({checkFormParams:t})},n.state=(a={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(a,"popoverVisible",[]),Re()(a,"panelColumn",[]),Re()(a,"checkFormParams",[]),Re()(a,"originOptionType",[]),Re()(a,"tableOptionType",[]),Re()(a,"tableColumnOptionType",[]),a),n}return A()(t,e),D()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentPage.sink;e&&e.length>0&&this.currentInitData(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;t.id!==a.id&&(this._syncEditor=!0,this.getCurrentData(t.id,e))}},{key:"render",value:function(){var e=this,t=this.state,a=t.tabTemplate,n=t.panelActiveKey,r=t.panelColumn,i=t.originOptionType,l=t.tableOptionType,o=t.tableColumnOptionType;return M.a.createElement("div",{className:"m-taksdetail panel-content"},M.a.createElement(Se.a,{activeKey:n,bordered:!1,onChange:this.handleActiveKey},a.map(function(t,a){return M.a.createElement(et,{header:e.panelHeader(a),key:a+1,style:{borderRadius:5},className:"input-panel"},M.a.createElement(rt,{sync:e._syncEditor,index:a,handleInputChange:e.handleInputChange,panelColumn:r,originOptionType:i,tableOptionType:l,tableColumnOptionType:o,onRef:e.recordForm,editorParamsChange:e.props.editorParamsChange}))})),M.a.createElement(m.a,{className:"stream-btn",onClick:function(){e.changeInputTabs("add")},style:{borderRadius:5}},M.a.createElement(ae.a,{type:"plus"}),M.a.createElement("span",null," 添加输入")))}}]),t}(q.Component),ot=Ie.a.Option,st=Se.a.Panel,ct=(ye.a.Group,We.a.Column),pt=(We.a.ColumnGroup,V.a.Item),ut=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,l=Array(i),o=0;o<i;o++)l[o]=arguments[o];return a=n=w()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(l))),n.checkParams=function(e){var t=n.props,a=t.index,r=(t.panelColumn[a].columns,{});return n.props.form.validateFields(function(e,t){r.status=!e}),r},n.originOption=function(e,t){switch(e){case"originType":return t.map(function(e){return M.a.createElement(ot,{key:e,value:""+e.id},e.name)});case"currencyType":return t.map(function(e){return M.a.createElement(ot,{key:e,value:""+e},e)});case"columnType":return t.map(function(e,t){return M.a.createElement(ot,{key:t,value:""+e.key},e.key)});case"primaryType":return t.map(function(e,t){return M.a.createElement(ot,{key:t,value:""+e.column},e.column)});default:return null}},r=a,w()(n,r)}return A()(t,e),D()(t,[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"render",value:function(){var e=this.props,t=e.handleInputChange,a=e.index,n=e.originOptionType,r=e.tableOptionType,i=e.panelColumn,l=e.tableColumnOptionType,o=this.props.form.getFieldDecorator,c=this.originOption("originType",n[a]||[]),u=this.originOption("currencyType",r[a]||[]),d=this.originOption("columnType",l[a]||[]),h=this.originOption("primaryType",i[a].columns||[]),g={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}};return M.a.createElement(s.a,{className:"title-content"},M.a.createElement(pt,v()({},g,{label:"存储类型"}),o("type",{rules:[{required:!0,message:"请选择存储类型"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("type",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},M.a.createElement(ot,{value:"1"},"MySQL")))),M.a.createElement(pt,v()({},g,{label:"数据源"}),o("sourceId",{initialValue:"disabled",rules:[{required:!0,message:"请选择数据源"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("sourceId",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},c))),M.a.createElement(pt,v()({},g,{label:"表"}),o("table",{rules:[{required:!0,message:"请选择表"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("table",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},u))),M.a.createElement(pt,v()({},g,{label:"映射表"}),o("tableName")(M.a.createElement(y.a,{placeholder:"请输入映射表名",onChange:function(e){return t("tableName",a,e.target.value)}}))),M.a.createElement(s.a,null,M.a.createElement(p.a,{span:"6"},M.a.createElement("span",{style:{color:"rgba(0, 0, 0, 0.85)",paddingRight:10,float:"right"}},"字段 :")),M.a.createElement(p.a,{span:"18",style:{marginBottom:20,border:"1px solid #ddd"}},M.a.createElement(We.a,{dataSource:i[a].columns,className:"table-small",pagination:!1,size:"small"},M.a.createElement(ct,{title:"字段",dataIndex:"column",key:"字段",width:"50%",render:function(e,n,r){return M.a.createElement(Ie.a,{className:"sub-right-select",value:e,onChange:function(e){t("subColumn",a,r,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},d)}}),M.a.createElement(ct,{title:"类型",dataIndex:"type",key:"类型",width:"40%",render:function(e,t,a){return M.a.createElement(y.a,{value:e,disabled:!0})}}),M.a.createElement(ct,{key:"delete",render:function(e,n,r){return M.a.createElement(ae.a,{type:"close",style:{fontSize:16,color:"#888"},onClick:function(){t("deleteColumn",a,r)}})}})),M.a.createElement("div",{style:{padding:"0 20 20"}},M.a.createElement(m.a,{className:"stream-btn",type:"dashed",style:{borderRadius:5},onClick:function(){t("columns",a,{})}},M.a.createElement(ae.a,{type:"plus"}),M.a.createElement("span",null," 添加输入"))))),M.a.createElement(pt,v()({},g,{label:"主键"}),o("primaryKey",{rules:[{required:!0,message:"请选择主键"}]})(M.a.createElement(Ie.a,{className:"right-select",onChange:function(e){t("primaryKey",a,e)},mode:"multiple",showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},h))),M.a.createElement(pt,v()({},g,{label:"并行度"}),o("parallelism")(M.a.createElement(Me.a,{className:"number-input",min:1,onChange:function(e){return t("parallelism",a,e)}}))),M.a.createElement(pt,v()({},g,{label:"缓存策略"}),o("cache",{rules:[{required:!0,message:"请选择缓存策略"}]})(M.a.createElement(Ie.a,{placeholder:"请选择",className:"right-select",onChange:function(e){t("cache",a,e)},showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},M.a.createElement(ot,{key:"None",value:"None"},"None"),M.a.createElement(ot,{key:"LRU",value:"LRU"},"LRU")))),"LRU"===i[a].cache?M.a.createElement(pt,v()({},g,{label:"缓存大小(行)"}),o("cacheSize",{rules:[{required:!0,message:"请输入缓存大小"}]})(M.a.createElement(Me.a,{className:"number-input",min:0,onChange:function(e){return t("cacheSize",a,e)}}))):void 0,"LRU"===i[a].cache?M.a.createElement(pt,v()({},g,{label:"缓存超时时间(ms)"}),o("cacheTTLMs",{rules:[{required:!0,message:"请输入缓存超时时间"}]})(M.a.createElement(Me.a,{className:"number-input",min:0,onChange:function(e){return t("cacheTTLMs",a,e)}}))):void 0)}}]),t}(q.Component),mt=V.a.create({mapPropsToFields:function(e){var t=e.panelColumn[e.index],a=t.type,n=t.sourceId,r=t.table,i=t.columns,l=t.parallelism,o=t.cache,s=t.cacheSize,c=t.cacheTTLMs;return{type:{value:a},sourceId:{value:n},table:{value:r},tableName:{value:t.tableName},columns:{value:i},parallelism:{value:l},cache:{value:o},cacheSize:{value:s},cacheTTLMs:{value:c},primaryKey:{value:t.primaryKey}}}})(ut),dt=(l={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(l,"popoverVisible",[]),Re()(l,"panelColumn",[]),Re()(l,"checkFormParams",[]),Re()(l,"originOptionType",[]),Re()(l,"tableOptionType",[]),Re()(l,"tableColumnOptionType",[]),l),yt=function(e){function t(e){var a;I()(this,t);var n=w()(this,(t.__proto__||S()(t)).call(this,e));return n.currentInitData=function(e){var t=n.state,a=t.tabTemplate,r=t.panelColumn;e.map(function(e,t){a.push(mt),r.push(e),n.getTypeOriginData(t,e.type),n.getTableType(t,e.sourceId),n.getTableColumns(t,e.sourceId,e.table)}),n.setOutputData({tabTemplate:a,panelColumn:r}),n.setState({tabTemplate:a,panelColumn:r})},n.getCurrentData=function(e,t){var a=t.currentPage,r=t.dimensionData,i=t.dispatch,l=a.side;if(!r[e]&&l.length>0)n.receiveState(e,l,i);else{var o=JSON.parse(Ve()(dt)),s=r[e]||o;n.setState(v()({},s))}},n.receiveState=function(e,t,a){var r=[],i=[],l=[],o=[],s=[],c=[],p=[],u=[];t.map(function(e){r.push(mt),i.push(e)}),a(Q.y({taskId:e,side:{tabTemplate:r,panelColumn:i,panelActiveKey:l,popoverVisible:o,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u}})),n.setState({tabTemplate:r,panelColumn:i,panelActiveKey:l,popoverVisible:o,checkFormParams:s,originOptionType:c,tableOptionType:p,tableColumnOptionType:u},function(){t.map(function(e,t){n.getTypeOriginData(t,e.type),n.getTableType(t,e.sourceId),n.getTableColumns(t,e.sourceId,e.table)})})},n.getTypeOriginData=function(e,t){var a=n.state.originOptionType;B.a.getTypeOriginData({type:t}).then(function(t){"add"===e?1===t.code?a.push(t.data):a.push([]):1===t.code?a[e]=t.data:a[e]=[],n.setOutputData({originOptionType:a}),n.setState({originOptionType:a})})},n.getTableType=function(e,t,a){var r=n.state.tableOptionType;t?B.a.getStremTableType({sourceId:t,isSys:!1}).then(function(t){"add"===e?1===t.code?r.push(t.data):r.push([]):1===t.code?r[e]=t.data:r[e]=[],n.setOutputData({tableOptionType:r}),n.setState({tableOptionType:r})}):((e="add")?r.push([]):r[e]=[],n.setOutputData({tableOptionType:r}),n.setState({tableOptionType:r}))},n.getTableColumns=function(e,t,a){var r=n.state.tableColumnOptionType;B.a.getStreamTableColumn({sourceId:t,tableName:a}).then(function(t){1===t.code?r[e]=t.data:r[e]=[],n.setOutputData({tableColumnOptionType:r}),n.setState({tableColumnOptionType:r})})},n.changeInputTabs=function(e,t){var a={type:"1",columns:[],sourceId:void 0,table:void 0,tableName:void 0,primaryKey:void 0,parallelism:1,cache:"LRU",cacheSize:1e4,cacheTTLMs:6e4},r=n.state,i=r.tabTemplate,l=r.panelActiveKey,o=r.popoverVisible,s=r.panelColumn,c=r.checkFormParams,p=r.originOptionType,u=r.tableOptionType,m=r.tableColumnOptionType;if("add"===e){i.push(mt),s.push(a),n.getTypeOriginData("add",a.type),n.getTableType("add",a.table),m.push([]);var d=""+i.length;l.push(d)}else i.splice(t,1),s.splice(t,1),p.splice(t,1),u.splice(t,1),m.splice(t,1),c.pop(),l=n.changeActiveKey(t),o[t]=!1;n.props.tableParamsChange(),n.setOutputData({tabTemplate:i,panelActiveKey:l,popoverVisible:o,panelColumn:s,checkFormParams:c,originOptionType:p,tableOptionType:u,tableColumnOptionType:m}),n.setState({tabTemplate:i,panelActiveKey:l,popoverVisible:o,panelColumn:s,checkFormParams:c,originOptionType:p,tableOptionType:u,tableColumnOptionType:m})},n.setOutputData=function(e){var t=n.props,a=t.dispatch,r=t.currentPage,i=v()({},n.state,e);a(Q.y({taskId:r.id,side:i}))},n.changeActiveKey=function(e){var t=n.state.panelActiveKey,a=""+(e+1),r=t.indexOf(a);return r>-1&&t.splice(r,1),t.map(function(t){return Number(t)>Number(e)?""+(Number(t)-1):t})},n.handleActiveKey=function(e){var t=n.state.panelActiveKey;t=e,n.setOutputData({panelActiveKey:t}),n.setState({panelActiveKey:t})},n.tableColumnType=function(e,t){return n.state.tableColumnOptionType[e].filter(function(e){return e.key===t})[0].type},n.filterPrimaryKey=function(e,t){return t.filter(function(t){var a=!1;return e.map(function(e){e.column===t&&(a=!0)}),a})},n.handleInputChange=function(e,t,a,r){var i=n.state,l=i.panelColumn,o=i.originOptionType,s=i.tableOptionType,c=i.tableColumnOptionType;if("columns"===e)l[t][e].push(a);else if("deleteColumn"===e){l[t].columns.splice(a,1);var p=n.filterPrimaryKey(l[t].columns,l[t].primaryKey||[]);l[t].primaryKey=p}else if("subColumn"===e){l[t].columns[a].column=r;var u=n.tableColumnType(t,r);l[t].columns[a].type=u}else l[t][e]=a;var m=["type","sourceId","table","columns","parallelism","cache","cacheSize","cacheTTLMs","tableName","primaryKey"];if("type"===e)o[t]=[],s[t]=[],c[t]=[],m.map(function(e){"type"!=e&&(l[t][e]="parallelism"==e?1:"columns"==e?[]:"cache"==e?"LRU":"cacheSize"==e?1e4:"cacheTTLMs"==e?6e4:void 0)}),n.getTypeOriginData(t,a);else if("sourceId"===e)s[t]=[],c[t]=[],l[t].columns=[],m.map(function(e){"type"!=e&&"sourceId"!=e&&(l[t][e]="parallelism"==e?1:"columns"==e?[]:"cache"==e?"LRU":"cacheSize"==e?1e4:"cacheTTLMs"==e?6e4:void 0)}),n.getTableType(t,a,e);else if("table"===e){c[t]=[],m.map(function(e){"type"!=e&&"sourceId"!=e&&"table"!=e&&(l[t][e]="parallelism"==e?1:"columns"==e?[]:"cache"==e?"LRU":"cacheSize"==e?1e4:"cacheTTLMs"==e?6e4:void 0)});var d=l[t].sourceId;n.getTableColumns(t,d,a)}n.props.tableParamsChange(),n.setOutputData({panelColumn:l}),n.setState({panelColumn:l})},n.clearCurrentInfo=function(e,t,a){var r=n.state,i=r.panelColumn,l=r.originOptionType,o=r.tableOptionType,s={type:void 0,columns:[],sourceId:void 0,table:void 0,tableName:void 0,parallelism:1,cache:"LRU",cacheSize:1e4,cacheTTLMs:6e4};"type"===e?(s.type=a,i[t]=s,l[t]=[],o[t]=[]):"sourceId"===e&&(s.type=i[t].type,s.sourceId=a,i[t]=s,o[t]=[]),n.setOutputData({panelColumn:i,originOptionType:l,tableOptionType:o}),n.setState({panelColumn:i,originOptionType:l,tableOptionType:o})},n.handlePopoverVisibleChange=function(e,t,a){var r=n.state.popoverVisible;r[t]=a,e&&(e.stopPropagation(),a&&(r=r.map(function(e,a){return t==a}))),n.setOutputData({popoverVisible:r}),n.setState({popoverVisible:r})},n.panelHeader=function(e){var t=n.state.popoverVisible,a=M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("div",{style:{padding:"8 0 12"}}," ",M.a.createElement(ae.a,{type:"exclamation-circle",style:{color:"#faad14"}}),"  你确定要删除此输出源吗？"),M.a.createElement("div",{style:{textAlign:"right",padding:"0 0 8"}},M.a.createElement(m.a,{style:{marginRight:8},size:"small",onClick:function(){n.handlePopoverVisibleChange(null,e,!1)}},"取消"),M.a.createElement(m.a,{type:"primary",size:"small",onClick:function(){n.changeInputTabs("delete",e)}},"确定")));return M.a.createElement("div",{className:"input-panel-title"},M.a.createElement("span",null," 维表 "+(e+1)),M.a.createElement(Ae.a,{trigger:"click",placement:"topLeft",content:a,visible:t[e],onClick:function(a){n.handlePopoverVisibleChange(a,e,!t[e])}},M.a.createElement("span",{className:"title-icon input-panel-title"},M.a.createElement(ae.a,{type:"delete"}))))},n.recordForm=function(e){var t=n.state.checkFormParams;t.push(e),n.setOutputData({checkFormParams:t}),n.setState({checkFormParams:t})},n.state=(a={popoverVisible:!1,tabTemplate:[],panelActiveKey:[]},Re()(a,"popoverVisible",[]),Re()(a,"panelColumn",[]),Re()(a,"checkFormParams",[]),Re()(a,"originOptionType",[]),Re()(a,"tableOptionType",[]),Re()(a,"tableColumnOptionType",[]),a),n}return A()(t,e),D()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentPage.side;e&&e.length>0&&this.currentInitData(e)}},{key:"componentWillReceiveProps",value:function(e){var t=e.currentPage,a=this.props.currentPage;t.id!==a.id&&this.getCurrentData(t.id,e)}},{key:"render",value:function(){var e=this,t=this.state,a=t.tabTemplate,n=t.panelActiveKey,r=t.panelColumn,i=t.originOptionType,l=t.tableOptionType,o=t.tableColumnOptionType;return M.a.createElement("div",{className:"m-taksdetail panel-content"},M.a.createElement(Se.a,{activeKey:n,bordered:!1,onChange:this.handleActiveKey},a.map(function(t,a){return M.a.createElement(st,{header:e.panelHeader(a),key:a+1,style:{borderRadius:5},className:"input-panel"},M.a.createElement(mt,{index:a,handleInputChange:e.handleInputChange,panelColumn:r,originOptionType:i,tableOptionType:l,tableColumnOptionType:o,onRef:e.recordForm}))})),M.a.createElement(m.a,{className:"stream-btn",onClick:function(){e.changeInputTabs("add")},style:{borderRadius:5}},M.a.createElement(ae.a,{type:"plus"}),M.a.createElement("span",null," 添加输入")))}}]),t}(q.Component),ht=pe.a.TabPane,vt=R.a.confirm,gt=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,l=Array(i),o=0;o<i;o++)l[o]=arguments[o];return a=n=w()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(l))),n.state={selected:"",expanded:!1},n.onChange=function(e){var t=n.props,a=t.dispatch,r=t.pages,i=parseInt(e,10),l=r&&r.find(function(e){return e.id===i});l&&(a(Q.x(l)),a(Q.p()),a(Q.q()),a(Q.o()))},n.onEdit=function(e,t){var a=n.props,r=a.pages,i=a.dispatch,l=r.filter(function(t){return t.id==e})[0]||{};switch(t){case"remove":l.notSynced?vt({title:"部分任务修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃这些修改数据",onOk:function(){i(Q.l(parseInt(e,10),r,l)),i(Q.f(l.id)),i(Q.g(l.id)),i(Q.e(l.id))},onCancel:function(){}}):(i(Q.l(parseInt(e,10),r,l)),i(Q.f(l.id)),i(Q.g(l.id)),i(Q.e(l.id)))}},n.mapPanels=function(e){return e&&e.length>0?e.map(function(e){var t=M.a.createElement("span",null,M.a.createElement(ue.a,{notSynced:e.notSynced}),e.name);return M.a.createElement(ht,{style:{height:"0px"},tab:t,key:e.id})}):[]},n.tabClick=function(e){var t=n.state,a=t.selected,r=t.expanded;e===a&&r?(n.setState({selected:"",expanded:!1}),n.SideBench.style.width="30px"):e!==a&&(n.SideBench.style.width="500px",n.setState({selected:e,expanded:!0}))},n.unLock=function(){var e=n.props,t=e.currentPage,a=e.dispatch,r=t.readWriteLockVO;vt({title:"解锁提醒",content:"文件正在被"+r.lastKeepLockUserName+"编辑中，开始编辑时间\n                "+W.a.formatDateTime(r.gmtModified)+"。\n                强制编辑可能导致"+r.lastKeepLockUserName+"对该文件的修改无法保存！\n            ",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){var e={fileId:t.id,type:Z.j.STREAM_TASK,lockVersion:r.version};B.a.unlockFile(e).then(function(e){if(1===e.code){var n=e.data;n.getLock?k.a.success("文件解锁成功！"):R.a.error({title:"解锁失败",content:"文件正在被"+n.lastKeepLockUserName+"编辑中!开始编辑时间\n                                "+W.a.formatDateTime(n.gmtModified)+"."});var r={id:t.id};B.a.getTask(r).then(function(e){if(1===e.code){var n=e.data;n.merged=!0;var r={id:t.id,readWriteLockVO:n.readWriteLockVO};a(Q.x(n)),a(Object(J.f)(r))}})}})},onCancel:function(){}})},n.handleCustomParamsChange=function(e){var t=n.props,a=t.currentPage,r=t.dispatch,i=T()(a,e);r(Q.x(i))},n.tableParamsChange=function(){n.props.editorChange()},r=a,w()(n,r)}return A()(t,e),D()(t,[{key:"componentWillReceiveProps",value:function(e){e.currentPage!=this.props.currentPage&&(this._syncEditor=!0)}},{key:"renderLock",value:function(e){return e.readWriteLockVO&&!e.readWriteLockVO.getLock?M.a.createElement("div",{className:"lock-layer"},M.a.createElement(se.a,{style:{position:"absolute",top:"10px",left:"35%",zIndex:"999"},showIcon:!0,message:M.a.createElement("span",null,"当前文件为只读状态！",M.a.createElement("a",{onClick:this.unLock},"解锁")),type:"warning"})):null}},{key:"closeAllorOthers",value:function(e){var t=e.key,a=this.props,n=a.pages,r=a.currentPage,i=a.dispatch;if("ALL"===t){var l=!0,o=!0,s=!1,c=void 0;try{for(var p,u=le()(n);!(o=(p=u.next()).done);o=!0){if(p.value.notSynced){l=!1;break}}}catch(e){s=!0,c=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw c}}l?(i(Q.a()),i(Q.c()),i(Q.d()),i(Q.b())):vt({title:"部分任务修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃所有修改数据",onOk:function(){i(Q.a()),i(Q.c()),i(Q.d()),i(Q.b())},onCancel:function(){}})}else{var m=!0,d=!0,y=!1,h=void 0;try{for(var v,g=le()(n);!(d=(v=g.next()).done);d=!0){var f=v.value;if(f.notSynced&&f.id!==r.id){m=!1;break}}}catch(e){y=!0,h=e}finally{try{!d&&g.return&&g.return()}finally{if(y)throw h}}m?(i(Q.k(r)),i(Q.i(r.id)),i(Q.j(r.id)),i(Q.h(r.id))):vt({title:"部分任务修改尚未同步到服务器，是否强制关闭 ?",content:"强制关闭将丢弃这些修改数据",onOk:function(){i(Q.k(r)),i(Q.i(r.id)),i(Q.j(r.id)),i(Q.h(r.id))},onCancel:function(){}})}}},{key:"editorParamsChange",value:function(e,t,a){var n;this._syncEditor?(this._syncEditor=!1,(n=this.props).editorParamsChange.apply(n,arguments)):this.props.editorChange(t)}},{key:"render",value:function(){var e=this,t=this.props,a=t.currentPage,n=t.pages,r=t.router,i=t.editorFocus,l=t.editorFocusOut;0===n.length&&r.push("/realtime");var o=this.mapPanels(n);return M.a.createElement(s.a,{className:"task-browser"},M.a.createElement("div",{className:"browser-content"},M.a.createElement(pe.a,{hideAdd:!0,onTabClick:this.onChange,activeKey:""+a.id,type:"editable-card",className:"browser-tabs",onEdit:this.onEdit,tabBarExtraContent:M.a.createElement(ee.a,{overlay:M.a.createElement(re.a,{style:{marginRight:2},onClick:this.closeAllorOthers.bind(this)},M.a.createElement(re.a.Item,{key:"OHTERS"},"关闭其他"),M.a.createElement(re.a.Item,{key:"ALL"},"关闭所有"))},M.a.createElement(ae.a,{type:"bars",style:{margin:"10 0 0 0"}}))},o),this.renderLock(a),M.a.createElement(ke,this.props),M.a.createElement("div",{className:"m-siderbench bd-left",ref:function(t){e.SideBench=t}},M.a.createElement(pe.a,{activeKey:this.state.selected,type:"card",className:"task-params",tabPosition:"right",onTabClick:this.tabClick},M.a.createElement(ht,{tab:M.a.createElement("span",{className:"title-vertical"},"任务详情"),key:"params1"},M.a.createElement(we,this.props)),0===a.taskType?M.a.createElement(ht,{tab:M.a.createElement("span",{className:"title-vertical tabpanel-content"},"源表"),key:"params3"},M.a.createElement(Ze,v()({},this.props,{tableParamsChange:this.tableParamsChange}))):"",0===a.taskType?M.a.createElement(ht,{tab:M.a.createElement("span",{style:{marginTop:10},className:"title-vertical tabpanel-content"},"结果表"),key:"params4"},M.a.createElement(lt,v()({},this.props,{tableParamsChange:this.tableParamsChange}))):"",0===a.taskType?M.a.createElement(ht,{tab:M.a.createElement("span",{className:"title-vertical tabpanel-content"},"维表"),key:"params5"},M.a.createElement(yt,v()({},this.props,{tableParamsChange:this.tableParamsChange}))):"",M.a.createElement(ht,{tab:M.a.createElement("span",{className:"title-vertical"},"环境参数"),key:"params2"},M.a.createElement(me.a,{key:"params-editor",options:Z.G,onFocus:i,focusOut:l,sync:this._syncEditor,value:a.taskParams,onChange:this.editorParamsChange.bind(this)}))))))}}]),t}(q.Component),ft=R.a.confirm,bt=V.a.Item,Tt=function(e){function t(){var e,a,n,r;I()(this,t);for(var i=arguments.length,l=Array(i),o=0;o<i;o++)l[o]=arguments[o];return a=n=w()(this,(e=t.__proto__||S()(t)).call.apply(e,[this].concat(l))),n.state={publishDesc:"",showPublish:!1},n.saveTask=function(){for(var e=n.props,t=e.currentPage,a=e.dispatch,r=e.inputData,i=e.outputData,l=e.dimensionData,o=r[t.id]||{},s=o.checkFormParams,c=void 0===s?[]:s,p=o.panelColumn,u=void 0===p?[]:p,m=i[t.id]||{},d=m.checkFormParams,y=void 0===d?[]:d,h=m.panelColumn,v=void 0===h?[]:h,g=l[t.id]||{},f=g.checkFormParams,b=void 0===f?[]:f,T=g.panelColumn,C=void 0===T?[]:T,O=0,P=c.length;O<P;O++){var S=c[O].checkParams();if(!S.status)return k.a.error("源表--输入源"+(c[O].props.index+1)+": "+(S.message||"您还有未填选项"))}if(y.length>0)for(var x=0,I=y.length;x<I;x++){var N=y[x].checkParams();if(!N.status)return k.a.error("结果表--输出源"+(y[x].props.index+1)+": "+(N.message||"您还有未填选项"))}if(b.length>0)for(var D=0,L=b.length;D<L;D++){var w=b[D].checkParams();if(!w.status)return k.a.error("维表--维表"+(b[D].props.index+1)+": "+(w.message||"您还有未填选项"))}var K=t.resourceList;K&&K.length>0&&(t.resourceIdList=K.map(function(e){return e.id})),u.length>0&&(t.source=u),v.length>0&&(t.sink=v),C.length>0&&(t.side=C),t.lockVersion=t.readWriteLockVO.version,B.a.saveTask(t).then(function(e){var n=function(e){k.a.success("任务保存成功"),e.notSynced=!1,a(Q.x(e)),t.taskType===Z.v.MR&&a(J.a({id:e.parentId,catalogueType:Z.k.TASK}))};if(1===e.code){var r=e.data.readWriteLockVO,i=r.result;0===i?n(e.data):1===i?ft({title:"锁定提醒",content:M.a.createElement("span",null,"文件正在被",r.lastKeepLockUserName,"编辑中，开始编辑时间为",W.a.formatDateTime(r.gmtModified),"。 强制保存可能导致",r.lastKeepLockUserName,"对文件的修改无法正常保存！"),okText:"确定保存",okType:"danger",cancelText:"取消",onOk:function(){B.a.forceUpdateTask(t).then(function(e){1===e.code&&n(e.data)})}}):2===i&&ft({title:"保存警告",content:M.a.createElement("span",null,"文件已经被",r.lastKeepLockUserName,"编辑过，编辑时间为",W.a.formatDateTime(r.gmtModified),"。 点击确认按钮会",M.a.createElement(E.a,{color:"orange"},"覆盖"),"您本地的代码，请您提前做好备份！"),okText:"确定覆盖",okType:"danger",cancelText:"取消",onOk:function(){var e={id:t.id,lockVersion:r.version};B.a.getTask(e).then(function(e){if(1===e.code){var t=e.data;t.merged=!0,n(t)}})}})}})},n.editorChange=function(e){var t=n.props,a=t.currentPage,r=t.dispatch;a=Object(j.cloneDeep)(a),(a=T()(a,e)).notSynced=!0,r(Q.x(a))},n.debounceChange=Object(j.debounce)(n.editorChange,300,{maxWait:2e3}),n.editorParamsChange=function(e,t){var a=n.props,r=a.currentPage,i=a.dispatch;e!==t&&(r.taskParams=t,i(Q.x(r)))},n.startTask=function(){var e=n.props,t=e.currentPage,a=e.dispatch;B.a.startTask({id:t.id,isRestoration:0}).then(function(e){1===e.code&&(t.status=10,a(Q.x(T()({},t))),k.a.success("任务已经成功提交！"))})},n.loadTreeData=function(e){var t=n.props.dispatch,a=e.props.data;return new f.a(function(e){t(J.a(a)),e()})},n.closePublish=function(){n.setState({publishDesc:"",showPublish:!1})},n.publishChange=function(e){n.setState({publishDesc:e.target.value})},n.renderPublish=function(){var e=n.props.user,t=n.state.publishDesc;return M.a.createElement(R.a,{wrapClassName:"vertical-center-modal",title:"发布任务",style:{height:"600px",width:"600px"},visible:n.state.showPublish,onCancel:n.closePublish,onOk:n.submitTab.bind(n),cancelText:"关闭"},M.a.createElement(V.a,null,M.a.createElement(bt,v()({},Z.y,{label:"发布人",hasFeedback:!0}),M.a.createElement("span",null,e.userName)),M.a.createElement(bt,v()({},Z.y,{label:M.a.createElement("span",{className:"ant-form-item-required"},"备注"),hasFeedback:!0}),M.a.createElement(y.a,{type:"textarea",value:t,name:"publishDesc",rows:4,onChange:n.publishChange}))))},r=a,w()(n,r)}return A()(t,e),D()(t,[{key:"componentDidMount",value:function(){}},{key:"autoSaveTask",value:function(){var e=this;this.timerID=setInterval(function(){if("edit"===e.state.editorState){var t=e.props.currentPage;B.a.saveTask(t).then(function(e){1===e.code&&k.a.success("任务已自动保存")})}},3e4)}},{key:"submitTab",value:function(){var e=this,t=this.props,a=t.currentPage,n=t.dispatch,r=this.state.publishDesc,i=Object(j.cloneDeep)(a);return r?r.length>200?(k.a.error("备注信息不可超过200个字符！"),!1):(i.publishDesc=r,i.preSave=!0,i.submitStatus=1,void Q.w(i).then(function(t){e.closePublish(),t&&(k.a.success("发布成功！"),B.a.getTask({id:a.id}).then(function(e){if(1===e.code){var t=e.data;t.merged=!0,t.notSynced=!1,n(Q.x(t))}}))})):(k.a.error("发布备注不可为空！"),!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.dispatch,n=t.currentPage,r=n.notSynced;return M.a.createElement(s.a,{className:"task-editor"},M.a.createElement("header",{className:"toolbar bd-bottom clear"},M.a.createElement(p.a,{className:"left"},M.a.createElement(m.a,{onClick:function(){a(H.a(X.b.ADD_TASK_VISIBLE))},title:"创建任务"},M.a.createElement(G.a,{className:"my-icon",type:"focus"})," 新建任务"),M.a.createElement(m.a,{disabled:n.invalid,onClick:this.saveTask,title:"保存任务"},M.a.createElement(G.a,{className:"my-icon",type:"save"}),"保存"),M.a.createElement(Y.a,null)),M.a.createElement(p.a,{className:"right"},M.a.createElement(m.a,{disabled:r,onClick:function(){e.setState({showPublish:!0})}},M.a.createElement(G.a,{className:"my-icon",type:"fly"})," 发布"),M.a.createElement(U.c,{to:"/operation/realtime?tname="+n.name},M.a.createElement(m.a,null,M.a.createElement(G.a,{className:"my-icon",type:"goin"})," 运维")))),M.a.createElement(gt,v()({},this.props,{ayncTree:this.loadTreeData,editorParamsChange:this.editorParamsChange,editorChange:this.debounceChange})),this.renderPublish())}}]),t}(q.Component);t.default=Object(z.b)(function(e){var t=e.realtimeTask,a=t.resources,n=t.pages,r=t.currentPage,i=t.inputData,l=t.outputData,o=t.dimensionData;return{currentPage:r,pages:n,resources:a,user:e.user,inputData:i,outputData:l,dimensionData:o}})(Tt)},aOJk:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(a("QbLZ")),r=u(a("iCc5")),i=u(a("V7oC")),l=u(a("FYw3")),o=u(a("mRg0")),s=u(a("sbe7")),c=u(a("d1El")),p=u(a("aVg8"));function u(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){return(0,r.default)(this,t),(0,l.default)(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return(0,o.default)(t,e),(0,i.default)(t,[{key:"getPopupDomNode",value:function(){return this.refs.tooltip.getPopupDomNode()}},{key:"getOverlay",value:function(){var e=this.props,t=e.title,a=e.prefixCls,n=e.content;return(0,p.default)(!("overlay"in this.props),"Popover[overlay] is removed, please use Popover[content] instead, see: https://u.ant.design/popover-content"),s.default.createElement("div",null,t&&s.default.createElement("div",{className:a+"-title"},t),s.default.createElement("div",{className:a+"-inner-content"},n))}},{key:"render",value:function(){var e=(0,n.default)({},this.props);return delete e.title,s.default.createElement(c.default,(0,n.default)({},e,{ref:"tooltip",overlay:this.getOverlay()}))}}]),t}(s.default.Component);t.default=m,m.defaultProps={prefixCls:"ant-popover",placement:"top",transitionName:"zoom-big",trigger:"hover",mouseEnterDelay:.1,mouseLeaveDelay:.1,overlayStyle:{}},e.exports=t.default}}]);