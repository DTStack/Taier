(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"/AHB":function(e,t,a){"use strict";a.r(t);var n=a("fvjX"),r=a("L3Ur"),s=a("Aqym"),l=a("LvDl"),i={userList:[]},o=a("6EK8"),c=a("+JEa"),u=Object(n.c)({routing:r.routerReducer,user:o.a,apps:c.b,app:c.a,consoleUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments[1];switch(t.type){case s.a.SET_USER_LIST:var a=t.data,n=Object(l.cloneDeep)(e);return n.userList=a,n;default:return e}}});t.default=u},"3J6H":function(e,t,a){},"95Qq":function(e,t,a){},Aqym:function(e,t,a){"use strict";var n=a("zbcj"),r=a.n(n)()(["SET_USER_LIST"],{prefix:"console/"});t.a=r},EMQV:function(e,t,a){},FdzR:function(e,t,a){},TmhF:function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a("udPp");function r(e){return{type:n.a.UPDATE_APP,data:e}}},XoD3:function(e,t,a){},YHBf:function(e,t,a){"use strict";a.r(t);var n,r=a("sbe7"),s=a.n(r),l=a("i8i4"),i=a.n(l),o=a("0cfB"),c=a("2NsA"),u=a("Yz+Y"),d=a.n(u),m=a("iCc5"),p=a.n(m),f=a("V7oC"),h=a.n(f),g=a("FYw3"),v=a.n(g),E=a("mRg0"),k=a.n(E),y=a("dtw8"),C=a("/MKj"),b=(a("3J6H"),a("EMQV"),a("FdzR"),a("95Qq"),a("XoD3"),a("f7r7"),a("5012"),a("s9ml"),a("XLg0")),S=a("2BCK"),_=a("vFRS"),x=a("NX2S"),U=a("UopC"),T=a("X9CO"),N=a("dVc0"),L=a("2Ul7"),R=a("AVFO"),I=a("17x9"),P=a.n(I),w=a("7Qib"),D=a("QbLZ"),M=a.n(D),O=a("pLPX"),A=Object(C.b)(function(e){return{user:e.user,apps:e.apps,routing:e.routing,common:e.common,app:e.app}})(n=function(e){function t(e){p()(this,t);var a=v()(this,(t.__proto__||d()(t)).call(this,e));return a.state={},a}return k()(t,e),h()(t,[{key:"render",value:function(){var e=this.props,t=(e.user,e.apps,"/console.html#/console"),a=[{id:"resourceManage",name:"资源管理",link:t+"/resourceManage",enable:!0},{id:"clusterManage",name:"多集群管理",link:t+"/clusterManage",enable:!0}],n=s.a.createElement("span",null,s.a.createElement("img",{style:{height:"20px",width:"20px",marginTop:"13px"},alt:"logo",src:"/public/console/img/logo.svg"}),s.a.createElement("span",{style:{fontSize:"14px",color:"#ffffff",position:"absolute",left:"80px",top:0}},"DTinsight.Console"));return s.a.createElement(O.c,M()({logoWidth:"170px",logo:n,menuItems:a},this.props))}}]),t}(r.Component))||n,F=a("4d7F"),H=a.n(F),q=(a("pjuD"),a("rR1Q")),V=a.n(q),j=a("gDS+"),B=a.n(j),z=(a("bZMm"),a("wFDc")),G=(a("tL+A"),a("QpBz")),Y=a.n(G),Q=a("OZjc");function Z(e){switch(e.status){case 402:case 200:return e;case 302:Y.a.info("登录超时, 请重新登录！");case 500:Y.a.error("服务器出现了点问题");default:return e}}function J(e){switch(e.code){case 1:return e;case 0:return te.openLogin(),H.a.reject(e);case 3:return V.a.error({message:"权限通知",description:e.message}),H.a.reject(e);case 16:hashHistory.push("/");default:return e.message&&Y.a.error(e.message,3),e}}var K=new(function(){function e(){p()(this,e)}return h()(e,[{key:"get",value:function(e,t){var a=t?this.build(e,t):e;return this.request(a,{method:"GET"})}},{key:"post",value:function(e,t){var a={method:"POST"};return t&&(a.body=B()(t)),this.request(e,a)}},{key:"postAsFormData",value:function(e,t){var a={method:"POST"};return t&&(a.body=this.buildFormData(t)),this.request(e,a)}},{key:"postForm",value:function(e,t){var a={method:"POST"};return t&&(a.body=new FormData(t)),this.request(e,a)}},{key:"request",value:function(e,t){return z.a.show(),t.credentials="same-origin",fetch(e,t).then(Z).then(function(e){return setTimeout(function(){z.a.hide()},300),e.json()}).then(J).catch(function(e){return z.a.hide(),V.a.error({message:"请求异常",description:"服务器可能出了点问题, 请稍后再试！"}),new H.a.reject(e)})}},{key:"defaultHeader",value:function(){return{Accept:"*/*","Content-Type":"application/json"}}},{key:"build",value:function(e,t){var a=[];if(t)for(var n in t)n&&a.push(n+"="+encodeURIComponent(t[n]));return e+"?"+a.join("&")}},{key:"buildFormData",value:function(e){if(e){var t=new FormData;for(var a in e)a&&t.append(a,e[a]);return t}}}]),e}()),X=a("PVY6"),W={DA_GET_USER_BY_ID:X.b+"/user/getUserById",DA_GET_USER_AUTH_BY_ID:X.b+"/user/getUserById",GET_USER_LIST:X.b+"/tenant/listTenant",GET_RESOURCE_USER_LIST:X.b+"/tenant/listByQueueId",BIND_USER_TO_RESOURCE:X.b+"/tenant/addToQueue",GET_RESOURCE_LIST:X.b+"/cluster/pageQueue",GET_CLUSTER_LIST:X.b+"/cluster/pageQuery",UPDATE_CLUSTER:X.a+"/upload/cluster/update",NEW_CLUSTER:X.a+"/upload/cluster/add",TEST_CLUSTER_CONNECT:X.b+"/cluster/testConnect",UPLOAD_CLUSTER_RESOURCE:X.a+"/upload/cluster/config",GET_CLUSTER:X.b+"/cluster/getOne"},$=APP_CONF.UIC_URL||"",ee=APP_CONF.UIC_DOMAIN||"",te={logout:function(){var e=this;K.post(W.APP_LOGOUT).then(function(t){1===t.code&&e.openLogin()})},openLogin:function(){Q.a.clear(),w.a.deleteCookie("dt_user_id",ee,"/"),w.a.deleteCookie("dt_token",ee,"/"),w.a.deleteCookie("dt_tenant_id",ee,"/"),w.a.deleteCookie("dt_tenant_name",ee,"/"),w.a.deleteCookie("dt_username",ee,"/"),w.a.deleteCookie("dt_is_tenant_admin",ee,"/"),w.a.deleteCookie("dt_is_tenant_creator",ee,"/"),w.a.deleteCookie("project_id",ee,"/"),window.location.href=$+"/#/login"},getLoginedUser:function(){return K.post(W.DA_GET_USER_BY_ID)},getUserList:function(){return K.post(W.DATA_API_GET_USER_LIST)}},ae=a("zbcj");a.n(ae)()(["GET_USER","UPDATE_USER","GET_NOT_PROJECT_USERS","GET_PROJECT_USERS","GET_USER_LIST"],{prefix:"user/"});var ne,re=a("TmhF"),se={children:P.a.node},le=Object(C.b)(function(e){return{common:e.common}})(ne=function(e){function t(){return p()(this,t),v()(this,(t.__proto__||d()(t)).apply(this,arguments))}return k()(t,e),h()(t,[{key:"componentWillMount",value:function(){this.props.dispatch}},{key:"componentDidMount",value:function(){(0,this.props.dispatch)(Object(re.a)(X.h))}},{key:"render",value:function(){var e=this.props.children,t=s.a.createElement(A,null);return s.a.createElement("div",{className:"main"},t,s.a.createElement("div",{className:"container overflow-x-hidden"},e||"加载中...."))}}]),t}(r.Component))||ne;le.propTypes=se,le.defaultProps={children:[]};var ie,oe=le,ce=(a("zmYW"),a("DtFj")),ue=a.n(ce),de=(a("mN36"),a("N9UN")),me=a.n(de),pe=(a("ek7I"),a("FAat")),fe=a.n(pe),he=a("wd/R"),ge=a.n(he),ve={getResourceList:function(e){return K.post(W.GET_RESOURCE_LIST,e)},getClusterList:function(e){return K.post(W.GET_CLUSTER_LIST,e)},uploadClusterResource:function(e){return K.postAsFormData(W.UPLOAD_CLUSTER_RESOURCE,e)},getTenantList:function(e){return K.post(W.GET_USER_LIST,e)},testCluster:function(e){return K.post(W.TEST_CLUSTER_CONNECT,e)},createCluster:function(e){return K.postAsFormData(W.NEW_CLUSTER,e)},bindUserToQuere:function(e){return K.post(W.BIND_USER_TO_RESOURCE,e)},getClusterInfo:function(e){return K.post(W.GET_CLUSTER,e)},updateCluster:function(e){return K.postAsFormData(W.UPDATE_CLUSTER,e)}},Ee=(a("fwXI"),a("CC+v")),ke=a.n(Ee),ye=(a("nTym"),a("qu0K")),Ce=a.n(ye),be=a("GQeE"),Se=a.n(be),_e=a("oF3Q"),xe=a.n(_e),Ue=a("YEIV"),Te=a.n(Ue),Ne=a("LvDl"),Le={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}},Re=a("Aqym");function Ie(){return function(e){ve.getTenantList({pageSize:9999,currentPage:1}).then(function(t){if(1===t.code)return e({type:Re.a.SET_USER_LIST,data:t.data.data})})}}var Pe=fe.a.Option;var we,De=Object(C.b)(function(e){return{consoleUser:e.consoleUser}},function(e){return{getTenantList:function(){e(Ie())}}})(ie=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,l=Array(s),i=0;i<s;i++)l[i]=arguments[i];return a=n=v()(this,(e=t.__proto__||d()(t)).call.apply(e,[this].concat(l))),n.state={loading:!1,selectUserMap:{},selectUser:"",selectHack:!1},r=a,v()(n,r)}return k()(t,e),h()(t,[{key:"componentDidMount",value:function(){var e=this.props.resource;this.setState({selectUserMap:this.exchangeSelectMap(e.tenants)})}},{key:"componentWillReceiveProps",value:function(e){var t=e.resource,a=e.visible,n=this.props;n.resource;n.visible!=a&&a&&(this.setState({selectUserMap:this.exchangeSelectMap(t.tenants),loading:!1}),this.resetValueByHack(),this.props.getTenantList())}},{key:"exchangeSelectMap",value:function(){var e={};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(t){e[t.tenantId]={tenantName:t.tenantName}}),e}},{key:"changeUserValue",value:function(e){this.setState({selectUser:e})}},{key:"selectUser",value:function(e,t){var a=this.state.selectUserMap;this.setState({selectUser:"",selectUserMap:M()({},a,Te()({},t.props.tenantid,{tenantName:t.props.children}))})}},{key:"removeUser",value:function(e){var t=this.state.selectUserMap;delete(t=Object(Ne.cloneDeep)(t))[e],this.setState({selectUserMap:t})}},{key:"getUserOptions",value:function(){var e=[],t=this.state.selectUserMap,a=this.props,n=a.consoleUser,r=a.resource,l=n.userList,i=r.tenants||[];l=Object(Ne.uniq)(l.concat(i),"tenantId");for(var o=0;o<l.length;o++){var c=l[o];t[c.tenantId]||e.push(s.a.createElement(Pe,{tenantid:c.tenantId,value:c.tenantName},c.tenantName))}return e}},{key:"initColumns",value:function(){return[{title:"租户名称",dataIndex:"name",className:"text-middle",render:function(e){return s.a.createElement("span",{className:"text-middle"},e)}}]}},{key:"getTableDataSource",value:function(){var e=this.state.selectUserMap;return xe()(e).map(function(e){return{id:e[0],name:e[1].tenantName}})}},{key:"getTenantsList",value:function(){var e=this.state.selectUserMap;return Se()(e)}},{key:"changeResource",value:function(){var e=this;this.setState({loading:!0});var t=this.props.resource;ve.bindUserToQuere({queueId:t.queueId,tenants:this.getTenantsList()}).then(function(t){e.setState({loading:!1}),1==t.code&&(Y.a.success("修改成功"),e.props.resourceUserChange())})}},{key:"onCancel",value:function(){this.props.onCancel()}},{key:"resetValueByHack",value:function(){var e=this;this.setState({selectHack:!0},function(){e.setState({selectHack:!1,selectUser:""})})}},{key:"render",value:function(){var e=this.state,t=e.selectUser,a=e.loading,n=e.selectHack,r=this.props,l=r.visible,i=r.resource,o=this.initColumns(),c=i.queueName;return s.a.createElement("div",{className:"contentBox"},s.a.createElement(ke.a,{title:"修改 ("+c+")",visible:l,onCancel:this.onCancel.bind(this),onOk:this.changeResource.bind(this),confirmLoading:a,maskClosable:!1,className:"m-card"},s.a.createElement(Ce.a.Item,M()({label:"绑定租户"},Le),!n&&s.a.createElement(fe.a,{mode:"combobox",style:{width:"100%"},placeholder:"请选择租户",onSelect:this.selectUser.bind(this),onSearch:this.changeUserValue.bind(this),value:t},this.getUserOptions())),s.a.createElement(ue.a,{className:"m-table",style:{margin:"0px 20px",marginTop:"30px"},columns:o,pagination:!1,dataSource:this.getTableDataSource(),scroll:{y:300}})))}}]),t}(s.a.Component))||ie,Me=fe.a.Option,Oe=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,l=Array(s),i=0;i<s;i++)l[i]=arguments[i];return a=n=v()(this,(e=t.__proto__||d()(t)).call.apply(e,[this].concat(l))),n.state={resource:{},dataSource:[],table:{pageIndex:1,total:0,loading:!0},changeModalVisible:!1},r=a,v()(n,r)}return k()(t,e),h()(t,[{key:"componentDidMount",value:function(){this.getResourceList()}},{key:"getResourceList",value:function(){var e=this,t=this.state.table,a=t.pageIndex;ve.getResourceList({currentPage:a,pageSize:10}).then(function(a){1==a.code?e.setState({dataSource:e.exchangeDataSource(a.data.data),table:M()({},t,{loading:!1,total:a.data.totalCount})}):e.setState({table:M()({},t,{loading:!1})})})}},{key:"getPagination",value:function(){var e=this.state.table;return{current:e.pageIndex,pageSize:10,total:e.total}}},{key:"exchangeDataSource",value:function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a];t.push(M()({},n,{type:"cluster",className:null,clusterId:n.id,children:r(n.queues,0)}))}function r(e,t){var a=[];if(!e)return null;for(var n=0;n<e.length;n++){var s=e[n];a.push(M()({},s,{queueId:s.id,deepLength:t,className:"table-row-color_level"+(t+1),children:r(s.childQueues,t+1)}))}return a.length>0?a:null}return t}},{key:"initTableColumns",value:function(){var e=this;return[{title:"集群名称",dataIndex:"clusterName",width:"200px"},{title:"资源队列",dataIndex:"queueName",width:"200px",render:function(e,t){return"cluster"==t.type?null:("STOPPED"==t.queueState&&(e+="(已停用)"),s.a.createElement("span",{style:{paddingLeft:10*t.deepLength+"px"}},e))}},{title:"最小容量（%）",dataIndex:"capacity",width:"120px",render:function(e,t){return"cluster"==t.type?null:100*e}},{title:"最大容量（%）",dataIndex:"maxCapacity",width:"120px",render:function(e,t){return"cluster"==t.type?null:100*e}},{title:"绑定租户",dataIndex:"tenants",render:function(e,t){return e?e.map(function(e){return e.tenantName}).join("，")||"无":null}},{title:"修改时间",dataIndex:"gmtModified",width:"200px",render:function(e){return new ge.a(e).format("YYYY-MM-DD HH:mm:ss")}},{title:"操作",dataIndex:"deal",render:function(t,a){return"STOPPED"!=a.queueState&&a.tenants?s.a.createElement("a",{onClick:e.changeResource.bind(e,a)},"修改"):null},width:"80px"}]}},{key:"changeResource",value:function(e){this.setState({resource:e,changeModalVisible:!0})}},{key:"changeUserValue",value:function(e){this.setState({selectUser:e})}},{key:"selectUser",value:function(e){var t=this.state.selectUserList;this.setState({selectUser:"",selectUserList:t.concat(e)})}},{key:"closeModal",value:function(){this.setState({changeModalVisible:!1})}},{key:"resourceUserChange",value:function(){this.setState({changeModalVisible:!1}),this.getResourceList()}},{key:"getUserOptions",value:function(){for(var e=this.state,t=e.userList,a=e.selectUserList,n=[],r=0;r<t.length;r++){var l=t[r];-1==a.indexOf(l.id)&&n.push(s.a.createElement(Me,{value:l.id},l.name))}return n}},{key:"render",value:function(){var e=this.state,t=e.dataSource,a=e.table,n=e.changeModalVisible,r=e.resource,l=a.loading,i=this.initTableColumns();return s.a.createElement("div",{className:"contentBox"},s.a.createElement(me.a,{style:{width:"900px",color:"rgba(1,1,1,0.84)"},noHovering:!0},s.a.createElement("h2",null,"什么是资源管理"),s.a.createElement("p",{style:{marginTop:"20px"}},"资源管理是以租户为单位进行计算资源的分配，当您需要多个租户，并且每个租户分配不同比例的资源容量时需要使用本功能，例如：您的集群有10个节点，每个节点的配置为8核16GB内存，总资源为80核160GB内存，那么您可以新建“销售”和“开发”2个租户，为销售租户分配30%的资源容量，为开发租户分配70%的资源容量。"),s.a.createElement("p",{style:{marginTop:"20px"}},"注意:"),s.a.createElement("ul",null,s.a.createElement("li",null,"1、“资源队列”仅包括集群的内存和CPU；"),s.a.createElement("li",null,"2、只支持将资源队列绑定到租户，暂时不支持绑定到项目；"),s.a.createElement("li",null,"3、每个资源队列的最小容量之和等于100%；"),s.a.createElement("li",null,"4、以资源队列的形式分配资源，资源队列的维护在配置文件中，本模块只是将资源队列绑定到租户；"),s.a.createElement("li",null,"5、可能已有的任务占用了较多的资源，导致更新配置后不会立即生效，需要等待已占用的资源释放；"))),s.a.createElement(ue.a,{rowClassName:function(e,t){return e.className},rowKey:function(e){return e.clusterId+"~"+e.queueId},style:{marginTop:"20px"},className:"m-table no-card-table",pagination:this.getPagination(),loading:l,dataSource:t,columns:i}),s.a.createElement(De,{visible:n,onCancel:this.closeModal.bind(this),resourceUserChange:this.resourceUserChange.bind(this),resource:r}))}}]),t}(s.a.Component),Ae=(a("MaXC"),a("4IMT")),Fe=a.n(Ae),He=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,l=Array(s),i=0;i<s;i++)l[i]=arguments[i];return a=n=v()(this,(e=t.__proto__||d()(t)).call.apply(e,[this].concat(l))),n.state={dataSource:[],table:{pageIndex:1,total:0,loading:!0}},r=a,v()(n,r)}return k()(t,e),h()(t,[{key:"componentDidMount",value:function(){this.getResourceList()}},{key:"getResourceList",value:function(){var e=this,t=this.state.table,a=t.pageIndex;ve.getClusterList({currentPage:a,pageSize:10}).then(function(a){1==a.code?e.setState({dataSource:a.data.data,table:M()({},t,{loading:!1,total:a.data.totalCount})}):e.setState({table:M()({},t,{loading:!1})})})}},{key:"getPagination",value:function(){var e=this.state.table;return{current:e.pageIndex,pageSize:10,total:e.total}}},{key:"initTableColumns",value:function(){var e=this;return[{title:"集群名称",dataIndex:"clusterName"},{title:"节点数量",dataIndex:"totalNode"},{title:"总资源数",dataIndex:"totalCore",width:"200px",render:function(e,t){var a=t.totalMemory/1024,n=Math.floor(a)!=a;return t.totalCore+"VCore "+(n?a.toFixed(2):a)+"GB"}},{title:"修改时间",dataIndex:"gmtModified",width:"200px",render:function(e){return new ge.a(e).format("YYYY-MM-DD HH:mm:ss")}},{title:"操作",dataIndex:"deal",render:function(t,a){return s.a.createElement("div",null,s.a.createElement("a",{onClick:e.editCluster.bind(e,a)},"修改"),s.a.createElement("span",{className:"ant-divider"}),s.a.createElement("a",{onClick:e.viewCluster.bind(e,a)},"查看"))}}]}},{key:"editCluster",value:function(e){y.g.push({pathname:"/console/clusterManage/editCluster",state:{cluster:e,mode:"edit"}})}},{key:"viewCluster",value:function(e){y.g.push({pathname:"/console/clusterManage/editCluster",state:{cluster:e,mode:"view"}})}},{key:"newCluster",value:function(){y.g.push({pathname:"/console/clusterManage/editCluster"})}},{key:"render",value:function(){var e=this.state,t=e.dataSource,a=e.table.loading,n=this.initTableColumns(),r=s.a.createElement("div",null,"多集群管理 ",s.a.createElement(Fe.a,{type:"primary",onClick:this.newCluster,style:{float:"right",marginTop:"9px"}},"新增集群"));return s.a.createElement("div",{className:"contentBox m-card"},s.a.createElement(me.a,{noHovering:!0,title:r},s.a.createElement(ue.a,{rowKey:function(e){return e.id},className:"m-table",pagination:this.getPagination(),loading:a,dataSource:t,columns:n})))}}]),t}(s.a.Component),qe=(a("FGdI"),a("Pbn2")),Ve=a.n(qe),je=(a("93XW"),a("d1El")),Be=a.n(je),ze=(a("hr7U"),a("9xET")),Ge=a.n(ze),Ye=(a("fv9D"),a("ZPTe")),Qe=a.n(Ye),Ze=a("m1cH"),Je=a.n(Ze),Ke=(a("PAYn"),a("EQeY")),Xe=a.n(Ke),We=a("sk9p"),$e=a.n(We),et=(a("cUip"),a("iJl9")),tt=a.n(et),at=a("ER3F"),nt=Ce.a.Item,rt=(tt.a.TextArea,fe.a.Option),st={NOTHING:0,SUCCESS:1,FAIL:2};function lt(){return(new Date).getTime()+""+~~(1e5*Math.random())}var it,ot,ct,ut,dt,mt=Object(C.b)(function(e){return{consoleUser:e.consoleUser}},function(e){return{getTenantList:function(){e(Ie())}}})(we=function(e){function t(){var e,a,n,r;p()(this,t);for(var s=arguments.length,l=Array(s),i=0;i<s;i++)l[i]=arguments[i];return a=n=v()(this,(e=t.__proto__||d()(t)).call.apply(e,[this].concat(l))),n.state={selectUserMap:{},selectUser:"",file:"",zipConfig:"",uploadLoading:!1,testLoading:!1,testStatus:st.NOTHING,flink_params:[],spark_params:[],core:null,nodeNumber:null,memory:null,extDefaultValue:{},fileHaveChange:!1},r=a,v()(n,r)}return k()(t,e),h()(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.location,n=t.form,r=a.state||{};"edit"!=r.mode&&"view"!=r.mode||ve.getClusterInfo({clusterId:r.cluster.id}).then(function(t){if(1==t.code){var a=t.data,r=a.clusterConf;r=JSON.parse(r);var s=e.exchangeServerParams(r);e.setState({core:a.totalCore,memory:a.totalMemory,nodeNumber:a.totalNode,zipConfig:B()({yarnConf:r.yarnConf,hadoopConf:r.hadoopConf,hiveMeta:r.hiveMeta}),flink_params:s.flinkKeys,spark_params:s.sparkKeys,extDefaultValue:s.default}),n.setFieldsValue({clusterName:a.clusterName,hiveConf:r.hiveConf,sparkConf:r.sparkConf,flinkConf:r.flinkConf})}})}},{key:"exchangeServerParams",value:function(e){var t={flinkKeys:[],sparkKeys:[],default:{}},a=e.sparkConf,n=e.flinkConf;function r(e,a,n,r){xe()(e).map(function(e){var n=$e()(e,2),s=n[0],l=n[1];if(!a.includes(s)){var i=lt();r.push({id:i}),t.default[i]={name:s,value:l}}})}return r(a,["typeName","sparkYarnArchive","sparkSqlProxyPath","sparkPythonExtLibPath"],0,t.sparkKeys),r(n,["typeName","flinkZkAddress","flinkHighAvailabilityStorageDir","flinkZkNamespace","jarTmpDir","flinkPluginRoot","remotePluginRootDir","clusterMode"],0,t.flinkKeys),t}},{key:"getUserOptions",value:function(){for(var e=this.props.consoleUser,t=this.state.selectUserMap,a=e.userList,n=[],r=0;r<a.length;r++){var l=a[r];t[l.tenantId]||n.push(s.a.createElement(rt,{value:l.tenantId+"$$"+l.tenantName},l.tenantName))}return n}},{key:"changeUserValue",value:function(e){this.setState({selectUser:e})}},{key:"selectUser",value:function(e,t){var a=this.state.selectUserMap;this.setState({selectUser:"",selectUserMap:M()({},a,Te()({},e.split("$$")[0],{name:t.props.children}))})}},{key:"getTableDataSource",value:function(){var e=this.state.selectUserMap;return xe()(e).map(function(e){return{id:e[0],name:e[1].name}})}},{key:"removeUser",value:function(e){var t=this.state.selectUserMap;delete(t=Object(Ne.cloneDeep)(t))[e],this.setState({selectUserMap:t})}},{key:"initColumns",value:function(){var e=this;return[{title:"租户名称",dataIndex:"name",width:"150px"},{title:"操作",dataIndex:"deal",render:function(t,a){return s.a.createElement("a",{onClick:e.removeUser.bind(e,a.id)},"删除")}}]}},{key:"validateFileType",value:function(e,t,a){t&&!/\.(zip)$/.test(t.toLocaleLowerCase())&&a("配置文件只能是zip文件!"),a()}},{key:"fileChange",value:function(e){var t=this,a=e.target;this.setState({file:{},uploadLoading:!0,zipConfig:"",fileHaveChange:!0}),ve.uploadClusterResource({config:a.files[0]}).then(function(e){1==e.code?t.setState({uploadLoading:!1,file:a,zipConfig:e.data}):(t.props.form.setFieldsValue({file:null}),t.setState({uploadLoading:!1}))})}},{key:"renderTestResult",value:function(){switch(this.state.testStatus){case st.NOTHING:return null;case st.SUCCESS:return s.a.createElement(Xe.a,{color:"#87d068"},"连通成功");case st.FAIL:return s.a.createElement("span",null,s.a.createElement(Xe.a,{color:"red"},"连通失败"))}}},{key:"addParam",value:function(e){var t=this.state,a=t.flink_params,n=t.spark_params;"flink"==e?this.setState({flink_params:[].concat(Je()(a),[{id:lt()}])}):this.setState({spark_params:[].concat(Je()(n),[{id:lt()}])})}},{key:"deleteParam",value:function(e,t){var a=this.state,n=a.flink_params,r=a.spark_params,s=void 0,l=void 0;"flink"==t?(l="flink_params",s=n):(l="spark_params",s=r),s=s.filter(function(t){return t.id!=e}),this.setState(Te()({},l,s))}},{key:"renderExtraParam",value:function(e){var t=this,a=this.state,n=a.flink_params,r=a.spark_params,l=a.extDefaultValue,i=this.props.form.getFieldDecorator,o="view"==(this.props.location.state||{}).mode;return("flink"==e?n:r).map(function(a){return s.a.createElement(Ge.a,{key:a.id},s.a.createElement(Qe.a,{span:Le.labelCol.sm.span},s.a.createElement(nt,{key:a.id+"-name"},i(e+"%"+a.id+"-name",{rules:[{required:!0,message:"请输入参数属性名"}],initialValue:l[a.id]&&l[a.id].name})(s.a.createElement(tt.a,{disabled:o,style:{width:"calc(100% - 12px)"}})),":")),s.a.createElement(Qe.a,{span:Le.wrapperCol.sm.span},s.a.createElement(nt,{key:a.id+"-value"},i(e+"%"+a.id+"-value",{rules:[{required:!0,message:"请输入参数属性值"}],initialValue:l[a.id]&&l[a.id].value})(s.a.createElement(tt.a,{disabled:o})))),o?null:s.a.createElement("a",{className:"formItem-right-text",onClick:t.deleteParam.bind(t,a.id,e)},"删除"))})}},{key:"renderZipConfig",value:function(e){var t=this.state.zipConfig;t=JSON.parse(t);var a=void 0;return"hdfs"==e?(a=xe()(t.hadoopConf),w.a.sortByCompareFunctions(a,function(e,t){var a=$e()(e,2),n=a[0],r=(a[1],$e()(t,2)),s=r[0];r[1];return"fs.defaultFS"==n?-1:"fs.defaultFS"==s?1:0},function(e,t){var a=$e()(e,2),n=a[0],r=(a[1],$e()(t,2)),s=r[0];r[1];return"dfs.nameservices"==n?-1:"dfs.nameservices"==s?1:0},function(e,t){var a=$e()(e,2),n=a[0],r=(a[1],$e()(t,2)),s=r[0];r[1];return n.indexOf("dfs.ha.namenodes")>-1?-1:s.indexOf("dfs.ha.namenodes")>-1?1:0},function(e,t){var a=$e()(e,2),n=a[0],r=(a[1],$e()(t,2)),s=r[0],l=(r[1],n.indexOf("dfs.namenode.rpc-address")>-1),i=s.indexOf("dfs.namenode.rpc-address")>-1;return l&&i?n>s?1:-1:l?-1:i?1:0})):(a=xe()(t.yarnConf),w.a.sortByCompareFunctions(a,function(e,t){var a=$e()(e,2),n=a[0],r=(a[1],$e()(t,2)),s=r[0];r[1];return"yarn.resourcemanager.ha.rm-ids"==n?-1:"yarn.resourcemanager.ha.rm-ids"==s?1:0},function(e,t){var a=$e()(e,2),n=a[0],r=(a[1],$e()(t,2)),s=r[0],l=(r[1],n.indexOf("yarn.resourcemanager.address")>-1),i=s.indexOf("yarn.resourcemanager.address")>-1;return l&&i?n>s?1:-1:l?-1:i?1:0},function(e,t){var a=$e()(e,2),n=a[0],r=(a[1],$e()(t,2)),s=r[0],l=(r[1],n.indexOf("yarn.resourcemanager.webapp.address")>-1),i=s.indexOf("yarn.resourcemanager.webapp.address")>-1;return l&&i?n>s?1:-1:l?-1:i?1:0})),a.map(function(e){var t=$e()(e,2),a=t[0],n=t[1];return s.a.createElement(Ge.a,{className:"zipConfig-item"},s.a.createElement(Qe.a,{className:"formitem-textname",span:Le.labelCol.sm.span+4},a.length>40?s.a.createElement(Be.a,{title:a},a.substr(0,40)+"..."):a,"："),s.a.createElement(Qe.a,{className:"formitem-textvalue",span:Le.wrapperCol.sm.span-1},n))})}},{key:"exchangeMemory",value:function(e){if(!e)return"--";var t=e/1024;return(Math.floor(t)!=t?t.toFixed(2):t)+"GB"}},{key:"save",value:function(){var e=this,t=(this.props.location.state||{}).mode;this.props.form.validateFieldsAndScroll(null,{},function(a,n){if(!a){var r="createCluster";"edit"==t&&(r="updateCluster"),ve[r](e.getServerParams(n,!0)).then(function(t){1==t.code&&(Y.a.success("保存成功"),e.props.router.goBack())})}})}},{key:"test",value:function(){var e=this;this.props.form.validateFieldsAndScroll(null,{},function(t,a){t||(e.setState({testLoading:!0}),ve.testCluster(e.getServerParams(a)).then(function(t){1==t.code?(e.setState({testLoading:!1,testStatus:st.SUCCESS,nodeNumber:t.data.totalNode,core:t.data.totalCores,memory:t.data.totalMemory}),Y.a.success("连通成功")):e.setState({testLoading:!1,testStatus:st.FAIL})}))})}},{key:"getServerParams",value:function(e,t){var a=this.props.location.state||{},n=a.mode,r=a.cluster,s=this.getClusterConf(e),l={clusterName:e.clusterName,clusterConf:B()(s)};if(t){var i=this.state.file;i&&(l.config=i.files[0])}return"edit"==n&&(l.id=r.id),l}},{key:"getClusterConf",value:function(e){var t=this.state.zipConfig;t=JSON.parse(t);var a={},n=this.getCustomParams(e,"spark"),r=this.getCustomParams(e,"flink");return a.hadoopConf=t.hadoopConf,a.yarnConf=t.yarnConf,a.hiveMeta=t.hiveMeta,a.hiveConf=e.hiveConf,a.sparkConf=M()({},e.sparkConf,n),a.flinkConf=M()({},e.flinkConf,r),a.hiveConf.username=a.hiveConf.username||"",a.hiveConf.password=a.hiveConf.password||"",a}},{key:"getCustomParams",value:function(e,t){var a={},n={};for(var r in e)if(r.startsWith(t+"%")){var s=r.split("%")[1].split("-"),l=s[0],i=s[1];n[l]||(n[l]={}),n[l][i]=e[r]}for(var o in n){var c=n[o];a[c.name]=c.value}return a}},{key:"render",value:function(){var e=this.state,t=(e.selectUser,e.file),a=e.zipConfig,n=e.uploadLoading,r=e.core,l=e.nodeNumber,i=e.memory,o=e.testLoading,c=e.fileHaveChange,u=this.props.form,d=u.getFieldDecorator,m=(u.getFieldValue,(this.props.location.state||{}).mode),p="view"==m,f=!("view"==m||"edit"==m);this.initColumns();return s.a.createElement("div",{className:"contentBox"},s.a.createElement("p",{className:"box-title",style:{height:"auto",paddingLeft:"20px"}},s.a.createElement(at.a,{size:"default",type:"textButton"})),s.a.createElement(me.a,{noHovering:!0,className:"contentBox shadow"},s.a.createElement("p",{className:"config-title"},"集群信息"),s.a.createElement("div",{className:"config-content",style:{width:"680px"}},s.a.createElement(nt,M()({label:"集群标识"},Le),d("clusterName",{rules:[{required:!0,message:"请输入集群标识"},{pattern:/^[a-z0-9_]{1,64}$/i,message:"集群标识不能超过64字符，支持英文、数字、下划线"}]})(s.a.createElement(tt.a,{disabled:!f,placeholder:"请输入集群标识",style:{width:"40%"}})),s.a.createElement("span",{style:{marginLeft:"30px"}},"节点数：",l||"--"," "),s.a.createElement("span",{style:{marginLeft:"10px"}},"资源数：",r||"--","VCore ",this.exchangeMemory(i)," "))),p?null:s.a.createElement("div",null,s.a.createElement("p",{className:"config-title"},"上传配置文件"),s.a.createElement("div",{className:"config-content",style:{width:"750px"}},s.a.createElement("p",{style:{marginBottom:"24px"}},"您需要获取Hadoop、Spark、Flink集群的配置文件，至少包括：",s.a.createElement("strong",null,"core-site.xml、hdfs-site.xml、hive-site.xml、yarn-site.xml"),"文件"),s.a.createElement(nt,M()({label:"配置文件"},Le),d("file",{rules:[{required:!(!c&&"edit"==m),message:"请选择上传文件"},{validator:this.validateFileType}]})(s.a.createElement("div",null,n?s.a.createElement("label",{style:{lineHeight:"28px"},className:"ant-btn disble"},"选择文件"):s.a.createElement("label",{style:{lineHeight:"28px"},className:"ant-btn",htmlFor:"myOfflinFile"},"选择文件"),n?s.a.createElement(Ve.a,{className:"blue-loading",type:"loading"}):null,s.a.createElement("span",null," ",t.files&&t.files[0].name),s.a.createElement("input",{name:"file",type:"file",id:"myOfflinFile",onChange:this.fileChange.bind(this),accept:".zip",style:{display:"none"}}))),s.a.createElement("span",null,"支持扩展名：.zip")),"如何获取这些配置文件？请您参考",s.a.createElement("a",null,"《帮助文档》"))),a?s.a.createElement("div",null,s.a.createElement("p",{className:"config-title"},"HDFS"),s.a.createElement("div",{className:"config-content",style:{width:"800px"}},this.renderZipConfig("hdfs")),s.a.createElement("p",{className:"config-title"},"YARN"),s.a.createElement("div",{className:"config-content",style:{width:"800px"}},this.renderZipConfig("yarn"))):null,s.a.createElement("p",{className:"config-title"},"Hive JDBC信息"),s.a.createElement("div",{className:"config-content",style:{width:"680px"}},s.a.createElement(nt,M()({label:"JDBC URL"},Le),d("hiveConf.jdbcUrl",{rules:[{required:!0,message:"请输入jdbcUrl"}]})(s.a.createElement(tt.a,{disabled:p}))),s.a.createElement(nt,M()({label:"用户名"},Le),d("hiveConf.username")(s.a.createElement(tt.a,{disabled:p}))),s.a.createElement(nt,M()({label:"密码"},Le),d("hiveConf.password")(s.a.createElement(tt.a,{disabled:p})))),s.a.createElement("p",{className:"config-title"},"Spark"),s.a.createElement("div",{className:"config-content",style:{width:"680px"}},s.a.createElement(nt,M()({label:"版本选择"},Le),d("sparkConf.typeName",{rules:[{required:!0,message:"请选择Spark版本"}],initialValue:"spark_yarn"})(s.a.createElement(fe.a,{disabled:p,style:{width:"100px"}},s.a.createElement(rt,{value:"spark_yarn"},"2.X")))),s.a.createElement(nt,M()({label:"sparkYarnArchive"},Le),d("sparkConf.sparkYarnArchive",{rules:[{required:!0,message:"请输入sparkYarnArchive"}],initialValue:"/sparkjars/jars"})(s.a.createElement(tt.a,{disabled:p}))),s.a.createElement(nt,M()({label:"sparkSqlProxyPath"},Le),d("sparkConf.sparkSqlProxyPath",{rules:[{required:!0,message:"请输入sparkSqlProxyPath"}],initialValue:"/user/spark/spark-0.0.1-SNAPSHOT.jar"})(s.a.createElement(tt.a,{disabled:p}))),s.a.createElement(nt,M()({label:"sparkPythonExtLibPath"},Le),d("sparkConf.sparkPythonExtLibPath",{rules:[{required:!0,message:"请输入sparkPythonExtLibPath"}],initialValue:"/pythons/pyspark.zip,hdfs://ns1/pythons/py4j-0.10.4-src.zip"})(s.a.createElement(tt.a,{disabled:p}))),this.renderExtraParam("spark"),p?null:s.a.createElement(Ge.a,null,s.a.createElement(Qe.a,{span:Le.labelCol.sm.span}),s.a.createElement(Qe.a,{className:"m-card",span:Le.wrapperCol.sm.span},s.a.createElement("a",{onClick:this.addParam.bind(this,"spark")},"添加自定义参数")))),s.a.createElement("p",{className:"config-title"},"Flink"),s.a.createElement("div",{className:"config-content",style:{width:"680px"}},s.a.createElement(nt,M()({label:"版本选择"},Le),d("flinkConf.typeName",{rules:[{required:!0,message:"请选择flink版本"}],initialValue:"flink140"})(s.a.createElement(fe.a,{disabled:p,style:{width:"100px"}},s.a.createElement(rt,{value:"flink140"},"1.4"),s.a.createElement(rt,{value:"flink150"},"1.5")))),s.a.createElement(nt,M()({label:"clusterMode"},Le),d("flinkConf.clusterMode",{rules:[{required:!0,message:"请选择clusterMode"}],initialValue:"yarn"})(s.a.createElement(fe.a,{disabled:p,style:{width:"100px"}},s.a.createElement(rt,{value:"standalone"},"standalone"),s.a.createElement(rt,{value:"yarn"},"yarn")))),s.a.createElement(nt,M()({label:"flinkZkAddress"},Le),d("flinkConf.flinkZkAddress",{rules:[{required:!0,message:"请输入flinkZkAddress"}]})(s.a.createElement(tt.a,{disabled:p,placeholder:"hostname1:port,hostname2:port，多个地址用英文逗号隔开"}))),s.a.createElement(nt,M()({label:s.a.createElement(Be.a,{title:"flinkHighAvailabilityStorageDir"},"flinkHighAvailabilityStorageDir")},Le),d("flinkConf.flinkHighAvailabilityStorageDir",{rules:[{required:!0,message:"请输入flinkHighAvailabilityStorageDir"}]})(s.a.createElement(tt.a,{disabled:p,placeholder:"Flink高可用存储地址，例如：/flink140/ha"}))),s.a.createElement(nt,M()({label:"flinkZkNamespace"},Le),d("flinkConf.flinkZkNamespace",{rules:[{required:!0,message:"请输入flinkZkNamespace"}]})(s.a.createElement(tt.a,{disabled:p,placeholder:"Flink在Zookeeper的namespace，例如：/flink140"}))),s.a.createElement(nt,M()({label:"jarTmpDir"},Le),d("flinkConf.jarTmpDir",{initialValue:"../tmp140"})(s.a.createElement(tt.a,{disabled:p}))),s.a.createElement(nt,M()({label:"flinkPluginRoot"},Le),d("flinkConf.flinkPluginRoot",{initialValue:"/opt/dtstack/flinkplugin"})(s.a.createElement(tt.a,{disabled:p}))),s.a.createElement(nt,M()({label:"remotePluginRootDir"},Le),d("flinkConf.remotePluginRootDir",{initialValue:"/opt/dtstack/flinkplugin"})(s.a.createElement(tt.a,{disabled:p}))),this.renderExtraParam("flink"),p?null:s.a.createElement(Ge.a,null,s.a.createElement(Qe.a,{span:Le.labelCol.sm.span}),s.a.createElement(Qe.a,{className:"m-card",span:Le.wrapperCol.sm.span},s.a.createElement("a",{onClick:this.addParam.bind(this,"flink")},"添加自定义参数")))),s.a.createElement("p",{className:"config-title"}),p?null:s.a.createElement("div",{className:"config-content",style:{width:"100%"}},s.a.createElement(Fe.a,{onClick:this.test.bind(this),loading:o,type:"primary"},"测试连通性"),s.a.createElement("span",{style:{marginLeft:"18px"}},this.renderTestResult()),s.a.createElement("span",{style:{float:"right",marginRight:"18px"}},s.a.createElement(Fe.a,{onClick:this.save.bind(this),type:"primary"},"保存"),s.a.createElement(Fe.a,{onClick:y.g.goBack,style:{marginLeft:"8px"}},"取消")))))}}]),t}(s.a.Component))||we,pt=Ce.a.create()(mt),ft=s.a.createElement(y.d,{path:"/",component:b.a},s.a.createElement(y.a,{to:"/console"}),s.a.createElement(y.d,{path:"/message",component:S.a},s.a.createElement(y.b,{component:_.a}),s.a.createElement(y.d,{path:"list",component:_.a}),s.a.createElement(y.d,{path:"detail/:msgId",component:x.a})),s.a.createElement(y.d,{path:"/admin",component:U.a},s.a.createElement(y.b,{component:T.a}),s.a.createElement(y.d,{path:"user",component:T.a}),s.a.createElement(y.d,{path:"role",component:N.a}),s.a.createElement(y.d,{path:"role/add",component:L.a}),s.a.createElement(y.d,{path:"role/edit/:roleId",component:R.a})),s.a.createElement(y.d,{path:"/console",component:oe},s.a.createElement(y.b,{component:Oe}),s.a.createElement(y.d,{path:"resourceManage",component:Oe}),s.a.createElement(y.d,{path:"clusterManage",component:He}),s.a.createElement(y.d,{path:"clusterManage/editCluster",component:pt}))),ht=function(e){function t(){return p()(this,t),v()(this,(t.__proto__||d()(t)).apply(this,arguments))}return k()(t,e),h()(t,[{key:"render",value:function(){var e=this.props,t=e.store,a=e.history;return s.a.createElement(C.a,{store:t},s.a.createElement(y.e,{routes:ft,history:a,key:Math.random(),onEnter:function(){}}))}}]),t}(s.a.Component);it=ht,ot=a("/AHB").default,ct=Object(c.a)(ot,"hash"),ut=ct.store,dt=ct.history,i.a.render(s.a.createElement(o.AppContainer,null,s.a.createElement(it,{store:ut,history:dt})),document.getElementById("app"))}},[["YHBf",2,0,1,35,3]]]);